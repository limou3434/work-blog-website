{"content":"<blockquote>\n<p>前要：在网络服务中，如果对 <code v-pre>CURD</code> 不加限制，会出现什么问题？</p>\n<p>在多个客户端同时向一个卖票服务器买票时（假设票数只剩一张），<code v-pre>A</code> 客户端让数据库内的票数 <code v-pre>count</code> 减 <code v-pre>1</code>，但是还没来得及更新数据，又有 <code v-pre>B</code> 服务器查询数据库，此时 <code v-pre>B</code> 服务器看到票数还是 <code v-pre>1</code>，又进行了减 <code v-pre>1</code> 操作，导致一张票被同时卖了两次。</p>\n</blockquote>\n<p><code v-pre>CURD</code> 的过程需要满足什么条件，才能解决上述问题呢？</p>\n<ol>\n<li>买票的过程得应该是原子操作（要么抢到，要么没抢）</li>\n<li>买票的过程中不能被相互影响（不能被互相影响，要割裂/独立开来）</li>\n<li>买完票后应该要永久有效（必须要做持久化，不能只是在内存中操作）</li>\n<li>ef</li>\n<li>买前和买后都是确定的状态（不能出现中间状态，要保证一致性）</li>\n</ol>\n<h1 id=\"_1-事务的理解\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-事务的理解\"><span>1.事务的理解</span></a></h1>\n<h2 id=\"_1-1-事务的概念\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-1-事务的概念\"><span>1.1.事务的概念</span></a></h2>\n<p>事务简单来理解就是 <strong>一组 DML 语句</strong>，也就是一组用于数据操作（插入数据、删除数据...）的语句。</p>\n<p>事务主要处理操作量大，复杂度高的数据，这些数据往往需要多条 <code v-pre>SQL</code> 语句来构成。</p>\n<p>但是事务还不仅仅是多条语句的集合，还必须保证四个属性（<code v-pre>ACID</code>）才能保证安全运行事务：</p>\n<ul>\n<li>\n<p><strong>原子性(Atomicity)</strong>：一组 <code v-pre>DML</code> 语句/一个事务，要么全部成功，要么全部失败，这是由 <code v-pre>MySQL</code> 提供的机制来保障的。</p>\n</li>\n<li>\n<p><strong>一致性(Consistency)</strong>：在事务开始和结束以后，数据库的完整性没有被破坏，写入的数据必须完全符合所有的预设规则（在 <code v-pre>MySQL</code> 中，一致性时被其他三个属性来保证的，但是需要数据库和用户来配合，才能得到一致性）</p>\n</li>\n<li>\n<p><strong>隔离性(Isolation)</strong>：防止多个事务并发执行时由于交叉执行导致的数据不一致问题，事务隔离有不同的等级</p>\n<p>(1)读未提交（<code v-pre>Read Uncommitted</code>）</p>\n<p>(2)读提交（<code v-pre>Read Committed</code>）</p>\n<p>(3)可重复读（<code v-pre>Repeatable Read</code>）</p>\n<p>(4)串行化（<code v-pre>Serialzable</code>）</p>\n</li>\n<li>\n<p><strong>持久性(Durability)</strong>：事务处理完后，对表中数据的影响是永久的（哪怕系统挂了也不会丢失），也就是持久化</p>\n</li>\n</ul>\n<blockquote>\n<p>注意：学习事务一定要在使用数据库的用户视角来理解。</p>\n</blockquote>\n<p>事务在 <code v-pre>MySQL</code> 内也一定是一个具体对象，这就需要先描述再组织。</p>\n<p>另外，事务不是 <code v-pre>MySQl</code> 天然就存在，而是为了在应用程序访问数据库的时候，能够简化编程模型，不需要考虑各种潜在并发问题、网络问题，用户只需要提交和回滚。因此，事务的本质是为了应用层服务的，而不是面向数据库内部。</p>\n<h2 id=\"_1-2-事务的版本\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-事务的版本\"><span>1.2.事务的版本</span></a></h2>\n<p><code v-pre>MySQL</code> 中只有使用了 <code v-pre>Innodb</code> 数据库引擎的数据库或数据表才可以支持事务，其他基本都不支持。</p>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 查看 MySQL 的引擎是否支持事务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">show engines \\G</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">***************************</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">. </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">row</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> ***************************</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">      Engine: InnoDB</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Support: </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">DEFAULT</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Comment: Supports transactions, </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">row</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">level</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> locking, </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">and</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> foreign keys</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Transactions: YES</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">          XA: YES</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  Savepoints: YES</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">***************************</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">. </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">row</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> ***************************</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">      Engine: MRG_MYISAM</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Support: YES</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Comment: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Collection</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> of identical MyISAM tables</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Transactions: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">          XA: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  Savepoints: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">***************************</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">. </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">row</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> ***************************</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">      Engine: MEMORY</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Support: YES</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Comment: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Hash</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> based, stored </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">in</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> memory, useful </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> temporary tables</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Transactions: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">          XA: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  Savepoints: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">***************************</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 4</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">. </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">row</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> ***************************</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">      Engine: BLACKHOLE</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Support: YES</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Comment: </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">/</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">dev</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">/</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">null</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> storage engine (anything you write </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">to</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> it disappears)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Transactions: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">          XA: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  Savepoints: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">***************************</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 5</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">. </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">row</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> ***************************</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">      Engine: MyISAM</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Support: YES</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Comment: MyISAM storage engine</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Transactions: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">          XA: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  Savepoints: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">***************************</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">. </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">row</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> ***************************</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">      Engine: CSV</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Support: YES</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Comment: CSV storage engine</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Transactions: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">          XA: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  Savepoints: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">***************************</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 7</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">. </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">row</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> ***************************</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">      Engine: ARCHIVE</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Support: YES</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Comment: Archive storage engine</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Transactions: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">          XA: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  Savepoints: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">***************************</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 8</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">. </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">row</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> ***************************</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">      Engine: PERFORMANCE_SCHEMA</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Support: YES</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Comment: Performance </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Schema</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Transactions: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">          XA: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  Savepoints: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">***************************</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 9</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">. </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">row</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> ***************************</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">      Engine: FEDERATED</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Support: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Comment: Federated MySQL storage engine</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Transactions: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NULL</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">          XA: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NULL</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  Savepoints: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NULL</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">9</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h1 id=\"_2-事务的操作\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-事务的操作\"><span>2.事务的操作</span></a></h1>\n<h2 id=\"_2-1-做一些准备工作\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-1-做一些准备工作\"><span>2.1.做一些准备工作</span></a></h2>\n<p>开始之前，先设置一下隔离性（后面提及）。</p>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 设置隔离性</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> global</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> transaction</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> isolation</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> level</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> READ</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> UNCOMMITTED</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> @@tx_isolation;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| @@tx_isolation   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">READ</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">UNCOMMITTED</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> warning (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>首先，事务有两种提交方式：</p>\n<ul>\n<li>自动提交</li>\n<li>手动提交</li>\n</ul>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 查看事务提交方式</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> show variables </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">like</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">autocommit</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| Variable_name | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Value</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| autocommit    | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">ON</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">01</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>可以用 <code v-pre>SET</code> 来改变 <code v-pre>MySQL</code> 的自动提交方式。</p>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 取消事务自动提交</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> autocommit</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> show variables </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">like</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">autocommit</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| Variable_name | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Value</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| autocommit    | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">OFF</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> autocommit</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> show variables </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">like</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">autocommit</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| Variable_name | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Value</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| autocommit    | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">ON</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>然后我们切换超级用户，使用 <code v-pre>netstat -nltp</code> 是一个用于显示网络连接、路由表和网络接口信息的命令行工具查看 <code v-pre>MySQL</code> 是否成功运行且占用端口号。</p>\n<div class=\"language-cmd line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"cmd\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-cmd\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 查看网络状态</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">netstat</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">nltp</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Active Internet </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">connections</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">only</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> servers</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Proto </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Recv</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Q</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> Send</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Q</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> Local Address           Foreign Address         State       </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">PID</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">/</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Program</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> name    </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> tcp6       </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">      0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> :::</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3306</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                 :::</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                    LISTEN      </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">7404</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">/</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">mysqld</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>原本是应该使用 <code v-pre>Windows11</code> 的 <code v-pre>cmd</code> 来远程访问 <code v-pre>Centos7</code> 云服务的 <code v-pre>MySQL</code> 服务，不过需要提前在 <code v-pre>Windows11</code> 中提前下载好 <code v-pre>MySQL</code>，所以我们先用本地的两个客户端来模拟，后续再来详细了解。</p>\n<p>然后修改事务等级，不然有些现象会看不到。</p>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端中设置事务隔离级别并且重启检查</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> global</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> transaction</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> isolation</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> level</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> read</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> uncommitted</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> quit</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Bye</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">$ mysql </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">uroot </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">p</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Enter </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">password</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Welcome </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">to</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> the MySQL monitor.  Commands </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">end</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> with</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> ; </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">or</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> \\g.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Your MySQL </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">connection</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> id </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">is</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 32</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Server</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> version</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">5</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">7</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">44</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> MySQL Community </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Server</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (GPL)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Copyright (c) </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2000</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2023</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, Oracle </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">and</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">/</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">or</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> its affiliates.</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Oracle </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">is</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> a registered trademark of Oracle Corporation </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">and</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">/</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">or</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> its</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">affiliates. Other names may be trademarks of their respective</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">owners.</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Type</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">help;</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> or</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">\\h</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> help. </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Type</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">\\c</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> to</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> clear</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> the current input </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">statement</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> @@tx_isolation;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| @@tx_isolation   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">READ</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">UNCOMMITTED</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> warning (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>启动两个 <code v-pre>MySQL</code> 客户端（模拟并发场景），然后其中一个客户端建立一个如下的表结构：</p>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端1：创建表结构</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">create</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> table</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> if</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> not</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> exists</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account(</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">id </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> primary key</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> varchar</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">50</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">not null</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> default</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> ''</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">blance </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">decimal</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">10</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">not null</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> default</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">)ENGINE</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">InnoDB </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">DEFAULT</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> CHARSET</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">UTF8;</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端2：查看是否能看到 account 数据表</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> desc</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">--------+---------------+------+-----+---------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| Field  | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Type</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">          | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Null</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Key</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">Default</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | Extra |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">--------+---------------+------+-----+---------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id     | </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">)       | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">   | PRI | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NULL</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    |       |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">   | </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">varchar</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">50</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">)   | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">   |     |         |       |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| blance | </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">decimal</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">10</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">   |     | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    |       |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">--------+---------------+------+-----+---------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>可以在一个客户端中查看连接情况，可以看到确实存在两个本地客户端。</p>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端1：查看 MySQL 的连接情况</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> show processlist\\G</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">***************************</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">. </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">row</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> ***************************</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Id: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">33</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">   User: ljp</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">   Host: localhost</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     db: limou_database</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Command: Query</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">   Time</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">  State</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: starting</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">   Info: show processlist</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">***************************</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">. </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">row</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> ***************************</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Id: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">34</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">   User: ljp</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">   Host: localhost</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     db: limou_database</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Command: Sleep</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">   Time</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">355</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">  State</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">   Info: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NULL</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2 id=\"_2-2-正常情况的事务\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-2-正常情况的事务\"><span>2.2.正常情况的事务</span></a></h2>\n<p>启动事务有两种方法：(1)<code v-pre>start transaction;</code> (2)<code v-pre>begin</code></p>\n<p>一旦开启事务，后续的 <code v-pre>SQL</code> 操作都属于同一个事务的部分。并且，我还设置了一个保存点（可选）</p>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端1：启动事务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> start transaction</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> savepoint s1;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端2：启动事务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> begin</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Empty</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>然后进行插入工作，设置第二个保存点，并且查看插入的数据是否同步到另外一个客户端。</p>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端1：插入数据</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> insert into</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">values</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">limou</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">10000</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> savepoint s2;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端2：查看数据</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">10000</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>尝试插入更多的插入和设置保存点的操作，同时没插入一个记录，就检查客户端是否数据同步。</p>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端1：插入数据和保存</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> savepoint s2;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> insert into</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">values</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">dimou</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> savepoint s3;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> insert into</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">values</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">iimou</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">10431</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端2：每次插入，就查看一次数据表</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">10000</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">10000</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | iimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">10431</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>如果我们突然后悔了，可以回滚事务。</p>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端1：回滚事务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rollback</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> to</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> s3;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端2：查看回滚后的数据表</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">10000</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>可以看到，数据表确实发生了回退，如果我们这个时候使用 <code v-pre>COMMIT</code> 就会提交本次事务。</p>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端1：提交事务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> commit</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">01</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><blockquote>\n<p>补充：使用 <code v-pre>roolback</code> 还可以将所有操作全部取消，但是一般很少这么做。</p>\n</blockquote>\n<p>而事务只有在启动的时候才可以进行回滚操作，而一旦提交了就无法进行回滚。</p>\n<h2 id=\"_2-3-异常情况的事务\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-3-异常情况的事务\"><span>2.3.异常情况的事务</span></a></h2>\n<p>如果其中一个服务端在事务状态下奔溃了会怎么样？其他客户端会自动回滚，也就是保证原子性，要么不做，要么就操作完。</p>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端1：不断插入数据最后因为异常导致奔溃，插入一次就在客户端2中查看一次</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> begin</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> insert into</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">values</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">eimou</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">20431</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">01</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> insert into</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">values</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">4</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">eimou</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">30434</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> ^C</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> Aborted</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端2：客户端1插入后不断查找数据表，最后检查奔溃后的数据表</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">10000</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">10000</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | eimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">20431</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">4</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | eimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">30434</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">4</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 奔溃后，这里自动发生了回滚，回到开头</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">10000</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>也有一些其他的情况会发生自动回滚（客户端因为关闭 <code v-pre>shell</code> 而导致退出），但是如果事务已经进行了提交（也就是使用了 <code v-pre>COMMIT</code>），就不会再进行回滚（包括因为崩溃造成的自动回滚）。</p>\n<p>但是我们之前设置的自动提交又是什么鬼？不是事务会自动提交吗？从现象来看，无论是设置 <code v-pre>autocommit</code> 为 <code v-pre>OFF</code> 还是 <code v-pre>ON</code> 现象都是一样的结果（这个您可以自己实验一下），那这个 <code v-pre>autocommit</code> 究竟有什么用呢？您先知道一个点，只要是手动开启启动事务，就必须手动提交，和是否设置自动提交无关即可。</p>\n<p>而对比有无设置 <code v-pre>autocommit</code>  的两种情况。</p>\n<h3 id=\"_2-3-1-设置为-off\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-3-1-设置为-off\"><span>2.3.1.设置为 OFF</span></a></h3>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端1：设置 autocommit 为 </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">OFF</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">，然后在事务中进行删除记录</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> show variables </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">like</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">autocommit</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| Variable_name | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Value</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| autocommit    | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">ON</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> autocommit</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> show variables </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">like</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">autocommit</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| Variable_name | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Value</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| autocommit    | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">OFF</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> delete</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">where</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> id</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">01</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> Aborted</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端2：不断查看数据表</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1没删除之前</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | timou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">50434</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1删除后</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1奔溃后，发现记录恢复</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | timou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">50434</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3 id=\"_2-3-2-设置为-on\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-3-2-设置为-on\"><span>2.3.2.设置为 ON</span></a></h3>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端1：进行删除操作，但是不在事务中删除后崩溃</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> show variables </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">like</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">autocommit</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| Variable_name | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Value</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| autocommit    | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">ON</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> delete</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">where</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> id</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">01</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> Aborted</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端2：不断查看数据表</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1没删除之前</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | timou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">50434</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1删除后</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1奔溃后，发现记录没有恢复</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>而且就算客户端 2 之前有做 <code v-pre>BEGIN</code>，再 <code v-pre>COMMIT</code> 后也不会恢复数据。</p>\n<p>以上测试说明，只要设置了 <code v-pre>autocommit</code>，就会把一条单纯的 <code v-pre>SQL</code> 语句单独看作一个事务，都会被自动 <code v-pre>BEGIN</code> 和 <code v-pre>COMMIT</code>。因此如果没设置 <code v-pre>autocommit</code> 就会因为没有 <code v-pre>COMMIT</code> 而导致数据回滚。</p>\n<blockquote>\n<p>复习：再理一理，<code v-pre>BEGIN</code> 是开启事务处理，<code v-pre>COMMIT</code> 是事务提交，防止回滚。</p>\n</blockquote>\n<p>但是如果我们手动进行回滚呢？</p>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端1：删除数据表，但是先 </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">commit</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> 再崩溃</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> show variables </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">like</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">autocommit</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| Variable_name | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Value</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| autocommit    | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">ON</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> autocommit</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> show variables </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">like</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">autocommit</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| Variable_name | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Value</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| autocommit    | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">OFF</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">01</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> delete</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">where</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> id</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> commit</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> Aborted</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端2：不断查看数据表</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1删除记录前</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1删除记录后</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Empty</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1崩溃后，没有发生回滚</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Empty</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>也侧面证明了：对于 <code v-pre>InnoDB</code> 里一条单纯的 <code v-pre>SQL</code> 就是一个完整的事务，最后都会因为 <code v-pre>autocommit=ON</code> 而自动提交（但是 <code v-pre>SELECT</code> 有点特殊，您先记住就行，因为 <code v-pre>MySQL</code> 有 <code v-pre>MVCC</code>）。</p>\n<blockquote>\n<p>补充：<code v-pre>COMMIT</code> 操作实际上就是数据持久化的一种手段。</p>\n</blockquote>\n<p>到这里就可以看到事务本身的 <strong>原子性（回滚）</strong> 和 <strong>持久性（提交）</strong>。</p>\n<h1 id=\"_3-事务的隔离\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-事务的隔离\"><span>3.事务的隔离</span></a></h1>\n<h2 id=\"_3-1-隔离和隔离级别\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-1-隔离和隔离级别\"><span>3.1.隔离和隔离级别</span></a></h2>\n<p>但是事务的隔离性体现在哪里呢？为何需要隔离呢？不隔离可以吗？</p>\n<p>一个 <code v-pre>MySQL</code> 服务可能会被多个客户端进程访问（一般都是程序直接连接数据库，命令行操作很少用到），访问的方式是以事务进行的。</p>\n<p>而事务在上述小节中实现了原子性和持久性，事务注定有执行前、执行中、执行后，一旦异常就会回滚。为了保证事务在执行中，为了保证事务尽量不受干扰，就产生的隔离性，根据不同的干扰级别可以设置不同的隔离级别。</p>\n<p>实际上，正常人的认知是：无论别的客户端 <code v-pre>A</code> 怎么对数据表怎么增删查改，另外一个客户端 <code v-pre>B</code> 要拿到最新的数据，不管两进程的先后顺序如何，都必须要先等待进程 <code v-pre>A</code> 完成一个事务。这个观点有问题吗？有点，举一个不恰当的例子，一个婴儿在出生后，不需要知道父母之前的经历，也能和父母一起创造新的经历，每个人只需要在自己生命周期内看到的世界也都是不一样的。这代表着：<strong>不一定需要获取最新的消息，只需要在自己的生命周期内看到该看到的就行，这就是隔离性</strong>。</p>\n<p>在 <code v-pre>MySQL</code> 中，原子性不仅是在操作上原子，还体现在时间上。一个改表的 <code v-pre>A</code> 客户端先执行事务，一个查表的 <code v-pre>B</code> 客户端后执行事务，两者在执行中交叉进行。而 <code v-pre>B</code> 客户端执行得较慢，<code v-pre>A</code> 客户端执行得较快，那么 <code v-pre>B</code> 客户端是否应该立刻获取最新的数据呢？不应该！因为要保证隔离性，隔离运行中的事务。</p>\n<p>因此隔离体现在运行事务中，而隔离性要隔离的程度就是隔离级别（根据内容重要度的不同，有些信息是可以不被隔离的，因此就有隔离级别），在交叉事务处理过程中，不同的事务级别分为：</p>\n<ul>\n<li><strong>读未提交(READ UNCOMMITTED)</strong>：所有事务都可以看到其他事务没有提交的执行结果（相当于没有任何隔离性，实际生产中不太可能用到这个级别），我们之前的书写的事务代码，就是读未提交，没有进行 <code v-pre>COMMIT</code> 也会看到事务中的操作后结果，而对方客户端一旦崩溃就和没有存在过一样，则本客户端发送回滚</li>\n<li><strong>读已提交(READ COMMITTED)</strong>：只有对事务进行了 <code v-pre>COMMIT</code>，才能看到更新的数据表（一条单纯的 <code v-pre>SQL</code> 语句本身就被包装成一个事务，因此使用单纯的 <code v-pre>SQL</code> 语句会让所有客户端都读取到）</li>\n<li><strong>可重复读(REPEATABLE READ)</strong>：即便对方客户端提交了，哪怕是退出了，本客户端都无法实时知道更新结果，只有在本客户端退出了再次启动，才能看到更新后的新数据（这是 <code v-pre>MySQL</code> 默认的隔离等级），但是可能会有幻读的问题。</li>\n<li><strong>串行化(SERIALIZABLE)</strong>：事务隔离的最高级别，强制事务进行排序，使之不会相互冲突，确实解决了幻读的问题，但是会导致超时和锁竞争（太极端了，实际生产中很少用）</li>\n</ul>\n<p>隔离级别，基本都是通过锁来实现的，不同的隔离级别使用的锁不一样，常见的有：表锁、行锁、读锁、写锁、间隙锁（<code v-pre>GAP</code>）、<code v-pre>Next-Key</code> 锁，简单认识一下就行。</p>\n<h2 id=\"_3-2-查看和设置隔离级别\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-2-查看和设置隔离级别\"><span>3.2.查看和设置隔离级别</span></a></h2>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 查看隔离级别</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> @@</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">global</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">tx_isolation</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">; # 全局设置</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">-----------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| @@</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">global</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">tx_isolation</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">-----------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">READ</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">UNCOMMITTED</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">      |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">-----------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> warning (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> @@</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">session</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">tx_isolation</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">; # 当前会话设置</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">------------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| @@</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">session</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">tx_isolation</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">------------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">READ</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">UNCOMMITTED</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">       |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">------------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> warning (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> @@tx_isolation; # 默认显示会话设置（就是当前会话的设置）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| @@tx_isolation   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">READ</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">UNCOMMITTED</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> warning (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>使用 <code v-pre>SET {SESSION/GLOBAL} TRANSACTION ISOLATION LEVEL {READ UNCOMMITTED/READ COMMITTED/REPEATABLE READ/SERIALIZABLE};</code> 就可以设置隔离级别。</p>\n<p>而如果设置了全局设置，只会在下一次重启客户端时才会更新设置，一般一开始设置了隔离级别就不要修改了，最好保证隔离级别是一致的。</p>\n<h2 id=\"_3-3-不同隔离级别带来的影响\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-3-不同隔离级别带来的影响\"><span>3.3.不同隔离级别带来的影响</span></a></h2>\n<p>再次强调，隔离主要是为了避免交叉事务出现问题。</p>\n<h3 id=\"_3-3-1-读未提交\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-3-1-读未提交\"><span>3.3.1.读未提交</span></a></h3>\n<blockquote>\n<p>复习：<strong>读未提交</strong>，所有事务都可以看到其他事务没有提交的执行结果（相当于没有任何隔离性，实际生产中不太可能用到这个级别），我们之前的书写的事务代码，就是读未提交，没有进行 <code v-pre>COMMIT</code> 也会看到事务中的操作后结果，而对方客户端一旦崩溃就和没有存在过一样，则本客户端发送回滚。</p>\n</blockquote>\n<p>实际上之前已经做过了，最上面从设置隔离级别为 <code v-pre>READ-UNCOMMITTED</code>，后续的操作都是读未提交情景下的操作。</p>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 设置隔离级别</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> global</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> transaction</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> isolation</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> level</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> READ</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> UNCOMMITTED</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 然后重启两个客户端，分别查看隔离等级</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> @@tx_isolation;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| @@tx_isolation   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">READ</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">UNCOMMITTED</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> warning (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端1：在事务中进行删除记录</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> autocommit</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> show variables </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">like</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">autocommit</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| Variable_name | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Value</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| autocommit    | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">OFF</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> delete</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">where</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> id</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">01</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> Aborted # 这里奔溃后，就相当于没有进行 </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">COMMIT</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端2：不断查看数据表</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1没删除之前</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | timou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">50434</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1删除后，还没提交就被读取到了，也就是“读未提交”</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1奔溃后，发现记录恢复</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | timou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">50434</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>这种未提交就可以被其他客户端读取的现象，也叫做 <strong>脏读</strong> 现象。</p>\n<h3 id=\"_3-3-2-读已提交\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-3-2-读已提交\"><span>3.3.2.读已提交</span></a></h3>\n<blockquote>\n<p>复习：<strong>读已提交</strong>，只有对事务进行了 <code v-pre>COMMIT</code>，才能看到更新的数据表（一条单纯的 <code v-pre>SQL</code> 语句本身就被包装成一个事务，因此使用单纯的 <code v-pre>SQL</code> 语句会让所有客户端都读取到）。</p>\n</blockquote>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 设置隔离级别</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> global</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> transaction</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> isolation</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> level</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> READ</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> COMMITTED</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 然后重启两个客户端，分别查看隔离等级</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> @@</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">global</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">tx_isolation</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">-----------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| @@</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">global</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">tx_isolation</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">-----------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">READ</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">COMMITTED</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">-----------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> warning (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端1进行修改数据表</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> begin</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> update</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">set</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> name</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">rimou</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> where</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> id</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> matched</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  Changed: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  Warnings: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> commit</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">01</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端2不断进行查看</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> begin</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 没修改之前</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance  |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1001</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1023</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | eimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2034</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1修改数据，但是没有进行 </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">commit</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">，继续在客户端2查看，发现数据仍旧没有被修改</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance  |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1001</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1023</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | eimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2034</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1使用 </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">commit</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">，此时客户端2就会发现数据被修改了</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance  |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1001</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | rimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1023</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | eimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2034</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>这种提交才可以被其他客户端读取的现象，在提交之前只能获得旧数据，这要看具体场景，才能决定是对是错的。</p>\n<p>读提交有一个问题，一旦服务端 1 提交了，哪怕客户端 2 还处于事务中，也会读取到更新的数据，这在某些场景是错误的。理论上插入后更新数据表难道有错吗？有可能有错，提交确实是要让所有事务看到，但有时候不应该让运行中的事务看到（后面有个例子）。</p>\n<h3 id=\"_3-3-3-可重复读\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-3-3-可重复读\"><span>3.3.3.可重复读</span></a></h3>\n<blockquote>\n<p>复习：<strong>可重复读</strong>，即便对方客户端提交了，哪怕是退出了，本客户端都无法实时知道更新结果，只有在本客户端退出了再次启动，才能看到更新后的新数据（这是 <code v-pre>MySQL</code> 默认的隔离等级），但是会有幻读的问题。</p>\n</blockquote>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 设置隔离等级</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> show variables </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">like</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">autocommit</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| Variable_name | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Value</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| autocommit    | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">ON</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">01</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> global</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> transaction</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> isolation</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> level</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> REPEATABLE</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> READ</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> @@</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">global</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">tx_isolation</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">-----------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| @@</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">global</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">tx_isolation</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">-----------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">REPEATABLE</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">READ</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">       |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">-----------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> warning (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端1：更新数据表</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> begin</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> update</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">set</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> name</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">iimou</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> where</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> id</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> matched</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  Changed: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  Warnings: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> commit</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端2：不断查看，奔溃后再次查看</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> begin</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 在没有更新数据表内记录之前查询</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance  |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1001</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | rimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1023</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | eimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2034</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 更新数据表内记录后查询</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance  |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1001</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | rimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1023</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | eimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2034</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 在客户端1 </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">commit</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> 后再次查询</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance  |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1001</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | rimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1023</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | eimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2034</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> Aborted </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> # 客户端2奔溃了...</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">$ mysql</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Welcome </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">to</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> the MySQL monitor.  Commands </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">end</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> with</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> ; </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">or</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> \\g.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Your MySQL </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">connection</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> id </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">is</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 54</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Server</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> version</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">5</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">7</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">44</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> MySQL Community </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Server</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (GPL)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Copyright (c) </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2000</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2023</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, Oracle </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">and</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">/</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">or</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> its affiliates.</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Oracle </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">is</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> a registered trademark of Oracle Corporation </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">and</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">/</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">or</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> its</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">affiliates. Other names may be trademarks of their respective</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">owners.</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Type</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">help;</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> or</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">\\h</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> help. </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Type</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">\\c</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> to</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> clear</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> the current input </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">statement</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> use</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> limou_database;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Reading </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">table</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> information </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> completion of </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">table</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> and</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> column names</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">You can turn </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">off</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> this feature </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">to</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> get</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> a quicker startup </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">with</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">A</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Database</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> changed</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 在客户端2奔溃后重新启动</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance  |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1001</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | rimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1023</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | iimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2034</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |  # 发现这里终于被修改了</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><blockquote>\n<p>例子：举一个超级生动具体的例子</p>\n<p>一家公司招聘程序员时，原本规定了一个工作等级，于是开始招聘员工，假设招进了 <code v-pre>A</code> 程序员，<code v-pre>A</code> 程序员和 <code v-pre>HR</code> 敲定了自己的工资等级，最后成功入职。问题是，假设公司新出现了一个大型项目，需要招聘大量程序员，于是提高了薪资等级中的工资量。果然成功吸引了程序员 <code v-pre>B</code>，程序员 <code v-pre>B</code> 和 <code v-pre>HR</code> 谈拢后，确定了和程序员 <code v-pre>A</code> 一样的等级，但是薪资却更高。</p>\n<p>而对于公司（黑心的）来说，不会直接告诉 <code v-pre>A</code> 你这个等级的薪资提高了，所以我要给你提薪...<code v-pre>A</code> 需要知道吗？不需要，你继续做你的工作就行了，在 <code v-pre>A</code> 的认知中，自己这个等级的薪资就是原先谈好的那么高。</p>\n<p>而一旦那一天工资项目出现问题，要进行裁员，就把 <code v-pre>A</code> 给“优化”（裁员）了，但是最后公司发现，自己貌似开走了一个“大动脉”（你之前写的代码逻辑非常重要，没 <code v-pre>A</code> 不行的那种），最后又把你找回来，按照 <code v-pre>B</code> 的薪资招聘你。</p>\n<p>这就是“可重复读”，<code v-pre>A</code> 始终用的是旧的薪资等级来判断薪资，但是后来的 <code v-pre>B</code> 却是更新后的第二套薪资体系，可是在 <code v-pre>A</code> 就职期间（被重新招聘前），没必要知道更新后的薪资等级（不然 <code v-pre>A</code> 闹起来怎么办，笑）。</p>\n<blockquote>\n<p>员工 <code v-pre>A</code>：客户端 1</p>\n<p>员工 <code v-pre>B</code>：客户端 2</p>\n<p><code v-pre>A</code> 就职期间：客户端 1 启动事务期间</p>\n<p><code v-pre>B</code> 就职期间：客户端 2 启动事务期间</p>\n<p><code v-pre>A</code> 离职时：客户端 1 结束事务进行提交</p>\n</blockquote>\n</blockquote>\n<p>但是，在一些数据库中，在可重复隔离下，<code v-pre>insert</code> 的 <code v-pre>sql</code> 可能无法被屏蔽（因为隔离性是通过加锁和其他策略来实现的，但是混则很难通过加锁来实现），在多次查询的过程中，就有可能会查出更新的数据（也就是“幻读”）。但是 <code v-pre>MySQL</code> 中，在 <code v-pre>RR</code> 级别中修复了这个问题（使用 <code v-pre>GAP+行锁</code>），我们不在这里深入了解，这也是为什么该级别是默认级别的原因。</p>\n<h3 id=\"_3-3-4-串行化\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-3-4-串行化\"><span>3.3.4.串行化</span></a></h3>\n<blockquote>\n<p>复习：<strong>串行化</strong>，事务隔离的最高级别，强制事务进行排序，使之不会相互冲突，确实解决了幻读的问题，但是会导致超时和锁竞争（太极端了，实际生产中很少用）</p>\n</blockquote>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 设置隔离级别</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> global</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> transaction</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> isolation</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> level</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> SERIALIZABLE</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">01</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> @@</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">global</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">tx_isolation</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">-----------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| @@</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">global</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">tx_isolation</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">-----------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">SERIALIZABLE</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">          |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">-----------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> warning (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端1较后开启事务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> begin</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> update</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">set</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> name</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">eimou</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> where</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> id</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 陷入阻塞状态，知道客户端2进行 </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">commit</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> 后才执行这条 </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">sql</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">14</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">32</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> matched</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  Changed: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  Warnings: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> commit</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">01</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端2较先开启事务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> begin</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1还没修改前</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance  |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1001</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | rimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1023</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | iimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2034</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1修改后</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance  |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1001</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | rimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1023</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | iimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2034</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> commit</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端2提交后查看</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance  |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1001</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | rimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1023</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | iimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2034</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> Aborted # 客户端2崩溃、</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">$ mysql</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Welcome </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">to</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> the MySQL monitor.  Commands </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">end</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> with</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> ; </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">or</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> \\g.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Your MySQL </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">connection</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> id </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">is</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 61</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Server</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> version</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">5</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">7</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">44</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> MySQL Community </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Server</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (GPL)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Copyright (c) </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2000</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2023</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, Oracle </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">and</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">/</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">or</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> its affiliates.</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Oracle </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">is</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> a registered trademark of Oracle Corporation </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">and</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">/</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">or</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> its</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">affiliates. Other names may be trademarks of their respective</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">owners.</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Type</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">help;</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> or</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">\\h</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> help. </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Type</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">\\c</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> to</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> clear</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> the current input </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">statement</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> use</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> limou_database;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Reading </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">table</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> information </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> completion of </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">table</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> and</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> column names</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">You can turn </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">off</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> this feature </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">to</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> get</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> a quicker startup </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">with</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">A</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Database</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> changed</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 重启后再次查看就发现依旧没有被修改</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance  |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1001</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | rimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1023</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | iimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2034</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 只有客户端1提交了，才能看到修改</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance  |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1001</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | eimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1023</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | iimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2034</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>注意，是事务之间串行化，不是进程之间串行化！</p>\n<p>以上隔离等级就是 <strong>隔离性</strong> 的体现，而怎么体现一致性呢？</p>\n<p>事务执行的结果，必须使数据库的一个一致性状态，转移到另外一个一致性状态。如果系统发生中断，某个事务未完成而被迫中止，而为改完的事务对数据库所做的修改已经写入数据库，此时数据库处于不正确、不一致的状态。因此是通过原子性（回滚）来保证一致的（而一致性和用户的逻辑强相关，由用户决定）。而其他三属性实际上都是围绕一致性来展开的，可以说 <code v-pre>AID</code> 是因，用户配合，<code v-pre>C</code> 是果。</p>\n<blockquote>\n<p>注意：这关于事务这块还是比较复杂的，建议深入了解，反复学习。</p>\n</blockquote>\n<h1 id=\"_4-隔离性的原理\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_4-隔离性的原理\"><span>4.隔离性的原理</span></a></h1>\n<p>数据库事务的并发场景有三个：</p>\n<ul>\n<li><code v-pre>读-读</code>：不存在任何问题，因此不需要并发控制</li>\n<li><code v-pre>读-写</code>：有线程安全问题，可能造成事务隔离性问题（脏读、幻读、不可重复读），这种情况是主要的</li>\n<li><code v-pre>写-写</code>：有线程安全问题，可能存在更新丢失问题（第一类更新丢失、第二类更新丢失）</li>\n</ul>\n<p><code v-pre>读-读</code> 我们几乎不需要讨论，重点讨论 <code v-pre>读-写</code> 的实现，不讨论 <code v-pre>写-写</code> 的实现。</p>\n<p>而多版本并发控制（<code v-pre>MVCC</code>）是一种用来解决 <code v-pre>读-写冲突</code> 的无锁并发控制。</p>\n<blockquote>\n<p>注意：理解 <code v-pre>MVCC</code> 必须先理解几个周边知识。</p>\n<ul>\n<li>事务的 <code v-pre>ID</code></li>\n<li>三个隐藏字段</li>\n<li><code v-pre>undo</code> 日志</li>\n</ul>\n</blockquote>\n<h2 id=\"_4-1-事务的-id\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_4-1-事务的-id\"><span>4.1.事务的 ID</span></a></h2>\n<p>为事务分配单向增长的事务 <code v-pre>ID</code>，为每个修改保存一个版本，版本与事务 <code v-pre>ID</code> 关联，读操作只读该事务开始前的数据快照，所以 <code v-pre>MVCC</code> 可以为数据库解决：</p>\n<ol>\n<li>并发读写数据库时，可以做到在\n(1)读操作时不用阻塞写操作\n(2)写操作时不用阻塞读操作\n提高了数据库并发读写的性能</li>\n<li>同时可以解决：\n(1)脏读（未提交就可以被其他客户端读取）\n(2)幻读（在多次查询的过程中查出更加新的数据）\n(3)不可重复读（对方客户端提交，本客户端就会立刻看到更新结果）</li>\n</ol>\n<p>事务 <code v-pre>ID</code> 越小，事务到来的顺序越靠前。</p>\n<p><code v-pre>MySQL</code> 底层是 <code v-pre>C/C++</code> 编写的，因此内部事务也一定是有对应的结构体/类，内部有事务的属性和方法，再生成事务实例进行组织（使用特点的数据结构进行组织）。</p>\n<p>而事务 <code v-pre>ID</code> 也一定是事务结构体内部的属性之一，此外还有其他的属性。</p>\n<h2 id=\"_4-2-三个隐藏字段\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_4-2-三个隐藏字段\"><span>4.2.三个隐藏字段</span></a></h2>\n<p>在数据表中，隐藏三个字段：</p>\n<ol>\n<li><code v-pre>DB_TRX_ID</code>：<code v-pre>6 byte</code>，记录创建这条记录，且最后一次修改（修改/插入）该记录的事务 <code v-pre>ID</code>（因此很容易对操作进行溯源）</li>\n<li><code v-pre>DB_ROLL_PTR</code>：<code v-pre>7 byte</code>，回滚指针，指向这条记录的上一个版本（简单理解成指向历史版本，这些数据一般都在 <code v-pre>undo log</code> 中。<code v-pre>MySQL</code> 在修改一条记录的时候，仍会保留该记录，然后再复制一份去修改，有点类似“写时拷贝”）</li>\n<li><code v-pre>DB_ROW_ID</code>：<code v-pre>6 byte</code>，隐含的自增 <code v-pre>ID</code>（也就是我们以前在索引里提到的隐藏主键），如果数据表没有主键，<code v-pre>InnoDB</code> 会自动以 <code v-pre>DB_ROW_ID</code> 产生一个聚簇索引（而如果用户设定了主键，就会导致该字段无效，因为一个表只能有一个主键）</li>\n<li><code v-pre>FLAG</code>：记录被更新或删除并不代表真的删除，而是 <code v-pre>flag</code> 变了，等到刷盘的时候再修改磁盘内的数据，并且如果希望恢复，也可以恢复该字段，达到恢复数据有效性的</li>\n</ol>\n<h2 id=\"_4-3-undo-日志\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_4-3-undo-日志\"><span>4.3.undo 日志</span></a></h2>\n<p>在提及 <code v-pre>undo</code> 日志之前，我们还需要提及下 <code v-pre>MySQL</code> 里的日志模块，<code v-pre>undo</code> 就是撤销的意思，本质是 <code v-pre>MySQL</code> 使用 <code v-pre>new/malloc()</code> 申请出来的一块内存空间，在内存种运行，临时性非常高。</p>\n<blockquote>\n<p>补充：我们之前提及的所有机制，索引、事务、隔离性、日志等，都是在内存种完成的操作，然后在特定的时候进行刷盘。</p>\n</blockquote>\n<h2 id=\"_4-4-模拟-mvcc\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_4-4-模拟-mvcc\"><span>4.4.模拟 MVCC</span></a></h2>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 创建一个用于解释的表结构</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> create</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> table</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> if</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> not</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> exists</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> student(</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    -></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> name</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> varchar</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">not null</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    -></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> age </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> not null</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    -></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> );</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">04</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>假设创建了上述表结构，此时数据表字段结构如下：</p>\n<table>\n<thead>\n<tr>\n<th>name</th>\n<th>age</th>\n<th>DB_TRX_ID(创建对应记录的事务 ID)</th>\n<th>DB_ROW_ID(隐式主键)</th>\n<th>DB_ROLL_PTR(回滚指针)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>limou</td>\n<td>18</td>\n<td>9（假设是 <code v-pre>9</code> 号 <code v-pre>ID</code> 的事务插入的）</td>\n<td>1</td>\n<td>null</td>\n</tr>\n</tbody>\n</table>\n<p>现在有一个事务 <code v-pre>ID=10</code> 的事务，封装内含操作为：修改 <code v-pre>name='limou'</code> 为 <code v-pre>name='dimou'</code> 的 <code v-pre>SQL</code> 语句。</p>\n<p>在修改前，先将原本未修改的记录 <code v-pre>[limou,18,9,1,null]</code> 加锁，然后保存/拷贝一份，放入 <code v-pre>undo log</code>，给予这条被保存的记录一个内存地址，假设是 <code v-pre>0xaa</code>。</p>\n<p>此时回到原来的记录，现在要对其进行修改：</p>\n<ol>\n<li><code v-pre>DB_ROLL_PTR=null</code> 变为 <code v-pre>DB_ROLL_PTR=0xaa</code>，这就是保存了一个版本</li>\n<li><code v-pre>name='limou'</code> 变为 <code v-pre>name='daimou'</code></li>\n<li><code v-pre>DB_TRX_ID=9</code> 变为 <code v-pre>DB_TRX_ID=10</code></li>\n<li><code v-pre>DB_ROW_ID=1</code> 变为 <code v-pre>DB_ROW_ID=2</code></li>\n</ol>\n<p>最后进行 <code v-pre>COMMIT</code> 时，释放该记录的锁，因此修改记录是原子的，保证串行化。</p>\n<table>\n<thead>\n<tr>\n<th>name</th>\n<th>age</th>\n<th>DB_TRX_ID(创建对应记录的事务 ID)</th>\n<th>DB_ROW_ID(隐式主键)</th>\n<th>DB_ROLL_PTR(回滚指针)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>dimou</td>\n<td>18</td>\n<td>10</td>\n<td>2</td>\n<td>0xaa</td>\n</tr>\n</tbody>\n</table>\n<p>假设这个时候又有一个事务 <code v-pre>ID=11</code> 的事务，该事务修改 <code v-pre>age=28</code>。也是要修改记录，那这条记录是哪一个记录的呢？首先排除历史记录，历史记录必须是稳定的，最好一次写入的。</p>\n<p>因此只能改最新的记录，能直接改么？不能！需要先复制一份记录 <code v-pre>[dimou,18,10,2,0xaa]</code> 到 <code v-pre>undo log</code> 中，然后再进行和第一次插入记录时一样的操作。</p>\n<blockquote>\n<p>注意：此时在 <code v-pre>undo log</code> 中的历史记录的字段 <code v-pre>DB_ROLL_PTR</code> 是相互链接的，形成版本链链表。</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>name</th>\n<th>age</th>\n<th>DB_TRX_ID(创建对应记录的事务 ID)</th>\n<th>DB_ROW_ID(隐式主键)</th>\n<th>DB_ROLL_PTR(回滚指针)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>dimou</td>\n<td>28</td>\n<td>11</td>\n<td>3</td>\n<td>0xbb</td>\n</tr>\n</tbody>\n</table>\n<p>而所谓的回滚操作，不就是对版本链链表的操作么（当然，肯定还有很多其他细节，这里不敢细细深究，我们这里简单来理解就行）。</p>\n<blockquote>\n<p>补充：实际上回滚时，不是直接把历史记录覆盖到数据表中的，而是和操作记录相反的 <code v-pre>SQL</code> 语句，如果需要回滚，只需要执行这些相反的操作就可以了（用户进行插入，<code v-pre>MySQL</code> 就记录一条相反的删除语法，方便以后回滚数据）。</p>\n</blockquote>\n<p>上面的版本链模型就是 <strong>多版本并发控制（<code v-pre>MVCC</code>）</strong> 的体现，其中每一个版本我们习惯称为一个 <strong>快照</strong>。</p>\n<p>那如果操作过多，<code v-pre>undo log</code> 会不会被塞满呢？首先 <code v-pre>undo log</code> 是一个内存级的。对于一个事务来说，一旦被 <code v-pre>COMMIT</code> 就会被 <code v-pre>delete/free()</code> 释放空间，内部的快照也会被清除（这也就是为什么 <code v-pre>COMMIT</code> 后的事务无法回滚的原因）。</p>\n<p>那在什么时候会持续保存快照数据？多事务的时候，有的时候访问的不是最新记录，而是历史记录（<code v-pre>undo log</code> 主要是配合隔离性设置的）。</p>\n<p>那如果删除数据呢？简单，设置 <code v-pre>flag</code> 就行，也是形成版本链/快照。</p>\n<p>那插入怎么办？数据表中本来就没有，那是怎么回滚的呢？记录和 <code v-pre>insert</code> 相反的 <code v-pre>delete</code> 操作即可，同样可以形成版本链/快照。</p>\n<p>那 <code v-pre>select</code> 呢？其本身只是查看数据表中的记录，版本记录没有意义，但是会有一个问题：<code v-pre>select</code> 该去查看哪一个版本的快照呢？</p>\n<p>首先我们定义读的方式：</p>\n<ul>\n<li><strong>当前读</strong>：读取到最新的数据，增删改数据表都涉及到当前读，而 <code v-pre>select</code> 有可能是当前读</li>\n<li><strong>快照读</strong>：读取到快照/历史版本就叫做快照读，一般是 <code v-pre>select</code> 在快照读</li>\n</ul>\n<p>读写并发时，如果是读取不同版本数据表，并且设置了隔离级别，这就注定是读取不同资源，也就无需加锁，因此就可以并发进行读写操作（当然，如果都是读操作都是当前读，也还是需要加锁的，因为是同一份最新的资源）。</p>\n<p>基本数据被其他客户端改了，只要读取的版本固定，就一定不会让不同的读取受到影响，进一步就是发生了隔离，这种就是在“版本上做隔离”！</p>\n<p><strong>而隔离级别的设置，就是对一个事务使用 <code v-pre>select</code> 能看到哪一个版本的设置</strong>。到此，隔离性会让所有并发执行事务看到不同的数据的基础也就找出来了（这是一个即提高效率，又为后续隔离性做铺垫的非常完美的方案）。</p>\n<p>因此隔离性、回滚，都是基于 <code v-pre>MVCC</code> 来控制、设置的。</p>\n<p>而串行化实际上就可以简单理解为，读写操作都要求加锁，导致事务变得串行化。</p>\n<p>为什么设置不同的隔离级别？首先事务是原子的，一定有先后顺序，从 <code v-pre>BEGIN</code> 到 <code v-pre>COMMIT</code> 一定是有一个过程的，多个事务中，让不同的事务看到它那个时间点该看到的数据（至于看到什么信息，是需要根据情况来抉择的，进而选择不同的隔离级别）。</p>\n<h2 id=\"_4-5-read-view\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_4-5-read-view\"><span>4.5.Read View</span></a></h2>\n<p><code v-pre>Read View</code> 就是事物进行快照读操作时生产的读视图，在事物执行的快照读那一刻，会生成数据库系统中一个快照，记录并维护系统当前活跃事务的 <code v-pre>ID</code>，这个 <code v-pre>ID</code> 是递增，所以最新的事务 <code v-pre>ID</code> 值越大。</p>\n<p>而 <code v-pre>Read View</code> 在 <code v-pre>MySQL</code> 源码中体现为一个类，本质就是一个结构体/类描述，用来进行可见性判断。当我们某个事务执行快照读的时候，会对该记录创建一个 <code v-pre>Read View</code> 读视图，可以把它的整体比作一个条件，用来判断当前事务能够看到哪个版本的数据，既可以是当前最新的数据，也可以是 <code v-pre>undo log</code> 里某个版本的数据。</p>\n<div class=\"language-cpp line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"cpp\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">//读视窗结构体</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> ReadView</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">private</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    trx_id_t</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> m_up_limit_id</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //低水位（没写错），小于等于这个 ID 的事务均可见</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    trx_id_t</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> m_low_limit_id</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //高水位（没写错），大于等于这个 ID 的事务均不可见</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    trx_id_t</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> m_creator_trx_id</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //创建该 Read View 对象的事务 ID</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    ids_t</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> m_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //创建视图时的其他一起活跃事务的 ID 列表</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    //up_limit_id：记录 m_ids 列表中事务 ID 最小的 ID（没有写错）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    //low_limit_id：Read View 生成时刻系统尚未分配的下一个事务 ID，就是目前已出现事务 ID 的最大值 +1（没有写错），不是事务最大值 +</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    trx_id_t</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> m_low_limit_no</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //配合 purge 值，了解一下就行，我们不关心</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    bool</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> m_closed</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //标记视图是否被关闭，也不太关心</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">};</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><blockquote>\n<p>补充：可以尝试使用进程结构体来类比事务结构体，而进程地址空间类比读视图。</p>\n</blockquote>\n<p>而 <strong>只有首次</strong> 某个事务执行快照读的时候，才会对该记录创建一个 <code v-pre>Read View</code> 读视图（进程也是类似）。</p>\n<p>我们再实际读取版本链的时候，是能读取到每个版本对于的事务 <code v-pre>ID</code> 的，即 <code v-pre>DB_TRX_ID</code> 字段的信息。</p>\n<p>那么现在的工作就是将 <code v-pre>DB_TRX_ID</code> 和 <code v-pre>ReadView{/*...*/};</code> 做比较，来得到事务是否可见的判断。</p>\n<figure><img src=\"@source/4.业务服务/2.存储服务/assets/cadf5343aace0afadac2ffc4c5f52d5.png\" alt=\"cadf5343aace0afadac2ffc4c5f52d5\" tabindex=\"0\" loading=\"lazy\"><figcaption>cadf5343aace0afadac2ffc4c5f52d5</figcaption></figure>\n<p>读取 <code v-pre>Undo Log</code> 的那一刻生成读视图：\n(1)遇到快照记录中，<code v-pre>DB_TRX_ID=m_creator_trx_id</code> 时，\n则说明是自己事务中处理的历史记录，自己做的操作就应该被自己 <strong>看到</strong>，因此跳过该记录就行。\n(2)遇到快照记录中，和同时期运行事务的最小 <code v-pre>ID</code>，即 <code v-pre>DB_TRX_ID&lt;up_limit_id</code> 时，\n则说明该记录对于的事务已经被提交/结束，否者不可能要小，所以我这个事务应该 <strong>看到</strong> 这个数据。\n(3)遇到快照记录中，大于等于系统未分批事务的最小 <code v-pre>ID</code>，即 <code v-pre>DB_TRX_ID&gt;=low_limit_id</code> 时，\n则说明我这个记录在形成快照时，这个快照记录对应的事务还没开始呢，但是这个事务比我先执行修改，导致我找得到这个记录，但由于是后来者，我理应 <strong>看不到</strong> 这个记录\n(4)遇到快照记录中，有 <code v-pre>up_limit_id&lt;DB_TRX_ID&lt;low_limit_id</code> 时，\n这说明该快照对应记录是同处于交叉运行的活跃事务，这个事务是否要被我看到，还没有提交，我也 <strong>看不到</strong> 这个记录。</p>\n<h2 id=\"_4-6-实际操作\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_4-6-实际操作\"><span>4.6.实际操作</span></a></h2>\n<p>假设当前学生表内有记录如下：</p>\n<table>\n<thead>\n<tr>\n<th>name</th>\n<th>age</th>\n<th>DB_TRX_ID(创建对应记录的事务 ID)</th>\n<th>DB_ROW_ID(隐式主键)</th>\n<th>DB_ROLL_PTR(回滚指针)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>limou</td>\n<td>18</td>\n<td>0</td>\n<td>1</td>\n<td>0xaa</td>\n</tr>\n</tbody>\n</table>\n<p>然后又如下几个事务：</p>\n<table>\n<thead>\n<tr>\n<th>时间点</th>\n<th>事务 1 [id = 1]</th>\n<th>事务 2 [id = 1]</th>\n<th>事务 3 [id = 1]</th>\n<th>事务 4 [id = 1]</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td>事务开始</td>\n<td>事务开始</td>\n<td>事务开始</td>\n<td>事务开始</td>\n</tr>\n<tr>\n<td>2</td>\n<td>交叉...</td>\n<td>交叉...</td>\n<td>交叉...</td>\n<td>修改提交 <code v-pre>'limou'-&gt;'dimou'</code></td>\n</tr>\n<tr>\n<td>3</td>\n<td>进行中</td>\n<td>快照读</td>\n<td>进行中</td>\n<td></td>\n</tr>\n<tr>\n<td>4</td>\n<td>...</td>\n<td>...</td>\n<td>...</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>注意：<code v-pre>ID</code> 值越小的事务越先被启动，这点需要注意。</p>\n</blockquote>\n<ol>\n<li>\n<p>事务 <code v-pre>4</code> 成功修改 <code v-pre>name='dimou'</code>，并且生成对应的版本链</p>\n<figure><img src=\"@source/4.业务服务/2.存储服务/assets/a97981ed798f4d965aad3ceb6ada95a.png\" alt=\"a97981ed798f4d965aad3ceb6ada95a\" tabindex=\"0\" loading=\"lazy\"><figcaption>a97981ed798f4d965aad3ceb6ada95a</figcaption></figure>\n</li>\n<li>\n<p>事务 <code v-pre>2</code> 对某行执行了快照读，此时数据库为改行数据生成一个 <code v-pre>Read View</code> 读视图，其内部属性值如下：</p>\n<div class=\"language-cpp line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"cpp\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">//事务2的 Read View</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">m_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //[1,3]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">up_limit_id</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">low_limit_id</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //4+1=5，注意是系统未分配的最近的事务 ID</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">creator_trx_id</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //本事务的事务 ID=2</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>上述属性会从 <code v-pre>DB_ROW_ID=2</code> 开始遍历版本链进行比对，事务二能不能看到事务四的提交呢（先不考虑隔离级别，直接按照我本小节的理解）？</p>\n</li>\n<li>\n<p>遍历快照可以确定，快照不对应事务的 <code v-pre>ID</code> 值四种情况，如果可以看到，这就是读提交 <code v-pre>RC</code> 的隔离级别</p>\n</li>\n</ol>\n<p>那 <code v-pre>RC</code> 究竟和 <code v-pre>RR</code> 有什么区别呢（分别指 <code v-pre>READ COMMITTED/REPEATABLE READ</code>）？</p>\n<p>首先您需要知道，指令 <code v-pre>SELECT * FROM table_name LOCK IN SHARE MODE;</code> 就是当前读，而不是您以前使用 <code v-pre>SELECT</code> 时默认的快照读，然后我们做一个实验：</p>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 设置为 RR 模式</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> global</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> transaction</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> isolation</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> level</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> REPEATABLE</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> READ</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 重启终端查看是否更改</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> @@tx_isolation;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">-----------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| @@tx_isolation |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">-----------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">REPEATABLE</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">READ</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">-----------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> warning (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 创建测试用的表</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">create</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> table</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> if</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> not</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> exists</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account(</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    id </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> primary key</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">    name</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> varchar</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">50</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">not null</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> default</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> ''</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    age </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">)ENGINE</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">InnoDB </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">DEFAULT</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> CHARSET</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">UTF8;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 插入一些记录，用来测试</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> insert into</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account (id, </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, age) </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">values</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">iimou</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">15</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><table>\n<thead>\n<tr>\n<th>事务 A</th>\n<th>事务 B</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code v-pre>begin;</code> 事务开始</td>\n<td><code v-pre>begin;</code> 事务开始</td>\n</tr>\n<tr>\n<td>交叉...</td>\n<td>交叉...</td>\n</tr>\n<tr>\n<td><code v-pre>select * from account;</code> 快照读（无影响）</td>\n<td><code v-pre>select * from account;</code> （此时第一次形成了 <code v-pre>Read View</code> 快照读，认为 <code v-pre>A</code> 和自己是一块运行的）</td>\n</tr>\n<tr>\n<td><code v-pre>update account set age=18 where id = 1;</code>（更新）</td>\n<td>-</td>\n</tr>\n<tr>\n<td><code v-pre>commit;</code></td>\n<td>-</td>\n</tr>\n<tr>\n<td>-</td>\n<td><code v-pre>select * from account;</code> 快照读（没读到 <code v-pre>age=18</code>）</td>\n</tr>\n<tr>\n<td>-</td>\n<td><code v-pre>select * from account lock in share mode;</code> 当前读（读到了 <code v-pre>age=18</code>）</td>\n</tr>\n</tbody>\n</table>\n<p>再来做一个测试：</p>\n<table>\n<thead>\n<tr>\n<th>事务 A</th>\n<th>事务 B</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code v-pre>begin;</code> （事务开始）</td>\n<td><code v-pre>begin;</code> （事务开始）</td>\n</tr>\n<tr>\n<td>交叉...</td>\n<td>交叉...</td>\n</tr>\n<tr>\n<td><code v-pre>select * from account;</code></td>\n<td>-</td>\n</tr>\n<tr>\n<td><code v-pre>update account set age=28 where id = 1;</code>（更新）</td>\n<td>-</td>\n</tr>\n<tr>\n<td><code v-pre>commit;</code></td>\n<td>-</td>\n</tr>\n<tr>\n<td>-</td>\n<td><code v-pre>select * from account;</code> （只在这个时候生成 <code v-pre>Read View</code>,读到 <code v-pre>age=28</code>，<code v-pre>B</code> 不认为 <code v-pre>A</code> 和自己同时活跃）</td>\n</tr>\n<tr>\n<td>-</td>\n<td><code v-pre>select * from account lock in share mode;</code>（读到了 <code v-pre>age=28</code>）</td>\n</tr>\n</tbody>\n</table>\n<p>欸，不是可重复读吗？为什么会被修改呢？如果你是事务 <code v-pre>B</code>，你自己一直不查你哪里知道数据库里是什么？只需要保证你从第一次读取的时候到最后退出时，都是读取到同一个数据就行了。在那之前，改了什么根本不需要关系。</p>\n<p>因此这里就可以得到一个结论：<code v-pre>Read View</code> 形成的时机会影响可见性。</p>\n<p>因此 <code v-pre>RR</code> 和 <code v-pre>RC</code> 的深层区别是 <code v-pre>Read View</code> 形成时机不同。</p>\n<ul>\n<li>\n<p>在 <code v-pre>RR</code> 级别下的某个事务的对某条记录的第一次快照读会创建一个快照及 <code v-pre>Read View</code>，将当前系统活跃的其他事务记录起来。</p>\n<p>此后在调用快照读的时候，还是使用的是同一个 <code v-pre>Read View</code>，所以只要当前事务在其他事务提交更新之前使用过快照读，那么之后的快照读使用的都是同一个 <code v-pre>Read View</code>，所以对之后的修改不可见。</p>\n<p><code v-pre>RR</code> 级别下，快照读生成 <code v-pre>Read View</code> 时，<code v-pre>Read View</code> 会记录此时所有其他活动事务的快照，这些事务的修改对于当前事务都是不可见的。而早于 <code v-pre>Read View</code> 创建的事务所做的修改均是可见。</p>\n</li>\n<li>\n<p>而在 <code v-pre>RC</code> 级别下的，事务中，每次快照读都会新生成一个快照和<code v-pre>Read View</code>，这就是我们在 <code v-pre>RC</code> 级别下的事务中可以看到别的事务提交的更新的原因。总之在 <code v-pre>RC</code> 隔离级别下，是每个快照读都会生成并获取最新的 <code v-pre>Read View</code>。所以，RC才会有不可重复读问题。</p>\n</li>\n</ul>\n<blockquote>\n<p>补充：建议再看一遍，待补充...</p>\n</blockquote>\n","env":{"base":"/","filePath":"/home/ljp/git/work/work-blog-website/work-blog-website-frontend/docs/4.业务服务/2.存储服务/009_ljp_2024_03_01_事务.md","filePathRelative":"4.业务服务/2.存储服务/009_ljp_2024_03_01_事务.md","frontmatter":{"createTime":"2025/06/21 15:33:57","permalink":"/4.业务服务/o6zk2t2t/"},"sfcBlocks":{"template":{"type":"template","content":"<template><blockquote>\n<p>前要：在网络服务中，如果对 <code v-pre>CURD</code> 不加限制，会出现什么问题？</p>\n<p>在多个客户端同时向一个卖票服务器买票时（假设票数只剩一张），<code v-pre>A</code> 客户端让数据库内的票数 <code v-pre>count</code> 减 <code v-pre>1</code>，但是还没来得及更新数据，又有 <code v-pre>B</code> 服务器查询数据库，此时 <code v-pre>B</code> 服务器看到票数还是 <code v-pre>1</code>，又进行了减 <code v-pre>1</code> 操作，导致一张票被同时卖了两次。</p>\n</blockquote>\n<p><code v-pre>CURD</code> 的过程需要满足什么条件，才能解决上述问题呢？</p>\n<ol>\n<li>买票的过程得应该是原子操作（要么抢到，要么没抢）</li>\n<li>买票的过程中不能被相互影响（不能被互相影响，要割裂/独立开来）</li>\n<li>买完票后应该要永久有效（必须要做持久化，不能只是在内存中操作）</li>\n<li>ef</li>\n<li>买前和买后都是确定的状态（不能出现中间状态，要保证一致性）</li>\n</ol>\n<h1 id=\"_1-事务的理解\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-事务的理解\"><span>1.事务的理解</span></a></h1>\n<h2 id=\"_1-1-事务的概念\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-1-事务的概念\"><span>1.1.事务的概念</span></a></h2>\n<p>事务简单来理解就是 <strong>一组 DML 语句</strong>，也就是一组用于数据操作（插入数据、删除数据...）的语句。</p>\n<p>事务主要处理操作量大，复杂度高的数据，这些数据往往需要多条 <code v-pre>SQL</code> 语句来构成。</p>\n<p>但是事务还不仅仅是多条语句的集合，还必须保证四个属性（<code v-pre>ACID</code>）才能保证安全运行事务：</p>\n<ul>\n<li>\n<p><strong>原子性(Atomicity)</strong>：一组 <code v-pre>DML</code> 语句/一个事务，要么全部成功，要么全部失败，这是由 <code v-pre>MySQL</code> 提供的机制来保障的。</p>\n</li>\n<li>\n<p><strong>一致性(Consistency)</strong>：在事务开始和结束以后，数据库的完整性没有被破坏，写入的数据必须完全符合所有的预设规则（在 <code v-pre>MySQL</code> 中，一致性时被其他三个属性来保证的，但是需要数据库和用户来配合，才能得到一致性）</p>\n</li>\n<li>\n<p><strong>隔离性(Isolation)</strong>：防止多个事务并发执行时由于交叉执行导致的数据不一致问题，事务隔离有不同的等级</p>\n<p>(1)读未提交（<code v-pre>Read Uncommitted</code>）</p>\n<p>(2)读提交（<code v-pre>Read Committed</code>）</p>\n<p>(3)可重复读（<code v-pre>Repeatable Read</code>）</p>\n<p>(4)串行化（<code v-pre>Serialzable</code>）</p>\n</li>\n<li>\n<p><strong>持久性(Durability)</strong>：事务处理完后，对表中数据的影响是永久的（哪怕系统挂了也不会丢失），也就是持久化</p>\n</li>\n</ul>\n<blockquote>\n<p>注意：学习事务一定要在使用数据库的用户视角来理解。</p>\n</blockquote>\n<p>事务在 <code v-pre>MySQL</code> 内也一定是一个具体对象，这就需要先描述再组织。</p>\n<p>另外，事务不是 <code v-pre>MySQl</code> 天然就存在，而是为了在应用程序访问数据库的时候，能够简化编程模型，不需要考虑各种潜在并发问题、网络问题，用户只需要提交和回滚。因此，事务的本质是为了应用层服务的，而不是面向数据库内部。</p>\n<h2 id=\"_1-2-事务的版本\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-事务的版本\"><span>1.2.事务的版本</span></a></h2>\n<p><code v-pre>MySQL</code> 中只有使用了 <code v-pre>Innodb</code> 数据库引擎的数据库或数据表才可以支持事务，其他基本都不支持。</p>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 查看 MySQL 的引擎是否支持事务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">show engines \\G</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">***************************</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">. </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">row</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> ***************************</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">      Engine: InnoDB</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Support: </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">DEFAULT</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Comment: Supports transactions, </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">row</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">level</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> locking, </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">and</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> foreign keys</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Transactions: YES</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">          XA: YES</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  Savepoints: YES</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">***************************</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">. </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">row</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> ***************************</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">      Engine: MRG_MYISAM</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Support: YES</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Comment: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Collection</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> of identical MyISAM tables</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Transactions: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">          XA: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  Savepoints: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">***************************</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">. </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">row</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> ***************************</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">      Engine: MEMORY</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Support: YES</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Comment: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Hash</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> based, stored </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">in</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> memory, useful </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> temporary tables</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Transactions: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">          XA: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  Savepoints: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">***************************</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 4</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">. </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">row</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> ***************************</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">      Engine: BLACKHOLE</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Support: YES</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Comment: </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">/</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">dev</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">/</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">null</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> storage engine (anything you write </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">to</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> it disappears)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Transactions: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">          XA: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  Savepoints: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">***************************</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 5</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">. </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">row</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> ***************************</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">      Engine: MyISAM</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Support: YES</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Comment: MyISAM storage engine</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Transactions: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">          XA: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  Savepoints: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">***************************</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">. </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">row</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> ***************************</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">      Engine: CSV</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Support: YES</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Comment: CSV storage engine</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Transactions: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">          XA: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  Savepoints: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">***************************</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 7</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">. </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">row</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> ***************************</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">      Engine: ARCHIVE</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Support: YES</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Comment: Archive storage engine</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Transactions: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">          XA: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  Savepoints: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">***************************</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 8</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">. </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">row</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> ***************************</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">      Engine: PERFORMANCE_SCHEMA</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Support: YES</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Comment: Performance </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Schema</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Transactions: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">          XA: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  Savepoints: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">***************************</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 9</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">. </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">row</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> ***************************</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">      Engine: FEDERATED</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Support: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Comment: Federated MySQL storage engine</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Transactions: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NULL</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">          XA: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NULL</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  Savepoints: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NULL</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">9</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h1 id=\"_2-事务的操作\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-事务的操作\"><span>2.事务的操作</span></a></h1>\n<h2 id=\"_2-1-做一些准备工作\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-1-做一些准备工作\"><span>2.1.做一些准备工作</span></a></h2>\n<p>开始之前，先设置一下隔离性（后面提及）。</p>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 设置隔离性</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> global</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> transaction</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> isolation</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> level</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> READ</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> UNCOMMITTED</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> @@tx_isolation;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| @@tx_isolation   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">READ</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">UNCOMMITTED</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> warning (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>首先，事务有两种提交方式：</p>\n<ul>\n<li>自动提交</li>\n<li>手动提交</li>\n</ul>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 查看事务提交方式</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> show variables </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">like</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">autocommit</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| Variable_name | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Value</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| autocommit    | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">ON</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">01</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>可以用 <code v-pre>SET</code> 来改变 <code v-pre>MySQL</code> 的自动提交方式。</p>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 取消事务自动提交</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> autocommit</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> show variables </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">like</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">autocommit</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| Variable_name | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Value</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| autocommit    | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">OFF</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> autocommit</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> show variables </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">like</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">autocommit</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| Variable_name | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Value</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| autocommit    | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">ON</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>然后我们切换超级用户，使用 <code v-pre>netstat -nltp</code> 是一个用于显示网络连接、路由表和网络接口信息的命令行工具查看 <code v-pre>MySQL</code> 是否成功运行且占用端口号。</p>\n<div class=\"language-cmd line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"cmd\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-cmd\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 查看网络状态</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">netstat</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">nltp</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Active Internet </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">connections</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">only</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> servers</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Proto </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Recv</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Q</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> Send</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Q</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> Local Address           Foreign Address         State       </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">PID</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">/</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Program</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> name    </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> tcp6       </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">      0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> :::</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3306</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                 :::</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                    LISTEN      </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">7404</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">/</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">mysqld</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>原本是应该使用 <code v-pre>Windows11</code> 的 <code v-pre>cmd</code> 来远程访问 <code v-pre>Centos7</code> 云服务的 <code v-pre>MySQL</code> 服务，不过需要提前在 <code v-pre>Windows11</code> 中提前下载好 <code v-pre>MySQL</code>，所以我们先用本地的两个客户端来模拟，后续再来详细了解。</p>\n<p>然后修改事务等级，不然有些现象会看不到。</p>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端中设置事务隔离级别并且重启检查</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> global</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> transaction</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> isolation</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> level</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> read</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> uncommitted</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> quit</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Bye</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">$ mysql </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">uroot </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">p</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Enter </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">password</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Welcome </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">to</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> the MySQL monitor.  Commands </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">end</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> with</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> ; </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">or</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> \\g.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Your MySQL </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">connection</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> id </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">is</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 32</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Server</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> version</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">5</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">7</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">44</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> MySQL Community </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Server</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (GPL)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Copyright (c) </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2000</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2023</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, Oracle </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">and</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">/</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">or</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> its affiliates.</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Oracle </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">is</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> a registered trademark of Oracle Corporation </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">and</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">/</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">or</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> its</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">affiliates. Other names may be trademarks of their respective</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">owners.</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Type</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">help;</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> or</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">\\h</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> help. </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Type</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">\\c</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> to</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> clear</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> the current input </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">statement</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> @@tx_isolation;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| @@tx_isolation   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">READ</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">UNCOMMITTED</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> warning (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>启动两个 <code v-pre>MySQL</code> 客户端（模拟并发场景），然后其中一个客户端建立一个如下的表结构：</p>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端1：创建表结构</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">create</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> table</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> if</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> not</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> exists</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account(</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">id </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> primary key</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> varchar</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">50</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">not null</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> default</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> ''</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">blance </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">decimal</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">10</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">not null</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> default</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">)ENGINE</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">InnoDB </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">DEFAULT</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> CHARSET</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">UTF8;</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端2：查看是否能看到 account 数据表</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> desc</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">--------+---------------+------+-----+---------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| Field  | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Type</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">          | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Null</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Key</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">Default</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | Extra |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">--------+---------------+------+-----+---------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id     | </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">)       | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">   | PRI | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NULL</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    |       |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">   | </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">varchar</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">50</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">)   | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">   |     |         |       |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| blance | </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">decimal</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">10</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">   |     | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    |       |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">--------+---------------+------+-----+---------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>可以在一个客户端中查看连接情况，可以看到确实存在两个本地客户端。</p>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端1：查看 MySQL 的连接情况</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> show processlist\\G</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">***************************</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">. </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">row</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> ***************************</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Id: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">33</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">   User: ljp</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">   Host: localhost</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     db: limou_database</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Command: Query</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">   Time</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">  State</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: starting</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">   Info: show processlist</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">***************************</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">. </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">row</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> ***************************</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Id: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">34</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">   User: ljp</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">   Host: localhost</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     db: limou_database</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Command: Sleep</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">   Time</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">355</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">  State</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">   Info: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NULL</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2 id=\"_2-2-正常情况的事务\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-2-正常情况的事务\"><span>2.2.正常情况的事务</span></a></h2>\n<p>启动事务有两种方法：(1)<code v-pre>start transaction;</code> (2)<code v-pre>begin</code></p>\n<p>一旦开启事务，后续的 <code v-pre>SQL</code> 操作都属于同一个事务的部分。并且，我还设置了一个保存点（可选）</p>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端1：启动事务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> start transaction</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> savepoint s1;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端2：启动事务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> begin</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Empty</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>然后进行插入工作，设置第二个保存点，并且查看插入的数据是否同步到另外一个客户端。</p>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端1：插入数据</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> insert into</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">values</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">limou</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">10000</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> savepoint s2;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端2：查看数据</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">10000</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>尝试插入更多的插入和设置保存点的操作，同时没插入一个记录，就检查客户端是否数据同步。</p>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端1：插入数据和保存</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> savepoint s2;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> insert into</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">values</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">dimou</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> savepoint s3;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> insert into</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">values</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">iimou</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">10431</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端2：每次插入，就查看一次数据表</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">10000</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">10000</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | iimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">10431</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>如果我们突然后悔了，可以回滚事务。</p>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端1：回滚事务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rollback</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> to</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> s3;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端2：查看回滚后的数据表</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">10000</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>可以看到，数据表确实发生了回退，如果我们这个时候使用 <code v-pre>COMMIT</code> 就会提交本次事务。</p>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端1：提交事务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> commit</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">01</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><blockquote>\n<p>补充：使用 <code v-pre>roolback</code> 还可以将所有操作全部取消，但是一般很少这么做。</p>\n</blockquote>\n<p>而事务只有在启动的时候才可以进行回滚操作，而一旦提交了就无法进行回滚。</p>\n<h2 id=\"_2-3-异常情况的事务\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-3-异常情况的事务\"><span>2.3.异常情况的事务</span></a></h2>\n<p>如果其中一个服务端在事务状态下奔溃了会怎么样？其他客户端会自动回滚，也就是保证原子性，要么不做，要么就操作完。</p>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端1：不断插入数据最后因为异常导致奔溃，插入一次就在客户端2中查看一次</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> begin</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> insert into</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">values</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">eimou</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">20431</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">01</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> insert into</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">values</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">4</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">eimou</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">30434</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> ^C</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> Aborted</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端2：客户端1插入后不断查找数据表，最后检查奔溃后的数据表</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">10000</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">10000</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | eimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">20431</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">4</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | eimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">30434</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">4</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 奔溃后，这里自动发生了回滚，回到开头</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">10000</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>也有一些其他的情况会发生自动回滚（客户端因为关闭 <code v-pre>shell</code> 而导致退出），但是如果事务已经进行了提交（也就是使用了 <code v-pre>COMMIT</code>），就不会再进行回滚（包括因为崩溃造成的自动回滚）。</p>\n<p>但是我们之前设置的自动提交又是什么鬼？不是事务会自动提交吗？从现象来看，无论是设置 <code v-pre>autocommit</code> 为 <code v-pre>OFF</code> 还是 <code v-pre>ON</code> 现象都是一样的结果（这个您可以自己实验一下），那这个 <code v-pre>autocommit</code> 究竟有什么用呢？您先知道一个点，只要是手动开启启动事务，就必须手动提交，和是否设置自动提交无关即可。</p>\n<p>而对比有无设置 <code v-pre>autocommit</code>  的两种情况。</p>\n<h3 id=\"_2-3-1-设置为-off\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-3-1-设置为-off\"><span>2.3.1.设置为 OFF</span></a></h3>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端1：设置 autocommit 为 </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">OFF</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">，然后在事务中进行删除记录</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> show variables </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">like</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">autocommit</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| Variable_name | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Value</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| autocommit    | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">ON</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> autocommit</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> show variables </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">like</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">autocommit</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| Variable_name | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Value</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| autocommit    | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">OFF</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> delete</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">where</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> id</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">01</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> Aborted</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端2：不断查看数据表</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1没删除之前</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | timou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">50434</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1删除后</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1奔溃后，发现记录恢复</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | timou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">50434</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3 id=\"_2-3-2-设置为-on\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-3-2-设置为-on\"><span>2.3.2.设置为 ON</span></a></h3>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端1：进行删除操作，但是不在事务中删除后崩溃</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> show variables </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">like</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">autocommit</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| Variable_name | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Value</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| autocommit    | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">ON</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> delete</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">where</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> id</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">01</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> Aborted</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端2：不断查看数据表</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1没删除之前</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | timou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">50434</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1删除后</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1奔溃后，发现记录没有恢复</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>而且就算客户端 2 之前有做 <code v-pre>BEGIN</code>，再 <code v-pre>COMMIT</code> 后也不会恢复数据。</p>\n<p>以上测试说明，只要设置了 <code v-pre>autocommit</code>，就会把一条单纯的 <code v-pre>SQL</code> 语句单独看作一个事务，都会被自动 <code v-pre>BEGIN</code> 和 <code v-pre>COMMIT</code>。因此如果没设置 <code v-pre>autocommit</code> 就会因为没有 <code v-pre>COMMIT</code> 而导致数据回滚。</p>\n<blockquote>\n<p>复习：再理一理，<code v-pre>BEGIN</code> 是开启事务处理，<code v-pre>COMMIT</code> 是事务提交，防止回滚。</p>\n</blockquote>\n<p>但是如果我们手动进行回滚呢？</p>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端1：删除数据表，但是先 </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">commit</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> 再崩溃</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> show variables </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">like</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">autocommit</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| Variable_name | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Value</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| autocommit    | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">ON</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> autocommit</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> show variables </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">like</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">autocommit</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| Variable_name | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Value</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| autocommit    | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">OFF</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">01</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> delete</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">where</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> id</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> commit</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> Aborted</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端2：不断查看数据表</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1删除记录前</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1删除记录后</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Empty</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1崩溃后，没有发生回滚</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Empty</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>也侧面证明了：对于 <code v-pre>InnoDB</code> 里一条单纯的 <code v-pre>SQL</code> 就是一个完整的事务，最后都会因为 <code v-pre>autocommit=ON</code> 而自动提交（但是 <code v-pre>SELECT</code> 有点特殊，您先记住就行，因为 <code v-pre>MySQL</code> 有 <code v-pre>MVCC</code>）。</p>\n<blockquote>\n<p>补充：<code v-pre>COMMIT</code> 操作实际上就是数据持久化的一种手段。</p>\n</blockquote>\n<p>到这里就可以看到事务本身的 <strong>原子性（回滚）</strong> 和 <strong>持久性（提交）</strong>。</p>\n<h1 id=\"_3-事务的隔离\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-事务的隔离\"><span>3.事务的隔离</span></a></h1>\n<h2 id=\"_3-1-隔离和隔离级别\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-1-隔离和隔离级别\"><span>3.1.隔离和隔离级别</span></a></h2>\n<p>但是事务的隔离性体现在哪里呢？为何需要隔离呢？不隔离可以吗？</p>\n<p>一个 <code v-pre>MySQL</code> 服务可能会被多个客户端进程访问（一般都是程序直接连接数据库，命令行操作很少用到），访问的方式是以事务进行的。</p>\n<p>而事务在上述小节中实现了原子性和持久性，事务注定有执行前、执行中、执行后，一旦异常就会回滚。为了保证事务在执行中，为了保证事务尽量不受干扰，就产生的隔离性，根据不同的干扰级别可以设置不同的隔离级别。</p>\n<p>实际上，正常人的认知是：无论别的客户端 <code v-pre>A</code> 怎么对数据表怎么增删查改，另外一个客户端 <code v-pre>B</code> 要拿到最新的数据，不管两进程的先后顺序如何，都必须要先等待进程 <code v-pre>A</code> 完成一个事务。这个观点有问题吗？有点，举一个不恰当的例子，一个婴儿在出生后，不需要知道父母之前的经历，也能和父母一起创造新的经历，每个人只需要在自己生命周期内看到的世界也都是不一样的。这代表着：<strong>不一定需要获取最新的消息，只需要在自己的生命周期内看到该看到的就行，这就是隔离性</strong>。</p>\n<p>在 <code v-pre>MySQL</code> 中，原子性不仅是在操作上原子，还体现在时间上。一个改表的 <code v-pre>A</code> 客户端先执行事务，一个查表的 <code v-pre>B</code> 客户端后执行事务，两者在执行中交叉进行。而 <code v-pre>B</code> 客户端执行得较慢，<code v-pre>A</code> 客户端执行得较快，那么 <code v-pre>B</code> 客户端是否应该立刻获取最新的数据呢？不应该！因为要保证隔离性，隔离运行中的事务。</p>\n<p>因此隔离体现在运行事务中，而隔离性要隔离的程度就是隔离级别（根据内容重要度的不同，有些信息是可以不被隔离的，因此就有隔离级别），在交叉事务处理过程中，不同的事务级别分为：</p>\n<ul>\n<li><strong>读未提交(READ UNCOMMITTED)</strong>：所有事务都可以看到其他事务没有提交的执行结果（相当于没有任何隔离性，实际生产中不太可能用到这个级别），我们之前的书写的事务代码，就是读未提交，没有进行 <code v-pre>COMMIT</code> 也会看到事务中的操作后结果，而对方客户端一旦崩溃就和没有存在过一样，则本客户端发送回滚</li>\n<li><strong>读已提交(READ COMMITTED)</strong>：只有对事务进行了 <code v-pre>COMMIT</code>，才能看到更新的数据表（一条单纯的 <code v-pre>SQL</code> 语句本身就被包装成一个事务，因此使用单纯的 <code v-pre>SQL</code> 语句会让所有客户端都读取到）</li>\n<li><strong>可重复读(REPEATABLE READ)</strong>：即便对方客户端提交了，哪怕是退出了，本客户端都无法实时知道更新结果，只有在本客户端退出了再次启动，才能看到更新后的新数据（这是 <code v-pre>MySQL</code> 默认的隔离等级），但是可能会有幻读的问题。</li>\n<li><strong>串行化(SERIALIZABLE)</strong>：事务隔离的最高级别，强制事务进行排序，使之不会相互冲突，确实解决了幻读的问题，但是会导致超时和锁竞争（太极端了，实际生产中很少用）</li>\n</ul>\n<p>隔离级别，基本都是通过锁来实现的，不同的隔离级别使用的锁不一样，常见的有：表锁、行锁、读锁、写锁、间隙锁（<code v-pre>GAP</code>）、<code v-pre>Next-Key</code> 锁，简单认识一下就行。</p>\n<h2 id=\"_3-2-查看和设置隔离级别\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-2-查看和设置隔离级别\"><span>3.2.查看和设置隔离级别</span></a></h2>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 查看隔离级别</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> @@</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">global</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">tx_isolation</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">; # 全局设置</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">-----------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| @@</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">global</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">tx_isolation</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">-----------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">READ</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">UNCOMMITTED</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">      |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">-----------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> warning (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> @@</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">session</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">tx_isolation</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">; # 当前会话设置</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">------------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| @@</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">session</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">tx_isolation</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">------------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">READ</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">UNCOMMITTED</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">       |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">------------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> warning (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> @@tx_isolation; # 默认显示会话设置（就是当前会话的设置）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| @@tx_isolation   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">READ</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">UNCOMMITTED</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> warning (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>使用 <code v-pre>SET {SESSION/GLOBAL} TRANSACTION ISOLATION LEVEL {READ UNCOMMITTED/READ COMMITTED/REPEATABLE READ/SERIALIZABLE};</code> 就可以设置隔离级别。</p>\n<p>而如果设置了全局设置，只会在下一次重启客户端时才会更新设置，一般一开始设置了隔离级别就不要修改了，最好保证隔离级别是一致的。</p>\n<h2 id=\"_3-3-不同隔离级别带来的影响\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-3-不同隔离级别带来的影响\"><span>3.3.不同隔离级别带来的影响</span></a></h2>\n<p>再次强调，隔离主要是为了避免交叉事务出现问题。</p>\n<h3 id=\"_3-3-1-读未提交\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-3-1-读未提交\"><span>3.3.1.读未提交</span></a></h3>\n<blockquote>\n<p>复习：<strong>读未提交</strong>，所有事务都可以看到其他事务没有提交的执行结果（相当于没有任何隔离性，实际生产中不太可能用到这个级别），我们之前的书写的事务代码，就是读未提交，没有进行 <code v-pre>COMMIT</code> 也会看到事务中的操作后结果，而对方客户端一旦崩溃就和没有存在过一样，则本客户端发送回滚。</p>\n</blockquote>\n<p>实际上之前已经做过了，最上面从设置隔离级别为 <code v-pre>READ-UNCOMMITTED</code>，后续的操作都是读未提交情景下的操作。</p>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 设置隔离级别</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> global</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> transaction</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> isolation</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> level</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> READ</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> UNCOMMITTED</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 然后重启两个客户端，分别查看隔离等级</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> @@tx_isolation;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| @@tx_isolation   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">READ</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">UNCOMMITTED</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> warning (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端1：在事务中进行删除记录</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> autocommit</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> show variables </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">like</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">autocommit</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| Variable_name | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Value</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| autocommit    | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">OFF</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> delete</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">where</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> id</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">01</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> Aborted # 这里奔溃后，就相当于没有进行 </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">COMMIT</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端2：不断查看数据表</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1没删除之前</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | timou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">50434</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1删除后，还没提交就被读取到了，也就是“读未提交”</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1奔溃后，发现记录恢复</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | timou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">50434</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>这种未提交就可以被其他客户端读取的现象，也叫做 <strong>脏读</strong> 现象。</p>\n<h3 id=\"_3-3-2-读已提交\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-3-2-读已提交\"><span>3.3.2.读已提交</span></a></h3>\n<blockquote>\n<p>复习：<strong>读已提交</strong>，只有对事务进行了 <code v-pre>COMMIT</code>，才能看到更新的数据表（一条单纯的 <code v-pre>SQL</code> 语句本身就被包装成一个事务，因此使用单纯的 <code v-pre>SQL</code> 语句会让所有客户端都读取到）。</p>\n</blockquote>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 设置隔离级别</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> global</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> transaction</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> isolation</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> level</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> READ</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> COMMITTED</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 然后重启两个客户端，分别查看隔离等级</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> @@</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">global</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">tx_isolation</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">-----------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| @@</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">global</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">tx_isolation</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">-----------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">READ</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">COMMITTED</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">-----------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> warning (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端1进行修改数据表</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> begin</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> update</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">set</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> name</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">rimou</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> where</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> id</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> matched</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  Changed: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  Warnings: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> commit</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">01</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端2不断进行查看</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> begin</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 没修改之前</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance  |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1001</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1023</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | eimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2034</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1修改数据，但是没有进行 </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">commit</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">，继续在客户端2查看，发现数据仍旧没有被修改</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance  |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1001</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1023</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | eimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2034</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1使用 </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">commit</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">，此时客户端2就会发现数据被修改了</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance  |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1001</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | rimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1023</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | eimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2034</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>这种提交才可以被其他客户端读取的现象，在提交之前只能获得旧数据，这要看具体场景，才能决定是对是错的。</p>\n<p>读提交有一个问题，一旦服务端 1 提交了，哪怕客户端 2 还处于事务中，也会读取到更新的数据，这在某些场景是错误的。理论上插入后更新数据表难道有错吗？有可能有错，提交确实是要让所有事务看到，但有时候不应该让运行中的事务看到（后面有个例子）。</p>\n<h3 id=\"_3-3-3-可重复读\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-3-3-可重复读\"><span>3.3.3.可重复读</span></a></h3>\n<blockquote>\n<p>复习：<strong>可重复读</strong>，即便对方客户端提交了，哪怕是退出了，本客户端都无法实时知道更新结果，只有在本客户端退出了再次启动，才能看到更新后的新数据（这是 <code v-pre>MySQL</code> 默认的隔离等级），但是会有幻读的问题。</p>\n</blockquote>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 设置隔离等级</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> show variables </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">like</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">autocommit</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| Variable_name | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Value</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| autocommit    | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">ON</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">01</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> global</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> transaction</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> isolation</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> level</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> REPEATABLE</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> READ</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> @@</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">global</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">tx_isolation</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">-----------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| @@</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">global</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">tx_isolation</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">-----------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">REPEATABLE</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">READ</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">       |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">-----------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> warning (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端1：更新数据表</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> begin</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> update</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">set</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> name</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">iimou</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> where</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> id</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> matched</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  Changed: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  Warnings: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> commit</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端2：不断查看，奔溃后再次查看</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> begin</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 在没有更新数据表内记录之前查询</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance  |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1001</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | rimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1023</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | eimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2034</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 更新数据表内记录后查询</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance  |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1001</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | rimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1023</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | eimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2034</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 在客户端1 </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">commit</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> 后再次查询</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance  |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1001</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | rimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1023</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | eimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2034</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> Aborted </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> # 客户端2奔溃了...</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">$ mysql</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Welcome </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">to</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> the MySQL monitor.  Commands </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">end</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> with</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> ; </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">or</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> \\g.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Your MySQL </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">connection</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> id </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">is</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 54</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Server</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> version</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">5</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">7</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">44</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> MySQL Community </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Server</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (GPL)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Copyright (c) </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2000</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2023</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, Oracle </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">and</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">/</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">or</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> its affiliates.</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Oracle </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">is</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> a registered trademark of Oracle Corporation </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">and</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">/</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">or</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> its</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">affiliates. Other names may be trademarks of their respective</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">owners.</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Type</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">help;</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> or</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">\\h</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> help. </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Type</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">\\c</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> to</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> clear</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> the current input </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">statement</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> use</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> limou_database;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Reading </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">table</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> information </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> completion of </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">table</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> and</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> column names</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">You can turn </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">off</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> this feature </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">to</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> get</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> a quicker startup </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">with</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">A</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Database</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> changed</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 在客户端2奔溃后重新启动</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance  |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1001</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | rimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1023</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | iimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2034</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |  # 发现这里终于被修改了</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><blockquote>\n<p>例子：举一个超级生动具体的例子</p>\n<p>一家公司招聘程序员时，原本规定了一个工作等级，于是开始招聘员工，假设招进了 <code v-pre>A</code> 程序员，<code v-pre>A</code> 程序员和 <code v-pre>HR</code> 敲定了自己的工资等级，最后成功入职。问题是，假设公司新出现了一个大型项目，需要招聘大量程序员，于是提高了薪资等级中的工资量。果然成功吸引了程序员 <code v-pre>B</code>，程序员 <code v-pre>B</code> 和 <code v-pre>HR</code> 谈拢后，确定了和程序员 <code v-pre>A</code> 一样的等级，但是薪资却更高。</p>\n<p>而对于公司（黑心的）来说，不会直接告诉 <code v-pre>A</code> 你这个等级的薪资提高了，所以我要给你提薪...<code v-pre>A</code> 需要知道吗？不需要，你继续做你的工作就行了，在 <code v-pre>A</code> 的认知中，自己这个等级的薪资就是原先谈好的那么高。</p>\n<p>而一旦那一天工资项目出现问题，要进行裁员，就把 <code v-pre>A</code> 给“优化”（裁员）了，但是最后公司发现，自己貌似开走了一个“大动脉”（你之前写的代码逻辑非常重要，没 <code v-pre>A</code> 不行的那种），最后又把你找回来，按照 <code v-pre>B</code> 的薪资招聘你。</p>\n<p>这就是“可重复读”，<code v-pre>A</code> 始终用的是旧的薪资等级来判断薪资，但是后来的 <code v-pre>B</code> 却是更新后的第二套薪资体系，可是在 <code v-pre>A</code> 就职期间（被重新招聘前），没必要知道更新后的薪资等级（不然 <code v-pre>A</code> 闹起来怎么办，笑）。</p>\n<blockquote>\n<p>员工 <code v-pre>A</code>：客户端 1</p>\n<p>员工 <code v-pre>B</code>：客户端 2</p>\n<p><code v-pre>A</code> 就职期间：客户端 1 启动事务期间</p>\n<p><code v-pre>B</code> 就职期间：客户端 2 启动事务期间</p>\n<p><code v-pre>A</code> 离职时：客户端 1 结束事务进行提交</p>\n</blockquote>\n</blockquote>\n<p>但是，在一些数据库中，在可重复隔离下，<code v-pre>insert</code> 的 <code v-pre>sql</code> 可能无法被屏蔽（因为隔离性是通过加锁和其他策略来实现的，但是混则很难通过加锁来实现），在多次查询的过程中，就有可能会查出更新的数据（也就是“幻读”）。但是 <code v-pre>MySQL</code> 中，在 <code v-pre>RR</code> 级别中修复了这个问题（使用 <code v-pre>GAP+行锁</code>），我们不在这里深入了解，这也是为什么该级别是默认级别的原因。</p>\n<h3 id=\"_3-3-4-串行化\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-3-4-串行化\"><span>3.3.4.串行化</span></a></h3>\n<blockquote>\n<p>复习：<strong>串行化</strong>，事务隔离的最高级别，强制事务进行排序，使之不会相互冲突，确实解决了幻读的问题，但是会导致超时和锁竞争（太极端了，实际生产中很少用）</p>\n</blockquote>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 设置隔离级别</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> global</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> transaction</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> isolation</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> level</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> SERIALIZABLE</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">01</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> @@</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">global</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">tx_isolation</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">-----------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| @@</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">global</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">tx_isolation</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">-----------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">SERIALIZABLE</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">          |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">-----------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> warning (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端1较后开启事务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> begin</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> update</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">set</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> name</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">eimou</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> where</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> id</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 陷入阻塞状态，知道客户端2进行 </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">commit</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> 后才执行这条 </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">sql</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">14</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">32</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> matched</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  Changed: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  Warnings: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> commit</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">01</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端2较先开启事务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> begin</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1还没修改前</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance  |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1001</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | rimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1023</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | iimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2034</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1修改后</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance  |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1001</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | rimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1023</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | iimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2034</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> commit</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端2提交后查看</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance  |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1001</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | rimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1023</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | iimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2034</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> Aborted # 客户端2崩溃、</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">$ mysql</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Welcome </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">to</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> the MySQL monitor.  Commands </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">end</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> with</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> ; </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">or</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> \\g.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Your MySQL </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">connection</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> id </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">is</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 61</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Server</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> version</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">5</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">7</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">44</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> MySQL Community </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Server</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (GPL)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Copyright (c) </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2000</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2023</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, Oracle </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">and</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">/</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">or</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> its affiliates.</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Oracle </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">is</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> a registered trademark of Oracle Corporation </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">and</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">/</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">or</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> its</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">affiliates. Other names may be trademarks of their respective</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">owners.</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Type</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">help;</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> or</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">\\h</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> help. </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Type</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">\\c</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> to</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> clear</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> the current input </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">statement</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> use</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> limou_database;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Reading </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">table</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> information </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> completion of </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">table</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> and</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> column names</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">You can turn </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">off</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> this feature </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">to</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> get</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> a quicker startup </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">with</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">A</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Database</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> changed</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 重启后再次查看就发现依旧没有被修改</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance  |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1001</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | rimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1023</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | iimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2034</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 只有客户端1提交了，才能看到修改</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance  |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1001</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | eimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1023</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | iimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2034</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>注意，是事务之间串行化，不是进程之间串行化！</p>\n<p>以上隔离等级就是 <strong>隔离性</strong> 的体现，而怎么体现一致性呢？</p>\n<p>事务执行的结果，必须使数据库的一个一致性状态，转移到另外一个一致性状态。如果系统发生中断，某个事务未完成而被迫中止，而为改完的事务对数据库所做的修改已经写入数据库，此时数据库处于不正确、不一致的状态。因此是通过原子性（回滚）来保证一致的（而一致性和用户的逻辑强相关，由用户决定）。而其他三属性实际上都是围绕一致性来展开的，可以说 <code v-pre>AID</code> 是因，用户配合，<code v-pre>C</code> 是果。</p>\n<blockquote>\n<p>注意：这关于事务这块还是比较复杂的，建议深入了解，反复学习。</p>\n</blockquote>\n<h1 id=\"_4-隔离性的原理\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_4-隔离性的原理\"><span>4.隔离性的原理</span></a></h1>\n<p>数据库事务的并发场景有三个：</p>\n<ul>\n<li><code v-pre>读-读</code>：不存在任何问题，因此不需要并发控制</li>\n<li><code v-pre>读-写</code>：有线程安全问题，可能造成事务隔离性问题（脏读、幻读、不可重复读），这种情况是主要的</li>\n<li><code v-pre>写-写</code>：有线程安全问题，可能存在更新丢失问题（第一类更新丢失、第二类更新丢失）</li>\n</ul>\n<p><code v-pre>读-读</code> 我们几乎不需要讨论，重点讨论 <code v-pre>读-写</code> 的实现，不讨论 <code v-pre>写-写</code> 的实现。</p>\n<p>而多版本并发控制（<code v-pre>MVCC</code>）是一种用来解决 <code v-pre>读-写冲突</code> 的无锁并发控制。</p>\n<blockquote>\n<p>注意：理解 <code v-pre>MVCC</code> 必须先理解几个周边知识。</p>\n<ul>\n<li>事务的 <code v-pre>ID</code></li>\n<li>三个隐藏字段</li>\n<li><code v-pre>undo</code> 日志</li>\n</ul>\n</blockquote>\n<h2 id=\"_4-1-事务的-id\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_4-1-事务的-id\"><span>4.1.事务的 ID</span></a></h2>\n<p>为事务分配单向增长的事务 <code v-pre>ID</code>，为每个修改保存一个版本，版本与事务 <code v-pre>ID</code> 关联，读操作只读该事务开始前的数据快照，所以 <code v-pre>MVCC</code> 可以为数据库解决：</p>\n<ol>\n<li>并发读写数据库时，可以做到在\n(1)读操作时不用阻塞写操作\n(2)写操作时不用阻塞读操作\n提高了数据库并发读写的性能</li>\n<li>同时可以解决：\n(1)脏读（未提交就可以被其他客户端读取）\n(2)幻读（在多次查询的过程中查出更加新的数据）\n(3)不可重复读（对方客户端提交，本客户端就会立刻看到更新结果）</li>\n</ol>\n<p>事务 <code v-pre>ID</code> 越小，事务到来的顺序越靠前。</p>\n<p><code v-pre>MySQL</code> 底层是 <code v-pre>C/C++</code> 编写的，因此内部事务也一定是有对应的结构体/类，内部有事务的属性和方法，再生成事务实例进行组织（使用特点的数据结构进行组织）。</p>\n<p>而事务 <code v-pre>ID</code> 也一定是事务结构体内部的属性之一，此外还有其他的属性。</p>\n<h2 id=\"_4-2-三个隐藏字段\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_4-2-三个隐藏字段\"><span>4.2.三个隐藏字段</span></a></h2>\n<p>在数据表中，隐藏三个字段：</p>\n<ol>\n<li><code v-pre>DB_TRX_ID</code>：<code v-pre>6 byte</code>，记录创建这条记录，且最后一次修改（修改/插入）该记录的事务 <code v-pre>ID</code>（因此很容易对操作进行溯源）</li>\n<li><code v-pre>DB_ROLL_PTR</code>：<code v-pre>7 byte</code>，回滚指针，指向这条记录的上一个版本（简单理解成指向历史版本，这些数据一般都在 <code v-pre>undo log</code> 中。<code v-pre>MySQL</code> 在修改一条记录的时候，仍会保留该记录，然后再复制一份去修改，有点类似“写时拷贝”）</li>\n<li><code v-pre>DB_ROW_ID</code>：<code v-pre>6 byte</code>，隐含的自增 <code v-pre>ID</code>（也就是我们以前在索引里提到的隐藏主键），如果数据表没有主键，<code v-pre>InnoDB</code> 会自动以 <code v-pre>DB_ROW_ID</code> 产生一个聚簇索引（而如果用户设定了主键，就会导致该字段无效，因为一个表只能有一个主键）</li>\n<li><code v-pre>FLAG</code>：记录被更新或删除并不代表真的删除，而是 <code v-pre>flag</code> 变了，等到刷盘的时候再修改磁盘内的数据，并且如果希望恢复，也可以恢复该字段，达到恢复数据有效性的</li>\n</ol>\n<h2 id=\"_4-3-undo-日志\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_4-3-undo-日志\"><span>4.3.undo 日志</span></a></h2>\n<p>在提及 <code v-pre>undo</code> 日志之前，我们还需要提及下 <code v-pre>MySQL</code> 里的日志模块，<code v-pre>undo</code> 就是撤销的意思，本质是 <code v-pre>MySQL</code> 使用 <code v-pre>new/malloc()</code> 申请出来的一块内存空间，在内存种运行，临时性非常高。</p>\n<blockquote>\n<p>补充：我们之前提及的所有机制，索引、事务、隔离性、日志等，都是在内存种完成的操作，然后在特定的时候进行刷盘。</p>\n</blockquote>\n<h2 id=\"_4-4-模拟-mvcc\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_4-4-模拟-mvcc\"><span>4.4.模拟 MVCC</span></a></h2>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 创建一个用于解释的表结构</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> create</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> table</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> if</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> not</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> exists</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> student(</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    -></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> name</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> varchar</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">not null</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    -></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> age </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> not null</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    -></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> );</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">04</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>假设创建了上述表结构，此时数据表字段结构如下：</p>\n<table>\n<thead>\n<tr>\n<th>name</th>\n<th>age</th>\n<th>DB_TRX_ID(创建对应记录的事务 ID)</th>\n<th>DB_ROW_ID(隐式主键)</th>\n<th>DB_ROLL_PTR(回滚指针)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>limou</td>\n<td>18</td>\n<td>9（假设是 <code v-pre>9</code> 号 <code v-pre>ID</code> 的事务插入的）</td>\n<td>1</td>\n<td>null</td>\n</tr>\n</tbody>\n</table>\n<p>现在有一个事务 <code v-pre>ID=10</code> 的事务，封装内含操作为：修改 <code v-pre>name='limou'</code> 为 <code v-pre>name='dimou'</code> 的 <code v-pre>SQL</code> 语句。</p>\n<p>在修改前，先将原本未修改的记录 <code v-pre>[limou,18,9,1,null]</code> 加锁，然后保存/拷贝一份，放入 <code v-pre>undo log</code>，给予这条被保存的记录一个内存地址，假设是 <code v-pre>0xaa</code>。</p>\n<p>此时回到原来的记录，现在要对其进行修改：</p>\n<ol>\n<li><code v-pre>DB_ROLL_PTR=null</code> 变为 <code v-pre>DB_ROLL_PTR=0xaa</code>，这就是保存了一个版本</li>\n<li><code v-pre>name='limou'</code> 变为 <code v-pre>name='daimou'</code></li>\n<li><code v-pre>DB_TRX_ID=9</code> 变为 <code v-pre>DB_TRX_ID=10</code></li>\n<li><code v-pre>DB_ROW_ID=1</code> 变为 <code v-pre>DB_ROW_ID=2</code></li>\n</ol>\n<p>最后进行 <code v-pre>COMMIT</code> 时，释放该记录的锁，因此修改记录是原子的，保证串行化。</p>\n<table>\n<thead>\n<tr>\n<th>name</th>\n<th>age</th>\n<th>DB_TRX_ID(创建对应记录的事务 ID)</th>\n<th>DB_ROW_ID(隐式主键)</th>\n<th>DB_ROLL_PTR(回滚指针)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>dimou</td>\n<td>18</td>\n<td>10</td>\n<td>2</td>\n<td>0xaa</td>\n</tr>\n</tbody>\n</table>\n<p>假设这个时候又有一个事务 <code v-pre>ID=11</code> 的事务，该事务修改 <code v-pre>age=28</code>。也是要修改记录，那这条记录是哪一个记录的呢？首先排除历史记录，历史记录必须是稳定的，最好一次写入的。</p>\n<p>因此只能改最新的记录，能直接改么？不能！需要先复制一份记录 <code v-pre>[dimou,18,10,2,0xaa]</code> 到 <code v-pre>undo log</code> 中，然后再进行和第一次插入记录时一样的操作。</p>\n<blockquote>\n<p>注意：此时在 <code v-pre>undo log</code> 中的历史记录的字段 <code v-pre>DB_ROLL_PTR</code> 是相互链接的，形成版本链链表。</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>name</th>\n<th>age</th>\n<th>DB_TRX_ID(创建对应记录的事务 ID)</th>\n<th>DB_ROW_ID(隐式主键)</th>\n<th>DB_ROLL_PTR(回滚指针)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>dimou</td>\n<td>28</td>\n<td>11</td>\n<td>3</td>\n<td>0xbb</td>\n</tr>\n</tbody>\n</table>\n<p>而所谓的回滚操作，不就是对版本链链表的操作么（当然，肯定还有很多其他细节，这里不敢细细深究，我们这里简单来理解就行）。</p>\n<blockquote>\n<p>补充：实际上回滚时，不是直接把历史记录覆盖到数据表中的，而是和操作记录相反的 <code v-pre>SQL</code> 语句，如果需要回滚，只需要执行这些相反的操作就可以了（用户进行插入，<code v-pre>MySQL</code> 就记录一条相反的删除语法，方便以后回滚数据）。</p>\n</blockquote>\n<p>上面的版本链模型就是 <strong>多版本并发控制（<code v-pre>MVCC</code>）</strong> 的体现，其中每一个版本我们习惯称为一个 <strong>快照</strong>。</p>\n<p>那如果操作过多，<code v-pre>undo log</code> 会不会被塞满呢？首先 <code v-pre>undo log</code> 是一个内存级的。对于一个事务来说，一旦被 <code v-pre>COMMIT</code> 就会被 <code v-pre>delete/free()</code> 释放空间，内部的快照也会被清除（这也就是为什么 <code v-pre>COMMIT</code> 后的事务无法回滚的原因）。</p>\n<p>那在什么时候会持续保存快照数据？多事务的时候，有的时候访问的不是最新记录，而是历史记录（<code v-pre>undo log</code> 主要是配合隔离性设置的）。</p>\n<p>那如果删除数据呢？简单，设置 <code v-pre>flag</code> 就行，也是形成版本链/快照。</p>\n<p>那插入怎么办？数据表中本来就没有，那是怎么回滚的呢？记录和 <code v-pre>insert</code> 相反的 <code v-pre>delete</code> 操作即可，同样可以形成版本链/快照。</p>\n<p>那 <code v-pre>select</code> 呢？其本身只是查看数据表中的记录，版本记录没有意义，但是会有一个问题：<code v-pre>select</code> 该去查看哪一个版本的快照呢？</p>\n<p>首先我们定义读的方式：</p>\n<ul>\n<li><strong>当前读</strong>：读取到最新的数据，增删改数据表都涉及到当前读，而 <code v-pre>select</code> 有可能是当前读</li>\n<li><strong>快照读</strong>：读取到快照/历史版本就叫做快照读，一般是 <code v-pre>select</code> 在快照读</li>\n</ul>\n<p>读写并发时，如果是读取不同版本数据表，并且设置了隔离级别，这就注定是读取不同资源，也就无需加锁，因此就可以并发进行读写操作（当然，如果都是读操作都是当前读，也还是需要加锁的，因为是同一份最新的资源）。</p>\n<p>基本数据被其他客户端改了，只要读取的版本固定，就一定不会让不同的读取受到影响，进一步就是发生了隔离，这种就是在“版本上做隔离”！</p>\n<p><strong>而隔离级别的设置，就是对一个事务使用 <code v-pre>select</code> 能看到哪一个版本的设置</strong>。到此，隔离性会让所有并发执行事务看到不同的数据的基础也就找出来了（这是一个即提高效率，又为后续隔离性做铺垫的非常完美的方案）。</p>\n<p>因此隔离性、回滚，都是基于 <code v-pre>MVCC</code> 来控制、设置的。</p>\n<p>而串行化实际上就可以简单理解为，读写操作都要求加锁，导致事务变得串行化。</p>\n<p>为什么设置不同的隔离级别？首先事务是原子的，一定有先后顺序，从 <code v-pre>BEGIN</code> 到 <code v-pre>COMMIT</code> 一定是有一个过程的，多个事务中，让不同的事务看到它那个时间点该看到的数据（至于看到什么信息，是需要根据情况来抉择的，进而选择不同的隔离级别）。</p>\n<h2 id=\"_4-5-read-view\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_4-5-read-view\"><span>4.5.Read View</span></a></h2>\n<p><code v-pre>Read View</code> 就是事物进行快照读操作时生产的读视图，在事物执行的快照读那一刻，会生成数据库系统中一个快照，记录并维护系统当前活跃事务的 <code v-pre>ID</code>，这个 <code v-pre>ID</code> 是递增，所以最新的事务 <code v-pre>ID</code> 值越大。</p>\n<p>而 <code v-pre>Read View</code> 在 <code v-pre>MySQL</code> 源码中体现为一个类，本质就是一个结构体/类描述，用来进行可见性判断。当我们某个事务执行快照读的时候，会对该记录创建一个 <code v-pre>Read View</code> 读视图，可以把它的整体比作一个条件，用来判断当前事务能够看到哪个版本的数据，既可以是当前最新的数据，也可以是 <code v-pre>undo log</code> 里某个版本的数据。</p>\n<div class=\"language-cpp line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"cpp\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">//读视窗结构体</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> ReadView</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">private</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    trx_id_t</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> m_up_limit_id</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //低水位（没写错），小于等于这个 ID 的事务均可见</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    trx_id_t</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> m_low_limit_id</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //高水位（没写错），大于等于这个 ID 的事务均不可见</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    trx_id_t</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> m_creator_trx_id</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //创建该 Read View 对象的事务 ID</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    ids_t</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> m_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //创建视图时的其他一起活跃事务的 ID 列表</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    //up_limit_id：记录 m_ids 列表中事务 ID 最小的 ID（没有写错）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    //low_limit_id：Read View 生成时刻系统尚未分配的下一个事务 ID，就是目前已出现事务 ID 的最大值 +1（没有写错），不是事务最大值 +</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    trx_id_t</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> m_low_limit_no</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //配合 purge 值，了解一下就行，我们不关心</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    bool</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> m_closed</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //标记视图是否被关闭，也不太关心</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">};</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><blockquote>\n<p>补充：可以尝试使用进程结构体来类比事务结构体，而进程地址空间类比读视图。</p>\n</blockquote>\n<p>而 <strong>只有首次</strong> 某个事务执行快照读的时候，才会对该记录创建一个 <code v-pre>Read View</code> 读视图（进程也是类似）。</p>\n<p>我们再实际读取版本链的时候，是能读取到每个版本对于的事务 <code v-pre>ID</code> 的，即 <code v-pre>DB_TRX_ID</code> 字段的信息。</p>\n<p>那么现在的工作就是将 <code v-pre>DB_TRX_ID</code> 和 <code v-pre>ReadView{/*...*/};</code> 做比较，来得到事务是否可见的判断。</p>\n<figure><img src=\"@source/4.业务服务/2.存储服务/assets/cadf5343aace0afadac2ffc4c5f52d5.png\" alt=\"cadf5343aace0afadac2ffc4c5f52d5\" tabindex=\"0\" loading=\"lazy\"><figcaption>cadf5343aace0afadac2ffc4c5f52d5</figcaption></figure>\n<p>读取 <code v-pre>Undo Log</code> 的那一刻生成读视图：\n(1)遇到快照记录中，<code v-pre>DB_TRX_ID=m_creator_trx_id</code> 时，\n则说明是自己事务中处理的历史记录，自己做的操作就应该被自己 <strong>看到</strong>，因此跳过该记录就行。\n(2)遇到快照记录中，和同时期运行事务的最小 <code v-pre>ID</code>，即 <code v-pre>DB_TRX_ID&lt;up_limit_id</code> 时，\n则说明该记录对于的事务已经被提交/结束，否者不可能要小，所以我这个事务应该 <strong>看到</strong> 这个数据。\n(3)遇到快照记录中，大于等于系统未分批事务的最小 <code v-pre>ID</code>，即 <code v-pre>DB_TRX_ID&gt;=low_limit_id</code> 时，\n则说明我这个记录在形成快照时，这个快照记录对应的事务还没开始呢，但是这个事务比我先执行修改，导致我找得到这个记录，但由于是后来者，我理应 <strong>看不到</strong> 这个记录\n(4)遇到快照记录中，有 <code v-pre>up_limit_id&lt;DB_TRX_ID&lt;low_limit_id</code> 时，\n这说明该快照对应记录是同处于交叉运行的活跃事务，这个事务是否要被我看到，还没有提交，我也 <strong>看不到</strong> 这个记录。</p>\n<h2 id=\"_4-6-实际操作\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_4-6-实际操作\"><span>4.6.实际操作</span></a></h2>\n<p>假设当前学生表内有记录如下：</p>\n<table>\n<thead>\n<tr>\n<th>name</th>\n<th>age</th>\n<th>DB_TRX_ID(创建对应记录的事务 ID)</th>\n<th>DB_ROW_ID(隐式主键)</th>\n<th>DB_ROLL_PTR(回滚指针)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>limou</td>\n<td>18</td>\n<td>0</td>\n<td>1</td>\n<td>0xaa</td>\n</tr>\n</tbody>\n</table>\n<p>然后又如下几个事务：</p>\n<table>\n<thead>\n<tr>\n<th>时间点</th>\n<th>事务 1 [id = 1]</th>\n<th>事务 2 [id = 1]</th>\n<th>事务 3 [id = 1]</th>\n<th>事务 4 [id = 1]</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td>事务开始</td>\n<td>事务开始</td>\n<td>事务开始</td>\n<td>事务开始</td>\n</tr>\n<tr>\n<td>2</td>\n<td>交叉...</td>\n<td>交叉...</td>\n<td>交叉...</td>\n<td>修改提交 <code v-pre>'limou'-&gt;'dimou'</code></td>\n</tr>\n<tr>\n<td>3</td>\n<td>进行中</td>\n<td>快照读</td>\n<td>进行中</td>\n<td></td>\n</tr>\n<tr>\n<td>4</td>\n<td>...</td>\n<td>...</td>\n<td>...</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>注意：<code v-pre>ID</code> 值越小的事务越先被启动，这点需要注意。</p>\n</blockquote>\n<ol>\n<li>\n<p>事务 <code v-pre>4</code> 成功修改 <code v-pre>name='dimou'</code>，并且生成对应的版本链</p>\n<figure><img src=\"@source/4.业务服务/2.存储服务/assets/a97981ed798f4d965aad3ceb6ada95a.png\" alt=\"a97981ed798f4d965aad3ceb6ada95a\" tabindex=\"0\" loading=\"lazy\"><figcaption>a97981ed798f4d965aad3ceb6ada95a</figcaption></figure>\n</li>\n<li>\n<p>事务 <code v-pre>2</code> 对某行执行了快照读，此时数据库为改行数据生成一个 <code v-pre>Read View</code> 读视图，其内部属性值如下：</p>\n<div class=\"language-cpp line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"cpp\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">//事务2的 Read View</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">m_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //[1,3]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">up_limit_id</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">low_limit_id</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //4+1=5，注意是系统未分配的最近的事务 ID</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">creator_trx_id</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //本事务的事务 ID=2</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>上述属性会从 <code v-pre>DB_ROW_ID=2</code> 开始遍历版本链进行比对，事务二能不能看到事务四的提交呢（先不考虑隔离级别，直接按照我本小节的理解）？</p>\n</li>\n<li>\n<p>遍历快照可以确定，快照不对应事务的 <code v-pre>ID</code> 值四种情况，如果可以看到，这就是读提交 <code v-pre>RC</code> 的隔离级别</p>\n</li>\n</ol>\n<p>那 <code v-pre>RC</code> 究竟和 <code v-pre>RR</code> 有什么区别呢（分别指 <code v-pre>READ COMMITTED/REPEATABLE READ</code>）？</p>\n<p>首先您需要知道，指令 <code v-pre>SELECT * FROM table_name LOCK IN SHARE MODE;</code> 就是当前读，而不是您以前使用 <code v-pre>SELECT</code> 时默认的快照读，然后我们做一个实验：</p>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 设置为 RR 模式</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> global</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> transaction</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> isolation</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> level</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> REPEATABLE</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> READ</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 重启终端查看是否更改</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> @@tx_isolation;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">-----------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| @@tx_isolation |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">-----------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">REPEATABLE</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">READ</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">-----------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> warning (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 创建测试用的表</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">create</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> table</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> if</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> not</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> exists</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account(</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    id </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> primary key</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">    name</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> varchar</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">50</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">not null</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> default</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> ''</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    age </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">)ENGINE</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">InnoDB </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">DEFAULT</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> CHARSET</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">UTF8;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 插入一些记录，用来测试</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> insert into</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account (id, </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, age) </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">values</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">iimou</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">15</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><table>\n<thead>\n<tr>\n<th>事务 A</th>\n<th>事务 B</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code v-pre>begin;</code> 事务开始</td>\n<td><code v-pre>begin;</code> 事务开始</td>\n</tr>\n<tr>\n<td>交叉...</td>\n<td>交叉...</td>\n</tr>\n<tr>\n<td><code v-pre>select * from account;</code> 快照读（无影响）</td>\n<td><code v-pre>select * from account;</code> （此时第一次形成了 <code v-pre>Read View</code> 快照读，认为 <code v-pre>A</code> 和自己是一块运行的）</td>\n</tr>\n<tr>\n<td><code v-pre>update account set age=18 where id = 1;</code>（更新）</td>\n<td>-</td>\n</tr>\n<tr>\n<td><code v-pre>commit;</code></td>\n<td>-</td>\n</tr>\n<tr>\n<td>-</td>\n<td><code v-pre>select * from account;</code> 快照读（没读到 <code v-pre>age=18</code>）</td>\n</tr>\n<tr>\n<td>-</td>\n<td><code v-pre>select * from account lock in share mode;</code> 当前读（读到了 <code v-pre>age=18</code>）</td>\n</tr>\n</tbody>\n</table>\n<p>再来做一个测试：</p>\n<table>\n<thead>\n<tr>\n<th>事务 A</th>\n<th>事务 B</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code v-pre>begin;</code> （事务开始）</td>\n<td><code v-pre>begin;</code> （事务开始）</td>\n</tr>\n<tr>\n<td>交叉...</td>\n<td>交叉...</td>\n</tr>\n<tr>\n<td><code v-pre>select * from account;</code></td>\n<td>-</td>\n</tr>\n<tr>\n<td><code v-pre>update account set age=28 where id = 1;</code>（更新）</td>\n<td>-</td>\n</tr>\n<tr>\n<td><code v-pre>commit;</code></td>\n<td>-</td>\n</tr>\n<tr>\n<td>-</td>\n<td><code v-pre>select * from account;</code> （只在这个时候生成 <code v-pre>Read View</code>,读到 <code v-pre>age=28</code>，<code v-pre>B</code> 不认为 <code v-pre>A</code> 和自己同时活跃）</td>\n</tr>\n<tr>\n<td>-</td>\n<td><code v-pre>select * from account lock in share mode;</code>（读到了 <code v-pre>age=28</code>）</td>\n</tr>\n</tbody>\n</table>\n<p>欸，不是可重复读吗？为什么会被修改呢？如果你是事务 <code v-pre>B</code>，你自己一直不查你哪里知道数据库里是什么？只需要保证你从第一次读取的时候到最后退出时，都是读取到同一个数据就行了。在那之前，改了什么根本不需要关系。</p>\n<p>因此这里就可以得到一个结论：<code v-pre>Read View</code> 形成的时机会影响可见性。</p>\n<p>因此 <code v-pre>RR</code> 和 <code v-pre>RC</code> 的深层区别是 <code v-pre>Read View</code> 形成时机不同。</p>\n<ul>\n<li>\n<p>在 <code v-pre>RR</code> 级别下的某个事务的对某条记录的第一次快照读会创建一个快照及 <code v-pre>Read View</code>，将当前系统活跃的其他事务记录起来。</p>\n<p>此后在调用快照读的时候，还是使用的是同一个 <code v-pre>Read View</code>，所以只要当前事务在其他事务提交更新之前使用过快照读，那么之后的快照读使用的都是同一个 <code v-pre>Read View</code>，所以对之后的修改不可见。</p>\n<p><code v-pre>RR</code> 级别下，快照读生成 <code v-pre>Read View</code> 时，<code v-pre>Read View</code> 会记录此时所有其他活动事务的快照，这些事务的修改对于当前事务都是不可见的。而早于 <code v-pre>Read View</code> 创建的事务所做的修改均是可见。</p>\n</li>\n<li>\n<p>而在 <code v-pre>RC</code> 级别下的，事务中，每次快照读都会新生成一个快照和<code v-pre>Read View</code>，这就是我们在 <code v-pre>RC</code> 级别下的事务中可以看到别的事务提交的更新的原因。总之在 <code v-pre>RC</code> 隔离级别下，是每个快照读都会生成并获取最新的 <code v-pre>Read View</code>。所以，RC才会有不可重复读问题。</p>\n</li>\n</ul>\n<blockquote>\n<p>补充：建议再看一遍，待补充...</p>\n</blockquote>\n</template>","contentStripped":"<blockquote>\n<p>前要：在网络服务中，如果对 <code v-pre>CURD</code> 不加限制，会出现什么问题？</p>\n<p>在多个客户端同时向一个卖票服务器买票时（假设票数只剩一张），<code v-pre>A</code> 客户端让数据库内的票数 <code v-pre>count</code> 减 <code v-pre>1</code>，但是还没来得及更新数据，又有 <code v-pre>B</code> 服务器查询数据库，此时 <code v-pre>B</code> 服务器看到票数还是 <code v-pre>1</code>，又进行了减 <code v-pre>1</code> 操作，导致一张票被同时卖了两次。</p>\n</blockquote>\n<p><code v-pre>CURD</code> 的过程需要满足什么条件，才能解决上述问题呢？</p>\n<ol>\n<li>买票的过程得应该是原子操作（要么抢到，要么没抢）</li>\n<li>买票的过程中不能被相互影响（不能被互相影响，要割裂/独立开来）</li>\n<li>买完票后应该要永久有效（必须要做持久化，不能只是在内存中操作）</li>\n<li>ef</li>\n<li>买前和买后都是确定的状态（不能出现中间状态，要保证一致性）</li>\n</ol>\n<h1 id=\"_1-事务的理解\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-事务的理解\"><span>1.事务的理解</span></a></h1>\n<h2 id=\"_1-1-事务的概念\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-1-事务的概念\"><span>1.1.事务的概念</span></a></h2>\n<p>事务简单来理解就是 <strong>一组 DML 语句</strong>，也就是一组用于数据操作（插入数据、删除数据...）的语句。</p>\n<p>事务主要处理操作量大，复杂度高的数据，这些数据往往需要多条 <code v-pre>SQL</code> 语句来构成。</p>\n<p>但是事务还不仅仅是多条语句的集合，还必须保证四个属性（<code v-pre>ACID</code>）才能保证安全运行事务：</p>\n<ul>\n<li>\n<p><strong>原子性(Atomicity)</strong>：一组 <code v-pre>DML</code> 语句/一个事务，要么全部成功，要么全部失败，这是由 <code v-pre>MySQL</code> 提供的机制来保障的。</p>\n</li>\n<li>\n<p><strong>一致性(Consistency)</strong>：在事务开始和结束以后，数据库的完整性没有被破坏，写入的数据必须完全符合所有的预设规则（在 <code v-pre>MySQL</code> 中，一致性时被其他三个属性来保证的，但是需要数据库和用户来配合，才能得到一致性）</p>\n</li>\n<li>\n<p><strong>隔离性(Isolation)</strong>：防止多个事务并发执行时由于交叉执行导致的数据不一致问题，事务隔离有不同的等级</p>\n<p>(1)读未提交（<code v-pre>Read Uncommitted</code>）</p>\n<p>(2)读提交（<code v-pre>Read Committed</code>）</p>\n<p>(3)可重复读（<code v-pre>Repeatable Read</code>）</p>\n<p>(4)串行化（<code v-pre>Serialzable</code>）</p>\n</li>\n<li>\n<p><strong>持久性(Durability)</strong>：事务处理完后，对表中数据的影响是永久的（哪怕系统挂了也不会丢失），也就是持久化</p>\n</li>\n</ul>\n<blockquote>\n<p>注意：学习事务一定要在使用数据库的用户视角来理解。</p>\n</blockquote>\n<p>事务在 <code v-pre>MySQL</code> 内也一定是一个具体对象，这就需要先描述再组织。</p>\n<p>另外，事务不是 <code v-pre>MySQl</code> 天然就存在，而是为了在应用程序访问数据库的时候，能够简化编程模型，不需要考虑各种潜在并发问题、网络问题，用户只需要提交和回滚。因此，事务的本质是为了应用层服务的，而不是面向数据库内部。</p>\n<h2 id=\"_1-2-事务的版本\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-事务的版本\"><span>1.2.事务的版本</span></a></h2>\n<p><code v-pre>MySQL</code> 中只有使用了 <code v-pre>Innodb</code> 数据库引擎的数据库或数据表才可以支持事务，其他基本都不支持。</p>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 查看 MySQL 的引擎是否支持事务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">show engines \\G</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">***************************</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">. </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">row</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> ***************************</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">      Engine: InnoDB</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Support: </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">DEFAULT</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Comment: Supports transactions, </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">row</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">level</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> locking, </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">and</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> foreign keys</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Transactions: YES</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">          XA: YES</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  Savepoints: YES</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">***************************</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">. </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">row</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> ***************************</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">      Engine: MRG_MYISAM</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Support: YES</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Comment: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Collection</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> of identical MyISAM tables</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Transactions: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">          XA: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  Savepoints: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">***************************</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">. </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">row</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> ***************************</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">      Engine: MEMORY</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Support: YES</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Comment: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Hash</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> based, stored </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">in</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> memory, useful </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> temporary tables</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Transactions: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">          XA: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  Savepoints: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">***************************</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 4</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">. </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">row</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> ***************************</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">      Engine: BLACKHOLE</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Support: YES</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Comment: </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">/</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">dev</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">/</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">null</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> storage engine (anything you write </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">to</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> it disappears)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Transactions: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">          XA: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  Savepoints: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">***************************</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 5</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">. </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">row</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> ***************************</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">      Engine: MyISAM</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Support: YES</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Comment: MyISAM storage engine</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Transactions: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">          XA: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  Savepoints: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">***************************</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">. </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">row</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> ***************************</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">      Engine: CSV</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Support: YES</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Comment: CSV storage engine</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Transactions: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">          XA: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  Savepoints: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">***************************</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 7</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">. </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">row</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> ***************************</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">      Engine: ARCHIVE</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Support: YES</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Comment: Archive storage engine</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Transactions: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">          XA: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  Savepoints: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">***************************</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 8</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">. </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">row</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> ***************************</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">      Engine: PERFORMANCE_SCHEMA</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Support: YES</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Comment: Performance </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Schema</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Transactions: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">          XA: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  Savepoints: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">***************************</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 9</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">. </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">row</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> ***************************</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">      Engine: FEDERATED</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Support: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Comment: Federated MySQL storage engine</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Transactions: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NULL</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">          XA: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NULL</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  Savepoints: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NULL</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">9</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h1 id=\"_2-事务的操作\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-事务的操作\"><span>2.事务的操作</span></a></h1>\n<h2 id=\"_2-1-做一些准备工作\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-1-做一些准备工作\"><span>2.1.做一些准备工作</span></a></h2>\n<p>开始之前，先设置一下隔离性（后面提及）。</p>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 设置隔离性</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> global</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> transaction</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> isolation</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> level</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> READ</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> UNCOMMITTED</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> @@tx_isolation;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| @@tx_isolation   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">READ</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">UNCOMMITTED</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> warning (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>首先，事务有两种提交方式：</p>\n<ul>\n<li>自动提交</li>\n<li>手动提交</li>\n</ul>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 查看事务提交方式</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> show variables </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">like</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">autocommit</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| Variable_name | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Value</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| autocommit    | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">ON</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">01</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>可以用 <code v-pre>SET</code> 来改变 <code v-pre>MySQL</code> 的自动提交方式。</p>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 取消事务自动提交</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> autocommit</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> show variables </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">like</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">autocommit</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| Variable_name | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Value</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| autocommit    | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">OFF</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> autocommit</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> show variables </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">like</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">autocommit</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| Variable_name | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Value</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| autocommit    | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">ON</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>然后我们切换超级用户，使用 <code v-pre>netstat -nltp</code> 是一个用于显示网络连接、路由表和网络接口信息的命令行工具查看 <code v-pre>MySQL</code> 是否成功运行且占用端口号。</p>\n<div class=\"language-cmd line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"cmd\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-cmd\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 查看网络状态</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">netstat</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">nltp</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Active Internet </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">connections</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">only</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> servers</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Proto </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Recv</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Q</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> Send</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Q</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> Local Address           Foreign Address         State       </span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">PID</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">/</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Program</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> name    </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> tcp6       </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">      0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> :::</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3306</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                 :::</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                    LISTEN      </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">7404</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">/</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">mysqld</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>原本是应该使用 <code v-pre>Windows11</code> 的 <code v-pre>cmd</code> 来远程访问 <code v-pre>Centos7</code> 云服务的 <code v-pre>MySQL</code> 服务，不过需要提前在 <code v-pre>Windows11</code> 中提前下载好 <code v-pre>MySQL</code>，所以我们先用本地的两个客户端来模拟，后续再来详细了解。</p>\n<p>然后修改事务等级，不然有些现象会看不到。</p>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端中设置事务隔离级别并且重启检查</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> global</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> transaction</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> isolation</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> level</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> read</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> uncommitted</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> quit</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Bye</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">$ mysql </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">uroot </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">p</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Enter </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">password</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Welcome </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">to</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> the MySQL monitor.  Commands </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">end</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> with</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> ; </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">or</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> \\g.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Your MySQL </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">connection</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> id </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">is</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 32</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Server</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> version</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">5</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">7</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">44</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> MySQL Community </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Server</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (GPL)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Copyright (c) </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2000</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2023</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, Oracle </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">and</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">/</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">or</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> its affiliates.</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Oracle </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">is</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> a registered trademark of Oracle Corporation </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">and</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">/</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">or</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> its</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">affiliates. Other names may be trademarks of their respective</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">owners.</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Type</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">help;</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> or</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">\\h</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> help. </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Type</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">\\c</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> to</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> clear</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> the current input </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">statement</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> @@tx_isolation;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| @@tx_isolation   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">READ</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">UNCOMMITTED</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> warning (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>启动两个 <code v-pre>MySQL</code> 客户端（模拟并发场景），然后其中一个客户端建立一个如下的表结构：</p>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端1：创建表结构</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">create</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> table</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> if</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> not</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> exists</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account(</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">id </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> primary key</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> varchar</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">50</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">not null</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> default</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> ''</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">blance </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">decimal</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">10</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">not null</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> default</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">)ENGINE</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">InnoDB </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">DEFAULT</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> CHARSET</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">UTF8;</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端2：查看是否能看到 account 数据表</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> desc</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">--------+---------------+------+-----+---------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| Field  | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Type</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">          | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Null</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Key</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">Default</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | Extra |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">--------+---------------+------+-----+---------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id     | </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">)       | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">   | PRI | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NULL</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    |       |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">   | </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">varchar</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">50</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">)   | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">   |     |         |       |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| blance | </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">decimal</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">10</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NO</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">   |     | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    |       |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">--------+---------------+------+-----+---------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>可以在一个客户端中查看连接情况，可以看到确实存在两个本地客户端。</p>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端1：查看 MySQL 的连接情况</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> show processlist\\G</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">***************************</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">. </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">row</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> ***************************</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Id: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">33</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">   User: ljp</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">   Host: localhost</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     db: limou_database</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Command: Query</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">   Time</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">  State</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: starting</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">   Info: show processlist</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">***************************</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">. </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">row</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> ***************************</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     Id: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">34</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">   User: ljp</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">   Host: localhost</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">     db: limou_database</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Command: Sleep</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">   Time</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">355</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">  State</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">   Info: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">NULL</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2 id=\"_2-2-正常情况的事务\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-2-正常情况的事务\"><span>2.2.正常情况的事务</span></a></h2>\n<p>启动事务有两种方法：(1)<code v-pre>start transaction;</code> (2)<code v-pre>begin</code></p>\n<p>一旦开启事务，后续的 <code v-pre>SQL</code> 操作都属于同一个事务的部分。并且，我还设置了一个保存点（可选）</p>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端1：启动事务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> start transaction</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> savepoint s1;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端2：启动事务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> begin</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Empty</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>然后进行插入工作，设置第二个保存点，并且查看插入的数据是否同步到另外一个客户端。</p>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端1：插入数据</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> insert into</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">values</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">limou</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">10000</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> savepoint s2;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端2：查看数据</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">10000</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>尝试插入更多的插入和设置保存点的操作，同时没插入一个记录，就检查客户端是否数据同步。</p>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端1：插入数据和保存</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> savepoint s2;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> insert into</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">values</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">dimou</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> savepoint s3;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> insert into</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">values</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">iimou</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">10431</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端2：每次插入，就查看一次数据表</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">10000</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">10000</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | iimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">10431</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>如果我们突然后悔了，可以回滚事务。</p>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端1：回滚事务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rollback</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> to</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> s3;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端2：查看回滚后的数据表</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">10000</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>可以看到，数据表确实发生了回退，如果我们这个时候使用 <code v-pre>COMMIT</code> 就会提交本次事务。</p>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端1：提交事务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> commit</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">01</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><blockquote>\n<p>补充：使用 <code v-pre>roolback</code> 还可以将所有操作全部取消，但是一般很少这么做。</p>\n</blockquote>\n<p>而事务只有在启动的时候才可以进行回滚操作，而一旦提交了就无法进行回滚。</p>\n<h2 id=\"_2-3-异常情况的事务\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-3-异常情况的事务\"><span>2.3.异常情况的事务</span></a></h2>\n<p>如果其中一个服务端在事务状态下奔溃了会怎么样？其他客户端会自动回滚，也就是保证原子性，要么不做，要么就操作完。</p>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端1：不断插入数据最后因为异常导致奔溃，插入一次就在客户端2中查看一次</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> begin</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> insert into</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">values</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">eimou</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">20431</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">01</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> insert into</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">values</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">4</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">eimou</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">30434</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> ^C</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> Aborted</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端2：客户端1插入后不断查找数据表，最后检查奔溃后的数据表</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">10000</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">10000</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | eimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">20431</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">4</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | eimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">30434</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">4</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 奔溃后，这里自动发生了回滚，回到开头</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">10000</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>也有一些其他的情况会发生自动回滚（客户端因为关闭 <code v-pre>shell</code> 而导致退出），但是如果事务已经进行了提交（也就是使用了 <code v-pre>COMMIT</code>），就不会再进行回滚（包括因为崩溃造成的自动回滚）。</p>\n<p>但是我们之前设置的自动提交又是什么鬼？不是事务会自动提交吗？从现象来看，无论是设置 <code v-pre>autocommit</code> 为 <code v-pre>OFF</code> 还是 <code v-pre>ON</code> 现象都是一样的结果（这个您可以自己实验一下），那这个 <code v-pre>autocommit</code> 究竟有什么用呢？您先知道一个点，只要是手动开启启动事务，就必须手动提交，和是否设置自动提交无关即可。</p>\n<p>而对比有无设置 <code v-pre>autocommit</code>  的两种情况。</p>\n<h3 id=\"_2-3-1-设置为-off\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-3-1-设置为-off\"><span>2.3.1.设置为 OFF</span></a></h3>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端1：设置 autocommit 为 </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">OFF</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">，然后在事务中进行删除记录</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> show variables </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">like</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">autocommit</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| Variable_name | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Value</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| autocommit    | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">ON</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> autocommit</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> show variables </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">like</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">autocommit</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| Variable_name | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Value</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| autocommit    | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">OFF</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> delete</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">where</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> id</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">01</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> Aborted</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端2：不断查看数据表</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1没删除之前</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | timou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">50434</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1删除后</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1奔溃后，发现记录恢复</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | timou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">50434</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3 id=\"_2-3-2-设置为-on\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-3-2-设置为-on\"><span>2.3.2.设置为 ON</span></a></h3>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端1：进行删除操作，但是不在事务中删除后崩溃</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> show variables </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">like</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">autocommit</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| Variable_name | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Value</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| autocommit    | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">ON</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> delete</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">where</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> id</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">01</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> Aborted</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端2：不断查看数据表</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1没删除之前</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | timou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">50434</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1删除后</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1奔溃后，发现记录没有恢复</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>而且就算客户端 2 之前有做 <code v-pre>BEGIN</code>，再 <code v-pre>COMMIT</code> 后也不会恢复数据。</p>\n<p>以上测试说明，只要设置了 <code v-pre>autocommit</code>，就会把一条单纯的 <code v-pre>SQL</code> 语句单独看作一个事务，都会被自动 <code v-pre>BEGIN</code> 和 <code v-pre>COMMIT</code>。因此如果没设置 <code v-pre>autocommit</code> 就会因为没有 <code v-pre>COMMIT</code> 而导致数据回滚。</p>\n<blockquote>\n<p>复习：再理一理，<code v-pre>BEGIN</code> 是开启事务处理，<code v-pre>COMMIT</code> 是事务提交，防止回滚。</p>\n</blockquote>\n<p>但是如果我们手动进行回滚呢？</p>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端1：删除数据表，但是先 </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">commit</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> 再崩溃</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> show variables </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">like</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">autocommit</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| Variable_name | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Value</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| autocommit    | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">ON</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> autocommit</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> show variables </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">like</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">autocommit</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| Variable_name | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Value</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| autocommit    | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">OFF</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">01</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> delete</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">where</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> id</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> commit</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> Aborted</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端2：不断查看数据表</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1删除记录前</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1删除记录后</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Empty</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1崩溃后，没有发生回滚</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Empty</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>也侧面证明了：对于 <code v-pre>InnoDB</code> 里一条单纯的 <code v-pre>SQL</code> 就是一个完整的事务，最后都会因为 <code v-pre>autocommit=ON</code> 而自动提交（但是 <code v-pre>SELECT</code> 有点特殊，您先记住就行，因为 <code v-pre>MySQL</code> 有 <code v-pre>MVCC</code>）。</p>\n<blockquote>\n<p>补充：<code v-pre>COMMIT</code> 操作实际上就是数据持久化的一种手段。</p>\n</blockquote>\n<p>到这里就可以看到事务本身的 <strong>原子性（回滚）</strong> 和 <strong>持久性（提交）</strong>。</p>\n<h1 id=\"_3-事务的隔离\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-事务的隔离\"><span>3.事务的隔离</span></a></h1>\n<h2 id=\"_3-1-隔离和隔离级别\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-1-隔离和隔离级别\"><span>3.1.隔离和隔离级别</span></a></h2>\n<p>但是事务的隔离性体现在哪里呢？为何需要隔离呢？不隔离可以吗？</p>\n<p>一个 <code v-pre>MySQL</code> 服务可能会被多个客户端进程访问（一般都是程序直接连接数据库，命令行操作很少用到），访问的方式是以事务进行的。</p>\n<p>而事务在上述小节中实现了原子性和持久性，事务注定有执行前、执行中、执行后，一旦异常就会回滚。为了保证事务在执行中，为了保证事务尽量不受干扰，就产生的隔离性，根据不同的干扰级别可以设置不同的隔离级别。</p>\n<p>实际上，正常人的认知是：无论别的客户端 <code v-pre>A</code> 怎么对数据表怎么增删查改，另外一个客户端 <code v-pre>B</code> 要拿到最新的数据，不管两进程的先后顺序如何，都必须要先等待进程 <code v-pre>A</code> 完成一个事务。这个观点有问题吗？有点，举一个不恰当的例子，一个婴儿在出生后，不需要知道父母之前的经历，也能和父母一起创造新的经历，每个人只需要在自己生命周期内看到的世界也都是不一样的。这代表着：<strong>不一定需要获取最新的消息，只需要在自己的生命周期内看到该看到的就行，这就是隔离性</strong>。</p>\n<p>在 <code v-pre>MySQL</code> 中，原子性不仅是在操作上原子，还体现在时间上。一个改表的 <code v-pre>A</code> 客户端先执行事务，一个查表的 <code v-pre>B</code> 客户端后执行事务，两者在执行中交叉进行。而 <code v-pre>B</code> 客户端执行得较慢，<code v-pre>A</code> 客户端执行得较快，那么 <code v-pre>B</code> 客户端是否应该立刻获取最新的数据呢？不应该！因为要保证隔离性，隔离运行中的事务。</p>\n<p>因此隔离体现在运行事务中，而隔离性要隔离的程度就是隔离级别（根据内容重要度的不同，有些信息是可以不被隔离的，因此就有隔离级别），在交叉事务处理过程中，不同的事务级别分为：</p>\n<ul>\n<li><strong>读未提交(READ UNCOMMITTED)</strong>：所有事务都可以看到其他事务没有提交的执行结果（相当于没有任何隔离性，实际生产中不太可能用到这个级别），我们之前的书写的事务代码，就是读未提交，没有进行 <code v-pre>COMMIT</code> 也会看到事务中的操作后结果，而对方客户端一旦崩溃就和没有存在过一样，则本客户端发送回滚</li>\n<li><strong>读已提交(READ COMMITTED)</strong>：只有对事务进行了 <code v-pre>COMMIT</code>，才能看到更新的数据表（一条单纯的 <code v-pre>SQL</code> 语句本身就被包装成一个事务，因此使用单纯的 <code v-pre>SQL</code> 语句会让所有客户端都读取到）</li>\n<li><strong>可重复读(REPEATABLE READ)</strong>：即便对方客户端提交了，哪怕是退出了，本客户端都无法实时知道更新结果，只有在本客户端退出了再次启动，才能看到更新后的新数据（这是 <code v-pre>MySQL</code> 默认的隔离等级），但是可能会有幻读的问题。</li>\n<li><strong>串行化(SERIALIZABLE)</strong>：事务隔离的最高级别，强制事务进行排序，使之不会相互冲突，确实解决了幻读的问题，但是会导致超时和锁竞争（太极端了，实际生产中很少用）</li>\n</ul>\n<p>隔离级别，基本都是通过锁来实现的，不同的隔离级别使用的锁不一样，常见的有：表锁、行锁、读锁、写锁、间隙锁（<code v-pre>GAP</code>）、<code v-pre>Next-Key</code> 锁，简单认识一下就行。</p>\n<h2 id=\"_3-2-查看和设置隔离级别\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-2-查看和设置隔离级别\"><span>3.2.查看和设置隔离级别</span></a></h2>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 查看隔离级别</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> @@</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">global</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">tx_isolation</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">; # 全局设置</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">-----------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| @@</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">global</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">tx_isolation</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">-----------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">READ</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">UNCOMMITTED</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">      |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">-----------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> warning (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> @@</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">session</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">tx_isolation</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">; # 当前会话设置</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">------------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| @@</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">session</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">tx_isolation</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">------------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">READ</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">UNCOMMITTED</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">       |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">------------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> warning (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> @@tx_isolation; # 默认显示会话设置（就是当前会话的设置）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| @@tx_isolation   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">READ</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">UNCOMMITTED</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> warning (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>使用 <code v-pre>SET {SESSION/GLOBAL} TRANSACTION ISOLATION LEVEL {READ UNCOMMITTED/READ COMMITTED/REPEATABLE READ/SERIALIZABLE};</code> 就可以设置隔离级别。</p>\n<p>而如果设置了全局设置，只会在下一次重启客户端时才会更新设置，一般一开始设置了隔离级别就不要修改了，最好保证隔离级别是一致的。</p>\n<h2 id=\"_3-3-不同隔离级别带来的影响\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-3-不同隔离级别带来的影响\"><span>3.3.不同隔离级别带来的影响</span></a></h2>\n<p>再次强调，隔离主要是为了避免交叉事务出现问题。</p>\n<h3 id=\"_3-3-1-读未提交\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-3-1-读未提交\"><span>3.3.1.读未提交</span></a></h3>\n<blockquote>\n<p>复习：<strong>读未提交</strong>，所有事务都可以看到其他事务没有提交的执行结果（相当于没有任何隔离性，实际生产中不太可能用到这个级别），我们之前的书写的事务代码，就是读未提交，没有进行 <code v-pre>COMMIT</code> 也会看到事务中的操作后结果，而对方客户端一旦崩溃就和没有存在过一样，则本客户端发送回滚。</p>\n</blockquote>\n<p>实际上之前已经做过了，最上面从设置隔离级别为 <code v-pre>READ-UNCOMMITTED</code>，后续的操作都是读未提交情景下的操作。</p>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 设置隔离级别</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> global</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> transaction</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> isolation</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> level</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> READ</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> UNCOMMITTED</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 然后重启两个客户端，分别查看隔离等级</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> @@tx_isolation;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| @@tx_isolation   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">READ</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">UNCOMMITTED</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> warning (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端1：在事务中进行删除记录</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> autocommit</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> show variables </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">like</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">autocommit</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| Variable_name | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Value</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| autocommit    | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">OFF</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> delete</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">where</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> id</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">01</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> Aborted # 这里奔溃后，就相当于没有进行 </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">COMMIT</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端2：不断查看数据表</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1没删除之前</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | timou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">50434</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1删除后，还没提交就被读取到了，也就是“读未提交”</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1奔溃后，发现记录恢复</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance   |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11030</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | timou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">50434</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+----------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>这种未提交就可以被其他客户端读取的现象，也叫做 <strong>脏读</strong> 现象。</p>\n<h3 id=\"_3-3-2-读已提交\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-3-2-读已提交\"><span>3.3.2.读已提交</span></a></h3>\n<blockquote>\n<p>复习：<strong>读已提交</strong>，只有对事务进行了 <code v-pre>COMMIT</code>，才能看到更新的数据表（一条单纯的 <code v-pre>SQL</code> 语句本身就被包装成一个事务，因此使用单纯的 <code v-pre>SQL</code> 语句会让所有客户端都读取到）。</p>\n</blockquote>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 设置隔离级别</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> global</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> transaction</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> isolation</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> level</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> READ</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> COMMITTED</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 然后重启两个客户端，分别查看隔离等级</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> @@</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">global</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">tx_isolation</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">-----------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| @@</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">global</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">tx_isolation</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">-----------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">READ</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">COMMITTED</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">-----------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> warning (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端1进行修改数据表</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> begin</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> update</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">set</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> name</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">rimou</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> where</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> id</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> matched</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  Changed: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  Warnings: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> commit</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">01</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端2不断进行查看</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> begin</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 没修改之前</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance  |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1001</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1023</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | eimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2034</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1修改数据，但是没有进行 </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">commit</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">，继续在客户端2查看，发现数据仍旧没有被修改</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance  |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1001</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | dimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1023</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | eimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2034</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1使用 </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">commit</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">，此时客户端2就会发现数据被修改了</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance  |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1001</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | rimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1023</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | eimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2034</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>这种提交才可以被其他客户端读取的现象，在提交之前只能获得旧数据，这要看具体场景，才能决定是对是错的。</p>\n<p>读提交有一个问题，一旦服务端 1 提交了，哪怕客户端 2 还处于事务中，也会读取到更新的数据，这在某些场景是错误的。理论上插入后更新数据表难道有错吗？有可能有错，提交确实是要让所有事务看到，但有时候不应该让运行中的事务看到（后面有个例子）。</p>\n<h3 id=\"_3-3-3-可重复读\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-3-3-可重复读\"><span>3.3.3.可重复读</span></a></h3>\n<blockquote>\n<p>复习：<strong>可重复读</strong>，即便对方客户端提交了，哪怕是退出了，本客户端都无法实时知道更新结果，只有在本客户端退出了再次启动，才能看到更新后的新数据（这是 <code v-pre>MySQL</code> 默认的隔离等级），但是会有幻读的问题。</p>\n</blockquote>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 设置隔离等级</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> show variables </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">like</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">autocommit</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| Variable_name | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Value</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| autocommit    | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">ON</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">---------------+-------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">01</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> global</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> transaction</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> isolation</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> level</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> REPEATABLE</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> READ</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> @@</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">global</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">tx_isolation</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">-----------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| @@</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">global</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">tx_isolation</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">-----------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">REPEATABLE</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">READ</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">       |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">-----------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> warning (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端1：更新数据表</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> begin</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> update</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">set</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> name</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">iimou</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> where</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> id</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> matched</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  Changed: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  Warnings: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> commit</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端2：不断查看，奔溃后再次查看</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> begin</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 在没有更新数据表内记录之前查询</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance  |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1001</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | rimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1023</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | eimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2034</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 更新数据表内记录后查询</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance  |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1001</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | rimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1023</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | eimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2034</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 在客户端1 </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">commit</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> 后再次查询</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance  |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1001</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | rimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1023</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | eimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2034</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> Aborted </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> # 客户端2奔溃了...</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">$ mysql</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Welcome </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">to</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> the MySQL monitor.  Commands </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">end</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> with</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> ; </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">or</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> \\g.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Your MySQL </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">connection</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> id </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">is</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 54</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Server</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> version</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">5</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">7</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">44</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> MySQL Community </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Server</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (GPL)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Copyright (c) </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2000</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2023</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, Oracle </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">and</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">/</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">or</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> its affiliates.</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Oracle </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">is</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> a registered trademark of Oracle Corporation </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">and</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">/</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">or</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> its</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">affiliates. Other names may be trademarks of their respective</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">owners.</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Type</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">help;</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> or</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">\\h</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> help. </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Type</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">\\c</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> to</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> clear</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> the current input </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">statement</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> use</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> limou_database;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Reading </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">table</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> information </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> completion of </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">table</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> and</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> column names</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">You can turn </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">off</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> this feature </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">to</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> get</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> a quicker startup </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">with</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">A</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Database</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> changed</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 在客户端2奔溃后重新启动</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance  |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1001</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | rimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1023</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | iimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2034</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |  # 发现这里终于被修改了</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><blockquote>\n<p>例子：举一个超级生动具体的例子</p>\n<p>一家公司招聘程序员时，原本规定了一个工作等级，于是开始招聘员工，假设招进了 <code v-pre>A</code> 程序员，<code v-pre>A</code> 程序员和 <code v-pre>HR</code> 敲定了自己的工资等级，最后成功入职。问题是，假设公司新出现了一个大型项目，需要招聘大量程序员，于是提高了薪资等级中的工资量。果然成功吸引了程序员 <code v-pre>B</code>，程序员 <code v-pre>B</code> 和 <code v-pre>HR</code> 谈拢后，确定了和程序员 <code v-pre>A</code> 一样的等级，但是薪资却更高。</p>\n<p>而对于公司（黑心的）来说，不会直接告诉 <code v-pre>A</code> 你这个等级的薪资提高了，所以我要给你提薪...<code v-pre>A</code> 需要知道吗？不需要，你继续做你的工作就行了，在 <code v-pre>A</code> 的认知中，自己这个等级的薪资就是原先谈好的那么高。</p>\n<p>而一旦那一天工资项目出现问题，要进行裁员，就把 <code v-pre>A</code> 给“优化”（裁员）了，但是最后公司发现，自己貌似开走了一个“大动脉”（你之前写的代码逻辑非常重要，没 <code v-pre>A</code> 不行的那种），最后又把你找回来，按照 <code v-pre>B</code> 的薪资招聘你。</p>\n<p>这就是“可重复读”，<code v-pre>A</code> 始终用的是旧的薪资等级来判断薪资，但是后来的 <code v-pre>B</code> 却是更新后的第二套薪资体系，可是在 <code v-pre>A</code> 就职期间（被重新招聘前），没必要知道更新后的薪资等级（不然 <code v-pre>A</code> 闹起来怎么办，笑）。</p>\n<blockquote>\n<p>员工 <code v-pre>A</code>：客户端 1</p>\n<p>员工 <code v-pre>B</code>：客户端 2</p>\n<p><code v-pre>A</code> 就职期间：客户端 1 启动事务期间</p>\n<p><code v-pre>B</code> 就职期间：客户端 2 启动事务期间</p>\n<p><code v-pre>A</code> 离职时：客户端 1 结束事务进行提交</p>\n</blockquote>\n</blockquote>\n<p>但是，在一些数据库中，在可重复隔离下，<code v-pre>insert</code> 的 <code v-pre>sql</code> 可能无法被屏蔽（因为隔离性是通过加锁和其他策略来实现的，但是混则很难通过加锁来实现），在多次查询的过程中，就有可能会查出更新的数据（也就是“幻读”）。但是 <code v-pre>MySQL</code> 中，在 <code v-pre>RR</code> 级别中修复了这个问题（使用 <code v-pre>GAP+行锁</code>），我们不在这里深入了解，这也是为什么该级别是默认级别的原因。</p>\n<h3 id=\"_3-3-4-串行化\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-3-4-串行化\"><span>3.3.4.串行化</span></a></h3>\n<blockquote>\n<p>复习：<strong>串行化</strong>，事务隔离的最高级别，强制事务进行排序，使之不会相互冲突，确实解决了幻读的问题，但是会导致超时和锁竞争（太极端了，实际生产中很少用）</p>\n</blockquote>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 设置隔离级别</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> global</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> transaction</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> isolation</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> level</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> SERIALIZABLE</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">01</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> @@</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">global</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">tx_isolation</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">-----------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| @@</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">global</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">tx_isolation</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">-----------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">SERIALIZABLE</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">          |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">-----------------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> warning (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端1较后开启事务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> begin</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> update</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">set</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> name</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">eimou</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> where</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> id</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 陷入阻塞状态，知道客户端2进行 </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">commit</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> 后才执行这条 </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">sql</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">14</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">32</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> matched</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  Changed: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  Warnings: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> commit</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">01</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 客户端2较先开启事务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> begin</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1还没修改前</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance  |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1001</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | rimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1023</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | iimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2034</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端1修改后</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance  |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1001</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | rimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1023</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | iimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2034</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> commit</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 客户端2提交后查看</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance  |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1001</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | rimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1023</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | iimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2034</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> Aborted # 客户端2崩溃、</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">$ mysql</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Welcome </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">to</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> the MySQL monitor.  Commands </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">end</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> with</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> ; </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">or</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> \\g.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Your MySQL </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">connection</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> id </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">is</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 61</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Server</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> version</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">5</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">7</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">44</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> MySQL Community </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Server</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (GPL)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Copyright (c) </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2000</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2023</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, Oracle </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">and</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">/</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">or</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> its affiliates.</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Oracle </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">is</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> a registered trademark of Oracle Corporation </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">and</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">/</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">or</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> its</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">affiliates. Other names may be trademarks of their respective</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">owners.</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Type</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">help;</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> or</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">\\h</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> help. </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Type</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">\\c</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> to</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> clear</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> the current input </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">statement</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> use</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> limou_database;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Reading </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">table</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> information </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> completion of </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">table</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> and</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> column names</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">You can turn </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">off</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> this feature </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">to</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> get</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> a quicker startup </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">with</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">A</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">Database</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> changed</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 重启后再次查看就发现依旧没有被修改</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance  |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1001</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | rimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1023</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | iimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2034</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account; # 只有客户端1提交了，才能看到修改</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| id | </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  | blance  |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | limou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1001</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | eimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1023</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">|  </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> | iimou | </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">2034</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">----+-------+---------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>注意，是事务之间串行化，不是进程之间串行化！</p>\n<p>以上隔离等级就是 <strong>隔离性</strong> 的体现，而怎么体现一致性呢？</p>\n<p>事务执行的结果，必须使数据库的一个一致性状态，转移到另外一个一致性状态。如果系统发生中断，某个事务未完成而被迫中止，而为改完的事务对数据库所做的修改已经写入数据库，此时数据库处于不正确、不一致的状态。因此是通过原子性（回滚）来保证一致的（而一致性和用户的逻辑强相关，由用户决定）。而其他三属性实际上都是围绕一致性来展开的，可以说 <code v-pre>AID</code> 是因，用户配合，<code v-pre>C</code> 是果。</p>\n<blockquote>\n<p>注意：这关于事务这块还是比较复杂的，建议深入了解，反复学习。</p>\n</blockquote>\n<h1 id=\"_4-隔离性的原理\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_4-隔离性的原理\"><span>4.隔离性的原理</span></a></h1>\n<p>数据库事务的并发场景有三个：</p>\n<ul>\n<li><code v-pre>读-读</code>：不存在任何问题，因此不需要并发控制</li>\n<li><code v-pre>读-写</code>：有线程安全问题，可能造成事务隔离性问题（脏读、幻读、不可重复读），这种情况是主要的</li>\n<li><code v-pre>写-写</code>：有线程安全问题，可能存在更新丢失问题（第一类更新丢失、第二类更新丢失）</li>\n</ul>\n<p><code v-pre>读-读</code> 我们几乎不需要讨论，重点讨论 <code v-pre>读-写</code> 的实现，不讨论 <code v-pre>写-写</code> 的实现。</p>\n<p>而多版本并发控制（<code v-pre>MVCC</code>）是一种用来解决 <code v-pre>读-写冲突</code> 的无锁并发控制。</p>\n<blockquote>\n<p>注意：理解 <code v-pre>MVCC</code> 必须先理解几个周边知识。</p>\n<ul>\n<li>事务的 <code v-pre>ID</code></li>\n<li>三个隐藏字段</li>\n<li><code v-pre>undo</code> 日志</li>\n</ul>\n</blockquote>\n<h2 id=\"_4-1-事务的-id\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_4-1-事务的-id\"><span>4.1.事务的 ID</span></a></h2>\n<p>为事务分配单向增长的事务 <code v-pre>ID</code>，为每个修改保存一个版本，版本与事务 <code v-pre>ID</code> 关联，读操作只读该事务开始前的数据快照，所以 <code v-pre>MVCC</code> 可以为数据库解决：</p>\n<ol>\n<li>并发读写数据库时，可以做到在\n(1)读操作时不用阻塞写操作\n(2)写操作时不用阻塞读操作\n提高了数据库并发读写的性能</li>\n<li>同时可以解决：\n(1)脏读（未提交就可以被其他客户端读取）\n(2)幻读（在多次查询的过程中查出更加新的数据）\n(3)不可重复读（对方客户端提交，本客户端就会立刻看到更新结果）</li>\n</ol>\n<p>事务 <code v-pre>ID</code> 越小，事务到来的顺序越靠前。</p>\n<p><code v-pre>MySQL</code> 底层是 <code v-pre>C/C++</code> 编写的，因此内部事务也一定是有对应的结构体/类，内部有事务的属性和方法，再生成事务实例进行组织（使用特点的数据结构进行组织）。</p>\n<p>而事务 <code v-pre>ID</code> 也一定是事务结构体内部的属性之一，此外还有其他的属性。</p>\n<h2 id=\"_4-2-三个隐藏字段\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_4-2-三个隐藏字段\"><span>4.2.三个隐藏字段</span></a></h2>\n<p>在数据表中，隐藏三个字段：</p>\n<ol>\n<li><code v-pre>DB_TRX_ID</code>：<code v-pre>6 byte</code>，记录创建这条记录，且最后一次修改（修改/插入）该记录的事务 <code v-pre>ID</code>（因此很容易对操作进行溯源）</li>\n<li><code v-pre>DB_ROLL_PTR</code>：<code v-pre>7 byte</code>，回滚指针，指向这条记录的上一个版本（简单理解成指向历史版本，这些数据一般都在 <code v-pre>undo log</code> 中。<code v-pre>MySQL</code> 在修改一条记录的时候，仍会保留该记录，然后再复制一份去修改，有点类似“写时拷贝”）</li>\n<li><code v-pre>DB_ROW_ID</code>：<code v-pre>6 byte</code>，隐含的自增 <code v-pre>ID</code>（也就是我们以前在索引里提到的隐藏主键），如果数据表没有主键，<code v-pre>InnoDB</code> 会自动以 <code v-pre>DB_ROW_ID</code> 产生一个聚簇索引（而如果用户设定了主键，就会导致该字段无效，因为一个表只能有一个主键）</li>\n<li><code v-pre>FLAG</code>：记录被更新或删除并不代表真的删除，而是 <code v-pre>flag</code> 变了，等到刷盘的时候再修改磁盘内的数据，并且如果希望恢复，也可以恢复该字段，达到恢复数据有效性的</li>\n</ol>\n<h2 id=\"_4-3-undo-日志\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_4-3-undo-日志\"><span>4.3.undo 日志</span></a></h2>\n<p>在提及 <code v-pre>undo</code> 日志之前，我们还需要提及下 <code v-pre>MySQL</code> 里的日志模块，<code v-pre>undo</code> 就是撤销的意思，本质是 <code v-pre>MySQL</code> 使用 <code v-pre>new/malloc()</code> 申请出来的一块内存空间，在内存种运行，临时性非常高。</p>\n<blockquote>\n<p>补充：我们之前提及的所有机制，索引、事务、隔离性、日志等，都是在内存种完成的操作，然后在特定的时候进行刷盘。</p>\n</blockquote>\n<h2 id=\"_4-4-模拟-mvcc\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_4-4-模拟-mvcc\"><span>4.4.模拟 MVCC</span></a></h2>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 创建一个用于解释的表结构</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> create</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> table</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> if</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> not</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> exists</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> student(</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    -></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> name</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> varchar</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">11</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">not null</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    -></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> age </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> not null</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    -></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> );</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">04</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>假设创建了上述表结构，此时数据表字段结构如下：</p>\n<table>\n<thead>\n<tr>\n<th>name</th>\n<th>age</th>\n<th>DB_TRX_ID(创建对应记录的事务 ID)</th>\n<th>DB_ROW_ID(隐式主键)</th>\n<th>DB_ROLL_PTR(回滚指针)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>limou</td>\n<td>18</td>\n<td>9（假设是 <code v-pre>9</code> 号 <code v-pre>ID</code> 的事务插入的）</td>\n<td>1</td>\n<td>null</td>\n</tr>\n</tbody>\n</table>\n<p>现在有一个事务 <code v-pre>ID=10</code> 的事务，封装内含操作为：修改 <code v-pre>name='limou'</code> 为 <code v-pre>name='dimou'</code> 的 <code v-pre>SQL</code> 语句。</p>\n<p>在修改前，先将原本未修改的记录 <code v-pre>[limou,18,9,1,null]</code> 加锁，然后保存/拷贝一份，放入 <code v-pre>undo log</code>，给予这条被保存的记录一个内存地址，假设是 <code v-pre>0xaa</code>。</p>\n<p>此时回到原来的记录，现在要对其进行修改：</p>\n<ol>\n<li><code v-pre>DB_ROLL_PTR=null</code> 变为 <code v-pre>DB_ROLL_PTR=0xaa</code>，这就是保存了一个版本</li>\n<li><code v-pre>name='limou'</code> 变为 <code v-pre>name='daimou'</code></li>\n<li><code v-pre>DB_TRX_ID=9</code> 变为 <code v-pre>DB_TRX_ID=10</code></li>\n<li><code v-pre>DB_ROW_ID=1</code> 变为 <code v-pre>DB_ROW_ID=2</code></li>\n</ol>\n<p>最后进行 <code v-pre>COMMIT</code> 时，释放该记录的锁，因此修改记录是原子的，保证串行化。</p>\n<table>\n<thead>\n<tr>\n<th>name</th>\n<th>age</th>\n<th>DB_TRX_ID(创建对应记录的事务 ID)</th>\n<th>DB_ROW_ID(隐式主键)</th>\n<th>DB_ROLL_PTR(回滚指针)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>dimou</td>\n<td>18</td>\n<td>10</td>\n<td>2</td>\n<td>0xaa</td>\n</tr>\n</tbody>\n</table>\n<p>假设这个时候又有一个事务 <code v-pre>ID=11</code> 的事务，该事务修改 <code v-pre>age=28</code>。也是要修改记录，那这条记录是哪一个记录的呢？首先排除历史记录，历史记录必须是稳定的，最好一次写入的。</p>\n<p>因此只能改最新的记录，能直接改么？不能！需要先复制一份记录 <code v-pre>[dimou,18,10,2,0xaa]</code> 到 <code v-pre>undo log</code> 中，然后再进行和第一次插入记录时一样的操作。</p>\n<blockquote>\n<p>注意：此时在 <code v-pre>undo log</code> 中的历史记录的字段 <code v-pre>DB_ROLL_PTR</code> 是相互链接的，形成版本链链表。</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th>name</th>\n<th>age</th>\n<th>DB_TRX_ID(创建对应记录的事务 ID)</th>\n<th>DB_ROW_ID(隐式主键)</th>\n<th>DB_ROLL_PTR(回滚指针)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>dimou</td>\n<td>28</td>\n<td>11</td>\n<td>3</td>\n<td>0xbb</td>\n</tr>\n</tbody>\n</table>\n<p>而所谓的回滚操作，不就是对版本链链表的操作么（当然，肯定还有很多其他细节，这里不敢细细深究，我们这里简单来理解就行）。</p>\n<blockquote>\n<p>补充：实际上回滚时，不是直接把历史记录覆盖到数据表中的，而是和操作记录相反的 <code v-pre>SQL</code> 语句，如果需要回滚，只需要执行这些相反的操作就可以了（用户进行插入，<code v-pre>MySQL</code> 就记录一条相反的删除语法，方便以后回滚数据）。</p>\n</blockquote>\n<p>上面的版本链模型就是 <strong>多版本并发控制（<code v-pre>MVCC</code>）</strong> 的体现，其中每一个版本我们习惯称为一个 <strong>快照</strong>。</p>\n<p>那如果操作过多，<code v-pre>undo log</code> 会不会被塞满呢？首先 <code v-pre>undo log</code> 是一个内存级的。对于一个事务来说，一旦被 <code v-pre>COMMIT</code> 就会被 <code v-pre>delete/free()</code> 释放空间，内部的快照也会被清除（这也就是为什么 <code v-pre>COMMIT</code> 后的事务无法回滚的原因）。</p>\n<p>那在什么时候会持续保存快照数据？多事务的时候，有的时候访问的不是最新记录，而是历史记录（<code v-pre>undo log</code> 主要是配合隔离性设置的）。</p>\n<p>那如果删除数据呢？简单，设置 <code v-pre>flag</code> 就行，也是形成版本链/快照。</p>\n<p>那插入怎么办？数据表中本来就没有，那是怎么回滚的呢？记录和 <code v-pre>insert</code> 相反的 <code v-pre>delete</code> 操作即可，同样可以形成版本链/快照。</p>\n<p>那 <code v-pre>select</code> 呢？其本身只是查看数据表中的记录，版本记录没有意义，但是会有一个问题：<code v-pre>select</code> 该去查看哪一个版本的快照呢？</p>\n<p>首先我们定义读的方式：</p>\n<ul>\n<li><strong>当前读</strong>：读取到最新的数据，增删改数据表都涉及到当前读，而 <code v-pre>select</code> 有可能是当前读</li>\n<li><strong>快照读</strong>：读取到快照/历史版本就叫做快照读，一般是 <code v-pre>select</code> 在快照读</li>\n</ul>\n<p>读写并发时，如果是读取不同版本数据表，并且设置了隔离级别，这就注定是读取不同资源，也就无需加锁，因此就可以并发进行读写操作（当然，如果都是读操作都是当前读，也还是需要加锁的，因为是同一份最新的资源）。</p>\n<p>基本数据被其他客户端改了，只要读取的版本固定，就一定不会让不同的读取受到影响，进一步就是发生了隔离，这种就是在“版本上做隔离”！</p>\n<p><strong>而隔离级别的设置，就是对一个事务使用 <code v-pre>select</code> 能看到哪一个版本的设置</strong>。到此，隔离性会让所有并发执行事务看到不同的数据的基础也就找出来了（这是一个即提高效率，又为后续隔离性做铺垫的非常完美的方案）。</p>\n<p>因此隔离性、回滚，都是基于 <code v-pre>MVCC</code> 来控制、设置的。</p>\n<p>而串行化实际上就可以简单理解为，读写操作都要求加锁，导致事务变得串行化。</p>\n<p>为什么设置不同的隔离级别？首先事务是原子的，一定有先后顺序，从 <code v-pre>BEGIN</code> 到 <code v-pre>COMMIT</code> 一定是有一个过程的，多个事务中，让不同的事务看到它那个时间点该看到的数据（至于看到什么信息，是需要根据情况来抉择的，进而选择不同的隔离级别）。</p>\n<h2 id=\"_4-5-read-view\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_4-5-read-view\"><span>4.5.Read View</span></a></h2>\n<p><code v-pre>Read View</code> 就是事物进行快照读操作时生产的读视图，在事物执行的快照读那一刻，会生成数据库系统中一个快照，记录并维护系统当前活跃事务的 <code v-pre>ID</code>，这个 <code v-pre>ID</code> 是递增，所以最新的事务 <code v-pre>ID</code> 值越大。</p>\n<p>而 <code v-pre>Read View</code> 在 <code v-pre>MySQL</code> 源码中体现为一个类，本质就是一个结构体/类描述，用来进行可见性判断。当我们某个事务执行快照读的时候，会对该记录创建一个 <code v-pre>Read View</code> 读视图，可以把它的整体比作一个条件，用来判断当前事务能够看到哪个版本的数据，既可以是当前最新的数据，也可以是 <code v-pre>undo log</code> 里某个版本的数据。</p>\n<div class=\"language-cpp line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"cpp\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">//读视窗结构体</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> ReadView</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">private</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    trx_id_t</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> m_up_limit_id</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //低水位（没写错），小于等于这个 ID 的事务均可见</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    trx_id_t</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> m_low_limit_id</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //高水位（没写错），大于等于这个 ID 的事务均不可见</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    trx_id_t</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> m_creator_trx_id</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //创建该 Read View 对象的事务 ID</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    ids_t</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> m_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //创建视图时的其他一起活跃事务的 ID 列表</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    //up_limit_id：记录 m_ids 列表中事务 ID 最小的 ID（没有写错）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    //low_limit_id：Read View 生成时刻系统尚未分配的下一个事务 ID，就是目前已出现事务 ID 的最大值 +1（没有写错），不是事务最大值 +</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    trx_id_t</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> m_low_limit_no</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //配合 purge 值，了解一下就行，我们不关心</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    bool</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> m_closed</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //标记视图是否被关闭，也不太关心</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">};</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><blockquote>\n<p>补充：可以尝试使用进程结构体来类比事务结构体，而进程地址空间类比读视图。</p>\n</blockquote>\n<p>而 <strong>只有首次</strong> 某个事务执行快照读的时候，才会对该记录创建一个 <code v-pre>Read View</code> 读视图（进程也是类似）。</p>\n<p>我们再实际读取版本链的时候，是能读取到每个版本对于的事务 <code v-pre>ID</code> 的，即 <code v-pre>DB_TRX_ID</code> 字段的信息。</p>\n<p>那么现在的工作就是将 <code v-pre>DB_TRX_ID</code> 和 <code v-pre>ReadView{/*...*/};</code> 做比较，来得到事务是否可见的判断。</p>\n<figure><img src=\"@source/4.业务服务/2.存储服务/assets/cadf5343aace0afadac2ffc4c5f52d5.png\" alt=\"cadf5343aace0afadac2ffc4c5f52d5\" tabindex=\"0\" loading=\"lazy\"><figcaption>cadf5343aace0afadac2ffc4c5f52d5</figcaption></figure>\n<p>读取 <code v-pre>Undo Log</code> 的那一刻生成读视图：\n(1)遇到快照记录中，<code v-pre>DB_TRX_ID=m_creator_trx_id</code> 时，\n则说明是自己事务中处理的历史记录，自己做的操作就应该被自己 <strong>看到</strong>，因此跳过该记录就行。\n(2)遇到快照记录中，和同时期运行事务的最小 <code v-pre>ID</code>，即 <code v-pre>DB_TRX_ID&lt;up_limit_id</code> 时，\n则说明该记录对于的事务已经被提交/结束，否者不可能要小，所以我这个事务应该 <strong>看到</strong> 这个数据。\n(3)遇到快照记录中，大于等于系统未分批事务的最小 <code v-pre>ID</code>，即 <code v-pre>DB_TRX_ID&gt;=low_limit_id</code> 时，\n则说明我这个记录在形成快照时，这个快照记录对应的事务还没开始呢，但是这个事务比我先执行修改，导致我找得到这个记录，但由于是后来者，我理应 <strong>看不到</strong> 这个记录\n(4)遇到快照记录中，有 <code v-pre>up_limit_id&lt;DB_TRX_ID&lt;low_limit_id</code> 时，\n这说明该快照对应记录是同处于交叉运行的活跃事务，这个事务是否要被我看到，还没有提交，我也 <strong>看不到</strong> 这个记录。</p>\n<h2 id=\"_4-6-实际操作\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_4-6-实际操作\"><span>4.6.实际操作</span></a></h2>\n<p>假设当前学生表内有记录如下：</p>\n<table>\n<thead>\n<tr>\n<th>name</th>\n<th>age</th>\n<th>DB_TRX_ID(创建对应记录的事务 ID)</th>\n<th>DB_ROW_ID(隐式主键)</th>\n<th>DB_ROLL_PTR(回滚指针)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>limou</td>\n<td>18</td>\n<td>0</td>\n<td>1</td>\n<td>0xaa</td>\n</tr>\n</tbody>\n</table>\n<p>然后又如下几个事务：</p>\n<table>\n<thead>\n<tr>\n<th>时间点</th>\n<th>事务 1 [id = 1]</th>\n<th>事务 2 [id = 1]</th>\n<th>事务 3 [id = 1]</th>\n<th>事务 4 [id = 1]</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td>事务开始</td>\n<td>事务开始</td>\n<td>事务开始</td>\n<td>事务开始</td>\n</tr>\n<tr>\n<td>2</td>\n<td>交叉...</td>\n<td>交叉...</td>\n<td>交叉...</td>\n<td>修改提交 <code v-pre>'limou'-&gt;'dimou'</code></td>\n</tr>\n<tr>\n<td>3</td>\n<td>进行中</td>\n<td>快照读</td>\n<td>进行中</td>\n<td></td>\n</tr>\n<tr>\n<td>4</td>\n<td>...</td>\n<td>...</td>\n<td>...</td>\n<td></td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>注意：<code v-pre>ID</code> 值越小的事务越先被启动，这点需要注意。</p>\n</blockquote>\n<ol>\n<li>\n<p>事务 <code v-pre>4</code> 成功修改 <code v-pre>name='dimou'</code>，并且生成对应的版本链</p>\n<figure><img src=\"@source/4.业务服务/2.存储服务/assets/a97981ed798f4d965aad3ceb6ada95a.png\" alt=\"a97981ed798f4d965aad3ceb6ada95a\" tabindex=\"0\" loading=\"lazy\"><figcaption>a97981ed798f4d965aad3ceb6ada95a</figcaption></figure>\n</li>\n<li>\n<p>事务 <code v-pre>2</code> 对某行执行了快照读，此时数据库为改行数据生成一个 <code v-pre>Read View</code> 读视图，其内部属性值如下：</p>\n<div class=\"language-cpp line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"cpp\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">//事务2的 Read View</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">m_ids</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //[1,3]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">up_limit_id</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">low_limit_id</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //4+1=5，注意是系统未分配的最近的事务 ID</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">creator_trx_id</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //本事务的事务 ID=2</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>上述属性会从 <code v-pre>DB_ROW_ID=2</code> 开始遍历版本链进行比对，事务二能不能看到事务四的提交呢（先不考虑隔离级别，直接按照我本小节的理解）？</p>\n</li>\n<li>\n<p>遍历快照可以确定，快照不对应事务的 <code v-pre>ID</code> 值四种情况，如果可以看到，这就是读提交 <code v-pre>RC</code> 的隔离级别</p>\n</li>\n</ol>\n<p>那 <code v-pre>RC</code> 究竟和 <code v-pre>RR</code> 有什么区别呢（分别指 <code v-pre>READ COMMITTED/REPEATABLE READ</code>）？</p>\n<p>首先您需要知道，指令 <code v-pre>SELECT * FROM table_name LOCK IN SHARE MODE;</code> 就是当前读，而不是您以前使用 <code v-pre>SELECT</code> 时默认的快照读，然后我们做一个实验：</p>\n<div class=\"language-sql line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"sql\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-sql\"><span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 设置为 RR 模式</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> global</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> transaction</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> isolation</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> level</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> REPEATABLE</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> READ</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> rows</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 重启终端查看是否更改</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> select</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> @@tx_isolation;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">-----------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| @@tx_isolation |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">-----------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">| </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">REPEATABLE</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">READ</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">-----------------+</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> set</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> warning (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 创建测试用的表</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">create</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> table</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> if</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> not</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> exists</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account(</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    id </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> primary key</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">    name</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> varchar</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">50</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">not null</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> default</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> ''</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    age </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">)ENGINE</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">InnoDB </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">DEFAULT</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> CHARSET</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">UTF8;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"># 插入一些记录，用来测试</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">mysql</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> insert into</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> account (id, </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, age) </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">values</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">iimou</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">15</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Query OK, </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> row</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> affected (</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">00</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> sec)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><table>\n<thead>\n<tr>\n<th>事务 A</th>\n<th>事务 B</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code v-pre>begin;</code> 事务开始</td>\n<td><code v-pre>begin;</code> 事务开始</td>\n</tr>\n<tr>\n<td>交叉...</td>\n<td>交叉...</td>\n</tr>\n<tr>\n<td><code v-pre>select * from account;</code> 快照读（无影响）</td>\n<td><code v-pre>select * from account;</code> （此时第一次形成了 <code v-pre>Read View</code> 快照读，认为 <code v-pre>A</code> 和自己是一块运行的）</td>\n</tr>\n<tr>\n<td><code v-pre>update account set age=18 where id = 1;</code>（更新）</td>\n<td>-</td>\n</tr>\n<tr>\n<td><code v-pre>commit;</code></td>\n<td>-</td>\n</tr>\n<tr>\n<td>-</td>\n<td><code v-pre>select * from account;</code> 快照读（没读到 <code v-pre>age=18</code>）</td>\n</tr>\n<tr>\n<td>-</td>\n<td><code v-pre>select * from account lock in share mode;</code> 当前读（读到了 <code v-pre>age=18</code>）</td>\n</tr>\n</tbody>\n</table>\n<p>再来做一个测试：</p>\n<table>\n<thead>\n<tr>\n<th>事务 A</th>\n<th>事务 B</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code v-pre>begin;</code> （事务开始）</td>\n<td><code v-pre>begin;</code> （事务开始）</td>\n</tr>\n<tr>\n<td>交叉...</td>\n<td>交叉...</td>\n</tr>\n<tr>\n<td><code v-pre>select * from account;</code></td>\n<td>-</td>\n</tr>\n<tr>\n<td><code v-pre>update account set age=28 where id = 1;</code>（更新）</td>\n<td>-</td>\n</tr>\n<tr>\n<td><code v-pre>commit;</code></td>\n<td>-</td>\n</tr>\n<tr>\n<td>-</td>\n<td><code v-pre>select * from account;</code> （只在这个时候生成 <code v-pre>Read View</code>,读到 <code v-pre>age=28</code>，<code v-pre>B</code> 不认为 <code v-pre>A</code> 和自己同时活跃）</td>\n</tr>\n<tr>\n<td>-</td>\n<td><code v-pre>select * from account lock in share mode;</code>（读到了 <code v-pre>age=28</code>）</td>\n</tr>\n</tbody>\n</table>\n<p>欸，不是可重复读吗？为什么会被修改呢？如果你是事务 <code v-pre>B</code>，你自己一直不查你哪里知道数据库里是什么？只需要保证你从第一次读取的时候到最后退出时，都是读取到同一个数据就行了。在那之前，改了什么根本不需要关系。</p>\n<p>因此这里就可以得到一个结论：<code v-pre>Read View</code> 形成的时机会影响可见性。</p>\n<p>因此 <code v-pre>RR</code> 和 <code v-pre>RC</code> 的深层区别是 <code v-pre>Read View</code> 形成时机不同。</p>\n<ul>\n<li>\n<p>在 <code v-pre>RR</code> 级别下的某个事务的对某条记录的第一次快照读会创建一个快照及 <code v-pre>Read View</code>，将当前系统活跃的其他事务记录起来。</p>\n<p>此后在调用快照读的时候，还是使用的是同一个 <code v-pre>Read View</code>，所以只要当前事务在其他事务提交更新之前使用过快照读，那么之后的快照读使用的都是同一个 <code v-pre>Read View</code>，所以对之后的修改不可见。</p>\n<p><code v-pre>RR</code> 级别下，快照读生成 <code v-pre>Read View</code> 时，<code v-pre>Read View</code> 会记录此时所有其他活动事务的快照，这些事务的修改对于当前事务都是不可见的。而早于 <code v-pre>Read View</code> 创建的事务所做的修改均是可见。</p>\n</li>\n<li>\n<p>而在 <code v-pre>RC</code> 级别下的，事务中，每次快照读都会新生成一个快照和<code v-pre>Read View</code>，这就是我们在 <code v-pre>RC</code> 级别下的事务中可以看到别的事务提交的更新的原因。总之在 <code v-pre>RC</code> 隔离级别下，是每个快照读都会生成并获取最新的 <code v-pre>Read View</code>。所以，RC才会有不可重复读问题。</p>\n</li>\n</ul>\n<blockquote>\n<p>补充：建议再看一遍，待补充...</p>\n</blockquote>\n","tagOpen":"<template>","tagClose":"</template>"},"script":null,"scriptSetup":null,"scripts":[],"styles":[],"customBlocks":[]},"content":">   前要：在网络服务中，如果对 `CURD` 不加限制，会出现什么问题？\n>\n>   在多个客户端同时向一个卖票服务器买票时（假设票数只剩一张），`A` 客户端让数据库内的票数 `count` 减 `1`，但是还没来得及更新数据，又有 `B` 服务器查询数据库，此时 `B` 服务器看到票数还是 `1`，又进行了减 `1` 操作，导致一张票被同时卖了两次。\n\n`CURD` 的过程需要满足什么条件，才能解决上述问题呢？\n\n1. 买票的过程得应该是原子操作（要么抢到，要么没抢）\n2. 买票的过程中不能被相互影响（不能被互相影响，要割裂/独立开来）\n3. 买完票后应该要永久有效（必须要做持久化，不能只是在内存中操作）\n4. ef\n5. 买前和买后都是确定的状态（不能出现中间状态，要保证一致性）\n\n# 1.事务的理解\n\n## 1.1.事务的概念\n\n事务简单来理解就是 **一组 DML 语句**，也就是一组用于数据操作（插入数据、删除数据...）的语句。\n\n事务主要处理操作量大，复杂度高的数据，这些数据往往需要多条 `SQL` 语句来构成。\n\n但是事务还不仅仅是多条语句的集合，还必须保证四个属性（`ACID`）才能保证安全运行事务：\n\n-   **原子性(Atomicity)**：一组 `DML` 语句/一个事务，要么全部成功，要么全部失败，这是由 `MySQL` 提供的机制来保障的。\n\n-   **一致性(Consistency)**：在事务开始和结束以后，数据库的完整性没有被破坏，写入的数据必须完全符合所有的预设规则（在 `MySQL` 中，一致性时被其他三个属性来保证的，但是需要数据库和用户来配合，才能得到一致性）\n\n-   **隔离性(Isolation)**：防止多个事务并发执行时由于交叉执行导致的数据不一致问题，事务隔离有不同的等级\n\n    (1)读未提交（`Read Uncommitted`）\n\n    (2)读提交（`Read Committed`）\n\n    (3)可重复读（`Repeatable Read`）\n\n    (4)串行化（`Serialzable`）\n\n-   **持久性(Durability)**：事务处理完后，对表中数据的影响是永久的（哪怕系统挂了也不会丢失），也就是持久化\n\n>   注意：学习事务一定要在使用数据库的用户视角来理解。\n\n事务在 `MySQL` 内也一定是一个具体对象，这就需要先描述再组织。\n\n另外，事务不是 `MySQl` 天然就存在，而是为了在应用程序访问数据库的时候，能够简化编程模型，不需要考虑各种潜在并发问题、网络问题，用户只需要提交和回滚。因此，事务的本质是为了应用层服务的，而不是面向数据库内部。\n\n## 1.2.事务的版本\n\n`MySQL` 中只有使用了 `Innodb` 数据库引擎的数据库或数据表才可以支持事务，其他基本都不支持。\n\n```sql\n# 查看 MySQL 的引擎是否支持事务\nshow engines \\G\n*************************** 1. row ***************************\n      Engine: InnoDB\n     Support: DEFAULT\n     Comment: Supports transactions, row-level locking, and foreign keys\nTransactions: YES\n          XA: YES\n  Savepoints: YES\n*************************** 2. row ***************************\n      Engine: MRG_MYISAM\n     Support: YES\n     Comment: Collection of identical MyISAM tables\nTransactions: NO\n          XA: NO\n  Savepoints: NO\n*************************** 3. row ***************************\n      Engine: MEMORY\n     Support: YES\n     Comment: Hash based, stored in memory, useful for temporary tables\nTransactions: NO\n          XA: NO\n  Savepoints: NO\n*************************** 4. row ***************************\n      Engine: BLACKHOLE\n     Support: YES\n     Comment: /dev/null storage engine (anything you write to it disappears)\nTransactions: NO\n          XA: NO\n  Savepoints: NO\n*************************** 5. row ***************************\n      Engine: MyISAM\n     Support: YES\n     Comment: MyISAM storage engine\nTransactions: NO\n          XA: NO\n  Savepoints: NO\n*************************** 6. row ***************************\n      Engine: CSV\n     Support: YES\n     Comment: CSV storage engine\nTransactions: NO\n          XA: NO\n  Savepoints: NO\n*************************** 7. row ***************************\n      Engine: ARCHIVE\n     Support: YES\n     Comment: Archive storage engine\nTransactions: NO\n          XA: NO\n  Savepoints: NO\n*************************** 8. row ***************************\n      Engine: PERFORMANCE_SCHEMA\n     Support: YES\n     Comment: Performance Schema\nTransactions: NO\n          XA: NO\n  Savepoints: NO\n*************************** 9. row ***************************\n      Engine: FEDERATED\n     Support: NO\n     Comment: Federated MySQL storage engine\nTransactions: NULL\n          XA: NULL\n  Savepoints: NULL\n9 rows in set (0.00 sec)\n```\n\n# 2.事务的操作\n\n## 2.1.做一些准备工作\n\n开始之前，先设置一下隔离性（后面提及）。\n\n```sql\n# 设置隔离性\nmysql> set global transaction isolation level READ UNCOMMITTED;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql> select @@tx_isolation;\n+------------------+\n| @@tx_isolation   |\n+------------------+\n| READ-UNCOMMITTED |\n+------------------+\n1 row in set, 1 warning (0.00 sec)\n```\n\n首先，事务有两种提交方式：\n\n-   自动提交\n-   手动提交\n\n```sql\n# 查看事务提交方式\nmysql> show variables like 'autocommit';\n+---------------+-------+\n| Variable_name | Value |\n+---------------+-------+\n| autocommit    | ON    |\n+---------------+-------+\n1 row in set (0.01 sec)\n```\n\n可以用 `SET` 来改变 `MySQL` 的自动提交方式。\n\n```sql\n# 取消事务自动提交\nmysql> set autocommit=0;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql> show variables like 'autocommit';\n+---------------+-------+\n| Variable_name | Value |\n+---------------+-------+\n| autocommit    | OFF   |\n+---------------+-------+\n1 row in set (0.00 sec)\n\nmysql> set autocommit=1;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql> show variables like 'autocommit';\n+---------------+-------+\n| Variable_name | Value |\n+---------------+-------+\n| autocommit    | ON    |\n+---------------+-------+\n1 row in set (0.00 sec)\n```\n\n然后我们切换超级用户，使用 `netstat -nltp` 是一个用于显示网络连接、路由表和网络接口信息的命令行工具查看 `MySQL` 是否成功运行且占用端口号。\n\n```cmd\n# 查看网络状态\n# netstat -nltp\nActive Internet connections (only servers)\nProto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    \n tcp6       0      0 :::3306                 :::*                    LISTEN      7404/mysqld         \n```\n\n原本是应该使用 `Windows11` 的 `cmd` 来远程访问 `Centos7` 云服务的 `MySQL` 服务，不过需要提前在 `Windows11` 中提前下载好 `MySQL`，所以我们先用本地的两个客户端来模拟，后续再来详细了解。\n\n然后修改事务等级，不然有些现象会看不到。\n\n```sql\n# 客户端中设置事务隔离级别并且重启检查\nmysql> set global transaction isolation level read uncommitted;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql> quit\nBye\n\n$ mysql -uroot -p\nEnter password: \nWelcome to the MySQL monitor.  Commands end with ; or \\g.\nYour MySQL connection id is 32\nServer version: 5.7.44 MySQL Community Server (GPL)\n\nCopyright (c) 2000, 2023, Oracle and/or its affiliates.\n\nOracle is a registered trademark of Oracle Corporation and/or its\naffiliates. Other names may be trademarks of their respective\nowners.\n\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\n\nmysql> select @@tx_isolation;\n+------------------+\n| @@tx_isolation   |\n+------------------+\n| READ-UNCOMMITTED |\n+------------------+\n1 row in set, 1 warning (0.00 sec)\n```\n\n启动两个 `MySQL` 客户端（模拟并发场景），然后其中一个客户端建立一个如下的表结构：\n\n```sql\n# 客户端1：创建表结构\ncreate table if not exists account(\nid int primary key,\nname varchar(50) not null default '',\nblance decimal(10,2) not null default 0.0\n)ENGINE=InnoDB DEFAULT CHARSET=UTF8;\n```\n\n```sql\n# 客户端2：查看是否能看到 account 数据表\nmysql> desc account;\n+--------+---------------+------+-----+---------+-------+\n| Field  | Type          | Null | Key | Default | Extra |\n+--------+---------------+------+-----+---------+-------+\n| id     | int(11)       | NO   | PRI | NULL    |       |\n| name   | varchar(50)   | NO   |     |         |       |\n| blance | decimal(10,2) | NO   |     | 0.00    |       |\n+--------+---------------+------+-----+---------+-------+\n3 rows in set (0.00 sec)\n```\n\n可以在一个客户端中查看连接情况，可以看到确实存在两个本地客户端。\n\n```sql\n# 客户端1：查看 MySQL 的连接情况\nmysql> show processlist\\G\n*************************** 1. row ***************************\n     Id: 33\n   User: ljp\n   Host: localhost\n     db: limou_database\nCommand: Query\n   Time: 0\n  State: starting\n   Info: show processlist\n*************************** 2. row ***************************\n     Id: 34\n   User: ljp\n   Host: localhost\n     db: limou_database\nCommand: Sleep\n   Time: 355\n  State: \n   Info: NULL\n2 rows in set (0.00 sec)\n```\n\n## 2.2.正常情况的事务\n\n启动事务有两种方法：(1)`start transaction;` (2)`begin`\n\n一旦开启事务，后续的 `SQL` 操作都属于同一个事务的部分。并且，我还设置了一个保存点（可选）\n\n```sql\n# 客户端1：启动事务\nmysql> start transaction;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql> savepoint s1;\nQuery OK, 0 rows affected (0.00 sec)\n```\n\n```sql\n# 客户端2：启动事务\nmysql> begin;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql> select * from account;\nEmpty set (0.00 sec)\n```\n\n然后进行插入工作，设置第二个保存点，并且查看插入的数据是否同步到另外一个客户端。\n\n```sql\n# 客户端1：插入数据\nmysql> insert into account values (2, 'limou', 10000);\nQuery OK, 1 row affected (0.00 sec)\n\nmysql> savepoint s2;\nQuery OK, 0 rows affected (0.00 sec)\n```\n\n```sql\n# 客户端2：查看数据\nmysql> select * from account;\n+----+-------+----------+\n| id | name  | blance   |\n+----+-------+----------+\n|  2 | limou | 10000.00 |\n+----+-------+----------+\n1 row in set (0.00 sec)\n```\n\n尝试插入更多的插入和设置保存点的操作，同时没插入一个记录，就检查客户端是否数据同步。\n\n```sql\n# 客户端1：插入数据和保存\nmysql> savepoint s2;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql> insert into account values (1, 'dimou', 11030);\nQuery OK, 1 row affected (0.00 sec)\n\nmysql> savepoint s3;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql> insert into account values (3, 'iimou', 10431);\nQuery OK, 1 row affected (0.00 sec)\n```\n\n```sql\n# 客户端2：每次插入，就查看一次数据表\nmysql> select * from account;\n+----+-------+----------+\n| id | name  | blance   |\n+----+-------+----------+\n|  1 | dimou | 11030.00 |\n|  2 | limou | 10000.00 |\n+----+-------+----------+\n2 rows in set (0.00 sec)\n\nmysql> select * from account;\n+----+-------+----------+\n| id | name  | blance   |\n+----+-------+----------+\n|  1 | dimou | 11030.00 |\n|  2 | limou | 10000.00 |\n|  3 | iimou | 10431.00 |\n+----+-------+----------+\n3 rows in set (0.00 sec)\n```\n\n如果我们突然后悔了，可以回滚事务。\n\n```sql\n# 客户端1：回滚事务\nmysql> rollback to s3;\nQuery OK, 0 rows affected (0.00 sec)\n```\n\n```sql\n# 客户端2：查看回滚后的数据表\nmysql> select * from account;\n+----+-------+----------+\n| id | name  | blance   |\n+----+-------+----------+\n|  1 | dimou | 11030.00 |\n|  2 | limou | 10000.00 |\n+----+-------+----------+\n2 rows in set (0.00 sec)\n```\n\n可以看到，数据表确实发生了回退，如果我们这个时候使用 `COMMIT` 就会提交本次事务。\n\n```sql\n# 客户端1：提交事务\nmysql> commit;\nQuery OK, 0 rows affected (0.01 sec)\n```\n\n>   补充：使用 `roolback` 还可以将所有操作全部取消，但是一般很少这么做。\n\n而事务只有在启动的时候才可以进行回滚操作，而一旦提交了就无法进行回滚。\n\n## 2.3.异常情况的事务\n\n如果其中一个服务端在事务状态下奔溃了会怎么样？其他客户端会自动回滚，也就是保证原子性，要么不做，要么就操作完。\n\n```sql\n# 客户端1：不断插入数据最后因为异常导致奔溃，插入一次就在客户端2中查看一次\nmysql> begin;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql> insert into account values (3, 'eimou', 20431);\nQuery OK, 1 row affected (0.01 sec)\n\nmysql> insert into account values (4, 'eimou', 30434);\nQuery OK, 1 row affected (0.00 sec)\n\nmysql> ^C\nmysql> Aborted\n```\n\n```sql\n# 客户端2：客户端1插入后不断查找数据表，最后检查奔溃后的数据表\nmysql> select * from account;\n+----+-------+----------+\n| id | name  | blance   |\n+----+-------+----------+\n|  1 | dimou | 11030.00 |\n|  2 | limou | 10000.00 |\n+----+-------+----------+\n2 rows in set (0.00 sec)\n\nmysql> select * from account;\n+----+-------+----------+\n| id | name  | blance   |\n+----+-------+----------+\n|  1 | dimou | 11030.00 |\n|  2 | limou | 10000.00 |\n|  3 | eimou | 20431.00 |\n|  4 | eimou | 30434.00 |\n+----+-------+----------+\n4 rows in set (0.00 sec)\n\nmysql> select * from account; # 奔溃后，这里自动发生了回滚，回到开头\n+----+-------+----------+\n| id | name  | blance   |\n+----+-------+----------+\n|  1 | dimou | 11030.00 |\n|  2 | limou | 10000.00 |\n+----+-------+----------+\n2 rows in set (0.00 sec)\n```\n\n也有一些其他的情况会发生自动回滚（客户端因为关闭 `shell` 而导致退出），但是如果事务已经进行了提交（也就是使用了 `COMMIT`），就不会再进行回滚（包括因为崩溃造成的自动回滚）。\n\n但是我们之前设置的自动提交又是什么鬼？不是事务会自动提交吗？从现象来看，无论是设置 `autocommit` 为 `OFF` 还是 `ON` 现象都是一样的结果（这个您可以自己实验一下），那这个 `autocommit` 究竟有什么用呢？您先知道一个点，只要是手动开启启动事务，就必须手动提交，和是否设置自动提交无关即可。\n\n而对比有无设置 `autocommit`  的两种情况。\n\n### 2.3.1.设置为 OFF\n\n```sql\n# 客户端1：设置 autocommit 为 OFF，然后在事务中进行删除记录\nmysql> show variables like 'autocommit';\n+---------------+-------+\n| Variable_name | Value |\n+---------------+-------+\n| autocommit    | ON    |\n+---------------+-------+\n1 row in set (0.00 sec)\n\nmysql> set autocommit=0;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql> show variables like 'autocommit';\n+---------------+-------+\n| Variable_name | Value |\n+---------------+-------+\n| autocommit    | OFF   |\n+---------------+-------+\n1 row in set (0.00 sec)\n\nmysql> delete from account where id=3;\nQuery OK, 1 row affected (0.01 sec)\n\nmysql> Aborted\n```\n\n```sql\n# 客户端2：不断查看数据表\nmysql> select * from account; # 客户端1没删除之前\n+----+-------+----------+\n| id | name  | blance   |\n+----+-------+----------+\n|  1 | dimou | 11030.00 |\n|  3 | timou | 50434.00 |\n+----+-------+----------+\n2 rows in set (0.00 sec)\n\nmysql> select * from account; # 客户端1删除后\n+----+-------+----------+\n| id | name  | blance   |\n+----+-------+----------+\n|  1 | dimou | 11030.00 |\n+----+-------+----------+\n1 row in set (0.00 sec)\n\nmysql> select * from account; # 客户端1奔溃后，发现记录恢复\n+----+-------+----------+\n| id | name  | blance   |\n+----+-------+----------+\n|  1 | dimou | 11030.00 |\n|  3 | timou | 50434.00 |\n+----+-------+----------+\n2 rows in set (0.00 sec)\n```\n\n### 2.3.2.设置为 ON\n\n```sql\n# 客户端1：进行删除操作，但是不在事务中删除后崩溃\nmysql> show variables like 'autocommit';\n+---------------+-------+\n| Variable_name | Value |\n+---------------+-------+\n| autocommit    | ON    |\n+---------------+-------+\n1 row in set (0.00 sec)\n\nmysql> delete from account where id=3;\nQuery OK, 1 row affected (0.01 sec)\n\nmysql> Aborted\n```\n\n```sql\n# 客户端2：不断查看数据表\nmysql> select * from account; # 客户端1没删除之前\n+----+-------+----------+\n| id | name  | blance   |\n+----+-------+----------+\n|  1 | dimou | 11030.00 |\n|  3 | timou | 50434.00 |\n+----+-------+----------+\n2 rows in set (0.00 sec)\n\nmysql> select * from account; # 客户端1删除后\n+----+-------+----------+\n| id | name  | blance   |\n+----+-------+----------+\n|  1 | dimou | 11030.00 |\n+----+-------+----------+\n1 row in set (0.00 sec)\n\nmysql> select * from account; # 客户端1奔溃后，发现记录没有恢复\n+----+-------+----------+\n| id | name  | blance   |\n+----+-------+----------+\n|  1 | dimou | 11030.00 |\n+----+-------+----------+\n1 row in set (0.00 sec)\n```\n\n而且就算客户端 2 之前有做 `BEGIN`，再 `COMMIT` 后也不会恢复数据。\n\n以上测试说明，只要设置了 `autocommit`，就会把一条单纯的 `SQL` 语句单独看作一个事务，都会被自动 `BEGIN` 和 `COMMIT`。因此如果没设置 `autocommit` 就会因为没有 `COMMIT` 而导致数据回滚。\n\n>   复习：再理一理，`BEGIN` 是开启事务处理，`COMMIT` 是事务提交，防止回滚。\n\n但是如果我们手动进行回滚呢？\n\n```sql\n# 客户端1：删除数据表，但是先 commit 再崩溃\nmysql> show variables like 'autocommit';\n+---------------+-------+\n| Variable_name | Value |\n+---------------+-------+\n| autocommit    | ON    |\n+---------------+-------+\n1 row in set (0.00 sec)\n\nmysql> set autocommit=0;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql> show variables like 'autocommit';\n+---------------+-------+\n| Variable_name | Value |\n+---------------+-------+\n| autocommit    | OFF   |\n+---------------+-------+\n1 row in set (0.01 sec)\n\nmysql> delete from account where id=1;\nQuery OK, 1 row affected (0.00 sec)\n\nmysql> commit;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql> Aborted\n```\n\n```sql\n# 客户端2：不断查看数据表\nmysql> select * from account; # 客户端1删除记录前\n+----+-------+----------+\n| id | name  | blance   |\n+----+-------+----------+\n|  1 | dimou | 11030.00 |\n+----+-------+----------+\n1 row in set (0.00 sec)\n\nmysql> select * from account; # 客户端1删除记录后\nEmpty set (0.00 sec)\n\nmysql> select * from account; # 客户端1崩溃后，没有发生回滚\nEmpty set (0.00 sec)\n```\n\n也侧面证明了：对于 `InnoDB` 里一条单纯的 `SQL` 就是一个完整的事务，最后都会因为 `autocommit=ON` 而自动提交（但是 `SELECT` 有点特殊，您先记住就行，因为 `MySQL` 有 `MVCC`）。\n\n>   补充：`COMMIT` 操作实际上就是数据持久化的一种手段。\n\n到这里就可以看到事务本身的 **原子性（回滚）** 和 **持久性（提交）**。\n\n#  3.事务的隔离\n\n## 3.1.隔离和隔离级别\n\n但是事务的隔离性体现在哪里呢？为何需要隔离呢？不隔离可以吗？\n\n一个 `MySQL` 服务可能会被多个客户端进程访问（一般都是程序直接连接数据库，命令行操作很少用到），访问的方式是以事务进行的。\n\n而事务在上述小节中实现了原子性和持久性，事务注定有执行前、执行中、执行后，一旦异常就会回滚。为了保证事务在执行中，为了保证事务尽量不受干扰，就产生的隔离性，根据不同的干扰级别可以设置不同的隔离级别。\n\n实际上，正常人的认知是：无论别的客户端 `A` 怎么对数据表怎么增删查改，另外一个客户端 `B` 要拿到最新的数据，不管两进程的先后顺序如何，都必须要先等待进程 `A` 完成一个事务。这个观点有问题吗？有点，举一个不恰当的例子，一个婴儿在出生后，不需要知道父母之前的经历，也能和父母一起创造新的经历，每个人只需要在自己生命周期内看到的世界也都是不一样的。这代表着：**不一定需要获取最新的消息，只需要在自己的生命周期内看到该看到的就行，这就是隔离性**。\n\n在 `MySQL` 中，原子性不仅是在操作上原子，还体现在时间上。一个改表的 `A` 客户端先执行事务，一个查表的 `B` 客户端后执行事务，两者在执行中交叉进行。而 `B` 客户端执行得较慢，`A` 客户端执行得较快，那么 `B` 客户端是否应该立刻获取最新的数据呢？不应该！因为要保证隔离性，隔离运行中的事务。\n\n因此隔离体现在运行事务中，而隔离性要隔离的程度就是隔离级别（根据内容重要度的不同，有些信息是可以不被隔离的，因此就有隔离级别），在交叉事务处理过程中，不同的事务级别分为：\n\n-   **读未提交(READ UNCOMMITTED)**：所有事务都可以看到其他事务没有提交的执行结果（相当于没有任何隔离性，实际生产中不太可能用到这个级别），我们之前的书写的事务代码，就是读未提交，没有进行 `COMMIT` 也会看到事务中的操作后结果，而对方客户端一旦崩溃就和没有存在过一样，则本客户端发送回滚\n-   **读已提交(READ COMMITTED)**：只有对事务进行了 `COMMIT`，才能看到更新的数据表（一条单纯的 `SQL` 语句本身就被包装成一个事务，因此使用单纯的 `SQL` 语句会让所有客户端都读取到）\n-   **可重复读(REPEATABLE READ)**：即便对方客户端提交了，哪怕是退出了，本客户端都无法实时知道更新结果，只有在本客户端退出了再次启动，才能看到更新后的新数据（这是 `MySQL` 默认的隔离等级），但是可能会有幻读的问题。\n-   **串行化(SERIALIZABLE)**：事务隔离的最高级别，强制事务进行排序，使之不会相互冲突，确实解决了幻读的问题，但是会导致超时和锁竞争（太极端了，实际生产中很少用）\n\n隔离级别，基本都是通过锁来实现的，不同的隔离级别使用的锁不一样，常见的有：表锁、行锁、读锁、写锁、间隙锁（`GAP`）、`Next-Key` 锁，简单认识一下就行。\n\n## 3.2.查看和设置隔离级别\n\n```sql\n# 查看隔离级别\nmysql> select @@global.tx_isolation; # 全局设置\n+-----------------------+\n| @@global.tx_isolation |\n+-----------------------+\n| READ-UNCOMMITTED      |\n+-----------------------+\n1 row in set, 1 warning (0.00 sec)\n\nmysql> select @@session.tx_isolation; # 当前会话设置\n+------------------------+\n| @@session.tx_isolation |\n+------------------------+\n| READ-UNCOMMITTED       |\n+------------------------+\n1 row in set, 1 warning (0.00 sec)\n\nmysql> select @@tx_isolation; # 默认显示会话设置（就是当前会话的设置）\n+------------------+\n| @@tx_isolation   |\n+------------------+\n| READ-UNCOMMITTED |\n+------------------+\n1 row in set, 1 warning (0.00 sec)\n```\n\n使用 `SET {SESSION/GLOBAL} TRANSACTION ISOLATION LEVEL {READ UNCOMMITTED/READ COMMITTED/REPEATABLE READ/SERIALIZABLE};` 就可以设置隔离级别。\n\n而如果设置了全局设置，只会在下一次重启客户端时才会更新设置，一般一开始设置了隔离级别就不要修改了，最好保证隔离级别是一致的。\n\n## 3.3.不同隔离级别带来的影响\n\n再次强调，隔离主要是为了避免交叉事务出现问题。\n\n### 3.3.1.读未提交\n\n>   复习：**读未提交**，所有事务都可以看到其他事务没有提交的执行结果（相当于没有任何隔离性，实际生产中不太可能用到这个级别），我们之前的书写的事务代码，就是读未提交，没有进行 `COMMIT` 也会看到事务中的操作后结果，而对方客户端一旦崩溃就和没有存在过一样，则本客户端发送回滚。\n\n实际上之前已经做过了，最上面从设置隔离级别为 `READ-UNCOMMITTED`，后续的操作都是读未提交情景下的操作。\n\n```sql\n# 设置隔离级别\nmysql> set global transaction isolation level READ UNCOMMITTED;\nQuery OK, 0 rows affected (0.00 sec)\n\n# 然后重启两个客户端，分别查看隔离等级\nmysql> select @@tx_isolation;\n+------------------+\n| @@tx_isolation   |\n+------------------+\n| READ-UNCOMMITTED |\n+------------------+\n1 row in set, 1 warning (0.00 sec)\n```\n\n```sql\n# 客户端1：在事务中进行删除记录\nmysql> set autocommit=0;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql> show variables like 'autocommit';\n+---------------+-------+\n| Variable_name | Value |\n+---------------+-------+\n| autocommit    | OFF   |\n+---------------+-------+\n1 row in set (0.00 sec)\n\nmysql> delete from account where id=3;\nQuery OK, 1 row affected (0.01 sec)\n\nmysql> Aborted # 这里奔溃后，就相当于没有进行 COMMIT\n```\n\n```sql\n# 客户端2：不断查看数据表\nmysql> select * from account; # 客户端1没删除之前\n+----+-------+----------+\n| id | name  | blance   |\n+----+-------+----------+\n|  1 | dimou | 11030.00 |\n|  3 | timou | 50434.00 |\n+----+-------+----------+\n2 rows in set (0.00 sec)\n\nmysql> select * from account; # 客户端1删除后，还没提交就被读取到了，也就是“读未提交”\n+----+-------+----------+\n| id | name  | blance   |\n+----+-------+----------+\n|  1 | dimou | 11030.00 |\n+----+-------+----------+\n1 row in set (0.00 sec)\n\nmysql> select * from account; # 客户端1奔溃后，发现记录恢复\n+----+-------+----------+\n| id | name  | blance   |\n+----+-------+----------+\n|  1 | dimou | 11030.00 |\n|  3 | timou | 50434.00 |\n+----+-------+----------+\n2 rows in set (0.00 sec)\n```\n\n这种未提交就可以被其他客户端读取的现象，也叫做 **脏读** 现象。\n\n### 3.3.2.读已提交\n\n>   复习：**读已提交**，只有对事务进行了 `COMMIT`，才能看到更新的数据表（一条单纯的 `SQL` 语句本身就被包装成一个事务，因此使用单纯的 `SQL` 语句会让所有客户端都读取到）。\n\n```sql\n# 设置隔离级别\nmysql> set global transaction isolation level READ COMMITTED;\nQuery OK, 0 rows affected (0.00 sec)\n\n# 然后重启两个客户端，分别查看隔离等级\nmysql> select @@global.tx_isolation;\n+-----------------------+\n| @@global.tx_isolation |\n+-----------------------+\n| READ-COMMITTED        |\n+-----------------------+\n1 row in set, 1 warning (0.00 sec)\n```\n\n```sql\n# 客户端1进行修改数据表\nmysql> begin;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql> update account set name='rimou' where id=2;\nQuery OK, 1 row affected (0.00 sec)\nRows matched: 1  Changed: 1  Warnings: 0\n\nmysql> commit;\nQuery OK, 0 rows affected (0.01 sec)\n```\n\n```sql\n# 客户端2不断进行查看\nmysql> begin;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql> select * from account; # 没修改之前\n+----+-------+---------+\n| id | name  | blance  |\n+----+-------+---------+\n|  1 | limou | 1001.00 |\n|  2 | dimou | 1023.00 |\n|  3 | eimou | 2034.00 |\n+----+-------+---------+\n3 rows in set (0.00 sec)\n\nmysql> select * from account; # 客户端1修改数据，但是没有进行 commit，继续在客户端2查看，发现数据仍旧没有被修改\n+----+-------+---------+\n| id | name  | blance  |\n+----+-------+---------+\n|  1 | limou | 1001.00 |\n|  2 | dimou | 1023.00 |\n|  3 | eimou | 2034.00 |\n+----+-------+---------+\n3 rows in set (0.00 sec)\n\nmysql> select * from account; # 客户端1使用 commit，此时客户端2就会发现数据被修改了\n+----+-------+---------+\n| id | name  | blance  |\n+----+-------+---------+\n|  1 | limou | 1001.00 |\n|  2 | rimou | 1023.00 |\n|  3 | eimou | 2034.00 |\n+----+-------+---------+\n3 rows in set (0.00 sec)\n```\n\n这种提交才可以被其他客户端读取的现象，在提交之前只能获得旧数据，这要看具体场景，才能决定是对是错的。\n\n读提交有一个问题，一旦服务端 1 提交了，哪怕客户端 2 还处于事务中，也会读取到更新的数据，这在某些场景是错误的。理论上插入后更新数据表难道有错吗？有可能有错，提交确实是要让所有事务看到，但有时候不应该让运行中的事务看到（后面有个例子）。\n\n### 3.3.3.可重复读\n\n>   复习：**可重复读**，即便对方客户端提交了，哪怕是退出了，本客户端都无法实时知道更新结果，只有在本客户端退出了再次启动，才能看到更新后的新数据（这是 `MySQL` 默认的隔离等级），但是会有幻读的问题。\n\n```sql\n# 设置隔离等级\nmysql> show variables like 'autocommit';\n+---------------+-------+\n| Variable_name | Value |\n+---------------+-------+\n| autocommit    | ON    |\n+---------------+-------+\n1 row in set (0.01 sec)\n\nmysql> set global transaction isolation level REPEATABLE READ;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql> select @@global.tx_isolation;\n+-----------------------+\n| @@global.tx_isolation |\n+-----------------------+\n| REPEATABLE-READ       |\n+-----------------------+\n1 row in set, 1 warning (0.00 sec)\n```\n\n```sql\n# 客户端1：更新数据表\nmysql> begin;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql> update account set name='iimou' where id=3;\nQuery OK, 1 row affected (0.00 sec)\nRows matched: 1  Changed: 1  Warnings: 0\n\nmysql> commit;\nQuery OK, 0 rows affected (0.00 sec)\n```\n\n```sql\n# 客户端2：不断查看，奔溃后再次查看\nmysql> begin;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql> select * from account; # 在没有更新数据表内记录之前查询\n+----+-------+---------+\n| id | name  | blance  |\n+----+-------+---------+\n|  1 | limou | 1001.00 |\n|  2 | rimou | 1023.00 |\n|  3 | eimou | 2034.00 |\n+----+-------+---------+\n3 rows in set (0.00 sec)\n\nmysql> select * from account; # 更新数据表内记录后查询\n+----+-------+---------+\n| id | name  | blance  |\n+----+-------+---------+\n|  1 | limou | 1001.00 |\n|  2 | rimou | 1023.00 |\n|  3 | eimou | 2034.00 |\n+----+-------+---------+\n3 rows in set (0.00 sec)\n\nmysql> select * from account; # 在客户端1 commit 后再次查询\n+----+-------+---------+\n| id | name  | blance  |\n+----+-------+---------+\n|  1 | limou | 1001.00 |\n|  2 | rimou | 1023.00 |\n|  3 | eimou | 2034.00 |\n+----+-------+---------+\n3 rows in set (0.00 sec)\n\nmysql> Aborted 3 # 客户端2奔溃了...\n\n$ mysql\nWelcome to the MySQL monitor.  Commands end with ; or \\g.\nYour MySQL connection id is 54\nServer version: 5.7.44 MySQL Community Server (GPL)\n\nCopyright (c) 2000, 2023, Oracle and/or its affiliates.\n\nOracle is a registered trademark of Oracle Corporation and/or its\naffiliates. Other names may be trademarks of their respective\nowners.\n\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\n\nmysql> use limou_database;\nReading table information for completion of table and column names\nYou can turn off this feature to get a quicker startup with -A\n\nDatabase changed\nmysql> select * from account; # 在客户端2奔溃后重新启动\n+----+-------+---------+\n| id | name  | blance  |\n+----+-------+---------+\n|  1 | limou | 1001.00 |\n|  2 | rimou | 1023.00 |\n|  3 | iimou | 2034.00 |  # 发现这里终于被修改了\n+----+-------+---------+\n3 rows in set (0.00 sec)\n```\n\n>   例子：举一个超级生动具体的例子\n>\n>   一家公司招聘程序员时，原本规定了一个工作等级，于是开始招聘员工，假设招进了 `A` 程序员，`A` 程序员和 `HR` 敲定了自己的工资等级，最后成功入职。问题是，假设公司新出现了一个大型项目，需要招聘大量程序员，于是提高了薪资等级中的工资量。果然成功吸引了程序员 `B`，程序员 `B` 和 `HR` 谈拢后，确定了和程序员 `A` 一样的等级，但是薪资却更高。\n>\n>   而对于公司（黑心的）来说，不会直接告诉 `A` 你这个等级的薪资提高了，所以我要给你提薪...`A` 需要知道吗？不需要，你继续做你的工作就行了，在 `A` 的认知中，自己这个等级的薪资就是原先谈好的那么高。\n>\n>   而一旦那一天工资项目出现问题，要进行裁员，就把 `A` 给“优化”（裁员）了，但是最后公司发现，自己貌似开走了一个“大动脉”（你之前写的代码逻辑非常重要，没 `A` 不行的那种），最后又把你找回来，按照 `B` 的薪资招聘你。\n>\n>   这就是“可重复读”，`A` 始终用的是旧的薪资等级来判断薪资，但是后来的 `B` 却是更新后的第二套薪资体系，可是在 `A` 就职期间（被重新招聘前），没必要知道更新后的薪资等级（不然 `A` 闹起来怎么办，笑）。\n>\n>   >   员工 `A`：客户端 1\n>   >\n>   >   员工 `B`：客户端 2\n>   >\n>   >   `A` 就职期间：客户端 1 启动事务期间\n>   >\n>   >   `B` 就职期间：客户端 2 启动事务期间\n>   >\n>   >   `A` 离职时：客户端 1 结束事务进行提交\n\n但是，在一些数据库中，在可重复隔离下，`insert` 的 `sql` 可能无法被屏蔽（因为隔离性是通过加锁和其他策略来实现的，但是混则很难通过加锁来实现），在多次查询的过程中，就有可能会查出更新的数据（也就是“幻读”）。但是 `MySQL` 中，在 `RR` 级别中修复了这个问题（使用 `GAP+行锁`），我们不在这里深入了解，这也是为什么该级别是默认级别的原因。\n\n### 3.3.4.串行化\n\n>   复习：**串行化**，事务隔离的最高级别，强制事务进行排序，使之不会相互冲突，确实解决了幻读的问题，但是会导致超时和锁竞争（太极端了，实际生产中很少用）\n\n```sql\n# 设置隔离级别\nmysql> set global transaction isolation level SERIALIZABLE;\nQuery OK, 0 rows affected (0.01 sec)\n\nmysql> select @@global.tx_isolation;\n+-----------------------+\n| @@global.tx_isolation |\n+-----------------------+\n| SERIALIZABLE          |\n+-----------------------+\n1 row in set, 1 warning (0.00 sec)\n```\n\n```sql\n# 客户端1较后开启事务\nmysql> begin;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql> update account set name='eimou' where id=2;\n\n# 陷入阻塞状态，知道客户端2进行 commit 后才执行这条 sql\n\nQuery OK, 1 row affected (14.32 sec)\nRows matched: 1  Changed: 1  Warnings: 0\n\nmysql> commit;\nQuery OK, 0 rows affected (0.01 sec)\n```\n\n```sql\n# 客户端2较先开启事务\nmysql> begin;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql> select * from account; # 客户端1还没修改前\n+----+-------+---------+\n| id | name  | blance  |\n+----+-------+---------+\n|  1 | limou | 1001.00 |\n|  2 | rimou | 1023.00 |\n|  3 | iimou | 2034.00 |\n+----+-------+---------+\n3 rows in set (0.00 sec)\n\nmysql> select * from account; # 客户端1修改后\n+----+-------+---------+\n| id | name  | blance  |\n+----+-------+---------+\n|  1 | limou | 1001.00 |\n|  2 | rimou | 1023.00 |\n|  3 | iimou | 2034.00 |\n+----+-------+---------+\n3 rows in set (0.00 sec)\n\nmysql> commit;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql> select * from account; # 客户端2提交后查看\n+----+-------+---------+\n| id | name  | blance  |\n+----+-------+---------+\n|  1 | limou | 1001.00 |\n|  2 | rimou | 1023.00 |\n|  3 | iimou | 2034.00 |\n+----+-------+---------+\n3 rows in set (0.00 sec)\n\nmysql> Aborted # 客户端2崩溃、\n\n$ mysql\nWelcome to the MySQL monitor.  Commands end with ; or \\g.\nYour MySQL connection id is 61\nServer version: 5.7.44 MySQL Community Server (GPL)\n\nCopyright (c) 2000, 2023, Oracle and/or its affiliates.\n\nOracle is a registered trademark of Oracle Corporation and/or its\naffiliates. Other names may be trademarks of their respective\nowners.\n\nType 'help;' or '\\h' for help. Type '\\c' to clear the current input statement.\n\nmysql> use limou_database;\nReading table information for completion of table and column names\nYou can turn off this feature to get a quicker startup with -A\nDatabase changed\n\nmysql> select * from account; # 重启后再次查看就发现依旧没有被修改\n+----+-------+---------+\n| id | name  | blance  |\n+----+-------+---------+\n|  1 | limou | 1001.00 |\n|  2 | rimou | 1023.00 |\n|  3 | iimou | 2034.00 |\n+----+-------+---------+\n3 rows in set (0.00 sec)\n\nmysql> select * from account; # 只有客户端1提交了，才能看到修改\n+----+-------+---------+\n| id | name  | blance  |\n+----+-------+---------+\n|  1 | limou | 1001.00 |\n|  2 | eimou | 1023.00 |\n|  3 | iimou | 2034.00 |\n+----+-------+---------+\n3 rows in set (0.00 sec)\n```\n\n注意，是事务之间串行化，不是进程之间串行化！\n\n以上隔离等级就是 **隔离性** 的体现，而怎么体现一致性呢？\n\n事务执行的结果，必须使数据库的一个一致性状态，转移到另外一个一致性状态。如果系统发生中断，某个事务未完成而被迫中止，而为改完的事务对数据库所做的修改已经写入数据库，此时数据库处于不正确、不一致的状态。因此是通过原子性（回滚）来保证一致的（而一致性和用户的逻辑强相关，由用户决定）。而其他三属性实际上都是围绕一致性来展开的，可以说 `AID` 是因，用户配合，`C` 是果。\n\n>   注意：这关于事务这块还是比较复杂的，建议深入了解，反复学习。\n\n# 4.隔离性的原理\n\n数据库事务的并发场景有三个：\n\n-   `读-读`：不存在任何问题，因此不需要并发控制\n-   `读-写`：有线程安全问题，可能造成事务隔离性问题（脏读、幻读、不可重复读），这种情况是主要的\n-   `写-写`：有线程安全问题，可能存在更新丢失问题（第一类更新丢失、第二类更新丢失）\n\n`读-读` 我们几乎不需要讨论，重点讨论 `读-写` 的实现，不讨论 `写-写` 的实现。\n\n而多版本并发控制（`MVCC`）是一种用来解决 `读-写冲突` 的无锁并发控制。\n\n>   注意：理解 `MVCC` 必须先理解几个周边知识。\n>\n>   -   事务的 `ID`\n>   -   三个隐藏字段\n>   -   `undo` 日志\n\n## 4.1.事务的 ID\n\n为事务分配单向增长的事务 `ID`，为每个修改保存一个版本，版本与事务 `ID` 关联，读操作只读该事务开始前的数据快照，所以 `MVCC` 可以为数据库解决：\n\n1.   并发读写数据库时，可以做到在\n     (1)读操作时不用阻塞写操作\n     (2)写操作时不用阻塞读操作\n     提高了数据库并发读写的性能\n2.   同时可以解决：\n     (1)脏读（未提交就可以被其他客户端读取）\n     (2)幻读（在多次查询的过程中查出更加新的数据）\n     (3)不可重复读（对方客户端提交，本客户端就会立刻看到更新结果）\n\n事务 `ID` 越小，事务到来的顺序越靠前。\n\n`MySQL` 底层是 `C/C++` 编写的，因此内部事务也一定是有对应的结构体/类，内部有事务的属性和方法，再生成事务实例进行组织（使用特点的数据结构进行组织）。\n\n而事务 `ID` 也一定是事务结构体内部的属性之一，此外还有其他的属性。\n\n## 4.2.三个隐藏字段\n\n在数据表中，隐藏三个字段：\n\n1.   `DB_TRX_ID`：`6 byte`，记录创建这条记录，且最后一次修改（修改/插入）该记录的事务 `ID`（因此很容易对操作进行溯源）\n2.   `DB_ROLL_PTR`：`7 byte`，回滚指针，指向这条记录的上一个版本（简单理解成指向历史版本，这些数据一般都在 `undo log` 中。`MySQL` 在修改一条记录的时候，仍会保留该记录，然后再复制一份去修改，有点类似“写时拷贝”）\n3.   `DB_ROW_ID`：`6 byte`，隐含的自增 `ID`（也就是我们以前在索引里提到的隐藏主键），如果数据表没有主键，`InnoDB` 会自动以 `DB_ROW_ID` 产生一个聚簇索引（而如果用户设定了主键，就会导致该字段无效，因为一个表只能有一个主键）\n4.   `FLAG`：记录被更新或删除并不代表真的删除，而是 `flag` 变了，等到刷盘的时候再修改磁盘内的数据，并且如果希望恢复，也可以恢复该字段，达到恢复数据有效性的\n\n## 4.3.undo 日志\n\n在提及 `undo` 日志之前，我们还需要提及下 `MySQL` 里的日志模块，`undo` 就是撤销的意思，本质是 `MySQL` 使用 `new/malloc()` 申请出来的一块内存空间，在内存种运行，临时性非常高。\n\n>   补充：我们之前提及的所有机制，索引、事务、隔离性、日志等，都是在内存种完成的操作，然后在特定的时候进行刷盘。\n\n## 4.4.模拟 MVCC\n\n```sql\n# 创建一个用于解释的表结构\nmysql> create table if not exists student(\n    -> name varchar(11) not null,\n    -> age int not null\n    -> );\nQuery OK, 0 rows affected (0.04 sec)\n```\n\n假设创建了上述表结构，此时数据表字段结构如下：\n\n| name  | age  | DB_TRX_ID(创建对应记录的事务 ID) | DB_ROW_ID(隐式主键) | DB_ROLL_PTR(回滚指针) |\n| ----- | ---- | -------------------------------- | ------------------- | --------------------- |\n| limou | 18   | 9（假设是 `9` 号 `ID` 的事务插入的） | 1                   | null |\n\n现在有一个事务 `ID=10` 的事务，封装内含操作为：修改 `name='limou'` 为 `name='dimou'` 的 `SQL` 语句。\n\n在修改前，先将原本未修改的记录 `[limou,18,9,1,null]` 加锁，然后保存/拷贝一份，放入 `undo log`，给予这条被保存的记录一个内存地址，假设是 `0xaa`。\n\n此时回到原来的记录，现在要对其进行修改：\n\n1.   `DB_ROLL_PTR=null` 变为 `DB_ROLL_PTR=0xaa`，这就是保存了一个版本\n2.   `name='limou'` 变为 `name='daimou'`\n3.   `DB_TRX_ID=9` 变为 `DB_TRX_ID=10`\n4.   `DB_ROW_ID=1` 变为 `DB_ROW_ID=2`\n\n最后进行 `COMMIT` 时，释放该记录的锁，因此修改记录是原子的，保证串行化。\n\n| name  | age  | DB_TRX_ID(创建对应记录的事务 ID) | DB_ROW_ID(隐式主键) | DB_ROLL_PTR(回滚指针) |\n| ----- | ---- | -------------------------------- | ------------------- | --------------------- |\n| dimou | 18   | 10                               | 2                   | 0xaa                  |\n\n假设这个时候又有一个事务 `ID=11` 的事务，该事务修改 `age=28`。也是要修改记录，那这条记录是哪一个记录的呢？首先排除历史记录，历史记录必须是稳定的，最好一次写入的。\n\n因此只能改最新的记录，能直接改么？不能！需要先复制一份记录 `[dimou,18,10,2,0xaa]` 到 `undo log` 中，然后再进行和第一次插入记录时一样的操作。\n\n>   注意：此时在 `undo log` 中的历史记录的字段 `DB_ROLL_PTR` 是相互链接的，形成版本链链表。\n\n| name  | age  | DB_TRX_ID(创建对应记录的事务 ID) | DB_ROW_ID(隐式主键) | DB_ROLL_PTR(回滚指针) |\n| ----- | ---- | -------------------------------- | ------------------- | --------------------- |\n| dimou | 28   | 11                               | 3                   | 0xbb                  |\n\n而所谓的回滚操作，不就是对版本链链表的操作么（当然，肯定还有很多其他细节，这里不敢细细深究，我们这里简单来理解就行）。\n\n>   补充：实际上回滚时，不是直接把历史记录覆盖到数据表中的，而是和操作记录相反的 `SQL` 语句，如果需要回滚，只需要执行这些相反的操作就可以了（用户进行插入，`MySQL` 就记录一条相反的删除语法，方便以后回滚数据）。\n\n上面的版本链模型就是 **多版本并发控制（`MVCC`）** 的体现，其中每一个版本我们习惯称为一个 **快照**。\n\n那如果操作过多，`undo log` 会不会被塞满呢？首先 `undo log` 是一个内存级的。对于一个事务来说，一旦被 `COMMIT` 就会被 `delete/free()` 释放空间，内部的快照也会被清除（这也就是为什么 `COMMIT` 后的事务无法回滚的原因）。\n\n那在什么时候会持续保存快照数据？多事务的时候，有的时候访问的不是最新记录，而是历史记录（`undo log` 主要是配合隔离性设置的）。\n\n那如果删除数据呢？简单，设置 `flag` 就行，也是形成版本链/快照。\n\n那插入怎么办？数据表中本来就没有，那是怎么回滚的呢？记录和 `insert` 相反的 `delete` 操作即可，同样可以形成版本链/快照。\n\n那 `select` 呢？其本身只是查看数据表中的记录，版本记录没有意义，但是会有一个问题：`select` 该去查看哪一个版本的快照呢？\n\n首先我们定义读的方式： \n\n-   **当前读**：读取到最新的数据，增删改数据表都涉及到当前读，而 `select` 有可能是当前读\n-   **快照读**：读取到快照/历史版本就叫做快照读，一般是 `select` 在快照读\n\n读写并发时，如果是读取不同版本数据表，并且设置了隔离级别，这就注定是读取不同资源，也就无需加锁，因此就可以并发进行读写操作（当然，如果都是读操作都是当前读，也还是需要加锁的，因为是同一份最新的资源）。\n\n基本数据被其他客户端改了，只要读取的版本固定，就一定不会让不同的读取受到影响，进一步就是发生了隔离，这种就是在“版本上做隔离”！\n\n**而隔离级别的设置，就是对一个事务使用 `select` 能看到哪一个版本的设置**。到此，隔离性会让所有并发执行事务看到不同的数据的基础也就找出来了（这是一个即提高效率，又为后续隔离性做铺垫的非常完美的方案）。\n\n因此隔离性、回滚，都是基于 `MVCC` 来控制、设置的。\n\n而串行化实际上就可以简单理解为，读写操作都要求加锁，导致事务变得串行化。\n\n为什么设置不同的隔离级别？首先事务是原子的，一定有先后顺序，从 `BEGIN` 到 `COMMIT` 一定是有一个过程的，多个事务中，让不同的事务看到它那个时间点该看到的数据（至于看到什么信息，是需要根据情况来抉择的，进而选择不同的隔离级别）。\n\n## 4.5.Read View\n\n`Read View` 就是事物进行快照读操作时生产的读视图，在事物执行的快照读那一刻，会生成数据库系统中一个快照，记录并维护系统当前活跃事务的 `ID`，这个 `ID` 是递增，所以最新的事务 `ID` 值越大。\n\n而 `Read View` 在 `MySQL` 源码中体现为一个类，本质就是一个结构体/类描述，用来进行可见性判断。当我们某个事务执行快照读的时候，会对该记录创建一个 `Read View` 读视图，可以把它的整体比作一个条件，用来判断当前事务能够看到哪个版本的数据，既可以是当前最新的数据，也可以是 `undo log` 里某个版本的数据。\n\n```cpp\n//读视窗结构体\nclass ReadView\n{\nprivate:\n    trx_id_t m_up_limit_id; //低水位（没写错），小于等于这个 ID 的事务均可见\n    trx_id_t m_low_limit_id; //高水位（没写错），大于等于这个 ID 的事务均不可见\n    \n    trx_id_t m_creator_trx_id; //创建该 Read View 对象的事务 ID\n    \n    ids_t m_ids; //创建视图时的其他一起活跃事务的 ID 列表\n    //up_limit_id：记录 m_ids 列表中事务 ID 最小的 ID（没有写错）\n    //low_limit_id：Read View 生成时刻系统尚未分配的下一个事务 ID，就是目前已出现事务 ID 的最大值 +1（没有写错），不是事务最大值 +\n\n    trx_id_t m_low_limit_no; //配合 purge 值，了解一下就行，我们不关心\n    bool m_closed; //标记视图是否被关闭，也不太关心\n};\n```\n\n>   补充：可以尝试使用进程结构体来类比事务结构体，而进程地址空间类比读视图。\n\n而 **只有首次** 某个事务执行快照读的时候，才会对该记录创建一个 `Read View` 读视图（进程也是类似）。\n\n我们再实际读取版本链的时候，是能读取到每个版本对于的事务 `ID` 的，即 `DB_TRX_ID` 字段的信息。\n\n那么现在的工作就是将 `DB_TRX_ID` 和 `ReadView{/*...*/};` 做比较，来得到事务是否可见的判断。\n\n![cadf5343aace0afadac2ffc4c5f52d5](./assets/cadf5343aace0afadac2ffc4c5f52d5.png)\n\n读取 `Undo Log` 的那一刻生成读视图：\n(1)遇到快照记录中，`DB_TRX_ID=m_creator_trx_id` 时，\n则说明是自己事务中处理的历史记录，自己做的操作就应该被自己 **看到**，因此跳过该记录就行。\n(2)遇到快照记录中，和同时期运行事务的最小 `ID`，即 `DB_TRX_ID<up_limit_id` 时，\n则说明该记录对于的事务已经被提交/结束，否者不可能要小，所以我这个事务应该 **看到** 这个数据。\n(3)遇到快照记录中，大于等于系统未分批事务的最小 `ID`，即 `DB_TRX_ID>=low_limit_id` 时，\n则说明我这个记录在形成快照时，这个快照记录对应的事务还没开始呢，但是这个事务比我先执行修改，导致我找得到这个记录，但由于是后来者，我理应 **看不到** 这个记录\n(4)遇到快照记录中，有 `up_limit_id<DB_TRX_ID<low_limit_id` 时，\n这说明该快照对应记录是同处于交叉运行的活跃事务，这个事务是否要被我看到，还没有提交，我也 **看不到** 这个记录。\n\n## 4.6.实际操作\n\n假设当前学生表内有记录如下：\n\n| name  | age  | DB_TRX_ID(创建对应记录的事务 ID) | DB_ROW_ID(隐式主键) | DB_ROLL_PTR(回滚指针) |\n| ----- | ---- | -------------------------------- | ------------------- | --------------------- |\n| limou | 18   | 0                                | 1                   | 0xaa                  |\n\n然后又如下几个事务：\n\n| 时间点 | 事务 1 [id = 1] | 事务 2 [id = 1] | 事务 3 [id = 1] | 事务 4 [id = 1]                 |\n| ------ | ----------- | ----------- | ----------- | --------------------------- |\n| 1      | 事务开始    | 事务开始    | 事务开始    | 事务开始                    |\n| 2      | 交叉...     | 交叉...     | 交叉...     | 修改提交 `'limou'->'dimou'` |\n| 3      | 进行中      | 快照读      | 进行中      |                             |\n| 4      | ...         | ...         | ...         |                             |\n\n>   注意：`ID` 值越小的事务越先被启动，这点需要注意。\n\n1.   事务 `4` 成功修改 `name='dimou'`，并且生成对应的版本链\n\n     ![a97981ed798f4d965aad3ceb6ada95a](./assets/a97981ed798f4d965aad3ceb6ada95a.png)\n\n2.   事务 `2` 对某行执行了快照读，此时数据库为改行数据生成一个 `Read View` 读视图，其内部属性值如下：\n     ```cpp\n     //事务2的 Read View\n     m_ids; //[1,3]\n     up_limit_id; //1\n     low_limit_id; //4+1=5，注意是系统未分配的最近的事务 ID\n     creator_trx_id; //本事务的事务 ID=2\n     ```\n\n     上述属性会从 `DB_ROW_ID=2` 开始遍历版本链进行比对，事务二能不能看到事务四的提交呢（先不考虑隔离级别，直接按照我本小节的理解）？\n\n3. 遍历快照可以确定，快照不对应事务的 `ID` 值四种情况，如果可以看到，这就是读提交 `RC` 的隔离级别\n\n那 `RC` 究竟和 `RR` 有什么区别呢（分别指 `READ COMMITTED/REPEATABLE READ`）？\n\n首先您需要知道，指令 `SELECT * FROM table_name LOCK IN SHARE MODE;` 就是当前读，而不是您以前使用 `SELECT` 时默认的快照读，然后我们做一个实验：\n\n```sql\n# 设置为 RR 模式\nmysql> set global transaction isolation level REPEATABLE READ;\nQuery OK, 0 rows affected (0.00 sec)\n\n# 重启终端查看是否更改\nmysql> select @@tx_isolation;\n+-----------------+\n| @@tx_isolation |\n+-----------------+\n| REPEATABLE-READ |\n+-----------------+\n1 row in set, 1 warning (0.00 sec)\n\n# 创建测试用的表\ncreate table if not exists account(\n    id int primary key,\n    name varchar(50) not null default '',\n    age int\n)ENGINE=InnoDB DEFAULT CHARSET=UTF8;\n\n# 插入一些记录，用来测试\nmysql> insert into account (id, name, age) values (1, 'iimou', 15);\nQuery OK, 1 row affected (0.00 sec)\n```\n\n| 事务 A                                            | 事务 B                                                       |\n| ------------------------------------------------- | ------------------------------------------------------------ |\n| `begin;` 事务开始                                 | `begin;` 事务开始                                            |\n| 交叉...                                           | 交叉...                                                      |\n| `select * from account;` 快照读（无影响）         | `select * from account;` （此时第一次形成了 `Read View` 快照读，认为 `A` 和自己是一块运行的） |\n| `update account set age=18 where id = 1;`（更新） | -                                                            |\n| `commit;`                                         | -                                                            |\n| -                                                 | `select * from account;` 快照读（没读到 `age=18`）           |\n| -                                                 | `select * from account lock in share mode;` 当前读（读到了 `age=18`） |\n\n再来做一个测试：\n\n| 事务 A                                            | 事务 B                                                       |\n| ------------------------------------------------- | ------------------------------------------------------------ |\n| `begin;` （事务开始）                             | `begin;` （事务开始）                                        |\n| 交叉...                                           | 交叉...                                                      |\n| `select * from account;`                          | -                                                            |\n| `update account set age=28 where id = 1;`（更新） | -                                                            |\n| `commit;`                                         | -                                                            |\n| -                                                 | `select * from account;` （只在这个时候生成 `Read View`,读到 `age=28`，`B` 不认为 `A` 和自己同时活跃） |\n| -                                                 | `select * from account lock in share mode;`（读到了 `age=28`） |\n\n欸，不是可重复读吗？为什么会被修改呢？如果你是事务 `B`，你自己一直不查你哪里知道数据库里是什么？只需要保证你从第一次读取的时候到最后退出时，都是读取到同一个数据就行了。在那之前，改了什么根本不需要关系。\n\n因此这里就可以得到一个结论：`Read View` 形成的时机会影响可见性。\n\n因此 `RR` 和 `RC` 的深层区别是 `Read View` 形成时机不同。\n\n-   在 `RR` 级别下的某个事务的对某条记录的第一次快照读会创建一个快照及 `Read View`，将当前系统活跃的其他事务记录起来。\n\n    此后在调用快照读的时候，还是使用的是同一个 `Read View`，所以只要当前事务在其他事务提交更新之前使用过快照读，那么之后的快照读使用的都是同一个 `Read View`，所以对之后的修改不可见。\n\n    `RR` 级别下，快照读生成 `Read View` 时，`Read View` 会记录此时所有其他活动事务的快照，这些事务的修改对于当前事务都是不可见的。而早于 `Read View` 创建的事务所做的修改均是可见。\n\n-   而在 `RC` 级别下的，事务中，每次快照读都会新生成一个快照和`Read View`，这就是我们在 `RC` 级别下的事务中可以看到别的事务提交的更新的原因。总之在 `RC` 隔离级别下，是每个快照读都会生成并获取最新的 `Read View`。所以，RC才会有不可重复读问题。\n\n>   补充：建议再看一遍，待补充...","excerpt":"","includedFiles":[],"tasklistId":0,"title":"1.事务的理解","headers":[{"level":2,"title":"1.1.事务的概念","slug":"_1-1-事务的概念","link":"#_1-1-事务的概念","children":[]},{"level":2,"title":"1.2.事务的版本","slug":"_1-2-事务的版本","link":"#_1-2-事务的版本","children":[]},{"level":2,"title":"2.1.做一些准备工作","slug":"_2-1-做一些准备工作","link":"#_2-1-做一些准备工作","children":[]},{"level":2,"title":"2.2.正常情况的事务","slug":"_2-2-正常情况的事务","link":"#_2-2-正常情况的事务","children":[]},{"level":2,"title":"2.3.异常情况的事务","slug":"_2-3-异常情况的事务","link":"#_2-3-异常情况的事务","children":[{"level":3,"title":"2.3.1.设置为 OFF","slug":"_2-3-1-设置为-off","link":"#_2-3-1-设置为-off","children":[]},{"level":3,"title":"2.3.2.设置为 ON","slug":"_2-3-2-设置为-on","link":"#_2-3-2-设置为-on","children":[]}]},{"level":2,"title":"3.1.隔离和隔离级别","slug":"_3-1-隔离和隔离级别","link":"#_3-1-隔离和隔离级别","children":[]},{"level":2,"title":"3.2.查看和设置隔离级别","slug":"_3-2-查看和设置隔离级别","link":"#_3-2-查看和设置隔离级别","children":[]},{"level":2,"title":"3.3.不同隔离级别带来的影响","slug":"_3-3-不同隔离级别带来的影响","link":"#_3-3-不同隔离级别带来的影响","children":[{"level":3,"title":"3.3.1.读未提交","slug":"_3-3-1-读未提交","link":"#_3-3-1-读未提交","children":[]},{"level":3,"title":"3.3.2.读已提交","slug":"_3-3-2-读已提交","link":"#_3-3-2-读已提交","children":[]},{"level":3,"title":"3.3.3.可重复读","slug":"_3-3-3-可重复读","link":"#_3-3-3-可重复读","children":[]},{"level":3,"title":"3.3.4.串行化","slug":"_3-3-4-串行化","link":"#_3-3-4-串行化","children":[]}]},{"level":2,"title":"4.1.事务的 ID","slug":"_4-1-事务的-id","link":"#_4-1-事务的-id","children":[]},{"level":2,"title":"4.2.三个隐藏字段","slug":"_4-2-三个隐藏字段","link":"#_4-2-三个隐藏字段","children":[]},{"level":2,"title":"4.3.undo 日志","slug":"_4-3-undo-日志","link":"#_4-3-undo-日志","children":[]},{"level":2,"title":"4.4.模拟 MVCC","slug":"_4-4-模拟-mvcc","link":"#_4-4-模拟-mvcc","children":[]},{"level":2,"title":"4.5.Read View","slug":"_4-5-read-view","link":"#_4-5-read-view","children":[]},{"level":2,"title":"4.6.实际操作","slug":"_4-6-实际操作","link":"#_4-6-实际操作","children":[]}]}}
