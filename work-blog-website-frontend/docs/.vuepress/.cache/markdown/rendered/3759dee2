{"content":"<h2 id=\"_1-设计不能被拷贝的类\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-设计不能被拷贝的类\"><span>1.设计不能被拷贝的类</span></a></h2>\n<blockquote>\n<p>解析：拷贝只会放生在两个场景中</p>\n<ol>\n<li>拷贝构造函数</li>\n<li>赋值运算符重载</li>\n</ol>\n<p>因此想要让一个类禁止拷贝，就需让该类不能调用“拷贝构造函数”以及“赋值运算符重载”，而 <code v-pre>C++11</code> 提供的 <code v-pre>delete</code> 重载关键字可以让这件事情变得更加简单。</p>\n</blockquote>\n<h3 id=\"_1-1-c-98-做法\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-1-c-98-做法\"><span>1.1.C++98 做法</span></a></h3>\n<div class=\"language-cpp line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"cpp\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> CopyBan</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">public</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tCopyBan</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t\t:</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> _c</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t{}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">private</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//拷贝构造私有化</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tCopyBan</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> CopyBan</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//赋值重载私有化</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">\tCopyBan</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> operator</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">=</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> CopyBan</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">private</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tint</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> _c</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\tCopyBan c</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//CopyBan copy(c);//禁用了</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">\treturn</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3 id=\"_1-2-c-11-做法\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-c-11-做法\"><span>1.2.C++11 做法</span></a></h3>\n<div class=\"language-cpp line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"cpp\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> CopyBan</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">public</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tCopyBan</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t\t:</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> _c</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t{}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//拷贝构造私有化</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tCopyBan</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> CopyBan</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> delete</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//赋值重载私有化</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">\tCopyBan</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> operator</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">=</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> CopyBan</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> delete</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">private</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tint</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> _c</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\tCopyBan c</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//CopyBan copy(c);//禁用了</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">\treturn</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2 id=\"_2-设计在堆上创建的类\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-设计在堆上创建的类\"><span>2.设计在堆上创建的类</span></a></h2>\n<h3 id=\"_2-1-析构私有\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-1-析构私有\"><span>2.1.析构私有</span></a></h3>\n<blockquote>\n<p>解析：一个在栈上的对象如果没有办法调用析构，就没有办法被创建，因为编译器认为没有析构，禁止直接创建对象，这种情况就只能使用 <code v-pre>new</code> 创建对象，并且提供一个用于释放的接口。</p>\n</blockquote>\n<div class=\"language-cpp line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"cpp\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> HeapOnly</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">public</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    static</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> void</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> Destroy_1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">HeapOnly</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> ptr</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">    {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">        delete</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> ptr</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">    }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    //or</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    void</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> Destroy_2</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">    {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">        delete</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> this</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">    }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">private</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ~HeapOnly</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    //HeapOnly h1;//禁用</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    HeapOnly</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> ph1 </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> HeapOnly</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    HeapOnly</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">::</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Destroy_1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">ph1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    HeapOnly</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> ph2 </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> HeapOnly</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">    ph2</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">-></span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Destroy_2</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    //HeapOnly h2(*ph1);//禁用</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3 id=\"_2-2-构造私有\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-2-构造私有\"><span>2.2.构造私有</span></a></h3>\n<blockquote>\n<p>解析：如果一个类的构造被私有了，那么就无法直接调用，包括 <code v-pre>new</code> 也无法调用，然后我们提供给用户一个接口，在类的内部 <code v-pre>new</code> 返回类指针给用户，交给用户释放即可。</p>\n<p>就是需要注意，还需要将拷贝构造私有化，避免用户使用接口后，解引用进行拷贝。</p>\n</blockquote>\n<div class=\"language-cpp line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"cpp\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> HeapOnly</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">public</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    static</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> HeapOnly</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> CreateObject</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">//这里必须是 static 静态成员函数</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">    {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> HeapOnly</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">    }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">private</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    HeapOnly</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    HeapOnly</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> HeapOnly</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    //HeapOnly h1;//禁用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    HeapOnly</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> ph </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> HeapOnly</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">::</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">CreateObject</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">//如果不是静态就需要创建对象来调用 CreateObject()，但我们已经没有办法产生对象了</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    //HeapOnly h2(*ph);//禁用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2 id=\"_3-设计在栈上创建的类\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-设计在栈上创建的类\"><span>3.设计在栈上创建的类</span></a></h2>\n<blockquote>\n<p>解析：需要删除 <code v-pre>operator new()</code> 才能彻底解决问题，注意不能私有构造函数！</p>\n</blockquote>\n<div class=\"language-cpp line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"cpp\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> StackOnly</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">public</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tstatic</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> StackOnly</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> CreateObj</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">\t\treturn</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> StackOnly</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//禁掉 operator new() 可以把用 new 调用拷贝构造申请对象给禁掉</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tvoid*</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> operator</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> new</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">size_t</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> size</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> delete</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tvoid</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> operator</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> delete</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">void*</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> p</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> delete</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">private</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tStackOnly</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">//实际上删除了 operator new() 就无需将构造函数私有化了，上述的 CreateObj() 也可以一起不要了</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t\t:</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> _a</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t{}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//不可私有拷贝构造</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//StackOnly(StackOnly&#x26; s)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//\t: _a(0)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//{}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">private</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tint</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> _a</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\tStackOnly obj </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> StackOnly</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">::</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">CreateObj</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//StackOnly* ptr1 = new StackOnly();//禁用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//StackOnly* ptr2 = new StackOnly(obj);//禁用，这个不能私有拷贝构造，只能删除 new 的底层调用 operator new，否则就无法返回 CreateObj() 的结果</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//delete&#x26; obj;//禁用</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">\treturn</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2 id=\"_4-设计无法被继承的类\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_4-设计无法被继承的类\"><span>4.设计无法被继承的类</span></a></h2>\n<h3 id=\"_4-1-c-98-做法\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_4-1-c-98-做法\"><span>4.1.C++98 做法</span></a></h3>\n<p>父类的构造函数被私有化就不会被子类继承。</p>\n<h3 id=\"_4-2-c-11-做法\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_4-2-c-11-做法\"><span>4.2.C++11 做法</span></a></h3>\n<p>使用关键字 <code v-pre>final</code>，表示该类不可被继承。</p>\n<h2 id=\"_5-设计创建单对象的类\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_5-设计创建单对象的类\"><span>5.设计创建单对象的类</span></a></h2>\n<p>实际上就是所谓的“单例模式”，该类只能被创建出一个对象，单例模式实际是一种设计模式。</p>\n<blockquote>\n<p>补充：常见的设计模式有 <code v-pre>23</code> 种，其实就是被反复使用、多数人知晓、经过分类、代码设计经验的总结，是编程界探索出来的一种编程“兵法”，其积极的一面是可以避免人们走入一些“坑”，当然设计模式只是一种实践经验，并不是所有的设计模式都适用于每个场景，使用哪种设计模式需要考虑到具体的需求和系统架构。</p>\n<ol>\n<li><code v-pre>Singleton</code>（单例模式）</li>\n<li><code v-pre>Factory Method</code>（工厂方法模式）</li>\n<li><code v-pre>Abstract Factory</code>（抽象工厂模式）</li>\n<li><code v-pre>Builder</code>（建造者模式）</li>\n<li><code v-pre>Prototype</code>（原型模式）</li>\n<li><code v-pre>Adapter</code>（适配器模式）</li>\n<li><code v-pre>Bridge</code>（桥接模式）</li>\n<li><code v-pre>Composite</code>（组合模式）</li>\n<li><code v-pre>Decorator</code>（装饰器模式）</li>\n<li><code v-pre>Facade</code>（外观模式）</li>\n<li><code v-pre>Flyweight</code>（享元模式）</li>\n<li><code v-pre>Proxy</code>（代理模式）</li>\n<li><code v-pre>Chain of Responsibility</code>（责任链模式）</li>\n<li><code v-pre>Command</code>（命令模式）</li>\n<li><code v-pre>Interpreter</code>（解释器模式）</li>\n<li><code v-pre>Iterator</code>（迭代器模式）</li>\n<li><code v-pre>Mediator</code>（中介者模式）</li>\n<li><code v-pre>Memento</code>（备忘录模式）</li>\n<li><code v-pre>Observer</code>（观察者模式）</li>\n<li><code v-pre>State</code>（状态模式）</li>\n<li><code v-pre>Strategy</code>（策略模式）</li>\n<li><code v-pre>Template Method</code>（模板方法模式）</li>\n<li><code v-pre>Visitor</code>（访问者模式）</li>\n</ol>\n<p>不过一般谈设计模式都是在接近上层的设计才会得到更多的关注，过于底层的设计一般比较少提及。</p>\n</blockquote>\n<p>“单例”的解释就是“单份实例化”，数据类型可以是任意的，但是全局只能有一个实例化，最典型的就是内存池，内存池最好只有一份，否则容易出现问题（尤其是项目变大时，往往绕不开单例模式）。</p>\n<h3 id=\"_5-1-饿汉模式\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_5-1-饿汉模式\"><span>5.1.饿汉模式</span></a></h3>\n<div class=\"language-cpp line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"cpp\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">//单例模式——饿汉模式</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">#</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">iostream</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">using</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> namespace</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">//饿汉模式：把对象提前创建好（最好是在 程序/main 启动时），并且随时需要（不要使用全局变量来实现，一是无法直接创建，二是容易重定义，应该使用静态变量）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">template</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> &#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> Type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> HungryManModel</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">public</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tstatic</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> HungryManModel</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> GetInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //4.获取实例对象，并且由于用户无法直接创建对象，这个函数也必须静态成员函数，方便用户调用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">\t\treturn</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x26;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">_inst</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //5.返回单例对象</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tHungryManModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> HungryManModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">Type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> delete</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //12.禁用拷贝构造</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">\tHungryManModel</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> operator</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">=</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> HungryManModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">Type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> delete</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //14.禁用赋值重载（一般禁用拷贝构造也会禁用赋值重载）</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//6.这里再加上对单例对象的一些操作方法</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tvoid</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> Add</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\t\t_data</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">++</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tvoid</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> Print</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\t\tcout </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x3C;&#x3C;</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">数据:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;&#x3C;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> _data </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x3C;&#x3C;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> endl</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">private</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tHungryManModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //2.将构造函数私有化，禁止用户直接在类外构造对象</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t\t:</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> _data</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">())</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t{}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">private</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\tType _data</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //1.对象内部的数据，假设在全局独有这一份</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tstatic</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> HungryManModel</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Type</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> _inst</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //3.设置静态成员变量，使得在 main() 被调用前就构造好单例对象，注意这个静态成员的内部并没有自己包含自己，因为静态变量存储在静态区，而不在对象内部</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">template</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> &#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> Type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">HungryManModel</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Type</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> HungryManModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">Type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">_inst</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //虽然在类外定义，但是该静态变量是属于类的（静态成员），因此可以调用构造函数</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//HungryManModel&#x3C;int> a;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //7.无法直接在类外直接创建对象</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//HungryManModel&#x3C;int>* pa = new HungryManModel&#x3C;int>();</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //8.无法直接在类外直接创建对象</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\tHungryManModel</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x3C;int>*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> p </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> HungryManModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">GetInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //9.获取单例对象</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\t</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//10.调用单例对象的方法</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\tp</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">-></span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Add</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\tp</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">-></span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Print</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //输出 1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tHungryManModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">GetInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()-></span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Add</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tHungryManModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">GetInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()-></span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Print</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //输出 2</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//11.发现还有一个缺陷：没有禁用拷贝构造，上述类依旧是有问题的，下面代码的就暴露出拷贝问题</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//HungryManModel&#x3C;int> copy(*HungryManModel&#x3C;int>::GetInstance());</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //拷贝</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\t</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//HungryManModel&#x3C;int>::GetInstance()->Add();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//HungryManModel&#x3C;int>::GetInstance()->Print();</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //输出 3</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\t</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//copy.Print();</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //依旧输出 2</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//13.甚至还有一些奇奇怪怪的操作，自己给自己赋值...虽然也不会有什么问题啦，以防万一，我们也把赋值重载给禁掉</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//*HungryManModel&#x3C;int>::GetInstance() = *HungryManModel&#x3C;int>::GetInstance();</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//15.允许创建不同类型的单例对象，但是每一种类型的对象在代码中都只会存在一份</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tHungryManModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">double</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">GetInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()-></span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Add</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tHungryManModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">double</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">GetInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()-></span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Print</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tHungryManModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">long</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">GetInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()-></span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Add</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tHungryManModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">long</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">GetInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()-></span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Print</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">\treturn</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><ol>\n<li>\n<p>饿汉模式的优点：相比懒汉模式，实现起来要简单一些，容易理解</p>\n</li>\n<li>\n<p>饿汉模式的缺点：饿汉模式还是有挺多缺点的</p>\n<p>(1)静态单例对象如果较多，则可能导致进程启动变慢，<code v-pre>main()</code> 可能会间隔一段时间才会被调用</p>\n<p>(2)多个单例对象可能有先后次序问题，有可能某一个单例对象需要在另外一个单例对象启动后，才可以启动，这种情况下使用饿汉模式就难以把控先后次序问题了（因为全局静态对象初始化的先后次序程序员很难确定）</p>\n</li>\n</ol>\n<blockquote>\n<p>补充：构造方法</p>\n<ol>\n<li>构造私有</li>\n<li>拷贝私有（包含拷贝构造和赋值拷贝）</li>\n<li>定义静态单例</li>\n<li>类加载时使用静态方法进行构造再返回单例</li>\n</ol>\n</blockquote>\n<h3 id=\"_5-2-懒汉模式\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_5-2-懒汉模式\"><span>5.2.懒汉模式</span></a></h3>\n<div class=\"language-cpp line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"cpp\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">//单例模式——懒汉模式</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">#</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">iostream</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">using</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> namespace</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">//懒汉模式：第一次用的时候再创建（现吃现做）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">template</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> &#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> Type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> SlackerModel</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">public</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tstatic</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> SlackerModel</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> GetInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //5.获取实例对象，并且由于用户无法直接创建对象，这个函数也必须静态成员函数，方便用户调用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">\t\tif</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">_inst </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">==</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> nullptr</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t\t{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\t\t\t_inst </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> SlackerModel</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Type</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //6.若指针为空，则创建一个对象（并且保证只有在第一次调用的时候创建，其他的时候都是原封不动返回）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t\t\t//由于懒汉模式的单例对象是 new 出来的，而该对象的生命周期一般跟随进程，所以一般不需要我们自己释放（极少情况需要我们自己释放），而是交给进程，进程结束就会自动释放（这是操作系统和进程的事情，我们无需考虑）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">\t\treturn</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> _inst</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //8.返回单例对象指针</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//7.禁用拷贝构造和赋值重载</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tSlackerModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> SlackerModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">Type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> delete</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">\tSlackerModel</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> operator</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> =</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> SlackerModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">Type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> delete</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//10.这里再加上对单例对象的一些操作方法</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tvoid</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> Add</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> _data</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">++</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tvoid</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> Print</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> cout </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x3C;&#x3C;</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">数据:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;&#x3C;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> _data </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x3C;&#x3C;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> endl</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tstatic</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> void</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> DelInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //9.如果考虑多一点，我们就支持用户手动释放单例对象</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">\t\tif</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">_inst </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">!=</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> nullptr</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t\t{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\t\t\tdelete</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> _inst</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\t\t\t_inst </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> nullptr</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t\t}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">private</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tSlackerModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> :</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> _data</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">())</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {}</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //2.将构造函数私有化，禁止用户直接在类外构造对象</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\t~SlackerModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t\t//12.但是析构的同时，可能需要做一些持久化操作（比如：要求把数据写到文件），进程虽然正常结束会释放内存空间，但是不会自动进行写入数据（这里的数据是用户在代码中的数据，本代码体现为 _data）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t\t//而只有用户调用了析构函数，才能做自定义的持久化操作，否之数据就会丢失</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t\t//fopen(...) 之类的语句</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\t\tcout </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x3C;&#x3C;</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">写入数据中...</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;&#x3C;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> endl</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //这里只是用打印语句简单模拟一下写入数据的过程</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\t\tcout </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x3C;&#x3C;</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">数据写入成功!</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;&#x3C;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> endl</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t\t//11.由于这里是使用 new 申请资源，除非使用智能指针，否则必须用户自己调用 delete 才会调用析构函数，</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t\t//进而做持久化操作，但是我们最好避免用户自己调用 delete，因此我们可以构造一个内部类，</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t\t//让内部类创建出来的静态对象自动调用析构函数（创建的对象会被自动释放）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tclass</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> GC</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //14..内部类是外部类的友元类</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tpublic</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\t\t~GC</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t\t{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\t\t\tDelInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //13.如果用户没有自己调用 DelInstance()，则这里会同构析构函数自动调用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t\t}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">private</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\tType _data</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //1.对象内部的数据，假设在全局独有这一份</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tstatic</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> SlackerModel</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Type</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">>*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> _inst</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //3.设置静态成员指针变量，使得在 main() 被调用前就构造好单例对象指针（指针的创建较快，此时的指针指向的对象还没有被实际创建出来）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tstatic</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> GC _gc</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //16.内部类对象，其销毁会自动引发析构函数，进而进行持久化操作</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">template</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> &#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> Type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">SlackerModel</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Type</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">>*</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> SlackerModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">Type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">_inst </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> nullptr</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //4.类外定义静态成员变量 _inst</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">template</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> &#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> Type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">typename</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> SlackerModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">Type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">GC</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> SlackerModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">Type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">_gc</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //17.类外定义静态成员变量 _gc</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">template</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> SlackerModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">double</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //18.由于类模板的原因，导致 _gc 对象没有被实例化出来，因此只能让模板类提前实例化出一份类，否则无法调用 _gc 的析构函数</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tSlackerModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">double</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">GetInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()-></span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Add</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tSlackerModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">double</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">GetInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()-></span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Add</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tSlackerModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">double</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">GetInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()-></span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Add</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tSlackerModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">double</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">GetInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()-></span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Print</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//delete SlackerModel&#x3C;double>::GetInstance();</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //虽然可以这么设计，但是我们不推荐，我们希望在 main() 结束后自动调用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\t</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tSlackerModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">double</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">GetInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()-></span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">DelInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //19.用户可以自己提前调用，析构单例对象</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\t</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//假设这下面还有某些代码...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\t</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">\treturn</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">//20.也可以不使用这句在 main() 调用结束自动调用 _gc 的析构函数</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">//21.当然，如果不需要做持久化操作，那么有关 GC 的代码就可以去除...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">//22.懒汉模式也提示我们：</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">//(1) 如果有些动作想要在 main() 前做，可以使用 static 的成员变量</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">//(2) 如果有些动作想要在 main() 后做，可以尝试使用类似智能指针或内部类析构</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><blockquote>\n<p>注意：我们上面的模式在单线程下是没什么问题的，但是在多线程的情况下依旧有问题（例如懒汉模式中，如果不会 <code v-pre>new</code> 语句加锁，就有可能出现同时申请内存控件的情况，也就会出现内存泄漏！），待补充...</p>\n</blockquote>\n<figure><img src=\"@source/1.编程语言/2.Cpp/assets/image-20240828212942426.png\" alt=\"image-20240828212942426\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20240828212942426</figcaption></figure>\n<p>上面这种情况需要多思考一下。</p>\n","env":{"base":"/","filePath":"/home/ljp/git/work/work-blog-website/work-blog-website-frontend/docs/1.编程语言/2.Cpp/030_2023_11_19_ljp_特殊类设计.md","filePathRelative":"1.编程语言/2.Cpp/030_2023_11_19_ljp_特殊类设计.md","frontmatter":{"createTime":"2025/06/21 15:33:58","permalink":"/1.编程语言/u27qbnuz/","title":"特殊类设计"},"sfcBlocks":{"template":{"type":"template","content":"<template><h2 id=\"_1-设计不能被拷贝的类\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-设计不能被拷贝的类\"><span>1.设计不能被拷贝的类</span></a></h2>\n<blockquote>\n<p>解析：拷贝只会放生在两个场景中</p>\n<ol>\n<li>拷贝构造函数</li>\n<li>赋值运算符重载</li>\n</ol>\n<p>因此想要让一个类禁止拷贝，就需让该类不能调用“拷贝构造函数”以及“赋值运算符重载”，而 <code v-pre>C++11</code> 提供的 <code v-pre>delete</code> 重载关键字可以让这件事情变得更加简单。</p>\n</blockquote>\n<h3 id=\"_1-1-c-98-做法\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-1-c-98-做法\"><span>1.1.C++98 做法</span></a></h3>\n<div class=\"language-cpp line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"cpp\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> CopyBan</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">public</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tCopyBan</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t\t:</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> _c</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t{}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">private</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//拷贝构造私有化</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tCopyBan</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> CopyBan</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//赋值重载私有化</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">\tCopyBan</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> operator</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">=</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> CopyBan</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">private</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tint</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> _c</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\tCopyBan c</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//CopyBan copy(c);//禁用了</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">\treturn</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3 id=\"_1-2-c-11-做法\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-c-11-做法\"><span>1.2.C++11 做法</span></a></h3>\n<div class=\"language-cpp line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"cpp\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> CopyBan</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">public</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tCopyBan</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t\t:</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> _c</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t{}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//拷贝构造私有化</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tCopyBan</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> CopyBan</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> delete</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//赋值重载私有化</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">\tCopyBan</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> operator</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">=</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> CopyBan</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> delete</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">private</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tint</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> _c</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\tCopyBan c</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//CopyBan copy(c);//禁用了</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">\treturn</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2 id=\"_2-设计在堆上创建的类\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-设计在堆上创建的类\"><span>2.设计在堆上创建的类</span></a></h2>\n<h3 id=\"_2-1-析构私有\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-1-析构私有\"><span>2.1.析构私有</span></a></h3>\n<blockquote>\n<p>解析：一个在栈上的对象如果没有办法调用析构，就没有办法被创建，因为编译器认为没有析构，禁止直接创建对象，这种情况就只能使用 <code v-pre>new</code> 创建对象，并且提供一个用于释放的接口。</p>\n</blockquote>\n<div class=\"language-cpp line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"cpp\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> HeapOnly</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">public</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    static</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> void</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> Destroy_1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">HeapOnly</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> ptr</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">    {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">        delete</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> ptr</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">    }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    //or</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    void</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> Destroy_2</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">    {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">        delete</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> this</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">    }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">private</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ~HeapOnly</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    //HeapOnly h1;//禁用</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    HeapOnly</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> ph1 </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> HeapOnly</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    HeapOnly</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">::</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Destroy_1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">ph1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    HeapOnly</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> ph2 </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> HeapOnly</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">    ph2</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">-></span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Destroy_2</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    //HeapOnly h2(*ph1);//禁用</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3 id=\"_2-2-构造私有\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-2-构造私有\"><span>2.2.构造私有</span></a></h3>\n<blockquote>\n<p>解析：如果一个类的构造被私有了，那么就无法直接调用，包括 <code v-pre>new</code> 也无法调用，然后我们提供给用户一个接口，在类的内部 <code v-pre>new</code> 返回类指针给用户，交给用户释放即可。</p>\n<p>就是需要注意，还需要将拷贝构造私有化，避免用户使用接口后，解引用进行拷贝。</p>\n</blockquote>\n<div class=\"language-cpp line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"cpp\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> HeapOnly</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">public</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    static</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> HeapOnly</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> CreateObject</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">//这里必须是 static 静态成员函数</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">    {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> HeapOnly</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">    }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">private</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    HeapOnly</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    HeapOnly</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> HeapOnly</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    //HeapOnly h1;//禁用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    HeapOnly</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> ph </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> HeapOnly</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">::</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">CreateObject</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">//如果不是静态就需要创建对象来调用 CreateObject()，但我们已经没有办法产生对象了</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    //HeapOnly h2(*ph);//禁用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2 id=\"_3-设计在栈上创建的类\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-设计在栈上创建的类\"><span>3.设计在栈上创建的类</span></a></h2>\n<blockquote>\n<p>解析：需要删除 <code v-pre>operator new()</code> 才能彻底解决问题，注意不能私有构造函数！</p>\n</blockquote>\n<div class=\"language-cpp line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"cpp\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> StackOnly</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">public</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tstatic</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> StackOnly</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> CreateObj</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">\t\treturn</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> StackOnly</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//禁掉 operator new() 可以把用 new 调用拷贝构造申请对象给禁掉</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tvoid*</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> operator</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> new</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">size_t</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> size</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> delete</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tvoid</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> operator</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> delete</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">void*</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> p</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> delete</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">private</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tStackOnly</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">//实际上删除了 operator new() 就无需将构造函数私有化了，上述的 CreateObj() 也可以一起不要了</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t\t:</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> _a</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t{}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//不可私有拷贝构造</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//StackOnly(StackOnly&#x26; s)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//\t: _a(0)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//{}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">private</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tint</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> _a</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\tStackOnly obj </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> StackOnly</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">::</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">CreateObj</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//StackOnly* ptr1 = new StackOnly();//禁用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//StackOnly* ptr2 = new StackOnly(obj);//禁用，这个不能私有拷贝构造，只能删除 new 的底层调用 operator new，否则就无法返回 CreateObj() 的结果</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//delete&#x26; obj;//禁用</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">\treturn</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2 id=\"_4-设计无法被继承的类\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_4-设计无法被继承的类\"><span>4.设计无法被继承的类</span></a></h2>\n<h3 id=\"_4-1-c-98-做法\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_4-1-c-98-做法\"><span>4.1.C++98 做法</span></a></h3>\n<p>父类的构造函数被私有化就不会被子类继承。</p>\n<h3 id=\"_4-2-c-11-做法\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_4-2-c-11-做法\"><span>4.2.C++11 做法</span></a></h3>\n<p>使用关键字 <code v-pre>final</code>，表示该类不可被继承。</p>\n<h2 id=\"_5-设计创建单对象的类\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_5-设计创建单对象的类\"><span>5.设计创建单对象的类</span></a></h2>\n<p>实际上就是所谓的“单例模式”，该类只能被创建出一个对象，单例模式实际是一种设计模式。</p>\n<blockquote>\n<p>补充：常见的设计模式有 <code v-pre>23</code> 种，其实就是被反复使用、多数人知晓、经过分类、代码设计经验的总结，是编程界探索出来的一种编程“兵法”，其积极的一面是可以避免人们走入一些“坑”，当然设计模式只是一种实践经验，并不是所有的设计模式都适用于每个场景，使用哪种设计模式需要考虑到具体的需求和系统架构。</p>\n<ol>\n<li><code v-pre>Singleton</code>（单例模式）</li>\n<li><code v-pre>Factory Method</code>（工厂方法模式）</li>\n<li><code v-pre>Abstract Factory</code>（抽象工厂模式）</li>\n<li><code v-pre>Builder</code>（建造者模式）</li>\n<li><code v-pre>Prototype</code>（原型模式）</li>\n<li><code v-pre>Adapter</code>（适配器模式）</li>\n<li><code v-pre>Bridge</code>（桥接模式）</li>\n<li><code v-pre>Composite</code>（组合模式）</li>\n<li><code v-pre>Decorator</code>（装饰器模式）</li>\n<li><code v-pre>Facade</code>（外观模式）</li>\n<li><code v-pre>Flyweight</code>（享元模式）</li>\n<li><code v-pre>Proxy</code>（代理模式）</li>\n<li><code v-pre>Chain of Responsibility</code>（责任链模式）</li>\n<li><code v-pre>Command</code>（命令模式）</li>\n<li><code v-pre>Interpreter</code>（解释器模式）</li>\n<li><code v-pre>Iterator</code>（迭代器模式）</li>\n<li><code v-pre>Mediator</code>（中介者模式）</li>\n<li><code v-pre>Memento</code>（备忘录模式）</li>\n<li><code v-pre>Observer</code>（观察者模式）</li>\n<li><code v-pre>State</code>（状态模式）</li>\n<li><code v-pre>Strategy</code>（策略模式）</li>\n<li><code v-pre>Template Method</code>（模板方法模式）</li>\n<li><code v-pre>Visitor</code>（访问者模式）</li>\n</ol>\n<p>不过一般谈设计模式都是在接近上层的设计才会得到更多的关注，过于底层的设计一般比较少提及。</p>\n</blockquote>\n<p>“单例”的解释就是“单份实例化”，数据类型可以是任意的，但是全局只能有一个实例化，最典型的就是内存池，内存池最好只有一份，否则容易出现问题（尤其是项目变大时，往往绕不开单例模式）。</p>\n<h3 id=\"_5-1-饿汉模式\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_5-1-饿汉模式\"><span>5.1.饿汉模式</span></a></h3>\n<div class=\"language-cpp line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"cpp\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">//单例模式——饿汉模式</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">#</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">iostream</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">using</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> namespace</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">//饿汉模式：把对象提前创建好（最好是在 程序/main 启动时），并且随时需要（不要使用全局变量来实现，一是无法直接创建，二是容易重定义，应该使用静态变量）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">template</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> &#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> Type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> HungryManModel</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">public</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tstatic</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> HungryManModel</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> GetInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //4.获取实例对象，并且由于用户无法直接创建对象，这个函数也必须静态成员函数，方便用户调用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">\t\treturn</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x26;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">_inst</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //5.返回单例对象</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tHungryManModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> HungryManModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">Type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> delete</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //12.禁用拷贝构造</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">\tHungryManModel</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> operator</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">=</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> HungryManModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">Type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> delete</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //14.禁用赋值重载（一般禁用拷贝构造也会禁用赋值重载）</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//6.这里再加上对单例对象的一些操作方法</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tvoid</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> Add</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\t\t_data</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">++</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tvoid</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> Print</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\t\tcout </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x3C;&#x3C;</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">数据:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;&#x3C;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> _data </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x3C;&#x3C;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> endl</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">private</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tHungryManModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //2.将构造函数私有化，禁止用户直接在类外构造对象</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t\t:</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> _data</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">())</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t{}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">private</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\tType _data</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //1.对象内部的数据，假设在全局独有这一份</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tstatic</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> HungryManModel</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Type</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> _inst</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //3.设置静态成员变量，使得在 main() 被调用前就构造好单例对象，注意这个静态成员的内部并没有自己包含自己，因为静态变量存储在静态区，而不在对象内部</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">template</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> &#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> Type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">HungryManModel</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Type</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> HungryManModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">Type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">_inst</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //虽然在类外定义，但是该静态变量是属于类的（静态成员），因此可以调用构造函数</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//HungryManModel&#x3C;int> a;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //7.无法直接在类外直接创建对象</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//HungryManModel&#x3C;int>* pa = new HungryManModel&#x3C;int>();</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //8.无法直接在类外直接创建对象</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\tHungryManModel</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x3C;int>*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> p </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> HungryManModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">GetInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //9.获取单例对象</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\t</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//10.调用单例对象的方法</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\tp</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">-></span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Add</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\tp</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">-></span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Print</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //输出 1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tHungryManModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">GetInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()-></span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Add</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tHungryManModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">GetInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()-></span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Print</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //输出 2</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//11.发现还有一个缺陷：没有禁用拷贝构造，上述类依旧是有问题的，下面代码的就暴露出拷贝问题</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//HungryManModel&#x3C;int> copy(*HungryManModel&#x3C;int>::GetInstance());</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //拷贝</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\t</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//HungryManModel&#x3C;int>::GetInstance()->Add();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//HungryManModel&#x3C;int>::GetInstance()->Print();</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //输出 3</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\t</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//copy.Print();</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //依旧输出 2</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//13.甚至还有一些奇奇怪怪的操作，自己给自己赋值...虽然也不会有什么问题啦，以防万一，我们也把赋值重载给禁掉</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//*HungryManModel&#x3C;int>::GetInstance() = *HungryManModel&#x3C;int>::GetInstance();</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//15.允许创建不同类型的单例对象，但是每一种类型的对象在代码中都只会存在一份</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tHungryManModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">double</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">GetInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()-></span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Add</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tHungryManModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">double</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">GetInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()-></span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Print</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tHungryManModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">long</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">GetInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()-></span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Add</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tHungryManModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">long</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">GetInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()-></span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Print</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">\treturn</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><ol>\n<li>\n<p>饿汉模式的优点：相比懒汉模式，实现起来要简单一些，容易理解</p>\n</li>\n<li>\n<p>饿汉模式的缺点：饿汉模式还是有挺多缺点的</p>\n<p>(1)静态单例对象如果较多，则可能导致进程启动变慢，<code v-pre>main()</code> 可能会间隔一段时间才会被调用</p>\n<p>(2)多个单例对象可能有先后次序问题，有可能某一个单例对象需要在另外一个单例对象启动后，才可以启动，这种情况下使用饿汉模式就难以把控先后次序问题了（因为全局静态对象初始化的先后次序程序员很难确定）</p>\n</li>\n</ol>\n<blockquote>\n<p>补充：构造方法</p>\n<ol>\n<li>构造私有</li>\n<li>拷贝私有（包含拷贝构造和赋值拷贝）</li>\n<li>定义静态单例</li>\n<li>类加载时使用静态方法进行构造再返回单例</li>\n</ol>\n</blockquote>\n<h3 id=\"_5-2-懒汉模式\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_5-2-懒汉模式\"><span>5.2.懒汉模式</span></a></h3>\n<div class=\"language-cpp line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"cpp\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">//单例模式——懒汉模式</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">#</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">iostream</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">using</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> namespace</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">//懒汉模式：第一次用的时候再创建（现吃现做）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">template</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> &#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> Type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> SlackerModel</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">public</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tstatic</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> SlackerModel</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> GetInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //5.获取实例对象，并且由于用户无法直接创建对象，这个函数也必须静态成员函数，方便用户调用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">\t\tif</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">_inst </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">==</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> nullptr</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t\t{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\t\t\t_inst </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> SlackerModel</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Type</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //6.若指针为空，则创建一个对象（并且保证只有在第一次调用的时候创建，其他的时候都是原封不动返回）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t\t\t//由于懒汉模式的单例对象是 new 出来的，而该对象的生命周期一般跟随进程，所以一般不需要我们自己释放（极少情况需要我们自己释放），而是交给进程，进程结束就会自动释放（这是操作系统和进程的事情，我们无需考虑）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">\t\treturn</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> _inst</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //8.返回单例对象指针</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//7.禁用拷贝构造和赋值重载</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tSlackerModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> SlackerModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">Type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> delete</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">\tSlackerModel</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> operator</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> =</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> SlackerModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">Type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> delete</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//10.这里再加上对单例对象的一些操作方法</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tvoid</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> Add</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> _data</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">++</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tvoid</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> Print</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> cout </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x3C;&#x3C;</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">数据:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;&#x3C;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> _data </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x3C;&#x3C;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> endl</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tstatic</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> void</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> DelInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //9.如果考虑多一点，我们就支持用户手动释放单例对象</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">\t\tif</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">_inst </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">!=</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> nullptr</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t\t{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\t\t\tdelete</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> _inst</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\t\t\t_inst </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> nullptr</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t\t}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">private</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tSlackerModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> :</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> _data</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">())</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {}</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //2.将构造函数私有化，禁止用户直接在类外构造对象</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\t~SlackerModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t\t//12.但是析构的同时，可能需要做一些持久化操作（比如：要求把数据写到文件），进程虽然正常结束会释放内存空间，但是不会自动进行写入数据（这里的数据是用户在代码中的数据，本代码体现为 _data）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t\t//而只有用户调用了析构函数，才能做自定义的持久化操作，否之数据就会丢失</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t\t//fopen(...) 之类的语句</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\t\tcout </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x3C;&#x3C;</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">写入数据中...</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;&#x3C;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> endl</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //这里只是用打印语句简单模拟一下写入数据的过程</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\t\tcout </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x3C;&#x3C;</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">数据写入成功!</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;&#x3C;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> endl</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t\t//11.由于这里是使用 new 申请资源，除非使用智能指针，否则必须用户自己调用 delete 才会调用析构函数，</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t\t//进而做持久化操作，但是我们最好避免用户自己调用 delete，因此我们可以构造一个内部类，</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t\t//让内部类创建出来的静态对象自动调用析构函数（创建的对象会被自动释放）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tclass</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> GC</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //14..内部类是外部类的友元类</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tpublic</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\t\t~GC</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t\t{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\t\t\tDelInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //13.如果用户没有自己调用 DelInstance()，则这里会同构析构函数自动调用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t\t}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">private</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\tType _data</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //1.对象内部的数据，假设在全局独有这一份</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tstatic</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> SlackerModel</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Type</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">>*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> _inst</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //3.设置静态成员指针变量，使得在 main() 被调用前就构造好单例对象指针（指针的创建较快，此时的指针指向的对象还没有被实际创建出来）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tstatic</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> GC _gc</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //16.内部类对象，其销毁会自动引发析构函数，进而进行持久化操作</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">template</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> &#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> Type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">SlackerModel</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Type</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">>*</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> SlackerModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">Type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">_inst </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> nullptr</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //4.类外定义静态成员变量 _inst</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">template</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> &#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> Type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">typename</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> SlackerModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">Type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">GC</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> SlackerModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">Type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">_gc</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //17.类外定义静态成员变量 _gc</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">template</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> SlackerModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">double</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //18.由于类模板的原因，导致 _gc 对象没有被实例化出来，因此只能让模板类提前实例化出一份类，否则无法调用 _gc 的析构函数</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tSlackerModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">double</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">GetInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()-></span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Add</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tSlackerModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">double</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">GetInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()-></span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Add</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tSlackerModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">double</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">GetInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()-></span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Add</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tSlackerModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">double</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">GetInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()-></span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Print</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//delete SlackerModel&#x3C;double>::GetInstance();</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //虽然可以这么设计，但是我们不推荐，我们希望在 main() 结束后自动调用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\t</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tSlackerModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">double</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">GetInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()-></span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">DelInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //19.用户可以自己提前调用，析构单例对象</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\t</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//假设这下面还有某些代码...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\t</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">\treturn</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">//20.也可以不使用这句在 main() 调用结束自动调用 _gc 的析构函数</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">//21.当然，如果不需要做持久化操作，那么有关 GC 的代码就可以去除...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">//22.懒汉模式也提示我们：</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">//(1) 如果有些动作想要在 main() 前做，可以使用 static 的成员变量</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">//(2) 如果有些动作想要在 main() 后做，可以尝试使用类似智能指针或内部类析构</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><blockquote>\n<p>注意：我们上面的模式在单线程下是没什么问题的，但是在多线程的情况下依旧有问题（例如懒汉模式中，如果不会 <code v-pre>new</code> 语句加锁，就有可能出现同时申请内存控件的情况，也就会出现内存泄漏！），待补充...</p>\n</blockquote>\n<figure><img src=\"@source/1.编程语言/2.Cpp/assets/image-20240828212942426.png\" alt=\"image-20240828212942426\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20240828212942426</figcaption></figure>\n<p>上面这种情况需要多思考一下。</p>\n</template>","contentStripped":"<h2 id=\"_1-设计不能被拷贝的类\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-设计不能被拷贝的类\"><span>1.设计不能被拷贝的类</span></a></h2>\n<blockquote>\n<p>解析：拷贝只会放生在两个场景中</p>\n<ol>\n<li>拷贝构造函数</li>\n<li>赋值运算符重载</li>\n</ol>\n<p>因此想要让一个类禁止拷贝，就需让该类不能调用“拷贝构造函数”以及“赋值运算符重载”，而 <code v-pre>C++11</code> 提供的 <code v-pre>delete</code> 重载关键字可以让这件事情变得更加简单。</p>\n</blockquote>\n<h3 id=\"_1-1-c-98-做法\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-1-c-98-做法\"><span>1.1.C++98 做法</span></a></h3>\n<div class=\"language-cpp line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"cpp\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> CopyBan</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">public</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tCopyBan</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t\t:</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> _c</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t{}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">private</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//拷贝构造私有化</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tCopyBan</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> CopyBan</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//赋值重载私有化</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">\tCopyBan</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> operator</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">=</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> CopyBan</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">private</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tint</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> _c</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\tCopyBan c</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//CopyBan copy(c);//禁用了</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">\treturn</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3 id=\"_1-2-c-11-做法\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-c-11-做法\"><span>1.2.C++11 做法</span></a></h3>\n<div class=\"language-cpp line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"cpp\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> CopyBan</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">public</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tCopyBan</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t\t:</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> _c</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t{}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//拷贝构造私有化</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tCopyBan</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> CopyBan</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> delete</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//赋值重载私有化</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">\tCopyBan</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> operator</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">=</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> CopyBan</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> delete</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">private</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tint</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> _c</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\tCopyBan c</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//CopyBan copy(c);//禁用了</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">\treturn</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2 id=\"_2-设计在堆上创建的类\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-设计在堆上创建的类\"><span>2.设计在堆上创建的类</span></a></h2>\n<h3 id=\"_2-1-析构私有\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-1-析构私有\"><span>2.1.析构私有</span></a></h3>\n<blockquote>\n<p>解析：一个在栈上的对象如果没有办法调用析构，就没有办法被创建，因为编译器认为没有析构，禁止直接创建对象，这种情况就只能使用 <code v-pre>new</code> 创建对象，并且提供一个用于释放的接口。</p>\n</blockquote>\n<div class=\"language-cpp line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"cpp\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> HeapOnly</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">public</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    static</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> void</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> Destroy_1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">HeapOnly</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> ptr</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">    {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">        delete</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> ptr</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">    }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    //or</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    void</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> Destroy_2</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">    {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">        delete</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> this</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">    }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">private</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ~HeapOnly</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    //HeapOnly h1;//禁用</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    HeapOnly</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> ph1 </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> HeapOnly</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    HeapOnly</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">::</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Destroy_1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">ph1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    HeapOnly</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> ph2 </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> HeapOnly</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">    ph2</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">-></span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Destroy_2</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    //HeapOnly h2(*ph1);//禁用</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3 id=\"_2-2-构造私有\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-2-构造私有\"><span>2.2.构造私有</span></a></h3>\n<blockquote>\n<p>解析：如果一个类的构造被私有了，那么就无法直接调用，包括 <code v-pre>new</code> 也无法调用，然后我们提供给用户一个接口，在类的内部 <code v-pre>new</code> 返回类指针给用户，交给用户释放即可。</p>\n<p>就是需要注意，还需要将拷贝构造私有化，避免用户使用接口后，解引用进行拷贝。</p>\n</blockquote>\n<div class=\"language-cpp line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"cpp\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> HeapOnly</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">public</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    static</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> HeapOnly</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> CreateObject</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">//这里必须是 static 静态成员函数</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">    {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> HeapOnly</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">    }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">private</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    HeapOnly</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    HeapOnly</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> HeapOnly</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    //HeapOnly h1;//禁用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    HeapOnly</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> ph </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> HeapOnly</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">::</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">CreateObject</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">//如果不是静态就需要创建对象来调用 CreateObject()，但我们已经没有办法产生对象了</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    //HeapOnly h2(*ph);//禁用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2 id=\"_3-设计在栈上创建的类\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-设计在栈上创建的类\"><span>3.设计在栈上创建的类</span></a></h2>\n<blockquote>\n<p>解析：需要删除 <code v-pre>operator new()</code> 才能彻底解决问题，注意不能私有构造函数！</p>\n</blockquote>\n<div class=\"language-cpp line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"cpp\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> StackOnly</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">public</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tstatic</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> StackOnly</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> CreateObj</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">\t\treturn</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> StackOnly</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//禁掉 operator new() 可以把用 new 调用拷贝构造申请对象给禁掉</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tvoid*</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> operator</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> new</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">size_t</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> size</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> delete</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tvoid</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> operator</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> delete</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">void*</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> p</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> delete</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">private</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tStackOnly</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">//实际上删除了 operator new() 就无需将构造函数私有化了，上述的 CreateObj() 也可以一起不要了</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t\t:</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> _a</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t{}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//不可私有拷贝构造</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//StackOnly(StackOnly&#x26; s)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//\t: _a(0)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//{}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">private</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tint</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> _a</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\tStackOnly obj </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> StackOnly</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">::</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">CreateObj</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//StackOnly* ptr1 = new StackOnly();//禁用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//StackOnly* ptr2 = new StackOnly(obj);//禁用，这个不能私有拷贝构造，只能删除 new 的底层调用 operator new，否则就无法返回 CreateObj() 的结果</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//delete&#x26; obj;//禁用</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">\treturn</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2 id=\"_4-设计无法被继承的类\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_4-设计无法被继承的类\"><span>4.设计无法被继承的类</span></a></h2>\n<h3 id=\"_4-1-c-98-做法\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_4-1-c-98-做法\"><span>4.1.C++98 做法</span></a></h3>\n<p>父类的构造函数被私有化就不会被子类继承。</p>\n<h3 id=\"_4-2-c-11-做法\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_4-2-c-11-做法\"><span>4.2.C++11 做法</span></a></h3>\n<p>使用关键字 <code v-pre>final</code>，表示该类不可被继承。</p>\n<h2 id=\"_5-设计创建单对象的类\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_5-设计创建单对象的类\"><span>5.设计创建单对象的类</span></a></h2>\n<p>实际上就是所谓的“单例模式”，该类只能被创建出一个对象，单例模式实际是一种设计模式。</p>\n<blockquote>\n<p>补充：常见的设计模式有 <code v-pre>23</code> 种，其实就是被反复使用、多数人知晓、经过分类、代码设计经验的总结，是编程界探索出来的一种编程“兵法”，其积极的一面是可以避免人们走入一些“坑”，当然设计模式只是一种实践经验，并不是所有的设计模式都适用于每个场景，使用哪种设计模式需要考虑到具体的需求和系统架构。</p>\n<ol>\n<li><code v-pre>Singleton</code>（单例模式）</li>\n<li><code v-pre>Factory Method</code>（工厂方法模式）</li>\n<li><code v-pre>Abstract Factory</code>（抽象工厂模式）</li>\n<li><code v-pre>Builder</code>（建造者模式）</li>\n<li><code v-pre>Prototype</code>（原型模式）</li>\n<li><code v-pre>Adapter</code>（适配器模式）</li>\n<li><code v-pre>Bridge</code>（桥接模式）</li>\n<li><code v-pre>Composite</code>（组合模式）</li>\n<li><code v-pre>Decorator</code>（装饰器模式）</li>\n<li><code v-pre>Facade</code>（外观模式）</li>\n<li><code v-pre>Flyweight</code>（享元模式）</li>\n<li><code v-pre>Proxy</code>（代理模式）</li>\n<li><code v-pre>Chain of Responsibility</code>（责任链模式）</li>\n<li><code v-pre>Command</code>（命令模式）</li>\n<li><code v-pre>Interpreter</code>（解释器模式）</li>\n<li><code v-pre>Iterator</code>（迭代器模式）</li>\n<li><code v-pre>Mediator</code>（中介者模式）</li>\n<li><code v-pre>Memento</code>（备忘录模式）</li>\n<li><code v-pre>Observer</code>（观察者模式）</li>\n<li><code v-pre>State</code>（状态模式）</li>\n<li><code v-pre>Strategy</code>（策略模式）</li>\n<li><code v-pre>Template Method</code>（模板方法模式）</li>\n<li><code v-pre>Visitor</code>（访问者模式）</li>\n</ol>\n<p>不过一般谈设计模式都是在接近上层的设计才会得到更多的关注，过于底层的设计一般比较少提及。</p>\n</blockquote>\n<p>“单例”的解释就是“单份实例化”，数据类型可以是任意的，但是全局只能有一个实例化，最典型的就是内存池，内存池最好只有一份，否则容易出现问题（尤其是项目变大时，往往绕不开单例模式）。</p>\n<h3 id=\"_5-1-饿汉模式\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_5-1-饿汉模式\"><span>5.1.饿汉模式</span></a></h3>\n<div class=\"language-cpp line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"cpp\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">//单例模式——饿汉模式</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">#</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">iostream</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">using</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> namespace</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">//饿汉模式：把对象提前创建好（最好是在 程序/main 启动时），并且随时需要（不要使用全局变量来实现，一是无法直接创建，二是容易重定义，应该使用静态变量）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">template</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> &#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> Type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> HungryManModel</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">public</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tstatic</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> HungryManModel</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> GetInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //4.获取实例对象，并且由于用户无法直接创建对象，这个函数也必须静态成员函数，方便用户调用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">\t\treturn</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x26;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">_inst</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //5.返回单例对象</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tHungryManModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> HungryManModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">Type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> delete</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //12.禁用拷贝构造</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">\tHungryManModel</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> operator</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">=</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> HungryManModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">Type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> delete</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //14.禁用赋值重载（一般禁用拷贝构造也会禁用赋值重载）</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//6.这里再加上对单例对象的一些操作方法</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tvoid</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> Add</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\t\t_data</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">++</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tvoid</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> Print</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\t\tcout </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x3C;&#x3C;</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">数据:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;&#x3C;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> _data </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x3C;&#x3C;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> endl</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">private</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tHungryManModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //2.将构造函数私有化，禁止用户直接在类外构造对象</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t\t:</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> _data</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">())</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t{}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">private</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\tType _data</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //1.对象内部的数据，假设在全局独有这一份</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tstatic</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> HungryManModel</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Type</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> _inst</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //3.设置静态成员变量，使得在 main() 被调用前就构造好单例对象，注意这个静态成员的内部并没有自己包含自己，因为静态变量存储在静态区，而不在对象内部</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">template</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> &#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> Type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">HungryManModel</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Type</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> HungryManModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">Type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">_inst</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //虽然在类外定义，但是该静态变量是属于类的（静态成员），因此可以调用构造函数</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//HungryManModel&#x3C;int> a;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //7.无法直接在类外直接创建对象</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//HungryManModel&#x3C;int>* pa = new HungryManModel&#x3C;int>();</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //8.无法直接在类外直接创建对象</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\tHungryManModel</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x3C;int>*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> p </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> HungryManModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">GetInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //9.获取单例对象</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\t</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//10.调用单例对象的方法</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\tp</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">-></span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Add</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">\tp</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">-></span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Print</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //输出 1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tHungryManModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">GetInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()-></span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Add</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tHungryManModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">GetInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()-></span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Print</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //输出 2</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//11.发现还有一个缺陷：没有禁用拷贝构造，上述类依旧是有问题的，下面代码的就暴露出拷贝问题</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//HungryManModel&#x3C;int> copy(*HungryManModel&#x3C;int>::GetInstance());</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //拷贝</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\t</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//HungryManModel&#x3C;int>::GetInstance()->Add();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//HungryManModel&#x3C;int>::GetInstance()->Print();</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //输出 3</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\t</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//copy.Print();</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //依旧输出 2</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//13.甚至还有一些奇奇怪怪的操作，自己给自己赋值...虽然也不会有什么问题啦，以防万一，我们也把赋值重载给禁掉</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//*HungryManModel&#x3C;int>::GetInstance() = *HungryManModel&#x3C;int>::GetInstance();</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//15.允许创建不同类型的单例对象，但是每一种类型的对象在代码中都只会存在一份</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tHungryManModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">double</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">GetInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()-></span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Add</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tHungryManModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">double</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">GetInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()-></span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Print</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tHungryManModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">long</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">GetInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()-></span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Add</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tHungryManModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">long</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">GetInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()-></span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Print</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">\treturn</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><ol>\n<li>\n<p>饿汉模式的优点：相比懒汉模式，实现起来要简单一些，容易理解</p>\n</li>\n<li>\n<p>饿汉模式的缺点：饿汉模式还是有挺多缺点的</p>\n<p>(1)静态单例对象如果较多，则可能导致进程启动变慢，<code v-pre>main()</code> 可能会间隔一段时间才会被调用</p>\n<p>(2)多个单例对象可能有先后次序问题，有可能某一个单例对象需要在另外一个单例对象启动后，才可以启动，这种情况下使用饿汉模式就难以把控先后次序问题了（因为全局静态对象初始化的先后次序程序员很难确定）</p>\n</li>\n</ol>\n<blockquote>\n<p>补充：构造方法</p>\n<ol>\n<li>构造私有</li>\n<li>拷贝私有（包含拷贝构造和赋值拷贝）</li>\n<li>定义静态单例</li>\n<li>类加载时使用静态方法进行构造再返回单例</li>\n</ol>\n</blockquote>\n<h3 id=\"_5-2-懒汉模式\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_5-2-懒汉模式\"><span>5.2.懒汉模式</span></a></h3>\n<div class=\"language-cpp line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"cpp\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">//单例模式——懒汉模式</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">#</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">iostream</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">using</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> namespace</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> std</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">//懒汉模式：第一次用的时候再创建（现吃现做）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">template</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> &#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> Type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> SlackerModel</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">public</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tstatic</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> SlackerModel</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> GetInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //5.获取实例对象，并且由于用户无法直接创建对象，这个函数也必须静态成员函数，方便用户调用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">\t\tif</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">_inst </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">==</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> nullptr</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t\t{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\t\t\t_inst </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> SlackerModel</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Type</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //6.若指针为空，则创建一个对象（并且保证只有在第一次调用的时候创建，其他的时候都是原封不动返回）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t\t\t//由于懒汉模式的单例对象是 new 出来的，而该对象的生命周期一般跟随进程，所以一般不需要我们自己释放（极少情况需要我们自己释放），而是交给进程，进程结束就会自动释放（这是操作系统和进程的事情，我们无需考虑）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">\t\treturn</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> _inst</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //8.返回单例对象指针</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//7.禁用拷贝构造和赋值重载</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tSlackerModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> SlackerModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">Type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> delete</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">\tSlackerModel</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> operator</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> =</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> SlackerModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">Type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x26;</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> self</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> delete</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//10.这里再加上对单例对象的一些操作方法</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tvoid</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> Add</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> _data</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">++</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tvoid</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> Print</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> cout </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x3C;&#x3C;</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">数据:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;&#x3C;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> _data </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x3C;&#x3C;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> endl</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> }</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tstatic</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> void</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> DelInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //9.如果考虑多一点，我们就支持用户手动释放单例对象</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">\t\tif</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> (</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">_inst </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">!=</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> nullptr</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t\t{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\t\t\tdelete</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> _inst</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\t\t\t_inst </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> nullptr</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t\t}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">private</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tSlackerModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> :</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> _data</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">())</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {}</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //2.将构造函数私有化，禁止用户直接在类外构造对象</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\t~SlackerModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t\t//12.但是析构的同时，可能需要做一些持久化操作（比如：要求把数据写到文件），进程虽然正常结束会释放内存空间，但是不会自动进行写入数据（这里的数据是用户在代码中的数据，本代码体现为 _data）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t\t//而只有用户调用了析构函数，才能做自定义的持久化操作，否之数据就会丢失</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t\t//fopen(...) 之类的语句</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\t\tcout </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x3C;&#x3C;</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">写入数据中...</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;&#x3C;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> endl</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //这里只是用打印语句简单模拟一下写入数据的过程</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\t\tcout </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x3C;&#x3C;</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">数据写入成功!</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;&#x3C;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> endl</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t\t//11.由于这里是使用 new 申请资源，除非使用智能指针，否则必须用户自己调用 delete 才会调用析构函数，</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t\t//进而做持久化操作，但是我们最好避免用户自己调用 delete，因此我们可以构造一个内部类，</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t\t//让内部类创建出来的静态对象自动调用析构函数（创建的对象会被自动释放）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tclass</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> GC</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //14..内部类是外部类的友元类</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tpublic</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\t\t~GC</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t\t{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\t\t\tDelInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //13.如果用户没有自己调用 DelInstance()，则这里会同构析构函数自动调用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t\t}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">\t};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">private</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\tType _data</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //1.对象内部的数据，假设在全局独有这一份</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tstatic</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> SlackerModel</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Type</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">>*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> _inst</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //3.设置静态成员指针变量，使得在 main() 被调用前就构造好单例对象指针（指针的创建较快，此时的指针指向的对象还没有被实际创建出来）</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">\tstatic</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> GC _gc</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //16.内部类对象，其销毁会自动引发析构函数，进而进行持久化操作</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">};</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">template</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> &#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> Type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">SlackerModel</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Type</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">>*</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> SlackerModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">Type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">_inst </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> nullptr</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //4.类外定义静态成员变量 _inst</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">template</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> &#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> Type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">typename</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> SlackerModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">Type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">GC</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> SlackerModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\">Type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">_gc</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //17.类外定义静态成员变量 _gc</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">template</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> SlackerModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">double</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>;</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //18.由于类模板的原因，导致 _gc 对象没有被实例化出来，因此只能让模板类提前实例化出一份类，否则无法调用 _gc 的析构函数</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">{</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tSlackerModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">double</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">GetInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()-></span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Add</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tSlackerModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">double</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">GetInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()-></span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Add</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tSlackerModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">double</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">GetInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()-></span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Add</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tSlackerModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">double</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">GetInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()-></span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Print</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//delete SlackerModel&#x3C;double>::GetInstance();</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //虽然可以这么设计，但是我们不推荐，我们希望在 main() 结束后自动调用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\t</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\tSlackerModel</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">double</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">>::</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">GetInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">()-></span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">DelInstance</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> //19.用户可以自己提前调用，析构单例对象</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\t</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">\t//假设这下面还有某些代码...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">\t</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">\treturn</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">//20.也可以不使用这句在 main() 调用结束自动调用 _gc 的析构函数</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">//21.当然，如果不需要做持久化操作，那么有关 GC 的代码就可以去除...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">//22.懒汉模式也提示我们：</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">//(1) 如果有些动作想要在 main() 前做，可以使用 static 的成员变量</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">//(2) 如果有些动作想要在 main() 后做，可以尝试使用类似智能指针或内部类析构</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><blockquote>\n<p>注意：我们上面的模式在单线程下是没什么问题的，但是在多线程的情况下依旧有问题（例如懒汉模式中，如果不会 <code v-pre>new</code> 语句加锁，就有可能出现同时申请内存控件的情况，也就会出现内存泄漏！），待补充...</p>\n</blockquote>\n<figure><img src=\"@source/1.编程语言/2.Cpp/assets/image-20240828212942426.png\" alt=\"image-20240828212942426\" tabindex=\"0\" loading=\"lazy\"><figcaption>image-20240828212942426</figcaption></figure>\n<p>上面这种情况需要多思考一下。</p>\n","tagOpen":"<template>","tagClose":"</template>"},"script":null,"scriptSetup":null,"scripts":[],"styles":[],"customBlocks":[]},"content":"\n## 1.设计不能被拷贝的类\n\n>   解析：拷贝只会放生在两个场景中\n>\n>   1.   拷贝构造函数\n>   2.   赋值运算符重载\n>\n>   因此想要让一个类禁止拷贝，就需让该类不能调用“拷贝构造函数”以及“赋值运算符重载”，而 `C++11` 提供的 `delete` 重载关键字可以让这件事情变得更加简单。\n\n### 1.1.C++98 做法\n\n```cpp\nclass CopyBan\n{\npublic:\n\tCopyBan()\n\t\t: _c(1) \n\t{}\n\nprivate:\n\t//拷贝构造私有化\n\tCopyBan(const CopyBan&);\n\t//赋值重载私有化\n\tCopyBan& operator=(const CopyBan&);\n\nprivate:\n\tint _c;\n};\n\nint main()\n{\n\tCopyBan c;\n\t//CopyBan copy(c);//禁用了\n\n\treturn 0;\n}\n```\n\n### 1.2.C++11 做法\n\n```cpp\nclass CopyBan\n{\npublic:\n\tCopyBan()\n\t\t: _c(1) \n\t{}\n\t//拷贝构造私有化\n\tCopyBan(const CopyBan&) = delete;\n\t//赋值重载私有化\n\tCopyBan& operator=(const CopyBan&) = delete;\n\nprivate:\n\tint _c;\n};\n\nint main()\n{\n\tCopyBan c;\n\t//CopyBan copy(c);//禁用了\n\n\treturn 0;\n}\n```\n\n## 2.设计在堆上创建的类\n\n### 2.1.析构私有\n\n>   解析：一个在栈上的对象如果没有办法调用析构，就没有办法被创建，因为编译器认为没有析构，禁止直接创建对象，这种情况就只能使用 `new` 创建对象，并且提供一个用于释放的接口。\n\n```cpp\nclass HeapOnly\n{\npublic:\n    static void Destroy_1(HeapOnly* ptr)\n    {\n        delete ptr;\n    }\n    //or\n    void Destroy_2()\n    {\n        delete this;\n    }\n\nprivate:\n    ~HeapOnly() {}\n};\n\nint main()\n{\n    //HeapOnly h1;//禁用\n\n    HeapOnly* ph1 = new HeapOnly;\n    HeapOnly::Destroy_1(ph1);\n\n    HeapOnly* ph2 = new HeapOnly;\n    ph2->Destroy_2();\n\n    //HeapOnly h2(*ph1);//禁用\n\n    return 0;\n}\n```\n\n### 2.2.构造私有\n\n>   解析：如果一个类的构造被私有了，那么就无法直接调用，包括 `new` 也无法调用，然后我们提供给用户一个接口，在类的内部 `new` 返回类指针给用户，交给用户释放即可。\n>\n>   就是需要注意，还需要将拷贝构造私有化，避免用户使用接口后，解引用进行拷贝。\n\n```cpp\nclass HeapOnly\n{\npublic:\n    static HeapOnly* CreateObject()//这里必须是 static 静态成员函数\n    {\n        return new HeapOnly;\n    }\n\nprivate:\n    HeapOnly() {}\n    HeapOnly(const HeapOnly&);\n};\n\nint main()\n{\n    //HeapOnly h1;//禁用\n    HeapOnly* ph = HeapOnly::CreateObject();//如果不是静态就需要创建对象来调用 CreateObject()，但我们已经没有办法产生对象了\n    //HeapOnly h2(*ph);//禁用\n    return 0;\n}\n```\n\n## 3.设计在栈上创建的类\n\n>   解析：需要删除 `operator new()` 才能彻底解决问题，注意不能私有构造函数！\n\n```cpp\nclass StackOnly\n{\npublic:\n\tstatic StackOnly CreateObj()\n\t{\n\t\treturn StackOnly();\n\t}\n\n\t//禁掉 operator new() 可以把用 new 调用拷贝构造申请对象给禁掉\n\tvoid* operator new(size_t size) = delete;\n\tvoid operator delete(void* p) = delete;\n\nprivate:\n\tStackOnly()//实际上删除了 operator new() 就无需将构造函数私有化了，上述的 CreateObj() 也可以一起不要了\n\t\t: _a(0)\n\t{}\n\n\t//不可私有拷贝构造\n\t//StackOnly(StackOnly& s)\n\t//\t: _a(0)\n\t//{}\n\nprivate:\n\tint _a;\n};\n\nint main()\n{\n\tStackOnly obj = StackOnly::CreateObj();\n\t//StackOnly* ptr1 = new StackOnly();//禁用\n\t//StackOnly* ptr2 = new StackOnly(obj);//禁用，这个不能私有拷贝构造，只能删除 new 的底层调用 operator new，否则就无法返回 CreateObj() 的结果\n\t//delete& obj;//禁用\n\n\treturn 0;\n}\n```\n\n## 4.设计无法被继承的类\n\n### 4.1.C++98 做法\n\n父类的构造函数被私有化就不会被子类继承。\n\n### 4.2.C++11 做法\n\n使用关键字 `final`，表示该类不可被继承。\n\n## 5.设计创建单对象的类\n\n实际上就是所谓的“单例模式”，该类只能被创建出一个对象，单例模式实际是一种设计模式。\n\n>   补充：常见的设计模式有 `23` 种，其实就是被反复使用、多数人知晓、经过分类、代码设计经验的总结，是编程界探索出来的一种编程“兵法”，其积极的一面是可以避免人们走入一些“坑”，当然设计模式只是一种实践经验，并不是所有的设计模式都适用于每个场景，使用哪种设计模式需要考虑到具体的需求和系统架构。\n>\n>   1.  `Singleton`（单例模式）\n>   2.  `Factory Method`（工厂方法模式）\n>   3.  `Abstract Factory`（抽象工厂模式）\n>   4.  `Builder`（建造者模式）\n>   5.  `Prototype`（原型模式）\n>   6.  `Adapter`（适配器模式）\n>   7.  `Bridge`（桥接模式）\n>   8.  `Composite`（组合模式）\n>   9.  `Decorator`（装饰器模式）\n>   10.  `Facade`（外观模式）\n>   11.  `Flyweight`（享元模式）\n>   12.  `Proxy`（代理模式）\n>   13.  `Chain of Responsibility`（责任链模式）\n>   14.  `Command`（命令模式）\n>   15.  `Interpreter`（解释器模式）\n>   16.  `Iterator`（迭代器模式）\n>   17.  `Mediator`（中介者模式）\n>   18.  `Memento`（备忘录模式）\n>   19.  `Observer`（观察者模式）\n>   20.  `State`（状态模式）\n>   21.  `Strategy`（策略模式）\n>   22.  `Template Method`（模板方法模式）\n>   23.  `Visitor`（访问者模式）\n>\n>   不过一般谈设计模式都是在接近上层的设计才会得到更多的关注，过于底层的设计一般比较少提及。\n\n“单例”的解释就是“单份实例化”，数据类型可以是任意的，但是全局只能有一个实例化，最典型的就是内存池，内存池最好只有一份，否则容易出现问题（尤其是项目变大时，往往绕不开单例模式）。\n\n### 5.1.饿汉模式\n\n```cpp\n//单例模式——饿汉模式\n#include <iostream>\nusing namespace std;\n\n//饿汉模式：把对象提前创建好（最好是在 程序/main 启动时），并且随时需要（不要使用全局变量来实现，一是无法直接创建，二是容易重定义，应该使用静态变量）\ntemplate <class Type>\nclass HungryManModel\n{\npublic:\n\tstatic HungryManModel* GetInstance() //4.获取实例对象，并且由于用户无法直接创建对象，这个函数也必须静态成员函数，方便用户调用\n\t{\n\t\treturn &_inst; //5.返回单例对象\n\t}\n\n\tHungryManModel(const HungryManModel<Type>& self) = delete; //12.禁用拷贝构造\n\n\tHungryManModel& operator=(const HungryManModel<Type>& self) = delete; //14.禁用赋值重载（一般禁用拷贝构造也会禁用赋值重载）\n\n\t//6.这里再加上对单例对象的一些操作方法\n\tvoid Add()\n\t{\n\t\t_data++;\n\t}\n\n\tvoid Print()\n\t{\n\t\tcout << \"数据:\" << _data << endl;\n\t}\n\nprivate:\n\tHungryManModel() //2.将构造函数私有化，禁止用户直接在类外构造对象\n\t\t: _data(Type())\n\t{}\n\nprivate:\n\tType _data; //1.对象内部的数据，假设在全局独有这一份\n\tstatic HungryManModel<Type> _inst; //3.设置静态成员变量，使得在 main() 被调用前就构造好单例对象，注意这个静态成员的内部并没有自己包含自己，因为静态变量存储在静态区，而不在对象内部\n};\n\ntemplate <class Type>\nHungryManModel<Type> HungryManModel<Type>::_inst; //虽然在类外定义，但是该静态变量是属于类的（静态成员），因此可以调用构造函数\n\nint main()\n{\n\t//HungryManModel<int> a; //7.无法直接在类外直接创建对象\n\t//HungryManModel<int>* pa = new HungryManModel<int>(); //8.无法直接在类外直接创建对象\n\tHungryManModel<int>* p = HungryManModel<int>::GetInstance(); //9.获取单例对象\n\t\n\t//10.调用单例对象的方法\n\tp->Add();\n\tp->Print(); //输出 1\n\tHungryManModel<int>::GetInstance()->Add();\n\tHungryManModel<int>::GetInstance()->Print(); //输出 2\n\n\t//11.发现还有一个缺陷：没有禁用拷贝构造，上述类依旧是有问题的，下面代码的就暴露出拷贝问题\n\t//HungryManModel<int> copy(*HungryManModel<int>::GetInstance()); //拷贝\n\t\n\t//HungryManModel<int>::GetInstance()->Add();\n\t//HungryManModel<int>::GetInstance()->Print(); //输出 3\n\t\n\t//copy.Print(); //依旧输出 2\n\n\t//13.甚至还有一些奇奇怪怪的操作，自己给自己赋值...虽然也不会有什么问题啦，以防万一，我们也把赋值重载给禁掉\n\t//*HungryManModel<int>::GetInstance() = *HungryManModel<int>::GetInstance();\n\n\t//15.允许创建不同类型的单例对象，但是每一种类型的对象在代码中都只会存在一份\n\tHungryManModel<double>::GetInstance()->Add();\n\tHungryManModel<double>::GetInstance()->Print();\n\n\tHungryManModel<long>::GetInstance()->Add();\n\tHungryManModel<long>::GetInstance()->Print();\n\treturn 0;\n}\n```\n\n1.   饿汉模式的优点：相比懒汉模式，实现起来要简单一些，容易理解\n\n2.   饿汉模式的缺点：饿汉模式还是有挺多缺点的\n\n     (1)静态单例对象如果较多，则可能导致进程启动变慢，`main()` 可能会间隔一段时间才会被调用\n\n     (2)多个单例对象可能有先后次序问题，有可能某一个单例对象需要在另外一个单例对象启动后，才可以启动，这种情况下使用饿汉模式就难以把控先后次序问题了（因为全局静态对象初始化的先后次序程序员很难确定）\n\n>   补充：构造方法\n>\n>   1.   构造私有\n>   2.   拷贝私有（包含拷贝构造和赋值拷贝）\n>   3.   定义静态单例\n>   4.   类加载时使用静态方法进行构造再返回单例\n\n### 5.2.懒汉模式\n\n```cpp\n//单例模式——懒汉模式\n#include <iostream>\nusing namespace std;\n\n//懒汉模式：第一次用的时候再创建（现吃现做）\ntemplate <class Type>\nclass SlackerModel\n{\npublic:\n\tstatic SlackerModel* GetInstance() //5.获取实例对象，并且由于用户无法直接创建对象，这个函数也必须静态成员函数，方便用户调用\n\t{\n\t\tif (_inst == nullptr)\n\t\t{\n\t\t\t_inst = new SlackerModel<Type>; //6.若指针为空，则创建一个对象（并且保证只有在第一次调用的时候创建，其他的时候都是原封不动返回）\n\t\t\t//由于懒汉模式的单例对象是 new 出来的，而该对象的生命周期一般跟随进程，所以一般不需要我们自己释放（极少情况需要我们自己释放），而是交给进程，进程结束就会自动释放（这是操作系统和进程的事情，我们无需考虑）\n\t\t}\n\n\t\treturn _inst; //8.返回单例对象指针\n\t}\n\n\t//7.禁用拷贝构造和赋值重载\n\tSlackerModel(const SlackerModel<Type>& self) = delete; \n\tSlackerModel& operator =(const SlackerModel<Type>& self) = delete; \n\n\t//10.这里再加上对单例对象的一些操作方法\n\tvoid Add() { _data++; }\n\tvoid Print() { cout << \"数据:\" << _data << endl; }\n\n\tstatic void DelInstance() //9.如果考虑多一点，我们就支持用户手动释放单例对象\n\t{\n\t\tif (_inst != nullptr)\n\t\t{\n\t\t\tdelete _inst;\n\t\t\t_inst = nullptr;\n\t\t}\n\t}\n\nprivate:\n\tSlackerModel() : _data(Type()) {} //2.将构造函数私有化，禁止用户直接在类外构造对象\n\n\t~SlackerModel()\n\t{\n\t\t//12.但是析构的同时，可能需要做一些持久化操作（比如：要求把数据写到文件），进程虽然正常结束会释放内存空间，但是不会自动进行写入数据（这里的数据是用户在代码中的数据，本代码体现为 _data）\n\t\t//而只有用户调用了析构函数，才能做自定义的持久化操作，否之数据就会丢失\n\t\t//fopen(...) 之类的语句\n\t\tcout << \"写入数据中...\" << endl; //这里只是用打印语句简单模拟一下写入数据的过程\n\t\tcout << \"数据写入成功!\" << endl;\n\n\t\t//11.由于这里是使用 new 申请资源，除非使用智能指针，否则必须用户自己调用 delete 才会调用析构函数，\n\t\t//进而做持久化操作，但是我们最好避免用户自己调用 delete，因此我们可以构造一个内部类，\n\t\t//让内部类创建出来的静态对象自动调用析构函数（创建的对象会被自动释放）\n\t}\n\n\tclass GC //14..内部类是外部类的友元类\n\t{\n\tpublic:\n\t\t~GC()\n\t\t{\n\t\t\tDelInstance(); //13.如果用户没有自己调用 DelInstance()，则这里会同构析构函数自动调用\n\t\t}\n\t};\n\nprivate:\n\tType _data; //1.对象内部的数据，假设在全局独有这一份\n\tstatic SlackerModel<Type>* _inst; //3.设置静态成员指针变量，使得在 main() 被调用前就构造好单例对象指针（指针的创建较快，此时的指针指向的对象还没有被实际创建出来）\n\tstatic GC _gc; //16.内部类对象，其销毁会自动引发析构函数，进而进行持久化操作\n};\n\ntemplate <class Type>\nSlackerModel<Type>* SlackerModel<Type>::_inst = nullptr; //4.类外定义静态成员变量 _inst\n\ntemplate <class Type>\ntypename SlackerModel<Type>::GC SlackerModel<Type>::_gc; //17.类外定义静态成员变量 _gc\n\ntemplate class SlackerModel<double>; //18.由于类模板的原因，导致 _gc 对象没有被实例化出来，因此只能让模板类提前实例化出一份类，否则无法调用 _gc 的析构函数\n\nint main()\n{\n\tSlackerModel<double>::GetInstance()->Add();\n\tSlackerModel<double>::GetInstance()->Add();\n\tSlackerModel<double>::GetInstance()->Add();\n\tSlackerModel<double>::GetInstance()->Print();\n\n\t//delete SlackerModel<double>::GetInstance(); //虽然可以这么设计，但是我们不推荐，我们希望在 main() 结束后自动调用\n\t\n\tSlackerModel<double>::GetInstance()->DelInstance(); //19.用户可以自己提前调用，析构单例对象\n\t\n\t//假设这下面还有某些代码...\n\t\n\treturn 0;\n}\n//20.也可以不使用这句在 main() 调用结束自动调用 _gc 的析构函数\n\n//21.当然，如果不需要做持久化操作，那么有关 GC 的代码就可以去除...\n \n//22.懒汉模式也提示我们：\n//(1) 如果有些动作想要在 main() 前做，可以使用 static 的成员变量\n//(2) 如果有些动作想要在 main() 后做，可以尝试使用类似智能指针或内部类析构\n```\n\n>   注意：我们上面的模式在单线程下是没什么问题的，但是在多线程的情况下依旧有问题（例如懒汉模式中，如果不会 `new` 语句加锁，就有可能出现同时申请内存控件的情况，也就会出现内存泄漏！），待补充...\n\n![image-20240828212942426](./assets/image-20240828212942426.png)\n\n上面这种情况需要多思考一下。","excerpt":"","includedFiles":[],"tasklistId":0,"title":"","headers":[{"level":2,"title":"1.设计不能被拷贝的类","slug":"_1-设计不能被拷贝的类","link":"#_1-设计不能被拷贝的类","children":[{"level":3,"title":"1.1.C++98 做法","slug":"_1-1-c-98-做法","link":"#_1-1-c-98-做法","children":[]},{"level":3,"title":"1.2.C++11 做法","slug":"_1-2-c-11-做法","link":"#_1-2-c-11-做法","children":[]}]},{"level":2,"title":"2.设计在堆上创建的类","slug":"_2-设计在堆上创建的类","link":"#_2-设计在堆上创建的类","children":[{"level":3,"title":"2.1.析构私有","slug":"_2-1-析构私有","link":"#_2-1-析构私有","children":[]},{"level":3,"title":"2.2.构造私有","slug":"_2-2-构造私有","link":"#_2-2-构造私有","children":[]}]},{"level":2,"title":"3.设计在栈上创建的类","slug":"_3-设计在栈上创建的类","link":"#_3-设计在栈上创建的类","children":[]},{"level":2,"title":"4.设计无法被继承的类","slug":"_4-设计无法被继承的类","link":"#_4-设计无法被继承的类","children":[{"level":3,"title":"4.1.C++98 做法","slug":"_4-1-c-98-做法","link":"#_4-1-c-98-做法","children":[]},{"level":3,"title":"4.2.C++11 做法","slug":"_4-2-c-11-做法","link":"#_4-2-c-11-做法","children":[]}]},{"level":2,"title":"5.设计创建单对象的类","slug":"_5-设计创建单对象的类","link":"#_5-设计创建单对象的类","children":[{"level":3,"title":"5.1.饿汉模式","slug":"_5-1-饿汉模式","link":"#_5-1-饿汉模式","children":[]},{"level":3,"title":"5.2.懒汉模式","slug":"_5-2-懒汉模式","link":"#_5-2-懒汉模式","children":[]}]}]}}
