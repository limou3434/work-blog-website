{"content":"<h2 id=\"_1-redis-读分离架构-高可用架构\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-redis-读分离架构-高可用架构\"><span>1.Redis 读分离架构/高可用架构</span></a></h2>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：实际上 <code v-pre>Redis</code> 的单机读写性能一般可以达到十万级别的 <code v-pre>QPS</code>，可以 <a href=\"https://redis.io/docs/latest/operate/oss_and_stack/management/optimization/benchmarks/#benchmark-results-on-bare-metal-servers-across-different-redis-versions\" target=\"_blank\" rel=\"noopener noreferrer\">查阅官方文档</a>。</p>\n</div>\n<h3 id=\"_1-1-架构原理\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-1-架构原理\"><span>1.1.架构原理</span></a></h3>\n<p>当客户端足够多时，要减轻 <code v-pre>redis</code> 节点的负担，则可以考虑多个从节点复制主节点的数据，主节点负责读写，从节点只负责读（不过这么做其实是有点问题的，后面一步一步来）。</p>\n<h3 id=\"_1-2-数据节点\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-数据节点\"><span>1.2.数据节点</span></a></h3>\n<h4 id=\"_1-2-1-复制\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-1-复制\"><span>1.2.1.复制</span></a></h4>\n<h5 id=\"_1-2-1-1-复制的建立\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-1-1-复制的建立\"><span>1.2.1.1.复制的建立</span></a></h5>\n<p>首先我们需要建立 <code v-pre>Redis</code> 的集群架构，<code v-pre>Redis</code> 实例之间会进行复制操作，实例划分为主节点和从节点，复制数据流是单向的，只能从主节点流向从节点。复制的配置方式有三种：</p>\n<ul>\n<li>配置文件中写入在 <code v-pre>slaveof {masterHost} {masterPort}</code> 随 <code v-pre>Redis</code> 启动生效</li>\n<li>在 <code v-pre>redis-server</code> 启动命令时加入 <code v-pre>--slaveof {masterHost} {masterPort}</code> 生效</li>\n<li>直接使用 <code v-pre>redis</code> 命令 <code v-pre>slaveof {masterHost} {masterPort}</code> 生效</li>\n</ul>\n<p>我们在启动 <code v-pre>Redis</code> 的时候，其实是可以选择不同的配置文件的，因此我们只需要保持原来的 <code v-pre>Redis</code> 不变（作为主节点），复制原来的配置文件稍作修改为 <code v-pre>redis-slave.conf </code> 即可（确保其中的 <code v-pre>daemonize</code> 为 <code v-pre>yes</code>，如果配置文件中已经设置好了，那其从节点配置文件可以继续使用主节点的配置文件，不做任何修改）。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 复制的建立</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-server</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/redis/redis-slave.conf</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> --port</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6380</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> --slaveof</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 127.0.0.1</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> ## 6379 的主节点就连接上 6380 的次节点</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>然后使用 <code v-pre>redis-server /etc/redis/redis-slave.conf --port 6380 --slaveof 127.0.0.1 6379</code> 启动从节点，并且使用 <code v-pre>netstat -nlpt</code> 检查是否启动，最后按下面的做法查验是否有分布式运行。</p>\n<h5 id=\"_1-2-1-2-复制的现象\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-1-2-复制的现象\"><span>1.2.1.2.复制的现象</span></a></h5>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 复制的过程</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># >>> begin: 连接主节点 >>></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 127.0.0.1</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">set</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> key</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">hello</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">OK</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> key</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"hello\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">info</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replication</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># Replication</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">role:master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">connected_slaves:1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave0:ip</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">=127.0.0.1,port=6380,state=online,offset=700,lag=1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_failover_state:no-failover</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_replid:8280d7308ba672a701170c8eeba15e258546de71</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_replid2:0000000000000000000000000000000000000000</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_repl_offset:700</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">second_repl_offset:-1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_active:1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_size:1048576</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_first_byte_offset:1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_histlen:700</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># &#x3C;&#x3C;&#x3C; end &#x3C;&#x3C;&#x3C;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># >>> begin: 连接从节点 >>></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 127.0.0.1</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6380</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> key</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"hello\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6380</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">info</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replication</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># Replication</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">role:slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_host:127.0.0.1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_port:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_link_status:up</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_last_io_seconds_ago:9</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_sync_in_progress:0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave_read_repl_offset:700</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave_repl_offset:700</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave_priority:100</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave_read_only:1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">replica_announced:1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">connected_slaves:0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_failover_state:no-failover</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_replid:8280d7308ba672a701170c8eeba15e258546de71</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_replid2:0000000000000000000000000000000000000000</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_repl_offset:700</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">second_repl_offset:-1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_active:1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_size:1048576</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_first_byte_offset:15</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_histlen:686</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># &#x3C;&#x3C;&#x3C; end &#x3C;&#x3C;&#x3C;</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>从运行结果中看到复制已经在工作了，针对主节点 <code v-pre>6379</code> 的任何修改都可以同步到从节点 <code v-pre>6380</code> 中，并且也可以使用 <code v-pre>info replication</code> 查看每个节点的复制信息（节点角色、状态等）。</p>\n<h5 id=\"_1-2-1-3-复制的断开\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-1-3-复制的断开\"><span>1.2.1.3.复制的断开</span></a></h5>\n<p>在从节点中可以执行 <code v-pre>slaveof no one</code> 断开和主节点的复制关系，从节点就会晋升为新的主节点，断开复制节点后不会抛弃原有数据，只是无法再获取主节点上的数据变化。断开节点后，还可以使用 <code v-pre>slaveof &lt;newMasterIp&gt; &lt;newMasterPort&gt;</code> 给从节点切换为别的主节点，或者干脆给从节点恢复原本的主节点。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 复制的断开</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># >>> begin: 从节点 >>></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 127.0.0.1</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6380</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6380</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> key</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"hello\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6380</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slaveof</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> no</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> one</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">OK</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># &#x3C;&#x3C;&#x3C; end &#x3C;&#x3C;&#x3C;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># >>> begin: 主节点 >>></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 127.0.0.1</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> key</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"hello\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">set</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> akey</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">OK</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># &#x3C;&#x3C;&#x3C; end &#x3C;&#x3C;&#x3C;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># >>> begin: 从节点 >>></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6380</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> akey</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 这样就无法直接复制主节点的数据了</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">nil</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6380</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slaveof</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 127.0.0.1</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">OK</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># &#x3C;&#x3C;&#x3C; end &#x3C;&#x3C;&#x3C;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># >>> begin: 主节点 >>></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 127.0.0.1</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 访问一次主节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># &#x3C;&#x3C;&#x3C; end &#x3C;&#x3C;&#x3C;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># >>> begin: 主节点 >>></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6380</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> akey</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 就会发现从节点恢复了复制</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"redis\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># &#x3C;&#x3C;&#x3C; end &#x3C;&#x3C;&#x3C;</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h5 id=\"_1-2-1-4-复制的安全\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-1-4-复制的安全\"><span>1.2.1.4.复制的安全</span></a></h5>\n<ul>\n<li><strong>权限校验</strong>：对于数据比较重要的节点，主节点会通过设置 <code v-pre>requirepass &lt;密码&gt;</code> 参数进行密码验证，这时所有的客户端访问进入命令行后必须先使用 <code v-pre>auth</code> 命令实行校验。从节点与主节点的复制连接是通过一个特殊标识的客户端来完成，因此需要配置从节点的 <code v-pre>masterauth &lt;密码&gt;</code> 参数与主节点密码保持一致，这样从节点才可以正确地连接到主节点并发起复制流程。</li>\n<li><strong>只读模式</strong>：只读默认情况下，从节点使用 <code v-pre>slave-read-only=yes</code> 配置为只读模式。由于复制只能从主节点到从节 点，对于从节点的任何修改主节点都无法感知，修改从节点会造成主从数据不一致，所以建议线上不要修改从节点的只读模式。</li>\n</ul>\n<p>为了不影响我原来的配置，我这里复制最原本的配置文件，作为主节点和从节点的配置。</p>\n<ol>\n<li>\n<p>配置主节点</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 配置主节点( redis-master.conf)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cp</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/redis/redis.conf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ~/redis-master.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> vim</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># ...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">port</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6380</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">requirepass</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">主节点密</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">码</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># ...</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></li>\n<li>\n<p>启动主节点</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 启动主节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-server</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis.conf</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></li>\n<li>\n<p>配置从节点</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 配置从节点(redis-slave.conf)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cp</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/redis/redis.conf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ~/redis-slave.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> vim</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-slave.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># ...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">port</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6381</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">requirepass</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">从节点密</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">码</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slaveof</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 127.0.0.1</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6380</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">masterauth</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">填入主节点密</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">码</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave-read-only</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> yes</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># ...</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></li>\n<li>\n<p>启动从节点</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 启动从节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-server</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-slave.conf</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></li>\n<li>\n<p>连接主节点并设置值</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 连接主节点并设置值</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6380</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -a</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">主节点密</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">码</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 或者不使用 -a 选项, 直接回车, 在命令行界面中使用 \"auth 密码\" 即可, 如果验证通过就会返回 OK</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6380</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">set</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> key</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">value1</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">ok</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6380</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> key</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"value1\"</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></li>\n<li>\n<p>验证从节点数据同步</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 验证从节点数据同步</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6381</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6381</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> key</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"value1\"</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></li>\n<li>\n<p>验证从节点只读模式</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 验证从节点只读模式</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6381</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">set</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> key</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">new_value</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">error</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> READONLY</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> You</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> can</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">t write against a read-only replica.</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></li>\n</ol>\n<h5 id=\"_1-2-1-5-复制的延迟\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-1-5-复制的延迟\"><span>1.2.1.5.复制的延迟</span></a></h5>\n<p>主从节点一般部署在不同机器上，复制时的网络延迟就成为需要考虑的问题，<code v-pre>Redis</code> 为我们提供了 <code v-pre>repl-disable-tcp-nodelay</code> 参数用于控制是否关闭 <code v-pre>TCP_NODELAY</code>，默认为 <code v-pre>no</code>，即开启 <code v-pre>tcpnodelay</code> 功能，说明如下：</p>\n<ul>\n<li>当关闭时，主节点产生的命令数据无论大小都会及时地发送给从节点，这样主从之间延迟会变小，但增加了网络带宽的消耗。适用于主从之间的网络环境良好的场景，如同机房部署。</li>\n<li>当开启时，主节点会合并较小的 <code v-pre>TCP</code> 数据包从而节省带宽，默认发送时间间隔取决于 <code v-pre>Linux</code> 的内核，一般默认为 <code v-pre>40</code> 毫秒。这种配置节省了带宽但增大主从之间的延迟。适用于主从网络环境复杂的场景，如跨机房部署。</li>\n</ul>\n<div class=\"hint-container caution\">\n<p class=\"hint-container-title\">警告</p>\n<p>警告：因此除非数据不紧急，否则使用 <code v-pre>Redis</code> 的从节点做读分离其实是有点问题的，因为可能会有较高的延迟，与其说是读分离，不如说从节点的重点是备份数据，方便后续的哨兵节点做故障转移的。</p>\n</div>\n<h4 id=\"_1-2-2-拓扑\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-2-拓扑\"><span>1.2.2.拓扑</span></a></h4>\n<ol>\n<li>\n<p><strong>一主一从结构</strong>：也就是我们之前一直使用的结构</p>\n<ul>\n<li>通常用于主节点出现宕机时，从节点可以提供临时故障转移</li>\n<li>同时写命令较高需要持久化时，就可以在从节点上开启 <code v-pre>AOF</code> 配置</li>\n</ul>\n<p>这样就可以保证数据持久化安全性，也可以避免对主节点性能的干扰。</p>\n</li>\n<li>\n<p><strong>一主多从结构</strong>：在大型电商平台中，商品详情页的访问量通常远高于商品数据的修改量。例如，商品价格、库存等信息修改的频率较低，而用户浏览商品详情的频率极高。因此可以一个主节点负责写入，其他从节点都负责读取（负载均衡读取）。</p>\n</li>\n<li>\n<p><strong>树形主从结构</strong>：树形主从结构（分层结构）使得从节点不但可以复制主节点数据，同时可以作为其他从节点的主节点继续向下层复制。当祖先主节点需要直接挂载的从节点较多时，可以通过引入复制中间层（就是祖先节点只挂载几个从节点后，那几个从节点构成一层中间层），有效降低住系欸按负载和需要传送给从节点的数据量。数据写入节点 <code v-pre>A</code> 之后会同步给 <code v-pre>B</code> 和 <code v-pre>C</code> 节点，<code v-pre>B</code> 节点进一步把数据同步给 <code v-pre>D</code> 和 <code v-pre>E</code> 节 点，这样当主节点 <code v-pre>A</code> 需要挂载多个从节点时，就可以避免对主节点 <code v-pre>A</code> 的过高性能干扰。</p>\n</li>\n</ol>\n<div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>补充：这里 <code v-pre>Redis</code> 只是做了复制和拓扑的工作，并没有使用现有的负载均衡算法，因此我们后面需要补充这类算法，在对应编程语言客户端中实现。</p>\n</div>\n<h4 id=\"_1-2-3-原理\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-3-原理\"><span>1.2.3.原理</span></a></h4>\n<h5 id=\"_1-2-3-1-链接检测\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-3-1-链接检测\"><span>1.2.3.1.链接检测</span></a></h5>\n<p>建立复制链接之前：</p>\n<ol>\n<li>\n<p><strong>保存主节点信息</strong>：当开始配置主从同步关系后，先启动从节点的话，会先保存主节点的地址信息，但复制流程尚未开始。 在从节点（如端口 <code v-pre>6380</code>）执行 <code v-pre>info replication</code>，可以看到以下信息，此时链接尚未建立。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 回显显示的配置</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6381</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">info</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replication</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># Replication</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">role:slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_host:127.0.0.1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_port:6380</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_link_status:up</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_last_io_seconds_ago:2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_sync_in_progress:0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave_read_repl_offset:43163</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave_repl_offset:43163</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave_priority:100</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave_read_only:1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">replica_announced:1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">connected_slaves:0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_failover_state:no-failover</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_replid:63d358c9223002afc5dcc995a235fcc14882c9d3</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_replid2:1c606c458fe22df08bae73d9af9a675cb7b49554</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_repl_offset:43163</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">second_repl_offset:43094</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_active:1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_size:1048576</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_first_byte_offset:43094</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_histlen:70\\</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># master_host 和 master_port 分别表示主节点的 IP 和 PORT</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># master_link_status 表示主节点的连接状态, 此时为 down, 说明尚未建立连接</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></li>\n<li>\n<p><strong>建立 TCP 连接</strong>：从节点会通过每秒运行的定时任务维护复制逻辑。</p>\n<ul>\n<li>如果检测到新的主节点，从节点会尝试与主节点建立基于 <code v-pre>TCP</code> 的网络连接</li>\n<li>若连接失败，定时任务会无限重试，直到连接成功或用户手动停止主从复制。</li>\n</ul>\n</li>\n<li>\n<p><strong>发送 PING 命令</strong>：成功建立连接后，从节点会发送 <code v-pre>PING</code> 命令，验证主节点的应用层状态。</p>\n<ul>\n<li>如果主节点正常，会返回 <code v-pre>PONG</code></li>\n<li>如果 <code v-pre>PONG</code> 超时，从节点会断开 <code v-pre>TCP</code> 连接，并等待下一次定时任务重新连接</li>\n</ul>\n</li>\n<li>\n<p><strong>权限验证</strong>：若主节点配置了 <code v-pre>requirepass</code> 参数，则需要密码验证。</p>\n<ul>\n<li>从节点需在配置文件中设置 <code v-pre>masterauth</code> 参数提供密码</li>\n<li>如果验证失败，主从复制过程将停止</li>\n</ul>\n</li>\n<li>\n<p><strong>同步数据集</strong>：在首次建立复制时，主节点会将其所有数据发送给从节点，分为以下两种情况。</p>\n<ul>\n<li><strong>全量同步</strong>：发送所有数据，耗时较长（后面会提及 <mark>方式、字段、指令</mark>）</li>\n<li><strong>部分同步</strong>：发送增量数据，耗时较短（后面会提及 <mark>方式、字段、指令</mark>）</li>\n</ul>\n</li>\n<li>\n<p><strong>命令持续复制</strong>：完成数据同步后，主节点会将后续所有修改命令发送给从节点，从节点执行这些命令以保持数据一致性。</p>\n</li>\n</ol>\n<p>建立复制链接之后：</p>\n<p>而实际上，为了做到实时复制，主从节点在建立复制链接后，主节点回报自己收到的修改操作，通过 <code v-pre>tcp</code> 长链接的方式，源源不断传输给从节点，从节点就会根据这写请求来同步修改自己的数据，保持和主节点的数据一致性。</p>\n<p>而这样的长链接需要使用心跳检测机制（这里的心跳机制是在 <code v-pre>Redis</code> 应用层实现的，而不是 <code v-pre>TCP</code> 自带的心跳机制）来维护链接状态：</p>\n<ol>\n<li>主从节点彼此之间都有心跳机制，各自模拟为对方的客户端进行通信</li>\n<li>主节点默认每隔 <code v-pre>10 s</code> 对从节点发送 <code v-pre>ping</code> 指令，判断从节点的存活性和链接状态（从节点也可以用这种方式来的只主节点是否掉线）</li>\n<li>从节点默认每隔 <code v-pre>1 s</code> 对主节点发送 <code v-pre>replconf ack {offset}</code> 指令来上报自己的偏移量（主节点会根据该偏移量来知道哪些数据已经被从节点接收并处理）</li>\n</ol>\n<p>如果主节点发现从节点通信延迟超过 <code v-pre>repl-timeout</code> 配置的值（默认 <code v-pre>60</code> 秒），则判定从节点下线，断 开复制客⼾端连接。从节点恢复连接后，⼼跳机制继续进⾏。</p>\n<h5 id=\"_1-2-3-2-复制方式\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-3-2-复制方式\"><span>1.2.3.2.复制方式</span></a></h5>\n<ul>\n<li>早期的<code v-pre> Redis</code> 只支持全量复制，这就导致有新的从节点加入时，如果数据量较大，就会非常消耗网络资源，并且一旦出现网络波动，就会导致数据丢失而重传。</li>\n<li>新版本的 <code v-pre>Redis</code> 支持部分复制，这主要处理在主从复制中网络闪断等原因造成的数据丢失场景，当从节点再次连接上主节点后，如果条件允许，主节点就会自动补发数据给从节点。补发的数量远小于全量复制，因此可以避免过量的开销。</li>\n</ul>\n<p>而同步的指令主要依靠 <code v-pre>psync replicationid &lt;offset&gt;</code>（是 <code v-pre>Redis</code> 内部自动调用的命令，不用我们自己调用），其中 <code v-pre>offset</code> 为 <code v-pre>-1</code> 代表全量复制指令，其他数值均为部分复制。</p>\n<p>触发全量复制，这通常在以下场景发生：</p>\n<ul>\n<li>从节点首次连接到主节点时。</li>\n<li>从节点与主节点数据完全不同步（如从节点为空或主节点 <code v-pre>replicationid</code> 改变）。</li>\n<li>主节点无法满足部分复制条件（如复制积压缓冲区不足）。</li>\n</ul>\n<p>触发部分复制，这通常在以下场景发生：</p>\n<ul>\n<li>从节点重新连接主节点时（短暂网络中断后）。</li>\n<li>从节点的 <code v-pre>replicationid</code> 和偏移量与主节点匹配，且主节点复制积压缓冲区中仍有缺失的数据。</li>\n</ul>\n<h5 id=\"_1-2-3-3-重要字段\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-3-3-重要字段\"><span>1.2.3.3.重要字段</span></a></h5>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：通过 <code v-pre>info replication</code> 可以观察下提及的字段，以及对应值的变化。</p>\n</div>\n<h6 id=\"_1-2-3-3-1-复制标识字段\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-3-3-1-复制标识字段\"><span>1.2.3.3.1.复制标识字段</span></a></h6>\n<p>节点的复制 <code v-pre>id</code>在以下两种情况。</p>\n<ul>\n<li>主节点初始启动时/重新启动时/异常恢复时</li>\n<li>从节点晋级成主节点时</li>\n</ul>\n<p>都会生成一个 <code v-pre>replication id</code>(同一个节点，每次重启，生成的 <code v-pre>replication id</code> 也会变化)，从节点和主节点建立连接之后，就会获取到主节点的 <code v-pre>replication id</code>，通过 <code v-pre>info replication</code> 即可查看 <code v-pre>replication id</code>。</p>\n<p>而每个节点需要记录两组 <code v-pre>master_replid</code>，这个设定解决的问题场景是这样的：</p>\n<ul>\n<li>比如当前有两个节点 <code v-pre>A</code> 和 <code v-pre>B</code>，<code v-pre>A</code> 为 <code v-pre>master</code>，<code v-pre>B</code> 为 <code v-pre>slave</code>。此时 <code v-pre>B</code> 就会记录 <code v-pre>A</code> 的 <code v-pre>master_replid</code>。如果网络出现抖动，<code v-pre>B</code> 以为 <code v-pre>A</code> 挂了，<code v-pre>B</code> 自己就会自动成为主节点。</li>\n<li>于是 <code v-pre>B</code> 给自己分配了新的 <code v-pre>master_replid</code>。此时就会使用 <code v-pre>master_replid2</code> 来保存之前 <code v-pre>A</code> 的 <code v-pre>master_replid</code>。</li>\n<li>如果后续网络恢复了，<code v-pre>B</code> 就可以根据 <code v-pre>master_replid2</code> 找回之前的主节点。</li>\n<li>如果后续网络没有恢复，<code v-pre>B</code> 就按照新的 <code v-pre>master_replid</code> 自成一派，继续处理后续的数据（您可以自己尝试 <code v-pre>kill</code> 掉主节点，重启主节点，查看中间的变化...）。</li>\n</ul>\n<h6 id=\"_1-2-3-3-2-复制偏移字段\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-3-3-2-复制偏移字段\"><span>1.2.3.3.2.复制偏移字段</span></a></h6>\n<p>参与复制的主从节点都会维护自身复制偏移量，主节点（<code v-pre>master</code>）在处理完写入命令后，会把命令的字节长度做累加记录，统计信息在 <code v-pre>info replication</code> 中的 <code v-pre>master_repl_offset</code> 指标中。</p>\n<p>从节点在接受到主节点发送的命令后，也会累加记录自身的偏移量，统计信息在 <code v-pre>info replication</code> 中的 <code v-pre>slave_repl_offset</code> 指标中。</p>\n<p>从节点每秒钟上报自身的复制偏移量给主节点，因此主节点也会保存从节点的复制偏移量，统计指标为 <code v-pre>slavex</code> 中的 <code v-pre>offset</code> 字段。</p>\n<p>因此，通过对比主从节点的复制偏移量，可以判断主从节点数据是否一致。</p>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：<code v-pre>replid + offset</code> 共同标识了一个“数据集”，如果两个节点，他们的 <code v-pre>replid</code> 和 <code v-pre>offset</code> 都相同，则这两个节点上持有的数据，就一定相同。</p>\n</div>\n<div class=\"hint-container note\">\n<p class=\"hint-container-title\">注</p>\n<p>吐槽：偏移量就相当于学习进度。</p>\n</div>\n<h5 id=\"_1-2-3-4-同步指令\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-3-4-同步指令\"><span>1.2.3.4.同步指令</span></a></h5>\n<p>从节点实现复制的原理实际上就是调用 <code v-pre>psync</code> 指令（由于早期不支持部分复制，会使用全量复制指令 <code v-pre>sync</code>，<code v-pre>Redis</code> 会自动根据当前版本来决定使用哪一个指令）。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 数据同步指令</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">psync</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">主节点复制标识replicationi</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">d</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">偏移量offse</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">t</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 如果 replicationid 设为 '?' 并且 offset 设为 '-1' 此时就是在尝试进行全量复制</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">#如果 replicationid offset 设为了具体的数值, 则是尝试进行部分复制</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>从节点使用后，主要发生了以下事情：</p>\n<figure><img src=\"@source/4.业务服务/3.缓存服务/assets/image-20241202145718801.png\" alt=\"\" tabindex=\"0\" loading=\"lazy\"><figcaption></figcaption></figure>\n<ol>\n<li>从节点发送 <code v-pre>psync</code> 命令给主节点，<code v-pre>replid</code> 和 <code v-pre>offset</code> 的默认值分别是 <code v-pre>?</code> 和 <code v-pre>-1</code></li>\n<li>主节点根据 <code v-pre>psync</code> 参数和自身数据情况决定响应结果：\n<ul>\n<li>如果回复 <code v-pre>+FULLRESYNC</code>，从节点进行全量复制流程</li>\n<li>如果回复 <code v-pre>+CONTINEU</code>，从节点进行部分复制流程</li>\n<li>如果回复 <code v-pre>-ERR</code>，说明 <code v-pre>Redis</code> 主节点版本过低，不支持 <code v-pre>psync</code> 命令，从节点可以使用 <code v-pre>sync</code> 命令进行全量复制</li>\n</ul>\n</li>\n</ol>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：当从节点初次连接主节点时，它不知道主节点的 <code v-pre>replicationid</code>（即它没有之前的同步信息）。</p>\n<p>这种情况下，从节点会发送 <code v-pre>PSYNC ? 0</code> 请求，表示它从未与主节点进行过同步，要求主节点进行全量同步。</p>\n</div>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：<code v-pre>psync</code> 一般不需要手动执行，<code v-pre>Redis-server</code> 会在主从复制模式下自动调用执行。</p>\n</div>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：<code v-pre>sync</code> 会阻塞 <code v-pre>redis server</code> 处理其他请求，<code v-pre>psync</code> 则不会。</p>\n</div>\n<h5 id=\"_1-2-3-5-详细过程\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-3-5-详细过程\"><span>1.2.3.5.详细过程</span></a></h5>\n<p>根据我们之前的知识，您也肯定明白两种复制方式的触发情况，但是我我们可以进一步细化这一步复制的概念。</p>\n<h6 id=\"_1-2-3-5-1-全量复制的细节\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-3-5-1-全量复制的细节\"><span>1.2.3.5.1.全量复制的细节</span></a></h6>\n<figure><img src=\"@source/4.业务服务/3.缓存服务/assets/image-20241202152620443.png\" alt=\"\" tabindex=\"0\" loading=\"lazy\"><figcaption></figcaption></figure>\n<ol>\n<li>从节点发送 <code v-pre>psync</code> 命令给主节点进行数据同步，由于是第一次进行复制，从节点没有主节点的运行 <code v-pre>ID</code> 和复制偏移量，所以发送 <code v-pre>psync ? -1</code>（不过有 <code v-pre>IP</code> 和<code v-pre>PORT</code> 所以不愁找不到主节点）。</li>\n<li>主节点根据命令，解析出要进行全量复制，回复 <code v-pre>+FULLRESYNC</code> 响应。</li>\n<li>从节点接收主节点的运行信息进行保存。</li>\n<li>主节点执行 <code v-pre>bgsave</code> 进行 <code v-pre>RDB</code> 文件的持久化。</li>\n<li>主节点发送 <code v-pre>RDB</code> 文件给从节点，从节点保存 <code v-pre>RDB</code> 数据到本地硬盘。</li>\n<li>主节点将从生成 <code v-pre>RDB</code> 到接收完成期间执行的写命令，写入到缓冲区中（不是指积压缓冲区），等从节点保存完 <code v-pre>RDB</code> 文件后，主节点再将缓冲区内的数据补发给从节点，补发的数据仍然按照 <code v-pre>RDB</code> 的二进制格式追加写入到收 到的 <code v-pre>rdb</code> 文件中，保持主从一致性。</li>\n<li>从节点清空自身原有的旧数据。</li>\n<li>从节点加载 <code v-pre>RDB</code> 文件得到与主节点一致的数据。</li>\n<li>如果从节点加载 <code v-pre>RDB</code> 完成之后，并且开启了 <code v-pre>AOF</code> 持久化功能，它会进行 <code v-pre>bgrewriteaof</code> 操作（不阻塞地优化 <code v-pre>AOF</code> 文件），得到最近的 <code v-pre>AOF</code> 文件。</li>\n</ol>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：默认情况下，进行全量复制需要主节点生成 <code v-pre>RDB</code> 文件到主节点的磁盘中, 再把磁盘上的 <code v-pre>RDB</code> 文件通过发送给从节点。<code v-pre>Redis</code> 从 <code v-pre>2.8.18</code> 版本开始支持无磁盘复制。主节点在执行 <code v-pre>RDB</code> 生成流程时, 不会生成 <code v-pre>RDB</code> 文件到磁盘中了，而是直接把生成的 <code v-pre>RDB</code> 数据通过网络发送给从节点，这样就节省了一系列的写硬盘和读硬盘的操作开销。</p>\n</div>\n<h6 id=\"_1-2-3-5-2-部分复制的细节\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-3-5-2-部分复制的细节\"><span>1.2.3.5.2.部分复制的细节</span></a></h6>\n<figure><img src=\"@source/4.业务服务/3.缓存服务/assets/image-20241202152701081.png\" alt=\"\" tabindex=\"0\" loading=\"lazy\"><figcaption></figcaption></figure>\n<ol>\n<li>当主从节点之间出现网络中断时，如果超过 <code v-pre>repl-timeout</code> 时间，主节点会认为从节点故障并终止复制连接。</li>\n<li>主从连接中断期间主节点依然响应命令，但这些复制命令都因网络中断无法及时发送给从节点，所以暂时将这些命令滞留在 <strong>复制积压缓冲区</strong> 中。</li>\n<li>当主从节点网络恢复后，从节点再次连上主节点。</li>\n<li>从节点将之前保存的 <code v-pre>replicationId</code> 和 <code v-pre>offset</code> 作为 <code v-pre>psync</code> 的参数发送给主节点，请求进行部分复制。</li>\n<li>主节点接到 <code v-pre>psync</code> 请求后，进行必要的验证。随后根据 <code v-pre>offset</code> 去复制积压缓冲区查找合适的数据， 并响应 <code v-pre>+CONTINUE</code> 给从节点（如果超出缓冲区的范围就需要切换为全量复制了）。</li>\n<li>主节点将需要从节点同步的数据发送给从节点，最终完成一致性。</li>\n</ol>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：复制积压缓冲区的概念。</p>\n<figure><img src=\"@source/4.业务服务/3.缓存服务/assets/image-20241202153856009.png\" alt=\"\" tabindex=\"0\" loading=\"lazy\"><figcaption></figcaption></figure>\n<p>复制积压缓冲区是保存在主节点上的一个固定长度的队列，默认大小为 <code v-pre>1MB</code>，当主节点有连接的从节点时被创建，这时主节点响应写命令时，不但会把命令发送给从节点，还会写入复制积压缓冲区，</p>\n<p>由于积压缓冲区本质上是先进先出的定长队列，所以能实现保存最近已复制数据的功能，用于补救 <strong>部分复制或复制命令</strong> 中丢失的数据。复制缓冲区相关统计信息可以通过主节点的 <code v-pre>info replication</code> 中。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 积压缓冲区信息</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">info</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replication</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># Replication</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">role:master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_active:1</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 开启复制缓冲区</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_size:1048576</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 缓冲区最大长度 </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_first_byte_offset:7479</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 起始偏移量, 计算当前缓冲区可用范围</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_histlen:1048576</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 已保存数据的有效长度</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 可算出复制积压缓冲区内的可用偏移量范围: [repl_backlog_first_byte_offset, repl_backlog_first_byte_offset + repl_backlog_histlen]</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></div>\n<h3 id=\"_1-3-哨兵节点\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-3-哨兵节点\"><span>1.3.哨兵节点</span></a></h3>\n<h4 id=\"_1-3-1-概念\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-3-1-概念\"><span>1.3.1.概念</span></a></h4>\n<p><code v-pre>Redis</code> 的主从复制模式可以将主节点的数据改变同步给从节点，这样从节点就可以起到两个作用：</p>\n<ul>\n<li>作为主节点的一个备份，一旦主节点出了故障不可达的情况，从节点可以作为后备“顶替”上来，并且保证数据尽量不丢失（主从复制表现为最终一致性）</li>\n<li>从节点可以分担主节点上的读压力，让主节点只承担写请求的处理，将所有的读请求负载均衡到各个从节点上。 但是主从复制模式并不是万能的，它同样遗留下以下几个问题：\n<ul>\n<li>主节点发生故障时，进行主备切换的过程是复杂的，需要完全的人工参与，导致故障恢复时间无法得到保障（这个用哨兵来解决）。</li>\n<li>主节点可以将读压力分散出去，但写压力/存储压力是无法法被分担的，还是受到单机的限制。 其中第一个问题是高可用问题，即 <code v-pre>Redis</code> 哨兵主要解决的问题（这个用集群来解决）。</li>\n</ul>\n</li>\n</ul>\n<p>不过，我们先来观察一个主节点故障后，一名运维工程师是如何 <Plot>在睡梦中惊醒后</Plot> 快速恢复服务 <Plot>然后回去继续补觉</Plot> 的。</p>\n<ol>\n<li>运维工程师监控面板，发现公司应用出现问题，排查后发现是分布式 <code v-pre>Redis</code> 的主节点发生了故障（假设这个应用只使用了一个主节点，多个一级从节点），但是此应用读取数据是没有问题只是无法写入。</li>\n<li>运维工程师在多个从节点中选择一个选择一个节点作为新主节点，修改所有从节点的配置文件，时从节点们指向新主节点，新的主节点也可以继续使用原有的读操作。</li>\n<li>运维工程师再修改应用的配置文件，让应用连接新的主节点，应用恢复写能力。</li>\n<li>运维工程师排除设计的旧主节点的问题后，修改旧主节点转化为新从节点，加入到分布式 <code v-pre>Redis</code> 架构中，以新主节点作为主节点。</li>\n</ol>\n<p>整个过程也被称为 <strong>故障转移</strong>，因此我们认为 <Plot>运维工程师真的很惨...咳咳</Plot> 这个应用并不高可用，我们希望这个过程是自动的，运维工程师只需要观察异常日志和指定分布是架构节点个数即可。</p>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：这里梳理一下概念。</p>\n<ul>\n<li>数据节点包含主节点、从节点，节点内运行 <code v-pre>redis-server</code> 服务</li>\n<li>哨兵集合内包含哨兵节点，节点内运行 <code v-pre>redis-sentinel</code> 服务</li>\n<li>应用方也叫客户端，可以是命令行也可以是语言第三方库</li>\n</ul>\n</div>\n<p>为了解决上面的问题，<code v-pre>Redis</code> 提出了 <code v-pre>Redis Sentinel</code> 这个分布式架构解决方案，其中包含若干个哨兵节点和数据节点。每个哨兵节点会对数据节点和其余 <code v-pre>Sentinel</code> 节点进行监控（在哨兵节点集合中，存在类似循环链表结构的互相监督机制），当它发现节点不可达时，会对节点做下线标识。</p>\n<p>如果下线的是主节点，它还会和其他的 <code v-pre>Sentinel</code> 节点（所有哨兵节点最好保持奇数总数，避免出现无法选举的问题）进行“协商”，当大多数 <code v-pre>Sentinel</code> 节点对主节点不可达这个结论达成共识之后，它们自己会在哨兵节点集合内部“选举”出一个 <strong>领导节点</strong> 来完成自动故障转移的工作，同时将这个变化实时通知给 <code v-pre>Redis</code> 应用方。整个过程是完全自动的，不需要人工介入。因此大体的流程和上面运维工程师做的类似，故障转移的流程大体如下：</p>\n<figure><img src=\"@source/4.业务服务/3.缓存服务/assets/image-20241202215147107.png\" alt=\"\" tabindex=\"0\" loading=\"lazy\"><figcaption></figcaption></figure>\n<ol>\n<li>监控：主节点故障，从节点同步连接中断，主从复制停止。哨兵节点通过定期监控发现主节点出现故障</li>\n<li>故障转移：哨兵节点与其他哨兵节点进行协商，达成多数认同主节点故障的共识（防止出故障的不是主节点，而是负责发现故障的哨兵节点，该情况经常发生于哨兵节点的网络被孤立的场景下）。后哨兵节点之间使用 <code v-pre>Raft</code> 算法选举出一个领导角色，由该节点负责后续的故障转移工作，哨兵领导者开始执行故障转移：\n<ul>\n<li>在从节点集合中选择一个作为新主节点</li>\n<li>让其他从节点同步新主节点</li>\n</ul>\n</li>\n<li>通知：通知应用层转移到新主节点</li>\n</ol>\n<h4 id=\"_1-3-2-部署\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-3-2-部署\"><span>1.3.2.部署</span></a></h4>\n<p>由于带有哨兵节点的分布式架构，直接本机部署多个数据节点和哨兵节点是有些麻烦的，因此为了演示方便，这里将会使用 <code v-pre>Docker Compose</code> 统一管理多个数据节点容器和多个哨兵节点容器。</p>\n<div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>注意：如果您没有学习过 <code v-pre>Docker</code> 相关的知识，其实也很难理解后面的集群知识，因此这里建议学习过一些 <code v-pre>Docker</code> 的操作和原理再来继续查阅本文档...</p>\n</div>\n<h5 id=\"_1-3-2-1-准备工作\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-3-2-1-准备工作\"><span>1.3.2.1.准备工作</span></a></h5>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 准备工作</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 安装编排工具</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> apt</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> install</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker-compose</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker-compose</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -v</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Docker</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Compose</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> version</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> v2.26.1</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 停止原有服务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> stop</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># $ sudo systemctl stop redis-sentinel # 如果有的话</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 拉取最新镜像</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> pull</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis:latest</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"hint-container caution\">\n<p class=\"hint-container-title\">警告</p>\n<p>警告：建议和我相同版本。</p>\n</div>\n<h5 id=\"_1-3-2-2-主从编排\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-3-2-2-主从编排\"><span>1.3.2.2.主从编排</span></a></h5>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 编排主从</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> vim</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/redis/redis-data/docker-compose.yml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/redis/redis-data/docker-compose.yml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">services:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis1:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-node-1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-server</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> --appendonly</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> yes</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6379:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis2:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-node-2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-server</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> --appendonly</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> yes</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> --slaveof</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-node-1</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6380:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis3:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-node-3</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-server</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> --appendonly</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> yes</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> --slaveof</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-node-1</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6381:6379</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>上述配置文件描述了三个节点容器，一个主节点容器，两个从节点容器（都开启 <code v-pre>AOP</code> 持久化）。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 启动指令</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 根据不同编排配置启动分布式</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cd</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/redis/redis-data</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker-compose</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> up</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -d</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看默认的网络</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> network</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ls</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">NETWORK</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ID</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">     NAME</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">                 DRIVER</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    SCOPE</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">efe47f88acdc</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   redis-data_default</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        bridge</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    local</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 注意: 这个网络名称是根据 \"编排配置文件所在目录名称 + _default\" 得到的</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> network</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> inspect</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-data_default</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Name</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-data_default</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Id</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">8533d02081e2576057d6838168e5e1d6e87f5daba69a1ea7d69e51fd4cd151a5</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Created</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">2024-12-05T13:47:48.417830084+08:00</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Scope</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">local</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Driver</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">bridge</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">EnableIPv6</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">false</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPAM</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Driver</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">default</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Options</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: null,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Config</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                    \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Subnet</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.20.0.0/16</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                    \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Gateway</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.20.0.1</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">            ]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Internal</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">false</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Attachable</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">false</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Ingress</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">false</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">ConfigFrom</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Network</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">ConfigOnly</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">false</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Containers</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">5680ccfbbc0ff83424c2472f5993a40d181308919bf6a0d4c5e7629e0d70f986</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Name</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-node-1</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">EndpointID</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">63fb132ccd54ae3cd7aa2c84ca7d66c8b7ea55a2f6945f47ccf42b065f635cc3</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">MacAddress</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">02:42:ac:14:00:03</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv4Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.20.0.3/16</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv6Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">6542ad572406c4a42f4cdc470f7bc7a11efa434709976b961ffb5bca6fb6a9c0</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Name</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-node-2</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">EndpointID</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">23dd68fec78289df8ac836cf4d91b04bc541847339a9a1b2d59d08ab285511ec</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">MacAddress</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">02:42:ac:14:00:04</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv4Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.20.0.4/16</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv6Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">f848db6f4005b6884cfeedbb3fe8beec5d3a51fde536305c2c756e6fa6999f80</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Name</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-node-3</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">EndpointID</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">4b7fe30897519d432fd4ff9a30b7c36baddfa8c8665b847cc109dc4ce1999c98</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">MacAddress</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">02:42:ac:14:00:02</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv4Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.20.0.2/16</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv6Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Options</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {},</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Labels</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">com.docker.compose.network</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">default</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">com.docker.compose.project</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-data</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">com.docker.compose.version</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">2.26.1</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 检查主从运行情况</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">info</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replication</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># Replication</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">role:master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">connected_slaves:2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave0:ip</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">=172.20.0.4,port=6379,state=online,offset=252,lag=0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave1:ip</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">=172.20.0.2,port=6379,state=online,offset=252,lag=0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_failover_state:no-failover</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_replid:8d4657bef20c6a9b9e260f04fe86a919fdc2db1f</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_replid2:0000000000000000000000000000000000000000</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_repl_offset:252</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">second_repl_offset:-1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_active:1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_size:1048576</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_first_byte_offset:1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_histlen:252</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">set</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> my_key</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 114514</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">OK</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> my_key</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"114514\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6380</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6380</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> my_key</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"114514\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6380</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6381</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6381</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> my_key</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"114514\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6381</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h5 id=\"_1-3-2-3-哨兵编排\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-3-2-3-哨兵编排\"><span>1.3.2.3.哨兵编排</span></a></h5>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 编排哨兵</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> vim</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/redis/redis-sentinel/docker-compose.yml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/redis/redis-sentinel/docker-compose.yml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">networks:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis-data_default:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    external:</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> true</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 表示网络来自外部</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">services:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  sentinel1:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-sentinel-1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    networks:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-data_default</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-server /etc/redis-config/redis.conf --sentinel</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    volumes:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">./sentinel2:/etc/redis-config</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 26379:26379</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  sentinel2:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-sentinel-2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    networks:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-data_default</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-server /etc/redis-config/redis.conf --sentinel</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    volumes:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">./sentinel2:/etc/redis-config</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 26380:26379</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  sentinel3:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-sentinel-3</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    networks:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-data_default</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-server /etc/redis-config/redis.conf --sentinel</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    volumes:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">./sentinel3:/etc/redis-config</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 26381:26379</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>每个哨兵节点其实在一开始都使用同一份内容配置文件，但是被我分开为三个配置文件 ，且每个哨兵节点都在监视主节点，三个节点的总票数为 <code v-pre>3</code> 只需要 <code v-pre>2</code> 张票即可判定主节点下线。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">  # 先查看现有的 Redis 主数据节点分配到的 ip 地址</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> network</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> inspect</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-data_default</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># ...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">            \"5680ccfbbc0ff83424c2472f5993a40d181308919bf6a0d4c5e7629e0d70f986\"</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">                \"Name\"</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-node-1</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">                \"EndpointID\"</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">63fb132ccd54ae3cd7aa2c84ca7d66c8b7ea55a2f6945f47ccf42b065f635cc3</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">                \"MacAddress\"</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">02:42:ac:14:00:03</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">                \"IPv4Address\"</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.20.0.3/16</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">                \"IPv6Address\"</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># ...</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 编写配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cd</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/redis/redis-sentinel</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> mkdir</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sentinel1</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sentinel2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sentinel3</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> vim</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sentinel1/redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bind</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0.0.0.0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">port</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 26379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> monitor</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.3</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 警告: 不允许使用容器名称替换 ip 地址</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> down-after-milliseconds</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1000</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 这里标识 sentinel monitor 主节点名 主节点ip 主节点端口 法定票数</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 复制三份配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cp</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  sentinel1/redis.conf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sentinel2/redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cp</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sentinel1/redis.conf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sentinel3/redis.conf</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看文件目录结构</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> $</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> tree</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -L</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker-compose.yml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sentinel1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">│</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sentinel2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">│</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">└──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sentinel3</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    └──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis.conf</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"hint-container caution\">\n<p class=\"hint-container-title\">警告</p>\n<p>警告：<code v-pre>redis-sentinel</code> 在运行过此中可能会对配置进行 <code v-pre>rewrite(重写)</code> 导致文件内容发生修改，如果用一份文件，就可能出现修改混乱的情况（例如三个哨兵节点监视的主节点失效后，就需要更改配置文件中主节点的 <code v-pre>ip</code> 和 <code v-pre>port</code>）。</p>\n</div>\n<div class=\"hint-container caution\">\n<p class=\"hint-container-title\">警告</p>\n<p>警告：将三个 <code v-pre>redis.conf</code> 放在各个目录中是必要的，我也不太清楚原因，但是我确实有搜索到 <a href=\"https://stackoverflow.com/questions/70384566/warning-sentinel-was-not-able-to-save-the-new-configuration-on-disk-device\" target=\"_blank\" rel=\"noopener noreferrer\">相关的资料</a>，不过也没有详细解释原因...</p>\n</div>\n<div class=\"hint-container caution\">\n<p class=\"hint-container-title\">警告</p>\n<p>补充：之前的 <code v-pre>redis</code> 数据节点之所以可以直接使用 <code v-pre>redis-master</code> 名称作为域名解析，是因为编排文件默认生成一个局域网，三个数据节点处于同一个局域网 <code v-pre>redis-data_default</code> 中。因此 <code v-pre>docker</code> 可以根据默认 <code v-pre>DNS</code> 解析得到容器在局域网中的 <code v-pre>ip</code>，但是貌似因为 <code v-pre>Redis</code> 最新版本中没有完全为哨兵节点适配这个问题，因此后面的三份 <code v-pre>redis.conf</code> 配置文件是根据前面分配给主数据节点的 <code v-pre>ip</code> 硬编码进去的，这里也有一些相关资料供您参考...</p>\n<ul>\n<li><a href=\"https://blog.csdn.net/weixin_63028438/article/details/136077092\" target=\"_blank\" rel=\"noopener noreferrer\">CSDN 相关资料</a></li>\n<li><a href=\"https://stackoverflow.com/questions/57464443/redis-sentinel-throws-error-cant-resolve-master-instance-hostname\" target=\"_blank\" rel=\"noopener noreferrer\">堆栈溢出相关资料</a></li>\n<li><a href=\"https://redis.io/docs/latest/operate/oss_and_stack/management/sentinel/#ip-addresses-and-dns-names\" target=\"_blank\" rel=\"noopener noreferrer\">Redis 官方文档</a></li>\n</ul>\n</div>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 启动指令</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> $</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cd</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/redis/redis-sentinel/</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> $</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker-compose</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> up</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -d</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> $</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker-compose</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ls</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> NAME</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">                STATUS</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">              CONFIG</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> FILES</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">redis-data</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">          running</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">3</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">          /etc/redis/redis-data/docker-compose.yml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">redis-sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">      running</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">3</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">          /etc/redis/redis-sentinel/docker-compose.yml</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>上述配置文件描述了三个哨兵节点容器，分别监听配置文件里规定的数据节点容器。</p>\n<h5 id=\"_1-3-2-4-现象观察\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-3-2-4-现象观察\"><span>1.3.2.4.现象观察</span></a></h5>\n<figure><img src=\"@source/4.业务服务/3.缓存服务/assets/未命名文件.png\" alt=\"\" tabindex=\"0\" loading=\"lazy\"><figcaption></figcaption></figure>\n<p>根据配置文件<code v-pre>docker</code> 网络应该符合上图，我们可以简单查看一下。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看网络</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> network</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> inspect</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-data_default</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Name</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-data_default</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Id</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">8533d02081e2576057d6838168e5e1d6e87f5daba69a1ea7d69e51fd4cd151a5</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Created</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">2024-12-05T13:47:48.417830084+08:00</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Scope</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">local</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Driver</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">bridge</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">EnableIPv6</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">false</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPAM</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Driver</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">default</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Options</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: null,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Config</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                    \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Subnet</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.20.0.0/16</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                    \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Gateway</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.20.0.1</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">            ]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Internal</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">false</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Attachable</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">false</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Ingress</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">false</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">ConfigFrom</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Network</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">ConfigOnly</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">false</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Containers</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">30fc3d7275e9e5c3a252c9838af4df3e0dcdb3d7aaa491247117b32c0d1733fd</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Name</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-sentinel-1</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">EndpointID</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">897b230ed7894a039328c8cac06a0eafb28c12b714814873e8693696d2243696</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">MacAddress</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">02:42:ac:14:00:05</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv4Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.20.0.5/16</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv6Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">3b3913ebe84f1997aaed3b4e632b33a62b324c77e614b8ad3bdc0866411f0cc4</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Name</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-sentinel-3</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">EndpointID</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">60092aabd2445d68477326529fe604b6daecc46bb5ddd7dbdc6c63ef1c5eee3b</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">MacAddress</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">02:42:ac:14:00:07</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv4Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.20.0.7/16</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv6Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">5680ccfbbc0ff83424c2472f5993a40d181308919bf6a0d4c5e7629e0d70f986</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Name</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-node-1</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">EndpointID</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">63fb132ccd54ae3cd7aa2c84ca7d66c8b7ea55a2f6945f47ccf42b065f635cc3</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">MacAddress</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">02:42:ac:14:00:03</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv4Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.20.0.3/16</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv6Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">6542ad572406c4a42f4cdc470f7bc7a11efa434709976b961ffb5bca6fb6a9c0</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Name</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-node-2</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">EndpointID</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">23dd68fec78289df8ac836cf4d91b04bc541847339a9a1b2d59d08ab285511ec</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">MacAddress</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">02:42:ac:14:00:04</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv4Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.20.0.4/16</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv6Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">7803c0046b724adcd30524b4241cd0f9d0aa17db187c08a3cf3e3dbd6b147d1b</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Name</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-sentinel-2</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">EndpointID</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">c6186ef8769b3719dfbafbc261471a65717ad88acd4e0571e220c7fd0c906fe5</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">MacAddress</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">02:42:ac:14:00:06</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv4Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.20.0.6/16</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv6Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">f848db6f4005b6884cfeedbb3fe8beec5d3a51fde536305c2c756e6fa6999f80</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Name</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-node-3</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">EndpointID</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">4b7fe30897519d432fd4ff9a30b7c36baddfa8c8665b847cc109dc4ce1999c98</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">MacAddress</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">02:42:ac:14:00:02</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv4Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.20.0.2/16</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv6Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Options</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {},</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Labels</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">com.docker.compose.network</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">default</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">com.docker.compose.project</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-data</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">com.docker.compose.version</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">2.26.1</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 观察现象</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看哨兵节点日志</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> container</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> logs</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-sentinel-1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 06:45:37.907</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> oO0OoO0OoO0Oo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Redis</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> is</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> starting</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> oO0OoO0OoO0Oo</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 06:45:37.907</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Redis</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> version=7.4.1,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> bits=64,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> commit=00000000,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> modified=0,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> pid=1,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> just</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> started</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 06:45:37.907</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Configuration</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> loaded</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 06:45:37.907</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> monotonic</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> clock:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> POSIX</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> clock_gettime</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 06:45:37.908</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Running</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> mode=sentinel,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> port=26379.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 06:45:37.908</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ID</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> is</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 37d3396d0d849849aae8412b320123e38a774f7f</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 06:45:37.908</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # +monitor master redis-master 172.20.0.3 6379 quorum 2 # 开始监控主节点, 并且配置仲裁数量为 2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 06:45:39.973</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> +sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 37d3396d0d849849aae8412b320123e38a774f7f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.6</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 26379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> @</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.3</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 注册一个哨兵节点监控主数据节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 06:45:39.979</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> new</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> configuration</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> saved</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> on</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> disk</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 06:45:39.981</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> +sentinel-address-switch</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.3</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ip</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.5</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> port</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 26379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> for</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 37d3396d0d849849aae8412b320123e38a774f7f</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 注册一个哨兵节点监控主数据节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 06:45:39.983</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> new</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> configuration</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> saved</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> on</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> disk</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 06:45:39.992</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> +sentinel-address-switch</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.3</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ip</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.7</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> port</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 26379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> for</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4ac62e0c7bde83b4acd18aa35bb544a7936f1a30</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 注册一个哨兵节点监控主数据节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 06:45:39.995</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> new</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> configuration</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> saved</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> on</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> disk</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 哨兵节点加载并且保存了新的配置到磁盘中</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sentinel1/redis.conf</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bind</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0.0.0.0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">port</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 26379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> monitor</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.3</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> down-after-milliseconds</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1000</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># Generated by CONFIG REWRITE  # 这一部分也是新增加的部分, 是哨兵节点写入的, 我们需要分开三个配置文件书写的原因就是因为哨兵节点会对配置文件进行修改</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">dir</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/data</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # Redis Sentinel 工作目录</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">latency-tracking-info-percentiles</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 50</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 99</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 99.9</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 配置延迟跟踪的百分位</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">user</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> default</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> on</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nopass</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sanitize-payload</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ~</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">*</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> &#x26;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> +@all </span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 配置默认用户的权限及认证方式</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> myid</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> b6acb72ff13c744f8559c5582f97490af5dfa5c0</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 当前哨兵节点的唯一标识符</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> config-epoch</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 配置主节点的纪元值, 用于主节点选举时的版本控制</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> leader-epoch</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 记录当前哨兵选举过程中被选中的主节点的纪元</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> current-epoch</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 当前哨兵的纪元 </span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> known-replica</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.2</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 声明一个已知的副本节点(从数据节点)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> known-replica</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.4</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 声明一个已知的副本节点(从数据节点)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> known-sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.6</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 26379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4ac62e0c7bde83b4acd18aa35bb544a7936f1a30</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 已知的其他哨兵节点信息</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> known-sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.7</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 26379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 37d3396d0d849849aae8412b320123e38a774f7f</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 已知的其他哨兵节点信息</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 模拟主节点挂掉</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> container</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> stop</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-node-1</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 重新查看日志</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> container</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> logs</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-node-1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># (省略) ...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:32.069</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # +sdown master redis-master 172.20.0.3 6379 # 本哨兵节点检测到主节点失效(主观下线)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:32.131</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # +odown master redis-master 172.20.0.3 6379 #quorum 2/2 # 所有哨兵节点通过投票决定该主数据节点已经完全不可用(客观下线), 这里的 quorum 意为多数同意</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># >>> begin: 开始故障转移 >>></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:32.131</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # +new-epoch 1 # 创建了一个新的选举周期, 标识为 1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:32.131</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # +try-failover master redis-master 172.20.0.3  # 开始尝试进行主节点故障转移</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:32.137</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> new</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> configuration</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> saved</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> on</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> disk</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # Sentinel 已经将新的配置加载的磁盘中</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:32.137</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # +vote-for-leader 37d3396d0d849849aae8412b320123e38a774f7f 1 # 选举新的领导</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:32.137</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 37d3396d0d849849aae8412b320123e38a774f7f</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> voted</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> for</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 37d3396d0d849849aae8412b320123e38a774f7f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:32.141</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4ac62e0c7bde83b4acd18aa35bb544a7936f1a30</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> voted</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> for</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 37d3396d0d849849aae8412b320123e38a774f7f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:32.214</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # +elected-leader master redis-master 172.20.0.3 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:32.214</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # +failover-state-select-slave master redis-master 172.20.0.3 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:32.305</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # +selected-slave slave 172.20.0.2:6379 172.20.0.2 6379 @ redis-master 172.20.0.3 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:32.305</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> +failover-state-send-slaveof-noone</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.20.0.2:6379</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.2</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> @</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.3</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:32.456</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> +failover-state-wait-promotion</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.20.0.2:6379</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.2</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> @</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.3</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:33.393</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> new</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> configuration</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> saved</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> on</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> disk</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:33.393</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # +promoted-slave slave 172.20.0.2:6379 172.20.0.2 6379 @ redis-master 172.20.0.3 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:33.393</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # +failover-state-reconf-slaves master redis-master 172.20.0.3 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:33.449</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> +slave-reconf-sent</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.20.0.4:6379</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.4</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> @</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.3</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:34.393</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> +slave-reconf-inprog</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.20.0.4:6379</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.4</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> @</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.3</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:34.393</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> +slave-reconf-done</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.20.0.4:6379</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.4</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> @</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.3</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:34.455</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # +failover-end master redis-master 172.20.0.3 6379 # 完成故障转移</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># &#x3C;&#x3C;&#x3C; end &#x3C;&#x3C;&#x3C;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:34.455</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # +switch-master redis-master 172.20.0.3 6379 172.20.0.2 6379 # 切换主节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:34.455</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> +slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.20.0.4:6379</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.4</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> @</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.2</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 更新新的从节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:34.455</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> +slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.20.0.3:6379</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.3</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> @</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.2</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 更新新的从节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:34.457</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> new</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> configuration</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> saved</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> on</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> disk</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:35.506</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # +sdown slave 172.20.0.3:6379 172.20.0.3 6379 @ redis-master 172.20.0.2 6379</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 重新访问新的主节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> container</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ls</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> |</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> grep</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">30fc3d7275e9</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">   \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">docker-entrypoint.s…</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">   2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> hours</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ago</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   Up</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> hours</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   6379/tcp,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 0.0.0.0:26379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">-</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">26379/tcp,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> :::26379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">-</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">26379/tcp</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">     redis-sentinel-1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">7803c0046b72</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">   \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">docker-entrypoint.s…</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">   2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> hours</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ago</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   Up</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> hours</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   6379/tcp,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 0.0.0.0:26380</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">-</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">26379/tcp,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [::]:26380-</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">26379/tcp   redis-sentinel-2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">3b3913ebe84f</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">   \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">docker-entrypoint.s…</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">   2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> hours</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ago</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   Up</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> hours</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   6379/tcp,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 0.0.0.0:26381</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">-</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">26379/tcp,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [::]:26381-</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">26379/tcp   redis-sentinel-3</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">6542ad572406</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">   \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">docker-entrypoint.s…</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">   3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> hours</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ago</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   Up</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> hours</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   0.0.0.0:6380</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">-</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">6379/tcp,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [::]:6380-</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">6379/tcp                 redis-node-2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">f848db6f4005</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">   \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">docker-entrypoint.s…</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">   3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> hours</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ago</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   Up</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> hours</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   0.0.0.0:6381</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">-</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">6379/tcp,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [::]:6381-</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">6379/tcp                 redis-node-3</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 进入客户端</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6380</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看最新配置</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6380</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">info</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replication</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># Replication</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">role:slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_host:172.20.0.2</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 容器内部的 id</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_port:6379</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 容器内部的 port</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_link_status:up</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_last_io_seconds_ago:1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_sync_in_progress:0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave_read_repl_offset:1465716</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave_repl_offset:1465716</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave_priority:100</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave_read_only:1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">replica_announced:1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">connected_slaves:0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_failover_state:no-failover</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_replid:d6cda86c05c8b419d7d5a8775c9ee7478d2c451e</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_replid2:8d4657bef20c6a9b9e260f04fe86a919fdc2db1f</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_repl_offset:1465716</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">second_repl_offset:808512</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_active:1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_size:1048576</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_first_byte_offset:408801</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_histlen:1056916</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 检查是否只读</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6381</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">config</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica-read-only</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">replica-read-only</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">yes</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 取消只读配置</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6381</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">config</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> set</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica-read-only</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> no</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">OK</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 测试是否发生主从复制</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6381</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">set</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> my_key</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">1433223</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">OK</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6381</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> my_key</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"1433223\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6381</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6380</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6380</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> my_key</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"1433223\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6380</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 回复旧的主节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> container</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> start</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-node-1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">redis-node-1</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> my_key</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"114514\"</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 还没有更改, 因为是懒加载的</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6381</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6381</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> my_key</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">8848</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6381</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> my_key</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"8848\"</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 这意味着这个旧主节点已经完全变为了新从节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：关于数据节点下线的判断。</p>\n<ul>\n<li>主观下线（<code v-pre>Subjectively Down, SDown</code>）：哨兵感知到主节点没心跳了，判定为主观下线</li>\n<li>客观下线（<code v-pre>Objectively Down, ODown</code>）: 多个哨兵达成一致意见，才能认为 <code v-pre>master</code> 确实下线了</li>\n</ul>\n</div>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：在进行主从切换时，所有参与的哨兵节点都会更新自己的配置，并带上当前的 <code v-pre>epoch</code> 标识，也就是所谓的“选举周期标识”。这样，其他哨兵节点就能知道哪个节点是最新的领导者，避免出现重复的操作。</p>\n</div>\n<div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>注意：哨兵节点最好是有奇数个，方便选举 <code v-pre>leader</code>，故障得票也更容易超过半数。</p>\n</div>\n<div class=\"hint-container caution\">\n<p class=\"hint-container-title\">警告</p>\n<p>警告：“主从复制+哨兵节点”的无人值守模式提高了高可用性，降低的运维成本，但也无法避免极端数据丢失的情况，并且也无法解决内存容量不够的问题，主节点所在的机器能存储的最多数据只和本机内存条有关，和其他从节点所在的机器的内存条是不会叠加的，毕竟从节点只是复制了主节点的数据而已。</p>\n</div>\n<h4 id=\"_1-3-3-原理\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-3-3-原理\"><span>1.3.3.原理</span></a></h4>\n<p>还是根据我们的架构图，<span style=\"text-emphasis:filled red;\">阐述一下 <code v-pre>Raft</code> 选举算法原理，待补充...</span></p>\n<figure><img src=\"@source/4.业务服务/3.缓存服务/assets/image-20241205170206256.png\" alt=\"\" tabindex=\"0\" loading=\"lazy\"><figcaption></figcaption></figure>\n<h2 id=\"_2-redis-写分离架构-多分片架构\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-redis-写分离架构-多分片架构\"><span>2.Redis 写分离架构/多分片架构</span></a></h2>\n<h3 id=\"_2-1-架构原理\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-1-架构原理\"><span>2.1.架构原理</span></a></h3>\n<p>如果我们把上述的读分离结构看作一个小集群，那么多个读分离结构就是一个大集群。这样做就会有多个主节点可以被写入，假定数据是 <code v-pre>1 TB</code> 的话，有三个这样的小集群，就可以根据分片算法，每个小集群存储数据集的 <code v-pre>1/3 TB</code> 即可。这样做既解决了读压力过大的问题又解决了写存储不够的问题。</p>\n<figure><img src=\"@source/4.业务服务/3.缓存服务/assets/高可用集群.png\" alt=\"\" tabindex=\"0\" loading=\"lazy\"><figcaption></figcaption></figure>\n<p><code v-pre>Redis</code> 有什么必要需要这么做么？有，例如搜索引擎，这种需求对读写响应速度是强需求，对海量数据存储也是强需求。</p>\n<h3 id=\"_2-2-分片算法\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-2-分片算法\"><span>2.2.分片算法</span></a></h3>\n<p>一个小集群相当于一个分片，可是直接引入某种机制一定会造成某些问题，假设给定数据全集</p>\n<ul>\n<li>这些数据应该写入到哪一个分片上？</li>\n<li>这些数据应该读出到哪一个分片上？</li>\n</ul>\n<h4 id=\"_2-2-1-哈希求余算法\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-2-1-哈希求余算法\"><span>2.2.1.哈希求余算法</span></a></h4>\n<p>假设有 <code v-pre>N</code> 个分片，使用<code v-pre>[0, N-1]</code> 的顺序进行编号，针对某个键值对，根据键名通过算法（例如 <code v-pre>md5</code> 算法）得到哈希值结果，再使用 <code v-pre>%N</code> 来求余，最终余数就是分片编号，根据计算出来的编号存储键值对即可。而读取的问题也是，根据想要获取键值对的键名，依葫芦画瓢得到对应的分片编号后，最对应的分区中查找即可。</p>\n<p>这种方式简单高效，数据分配相对均匀（其实表现一般），但缺点就是拓展性差，一旦分区数量增加，就会导致原有的映射规则被破坏，一旦需要扩容就需要重新对所有的键值对进行分区，数据在节点之间多次流动以满足新的映射规则，这增加了维护成本。并且在业务中如果发生分区拓展，造成的数据流动会影响业务的正常读写，有可能导致严重的数据一致性问题。迁移的过程中一旦发生数据丢失，就会导致数据丢失的严重情况。</p>\n<h4 id=\"_2-2-2-一致性哈希算法\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-2-2-一致性哈希算法\"><span>2.2.2.一致性哈希算法</span></a></h4>\n<figure><img src=\"@source/4.业务服务/3.缓存服务/assets/yzxhxsf.png\" alt=\"\" tabindex=\"0\" loading=\"lazy\"><figcaption></figcaption></figure>\n<p>换一种思路，我们不再进行简单的求余，把 <span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">[</mo><mn>0</mn><mo separator=\"true\">,</mo><msup><mn>2</mn><mn>32</mn></msup><mo>−</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">[0, 2^{32}-1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">32</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span> 这个数据空间映射到一个圆环上，数据按照顺时针的方向增长，键值对的键名映射为哈希值 <code v-pre>H</code> 后，假设我们有 <code v-pre>N</code> 个分片，人为设置分布在圆环上的 <code v-pre>N</code> 个点的位置上（分片点）。然后根据 <code v-pre>H</code> 在圆环上的位置，顺时针往下寻找分片点，遇到第一个分片点就把键值对存储到对应的分片中。</p>\n<p>这种分配方式相当于把所有的哈希值的可能取值都提前做好了分区，如果需要扩容，就可以在某两个分片之间新建一个分片点，新的分片点将夺取前一个分片点的部分数据（分片点按照顺时针顺序分前后），这样每分一个分片就会增加存储量，减少前一个分片的压力。大大减少了扩容时数据搬运的规模，提高了扩容操作的效率，同时不影响业务读写。但缺点就是有可能发生数据分配不均匀，导致数据倾斜。</p>\n<p>为此 一致性哈希做了更多的优化，也就是 <code v-pre>虚拟节点</code>。 当节点较少的时候，为每个物理节点 <code v-pre>创建多个虚拟节点</code>，使所有的节点 <code v-pre>均匀的分布</code> 在 <code v-pre>Hash</code> 环上 ， 从而使数据<code v-pre>相对均衡</code>。当数据操作请求进来时 ， 如果指向了虚拟节点，就映射到实际的物理节点中。通过这样的方式，就可以保证数据的相对均衡。 当然，这种均衡还是相对的。</p>\n<p>另外，更加严重的问题是，如果某个节点集群发生雪崩（当大量读写涌入时，无论如何更替主从节点，最后整个节点集群还是会刮掉），但是后续的节点集群如果负荷能力甚至都比前面节点集群要小，就会导致后续的节点集群继续承接读写压力，过一段时间再次崩溃，一直往后就会造成雪崩的问题。这种问题轻微会导致数据倾斜、部分数据丢失，严重会导致整个 <code v-pre>Redis</code> 大集群（也就是圆环上所有的节点集群）失去响应。尽管有人提出了虚拟节点的方式来解决这个问题，但是也会增加系统的复杂度和维护难度。</p>\n<h4 id=\"_2-2-3-哈希槽算法\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-2-3-哈希槽算法\"><span>2.2.3.哈希槽算法</span></a></h4>\n<figure><img src=\"@source/4.业务服务/3.缓存服务/assets/img_v3_02ha_93cb8443-7827-4a14-88bf-aec811367b6g.jpg\" alt=\"\" tabindex=\"0\" loading=\"lazy\"><figcaption></figcaption></figure>\n<p>上述两种方式一是导致扩容成本高，二是导致分配不均匀，因此 <code v-pre>Redis cluster</code> 就引入了哈希槽算法（例如使用 <span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>h</mi><mi>a</mi><mi>s</mi><mi>h</mi><mi mathvariant=\"normal\">_</mi><mi>s</mi><mi>l</mi><mi>o</mi><mi>t</mi><mo>=</mo><mi>c</mi><mi>r</mi><mi>c</mi><mn>16</mn><mo stretchy=\"false\">(</mo><mi>k</mi><mi>e</mi><msub><mi>y</mi><mi>n</mi></msub><mi>a</mi><mi>m</mi><mi>e</mi><mo stretchy=\"false\">)</mo><mi mathvariant=\"normal\">%</mi><mn>16384</mn></mrow><annotation encoding=\"application/x-tex\">hash\\_slot = crc16(key_name) \\% 16384</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0044em;vertical-align:-0.31em;\"></span><span class=\"mord mathnormal\">ha</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">h</span><span class=\"mord\" style=\"margin-right:0.02778em;\">_</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">crc</span><span class=\"mord\">16</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mord mathnormal\">e</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\">am</span><span class=\"mord mathnormal\">e</span><span class=\"mclose\">)</span><span class=\"mord\">%16384</span></span></span></span> 的到哈希值）。<code v-pre>Redis cluster</code>采用数据分片的哈希槽来进行数据存储和数据的读取，<code v-pre>Redis cluster</code> 一共有 <span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mn>14</mn></msup><mo>=</mo><mn>16384</mn></mrow><annotation encoding=\"application/x-tex\">2^{14}=16384</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">14</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">16384</span></span></span></span>个槽，所有的 <code v-pre>master</code> 节点都会有一个槽区，比如 <span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">[</mo><mn>0</mn><mo separator=\"true\">,</mo><mn>1000</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">[0, 1000)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">1000</span><span class=\"mclose\">)</span></span></span></span>，槽数是可以迁移的。<code v-pre>master</code>节点的 <code v-pre>slave</code> 节点不分配槽，只拥有读权限。第一次新建 <code v-pre>Redis cluster</code> 时，<code v-pre>16384</code> 个槽是被 <code v-pre>master</code> 节点均匀分布的。</p>\n<p>哈希槽不是闭合的，并且一个键值对的键名计算得到哈希值后，是固定在某一个区域的，不会像一致性算法一样出现大面积雪崩的情况，哪怕是某一个节点集群故障了，也不会导致大量的读写压力转移到别的节点上，仍能保持业务一定的活性。</p>\n<p>并且扩容机制和一致性算法有些类似，但由于映射区域固定（一致性算法是遇到主节点才存储），也可以避免大面积的传输，是兼顾多方面的好手。</p>\n<h3 id=\"_2-3-搭建集群\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-3-搭建集群\"><span>2.3.搭建集群</span></a></h3>\n<p>前面的话太空，这里依旧是使用单机部署集群，真正意义上的跨主机集群，需要使用 <code v-pre>k8s</code> 来操作。在单机部署上，使用 <code v-pre>docker-compose</code> 模拟 <code v-pre>k8s</code> 工具，一个容器就是一台裸机。我们需要 <code v-pre>11</code> 个 <code v-pre>Redis</code> 节点，其中 <code v-pre>9</code> 个用来演示集群的搭建，<code v-pre>2</code> 个用作后续扩容缩容准备。</p>\n<h4 id=\"_2-3-1-设置目录\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-3-1-设置目录\"><span>2.3.1.设置目录</span></a></h4>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 设置目录</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cd</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/redis/</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> mkdir</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cluster</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cd</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cluster</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> touch</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker-compose.yml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> touch</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> generate.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> touch</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> dissipate.sh</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h4 id=\"_2-3-2-脚本文件\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-3-2-脚本文件\"><span>2.3.2.脚本文件</span></a></h4>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 脚本文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cd</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/redis/redis-cluster</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> vim</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> generate.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> generate.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># !/bin/bash</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 集群节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">for</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> port</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> $(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">seq</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 9</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">do</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    mkdir</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">${</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">port</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    touch</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">${</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">port</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    cat</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;&#x3C;</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> EOF</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> ></span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">${</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">port</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">/redis.conf</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 两个 EOF 之间的多行文本会被全部输入到 cat 中</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">port 6379 # 容器内的 PORT</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">bind 0.0.0.0 # 容器内的 IP</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">protected-mode no # 关闭保护模式(原本是会屏蔽掉一些不安全的访问的)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">appendonly yes # 开启 AOF 持久化</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster-enabled yes # 开启集群模式</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster-config-file nodes.conf # 指定集群配置文件的名称, 节点可以通过读取该文件来解集群的状态</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster-node-timeout 5000 # 设置集群节点超时时间</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster-announce-ip 172.30.0.10</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">${</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">port</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> # 向集群中的其他节点宣告自己的集群网络 IP</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster-announce-port 6379 # 向集群中的其他节点宣告自己的集群网络 PORT</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster-announce-bus-port 16379 # 集群内部节点之间的通信总线端口(集群管理的信息交互是通过这个端口进行的)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">EOF</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">done</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 备用节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">for</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> port</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> $(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">seq</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 10</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 11</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">do</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    mkdir</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">${</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">port</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    touch</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">${</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">port</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    cat</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;&#x3C;</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> EOF</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> ></span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">${</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">port</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">/redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">port 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">bind 0.0.0.0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">protected-mode no</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">appendonly yes</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster-enabled yes</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster-config-file nodes.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster-node-timeout 5000</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster-announce-ip 172.30.0.1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">${</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">port</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster-announce-port 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster-announce-bus-port 16379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">EOF</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">done</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> vim</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> dissipate.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> dissipate.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># !/bin/bash</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">rm</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -rf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">*</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 去除上述注释后运行脚本</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> bash</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> generate.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ls</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">dissipate.sh</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  generate.sh</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  redis1</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  redis10</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  redis11</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  redis2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  redis3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  redis4</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  redis5</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  redis6</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  redis7</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  redis8</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  redis9</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> tree</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -L</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> dissipate.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> generate.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">│</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis10</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">│</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis11</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">│</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">│</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis3</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">│</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis4</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">│</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis5</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">│</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis6</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">│</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis7</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">│</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis8</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">│</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">└──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis9</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    └──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis.conf</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">12</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> directories,</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 13</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> files</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看配置内容是否正确</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis1/redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">port</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bind</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0.0.0.0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">protected-mode</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> no</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">appendonly</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> yes</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">cluster-enabled</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> yes</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">cluster-config-file</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">cluster-node-timeout</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 5000</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">cluster-announce-ip</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.101</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">cluster-announce-port</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">cluster-announce-bus-port</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 16379</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"hint-container caution\">\n<p class=\"hint-container-title\">警告</p>\n<p>警告：注意请删除上面脚本中的注释后再运行。</p>\n</div>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：常用目录配置结构就是，使用一个目录来标识一个 <code v-pre>Redis</code> 集群，然后目录中存放多个节点目录（可能是数据节点，也可能是哨兵节点），节点目录中存放配置文件 <code v-pre>redis.conf</code>，我们可以根据 <code v-pre>redis-server</code> 读取不同的配置文件，来决定一个节点是数据节点还是哨兵节点。</p>\n</div>\n<h4 id=\"_2-3-3-编排文件\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-3-3-编排文件\"><span>2.3.3.编排文件</span></a></h4>\n<div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>注意：之前我们使用的网络名称是根据父目录名称来得到的，但是其实我们也可以自己自定义一个，下面的配置文件就事先定义了一个集群网络。</p>\n</div>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 编排容器</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cd</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/redis/redis-cluster</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> vim</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker-compose.yml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker-compose.yml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">#  先自定义集群网络 redis-cluster-net</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">networks:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis-cluster-net:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    driver:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> bridge</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ipam:</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 配置子网 IP 地址分配规则</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      config:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> subnet:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.0/24</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 配置子网范围为 172.30.0.1 到 172.30.0.254</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">services:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis1:</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 服务名</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 指定镜像文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis1</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 生成的容器名</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 设置自动重启策略</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    deploy:</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 部署</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      resources:</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 资源</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        limits:</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 最大额度</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 512M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        reservations:</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 最小额度</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 256M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    volumes:</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 存储映射</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ./redis1:/usr/local/etc/redis</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 端口映射</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6371:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-server</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/usr/local/etc/redis/redis.conf</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">]</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 启动指令</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    networks:</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 网络配置</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      redis-cluster-net:</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 在开头定义的子网网络中</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        ipv4_address:</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.101</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 为容器指定静态的 ipv4 地址, 避免地址改动引起其他地方的修改</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis2:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    deploy:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      resources:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        limits:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 512M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        reservations:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 256M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    volumes:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ./redis2:/usr/local/etc/redis</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6372:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-server</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/usr/local/etc/redis/redis.conf</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    networks:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      redis-cluster-net:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        ipv4_address:</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.102</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis3:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis3</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    deploy:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      resources:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        limits:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 512M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        reservations:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 256M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    volumes:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ./redis3:/usr/local/etc/redis</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6373:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-server</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/usr/local/etc/redis/redis.conf</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    networks:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      redis-cluster-net:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        ipv4_address:</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.103</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis4:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis4</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    deploy:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      resources:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        limits:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 512M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        reservations:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 256M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    volumes:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ./redis4:/usr/local/etc/redis</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6374:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-server</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/usr/local/etc/redis/redis.conf</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    networks:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      redis-cluster-net:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        ipv4_address:</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.104</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis5:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis5</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    deploy:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      resources:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        limits:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 512M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        reservations:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 256M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    volumes:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ./redis5:/usr/local/etc/redis</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6375:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-server</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/usr/local/etc/redis/redis.conf</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    networks:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      redis-cluster-net:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        ipv4_address:</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.105</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis6:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis6</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    deploy:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      resources:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        limits:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 512M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        reservations:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 256M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    volumes:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ./redis6:/usr/local/etc/redis</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6376:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-server</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/usr/local/etc/redis/redis.conf</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    networks:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      redis-cluster-net:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        ipv4_address:</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.106</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis7:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis7</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    deploy:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      resources:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        limits:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 512M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        reservations:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 256M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    volumes:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ./redis7:/usr/local/etc/redis</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6377:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-server</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/usr/local/etc/redis/redis.conf</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    networks:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      redis-cluster-net:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        ipv4_address:</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.107</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis8:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis8</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    deploy:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      resources:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        limits:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 512M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        reservations:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 256M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    volumes:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ./redis8:/usr/local/etc/redis</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6378:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-server</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/usr/local/etc/redis/redis.conf</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    networks:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      redis-cluster-net:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        ipv4_address:</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.108</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis9:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis9</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    deploy:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      resources:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        limits:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 512M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        reservations:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 256M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    volumes:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ./redis9:/usr/local/etc/redis</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6379:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-server</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/usr/local/etc/redis/redis.conf</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    networks:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      redis-cluster-net:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        ipv4_address:</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.109</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis10:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis10</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    deploy:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      resources:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        limits:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 512M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        reservations:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 256M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    volumes:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ./redis10:/usr/local/etc/redis</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6380:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-server</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/usr/local/etc/redis/redis.conf</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    networks:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      redis-cluster-net:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        ipv4_address:</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.110</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis11:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis11</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    deploy:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      resources:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        limits:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 512M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        reservations:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 256M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    volumes:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ./redis11:/usr/local/etc/redis</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6381:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-server</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/usr/local/etc/redis/redis.conf</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    networks:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      redis-cluster-net:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        ipv4_address:</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.111</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h4 id=\"_2-3-4-启动指令\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-3-4-启动指令\"><span>2.3.4.启动指令</span></a></h4>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 启动指令</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 启动编排中的容器</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker-compose</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> up</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -d</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 检查容器日志是否正常</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker-compose</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ls</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">NAME</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">                STATUS</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">              CONFIG</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> FILES</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">redis-cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">       running</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">11</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">         /etc/redis/redis-cluster/docker-compose.yml</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> container</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> logs</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:C</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 06</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 12:47:43.226</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # WARNING: Changing databases number from 16 to 1 since we are in cluster mode # 这个警告表示在 Redis 集群模式下, 数据库的数量已从 16 个减少为 1 个, 在默认的 Redis 单机模式下, Redis 允许使用 16 个数据库(编号从 0 到 15), 但是在集群模式下, Redis 只支持一个数据库(即 0 号数据库)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:C</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 06</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 12:47:43.226</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> oO0OoO0OoO0Oo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Redis</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> is</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> starting</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> oO0OoO0OoO0Oo</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:C</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 06</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 12:47:43.226</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Redis</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> version=7.4.1,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> bits=64,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> commit=00000000,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> modified=0,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> pid=1,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> just</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> started</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:C</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 06</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 12:47:43.226</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Configuration</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> loaded</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:M</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 06</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 12:47:43.226</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> monotonic</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> clock:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> POSIX</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> clock_gettime</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:M</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 06</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 12:47:43.227</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Running</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> mode=cluster,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> port=6379.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:M</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 06</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 12:47:43.227</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> No</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> configuration</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> found,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> I</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">m 9922b4fb888f86437a10912ed4505f86277b6c2e</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">1:M 06 Dec 2024 12:47:43.229 * Server initialized</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">1:M 06 Dec 2024 12:47:43.230 * Creating AOF base file appendonly.aof.1.base.rdb on server start</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">1:M 06 Dec 2024 12:47:43.233 * Creating AOF incr file appendonly.aof.1.incr.aof on server start</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">1:M 06 Dec 2024 12:47:43.233 * Ready to accept connections tcp</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"># 创建集群</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">$ redis-cli --cluster create \\ # 表示创建集群</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.30.0.101:6379 172.30.0.102:6379 172.30.0.103:6379 \\ # 加入集群的节点地址</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.30.0.104:6379 172.30.0.105:6379 172.30.0.106:6379 \\ # 加入集群的节点地址</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.30.0.107:6379 172.30.0.108:6379 172.30.0.109:6379 \\ # 加入集群的节点地址</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">--cluster-replicas 2 # 表示每一个节点需要两个从节点进行备份</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"># 完整指令为 redis-cli --cluster create 172.30.0.101:6379 172.30.0.102:6379 172.30.0.103:6379 172.30.0.104:6379 172.30.0.105:6379 172.30.0.106:6379 172.30.0.107:6379 172.30.0.108:6379 172.30.0.109:6379 --cluster-replicas 2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">>>> Performing hash slots allocation on 9 nodes...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Master[0] -> Slots 0 - 5460</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Master[1] -> Slots 5461 - 10922</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Master[2] -> Slots 10923 - 16383</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Adding replica 172.30.0.105:6379 to 172.30.0.101:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Adding replica 172.30.0.106:6379 to 172.30.0.101:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Adding replica 172.30.0.107:6379 to 172.30.0.102:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Adding replica 172.30.0.108:6379 to 172.30.0.102:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Adding replica 172.30.0.109:6379 to 172.30.0.103:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Adding replica 172.30.0.104:6379 to 172.30.0.103:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">M: 9922b4fb888f86437a10912ed4505f86277b6c2e 172.30.0.101:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   slots:[0-5460] (5461 slots) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">M: e42760e10502691aa9e9791a103ac77cb707c070 172.30.0.102:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   slots:[5461-10922] (5462 slots) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">M: 4544c27547b8392cbd5b2e7afcb80c0066d37e9f 172.30.0.103:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   slots:[10923-16383] (5461 slots) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">S: 12992b85a92de26dd849f1abf012ad674da733e4 172.30.0.104:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   replicates 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">S: bce31769a218d92d5a3735458e6e479759bdd500 172.30.0.105:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   replicates 9922b4fb888f86437a10912ed4505f86277b6c2e</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">S: 9cd6418590131bf0b6fa20c046ee9bbb06f56afe 172.30.0.106:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   replicates 9922b4fb888f86437a10912ed4505f86277b6c2e</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">S: 0903a2928d09168fa3cc2f4f74c96fe926eef8ef 172.30.0.107:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   replicates e42760e10502691aa9e9791a103ac77cb707c070</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">S: bc2a17498f1c88f2d827638625e3b998b5d36abf 172.30.0.108:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   replicates e42760e10502691aa9e9791a103ac77cb707c070</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">S: fc92b4b941bc55edc638b3ed5570c77649f11124 172.30.0.109:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   replicates 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Can I set the above configuration? (type </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">yes</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to accept): yes # 这里需要输入 yes 后回车</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">>>> Nodes configuration updated</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">>>> Assign a different config epoch to each node</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">>>> Sending CLUSTER MEET messages to join the cluster</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Waiting for the cluster to join</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">>>> Performing Cluster Check (using node 172.30.0.101:6379)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">M: 9922b4fb888f86437a10912ed4505f86277b6c2e 172.30.0.101:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   slots:[0-5460] (5461 slots) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   2 additional replica(s)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">S: 0903a2928d09168fa3cc2f4f74c96fe926eef8ef 172.30.0.107:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   slots: (0 slots) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   replicates e42760e10502691aa9e9791a103ac77cb707c070</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">M: e42760e10502691aa9e9791a103ac77cb707c070 172.30.0.102:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   slots:[5461-10922] (5462 slots) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   2 additional replica(s)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">S: bc2a17498f1c88f2d827638625e3b998b5d36abf 172.30.0.108:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   slots: (0 slots) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   replicates e42760e10502691aa9e9791a103ac77cb707c070</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">S: 9cd6418590131bf0b6fa20c046ee9bbb06f56afe 172.30.0.106:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   slots: (0 slots) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   replicates 9922b4fb888f86437a10912ed4505f86277b6c2e</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">S: 12992b85a92de26dd849f1abf012ad674da733e4 172.30.0.104:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   slots: (0 slots) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   replicates 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">S: bce31769a218d92d5a3735458e6e479759bdd500 172.30.0.105:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   slots: (0 slots) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   replicates 9922b4fb888f86437a10912ed4505f86277b6c2e</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">M: 4544c27547b8392cbd5b2e7afcb80c0066d37e9f 172.30.0.103:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   slots:[10923-16383] (5461 slots) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   2 additional replica(s)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">S: fc92b4b941bc55edc638b3ed5570c77649f11124 172.30.0.109:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   slots: (0 slots) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   replicates 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">[OK] All nodes agree about slots configuration.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">>>> Check for open slots...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">>>> Check slots coverage...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">[OK] All 16384 slots covered.</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"># 查看正在运行的容器</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">$ docker container ls</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">CONTAINER ID   IMAGE          COMMAND                   CREATED          STATUS          PORTS                                         NAMES</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">25ec15dde362   redis:latest   \"docker-entrypoint.s…\"   23 minutes ago   Up 23 minutes   0.0.0.0:6377->6379/tcp, [::]:6377->6379/tcp   redis7</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">77414c90b6ea   redis:latest   \"docker-entrypoint.s…\"   23 minutes ago   Up 23 minutes   0.0.0.0:6380->6379/tcp, [::]:6380->6379/tcp   redis10</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">41dacddb4ac3   redis:latest   \"docker-entrypoint.s…\"   23 minutes ago   Up 23 minutes   0.0.0.0:6371->6379/tcp, [::]:6371->6379/tcp   redis1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">573c13c744ca   redis:latest   \"docker-entrypoint.s…\"   23 minutes ago   Up 23 minutes   0.0.0.0:6373->6379/tcp, [::]:6373->6379/tcp   redis3</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">6aa2609836c7   redis:latest   \"docker-entrypoint.s…\"   23 minutes ago   Up 23 minutes   0.0.0.0:6379->6379/tcp, :::6379->6379/tcp     redis9</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">bcbd5203f15c   redis:latest   \"docker-entrypoint.s…\"   23 minutes ago   Up 23 minutes   0.0.0.0:6381->6379/tcp, [::]:6381->6379/tcp   redis11</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">67e1aeef7b1d   redis:latest   \"docker-entrypoint.s…\"   23 minutes ago   Up 23 minutes   0.0.0.0:6378->6379/tcp, [::]:6378->6379/tcp   redis8</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">9fa7e3fb21bc   redis:latest   \"docker-entrypoint.s…\"   23 minutes ago   Up 23 minutes   0.0.0.0:6374->6379/tcp, [::]:6374->6379/tcp   redis4</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">ec8d07d38191   redis:latest   \"docker-entrypoint.s…\"   23 minutes ago   Up 23 minutes   0.0.0.0:6376->6379/tcp, [::]:6376->6379/tcp   redis6</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">5031b98a28d5   redis:latest   \"docker-entrypoint.s…\"   23 minutes ago   Up 23 minutes   0.0.0.0:6375->6379/tcp, [::]:6375->6379/tcp   redis5</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">1acb75345d10   redis:latest   \"docker-entrypoint.s…\"   23 minutes ago   Up 23 minutes   0.0.0.0:6372->6379/tcp, [::]:6372->6379/tcp   redis2</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：创建集群这一步完全可以使用</p>\n</div>\n<p>从上面的输出来看，<code v-pre>redis-cli</code> 的 <code v-pre>--cluster create</code> 命令成功地将 <code v-pre>9</code> 个 <code v-pre>Redis</code> 节点配置为一个 <code v-pre>Redis</code> 集群，并且已经自动完成了分配槽位、添加副本、以及节点之间的通信（使用的正式哈希槽算法）。回显显示的信息如下：</p>\n<ul>\n<li><strong>槽位分配</strong>：集群被划分为 <code v-pre>16384</code> 个槽位，三个主节点分别负责分配槽位：\n<ul>\n<li><code v-pre>172.30.0.101:6379</code>：负责 <code v-pre>0-5460</code> 号槽位</li>\n<li><code v-pre>172.30.0.102:6379</code>：负责 <code v-pre>5461-10922</code> 号槽位</li>\n<li><code v-pre>172.30.0.103:6379</code>：负责 <code v-pre>10923-16383</code> 号槽位</li>\n</ul>\n</li>\n<li><strong>副本添加</strong>：每个主节点都有两个副本节点：\n<ul>\n<li><code v-pre>172.30.0.101:6379</code> 有两个副本：<code v-pre>172.30.0.105:6379</code> 和 <code v-pre>172.30.0.106:6379</code></li>\n<li><code v-pre>172.30.0.102:6379</code> 有两个副本：<code v-pre>172.30.0.107:6379</code> 和 <code v-pre>172.30.0.108:6379</code></li>\n<li><code v-pre>172.30.0.103:6379</code> 有两个副本：<code v-pre>172.30.0.109:6379</code> 和 <code v-pre>172.30.0.104:6379</code></li>\n</ul>\n</li>\n<li><strong>节点信息</strong>：每个主节点和副本的状态都列出，并确认了副本正确地复制了主节点的数据。</li>\n<li><strong>集群检查</strong>：\n<ul>\n<li>所有 <code v-pre>16384</code> 个槽位都已经被覆盖和分配。</li>\n<li>所有节点和槽位配置一致，没有发现未分配的槽位。</li>\n</ul>\n</li>\n</ul>\n<p>此时,使用客户端连上集群中的任何一个节点，都相当于连上了整个集群。那么由于有分片的的存在，我们访问的主节点不一定就是数据所在的节点怎么办呢？客户端后面要加上 <code v-pre>-c</code> 选项，否则 <code v-pre>key</code> 如果没有落到当前节点上，是不能进行操作的，<code v-pre>-c</code> 会自动把请求重定向到对应节点。</p>\n<p>不过我们不急着操作先，先来使用 <code v-pre> cluster nodes</code> 来查看整个集群的信息，然后再来使用集群。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 使用集群</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.101</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -c</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 注意携带 -c 选项</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">0903a2928d09168fa3cc2f4f74c96fe926eef8ef</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.107:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733490348922</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> myself,master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 0-5460</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733490348000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5461-10922</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bc2a17498f1c88f2d827638625e3b998b5d36abf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.108:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733490347917</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9cd6418590131bf0b6fa20c046ee9bbb06f56afe</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.106:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733490349525</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">12992b85a92de26dd849f1abf012ad674da733e4</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.104:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733490348419</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bce31769a218d92d5a3735458e6e479759bdd500</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.105:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733490349023</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.103:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733490348520</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 10923-16383</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">fc92b4b941bc55edc638b3ed5570c77649f11124</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.109:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733490348520</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">set</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> akey</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">666</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">-</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Redirected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slot</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [8093] located at 172.30.0.102:6379 </span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 这句话表示您发送的请求被重定向到一个位于 172.30.0.102:6379 的主节点，该节点负责处理槽位编号为 8093 的数据。</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">OK</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.102:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> akey</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"666\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.102:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 尝试不带 -c 选项直接进行访问</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.101</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> akey</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">error</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> MOVED</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 8093</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 果然访问不到了...并且提示到另外一个主节点进行寻找</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 尝试不带 -c 选项直接进行访问</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.103</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.103:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> akey</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">error</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> MOVED</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 8093</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 果然还是不行</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.103:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 尝试不带 -c 选项直接进行访问</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.102</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.102:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> akey</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"666\"</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 说明数据确实进行了分片</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.102:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 使用从节点访问试一试</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.107</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.107:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> akey</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">error</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> MOVED</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 8093</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 欸? 这是怎么回事呢? 难道从节点没有把主节点数据拷贝过来?</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.107:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">readonly</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 打开只读试试</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">OK</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.107:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> akey</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"666\"</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 欸果然可以了</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.107:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 不过每次退出都需要重新执行 readonly, 除非我们修改所有节点的 redis.conf 配置文件中的配置选项为 \"slave-read-only no\", 这种设置不会对主节点产生影响(待补充...)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"hint-container caution\">\n<p class=\"hint-container-title\">警告</p>\n<p>警告：<code v-pre>Redis</code> 默认从节点只是拿来数据备份和进行故障转移的，默热不推荐我们使用从节点进行数据读取，因为复制带来的延迟在集群状态下可能会很高，导致读取到旧数据（这个备份过此是异步的）。在有集群的情况下，我们可以不用再向之前的主从架构一样，将主节点用来写，从节点都用来读。而是主节点都用来读写，从节点用来做数据备份和故障转移即可。因此与其说分片把写分离，不如说分片让读写都分离了。</p>\n<p>因此在业务架构中，最好一个项目使用一个 <code v-pre>Redis</code> 集群，然后如果该项目本身就是分布式的（例如后端是分布式的，则可以让后端分别寻找对应的主节点进行读取，这样读写压力会被不同机器分摊）。</p>\n<ul>\n<li>写入被不同机器分摊</li>\n<li>读出被不同机器分摊</li>\n<li>数据被负载均衡存入</li>\n<li>数据被主从结构备份</li>\n<li>避免读从节点旧数据</li>\n</ul>\n</div>\n<div class=\"hint-container caution\">\n<p class=\"hint-container-title\">警告</p>\n<p>警告：在集群状态下，会不会出现，写入过程中（还没写入完）进行读取导致失败的情况呢？不可能，为什么？因为一个 <code v-pre>Redis</code>节点是单线程的，在集群中，写入和读出一定是同一个槽，而管理这个槽的 <code v-pre>Redis</code> 分片一定会单线程执行写入和读取这两个命令，如果很确定写入比读出早，那么读出是百分百有数据，不会有意外情况。</p>\n</div>\n<h3 id=\"_2-4-故障转移\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-4-故障转移\"><span>2.4.故障转移</span></a></h3>\n<p>手动停止一个主节点，看看会发生什么现象。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 故障转移</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 查看节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> $</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.102</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -c</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.102:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">fc92b4b941bc55edc638b3ed5570c77649f11124</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.109:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492320000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bce31769a218d92d5a3735458e6e479759bdd500</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.105:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492319548</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.103:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492320553</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 10923-16383</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492319548</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 0-5460</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bc2a17498f1c88f2d827638625e3b998b5d36abf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.108:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492319950</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> myself,master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5461-10922</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">12992b85a92de26dd849f1abf012ad674da733e4</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.104:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492319000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">0903a2928d09168fa3cc2f4f74c96fe926eef8ef</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.107:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492320000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9cd6418590131bf0b6fa20c046ee9bbb06f56afe</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.106:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492319000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.102:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 手动停止</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> stop</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">redis1</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 观察节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> $</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.102</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -c</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.102:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">fc92b4b941bc55edc638b3ed5570c77649f11124</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.109:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492469571</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bce31769a218d92d5a3735458e6e479759bdd500</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.105:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492469000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 10</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 0-5460</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 原本是从节点的 172.30.0.105:6379 变为了主节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.103:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492468566</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 10923-16383</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master,fail</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492324572</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492322000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 可以看到这一个主节点爆 fail 以及发生故障</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bc2a17498f1c88f2d827638625e3b998b5d36abf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.108:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492469000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> myself,master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5461-10922</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">12992b85a92de26dd849f1abf012ad674da733e4</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.104:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492469571</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">0903a2928d09168fa3cc2f4f74c96fe926eef8ef</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.107:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492469000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9cd6418590131bf0b6fa20c046ee9bbb06f56afe</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.106:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> bce31769a218d92d5a3735458e6e479759bdd500</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492470073</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 10</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.102:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 手动恢复</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> start</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">redis1</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 观察节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> $</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.102</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -c</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.102:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">fc92b4b941bc55edc638b3ed5570c77649f11124</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.109:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492665569</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bce31769a218d92d5a3735458e6e479759bdd500</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.105:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492665368</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 10</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 0-5460</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 这个 172.30.0.105:6379 节点依旧是主节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.103:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492666000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 10923-16383</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> bce31769a218d92d5a3735458e6e479759bdd500</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492666573</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 10</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 172.30.0.101:6379 从原本的主节点变为了从节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bc2a17498f1c88f2d827638625e3b998b5d36abf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.108:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492666372</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> myself,master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5461-10922</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">12992b85a92de26dd849f1abf012ad674da733e4</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.104:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492666000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">0903a2928d09168fa3cc2f4f74c96fe926eef8ef</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.107:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492664866</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9cd6418590131bf0b6fa20c046ee9bbb06f56afe</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.106:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> bce31769a218d92d5a3735458e6e479759bdd500</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492665000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 10</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.102:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：另外，可以使用 <code v-pre>cluster failover</code> 进行集群恢复，例如上述的主节点因为故障变为从节点，可以使用这个指令继续恢复回主节点的位置，不过需要恢复谁就需要登陆谁进行恢复。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 恢复集群</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> failover</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">OK</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> myself,master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 11</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 0-5460</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">12992b85a92de26dd849f1abf012ad674da733e4</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.104:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492921973</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bc2a17498f1c88f2d827638625e3b998b5d36abf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.108:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492920000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bce31769a218d92d5a3735458e6e479759bdd500</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.105:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492919563</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 11</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492921070</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5461-10922</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9cd6418590131bf0b6fa20c046ee9bbb06f56afe</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.106:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492921000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 11</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">0903a2928d09168fa3cc2f4f74c96fe926eef8ef</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.107:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492920000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">fc92b4b941bc55edc638b3ed5570c77649f11124</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.109:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492920568</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.103:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492920969</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 10923-16383</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></div>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：故障判定处理流程。集群中的所有节点, 都会周期性的使用心跳包进行通信。</p>\n<ol>\n<li>节点 <code v-pre>A</code> 给 节点 <code v-pre>B</code> 发送 <code v-pre>ping</code> 包，<code v-pre>B</code> 就会给 <code v-pre>A</code> 返回一个 <code v-pre>pong</code> 包。<code v-pre>ping</code> 和 <code v-pre>pong</code> 除了 <code v-pre>message type</code> 属性之外，其他部分都是一样的，这里包含了集群的配置信息（该节点的 <code v-pre>id</code>，该节点从属于哪个分片，是主节点还是从节点，从属于谁，持有哪些 <code v-pre>slots</code> 的位图...）</li>\n<li>每个节点每秒钟，都会给一些随机的节点发起 <code v-pre>ping</code> 包，而不是全发一遍。这样设定是为了避免在节点很多的时候，心跳包也非常多（比如有 <code v-pre>9</code> 个节点，如果全发，就是 <code v-pre>9 * 8 == 72</code> 组心跳了，而且这是按照 <code v-pre>N^2</code> 这样的级别增长的）</li>\n<li>当节点 <code v-pre>A</code> 给节点 <code v-pre>B</code> 发起 <code v-pre>ping</code> 包，<code v-pre>B</code> 不能如期回应的时候，此时 <code v-pre>A</code> 就会尝试重置和 <code v-pre>B</code> 的 <code v-pre>tcp</code> 连接，看能否连接成功。如果仍然连接失败，<code v-pre>A</code> 就会把 <code v-pre>B</code> 设为 <code v-pre>PFAIL</code> 状态（相当于主观下线）</li>\n<li><code v-pre>A</code> 判定 <code v-pre>B</code> 为 <code v-pre>PFAIL</code> 之后，会通过 <code v-pre>redis</code> 内置的 <code v-pre>Gossip</code> 协议，和其他节点进行沟通，向其他节点确认 <code v-pre>B</code> 的状态（每个节点都会维护一个自己的“下线列表”，由于视角不同，每个节点的下线列表也不一定相同）</li>\n<li>此时 <code v-pre>A</code> 发现其他很多节点，也认为 <code v-pre>B</code> 为 <code v-pre>PFAIL</code>，并且数目超过总集群个数的一半，那么 <code v-pre>A</code> 就会把 <code v-pre>B</code> 标记成 <code v-pre>FAIL</code>（相当于客观下线），并且把这个消息同步给其他节点（其他节点收到之后，也会把 <code v-pre>B</code> 标记成 <code v-pre>FAIL</code>)</li>\n<li>至此 <code v-pre>B</code> 就彻底被判定为故障节点了</li>\n</ol>\n<p>另外，在 <code v-pre>Redis</code> 集群中，出现集群宕机（比主节点故障更加严重的情况）的情况通常是由以下三种情况引起的：</p>\n<ul>\n<li><strong>某个分片的所有主节点和从节点都挂了</strong>：如果一个分片的主节点和从节点都宕机，<code v-pre>Redis</code> 集群将无法处理该分片的数据请求，导致整个集群处于 <code v-pre>fail</code> 状态。</li>\n<li><strong>某个分片的主节点挂了，但没有从节点</strong>：如果某个分片的主节点宕机，而该分片没有从节点，<code v-pre>Redis</code> 集群无法进行故障转移，导致该分片无法正常服务，进而可能导致集群 <code v-pre>fail</code>。</li>\n<li><strong>超过半数的主节点挂了</strong>：如果集群中的主节点宕机超过一半，<code v-pre>Redis</code> 集群无法保证数据的完整性和可用性，这时集群会进入 <code v-pre>fail</code> 状态。</li>\n</ul>\n</div>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：故障转移处理流程。</p>\n<ol>\n<li>故障判断：\n<ul>\n<li><strong>如果故障节点是从节点</strong>：无需进行故障迁移，因为从节点只是备份数据，不会影响集群的整体功能。</li>\n<li><strong>如果故障节点是主节点</strong>：需要进行故障迁移，选举从节点中的一个作为新的主节点。</li>\n</ul>\n</li>\n<li>从节点资格判定：从节点首先要判断自己是否具备成为主节点的资格。如果从节点和主节点的通信已经中断太久，导致数据差异过大，超过了预定的阈值，则该从节点将失去竞选资格。</li>\n<li>休眠时间：有资格的从节点（如 <code v-pre>C</code> 和 <code v-pre>D</code>）会先进行短暂的休眠，休眠时间为“基础时间<code v-pre>500ms</code> + 随机时间：<code v-pre>[0, 500ms]</code> + 排名时间（根据节点的排名，越靠前的节点休眠时间越短，排名越靠后的节点休眠时间越长，<code v-pre>排名 * 1000ms</code>）”</li>\n<li>投票阶段：如 <code v-pre>C</code> 休眠结束后，<code v-pre>C</code> 会向集群中的所有节点发起拉票操作，并且只有主节点有投票资格。每个主节点只能投一票，投票给其认为最合适的从节点。<code v-pre>C</code> 需要获得集群中超过一半的主节点的支持票，才能晋升为主节点。</li>\n<li>提升为主节点：一旦 <code v-pre>C</code> 获得超过一半的主节点投票，它就会被晋升为主节点。<code v-pre>C</code> 会执行 <code v-pre>slaveof no one</code> 来成为独立的主节点，同时让 <code v-pre>D</code> 成为 <code v-pre>C</code> 的从节点（<code v-pre>slaveof C</code>）。</li>\n<li>更新集群信息：<code v-pre>C</code> 会将自己晋升为主节点的消息同步给其他节点，其他节点会更新自己的集群结构信息，确保集群中各节点的信息一致。</li>\n</ol>\n<p>这个过程更加细致，也就是之前提到过的著名选举算法，<code v-pre>Raft</code> 算法。</p>\n</div>\n<h3 id=\"_2-5-扩容集群\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-5-扩容集群\"><span>2.5.扩容集群</span></a></h3>\n<p>接下来需要把 <code v-pre>redis10</code> 和 <code v-pre>redis11</code> 也加入到集群中，应该怎么做呢？很简单，我们之前使用 <code v-pre>redis-cli --cluster create &lt;节点列表&gt;</code> 创建集群，就可以使用 <code v-pre>redis-cli --cluster add-node &lt;单个节点&gt; &lt;集群中任意节点地址&gt;</code> 来添加新的节点（默认）。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 扩容集群</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> --cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> add-node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.110:6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Adding</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.110:6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Performing</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Check</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (using </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:[0-5460]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (5461 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 12992b85a92de26dd849f1abf012ad674da733e4</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.104:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> bc2a17498f1c88f2d827638625e3b998b5d36abf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.108:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> bce31769a218d92d5a3735458e6e479759bdd500</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.105:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:[5461-10922]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (5462 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9cd6418590131bf0b6fa20c046ee9bbb06f56afe</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.106:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 0903a2928d09168fa3cc2f4f74c96fe926eef8ef</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.107:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> fc92b4b941bc55edc638b3ed5570c77649f11124</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.109:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.103:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:[10923-16383]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (5461 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">OK</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> All nodes agree about slots configuration.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Check</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> for</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> open</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slots...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Check</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slots</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> coverage...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">OK</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> All 16384 slots covered.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Getting</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> functions</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> from</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cluster</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Send</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> FUNCTION</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> LIST</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.110:6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> verify</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> there</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> is</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> no</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> functions</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> in</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> it</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Send</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> FUNCTION</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> RESTORE</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.110:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Send</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> CLUSTER</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> MEET</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.110:6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> make</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> it</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> join</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cluster.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">OK</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> New node added correctly.</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 然后进入集群查看主从关系</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> $</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.101</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -c</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">5863ebe5623e98c9f405b9da099d0e75990aebce</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.110:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733494939225</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 可以看到 172.30.0.110:6379 成为了集群中新的主节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> myself,master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 11</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 0-5460</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">12992b85a92de26dd849f1abf012ad674da733e4</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.104:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733494938000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bc2a17498f1c88f2d827638625e3b998b5d36abf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.108:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733494939023</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bce31769a218d92d5a3735458e6e479759bdd500</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.105:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733494938522</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 11</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733494938522</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5461-10922</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9cd6418590131bf0b6fa20c046ee9bbb06f56afe</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.106:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733494938000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 11</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">0903a2928d09168fa3cc2f4f74c96fe926eef8ef</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.107:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733494939000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">fc92b4b941bc55edc638b3ed5570c77649f11124</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.109:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733494938722</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.103:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733494939727</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 10923-16383</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 不过虽然节点已经成功加入集群, 但是新的节点并不会自动接管已有的槽(slots), 除非明确执行了槽迁移操作</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 进行槽迁移操作</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> --cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> reshard</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 只需要任意集群中的节点即可完成槽迁移操作</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Performing</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Check</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (using </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) </span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 注意下面生成的信息, 里面的节点携带有 id 信息的存在, 后面用得到</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:[0-5460]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (5461 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5863ebe5623e98c9f405b9da099d0e75990aebce</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.110:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 12992b85a92de26dd849f1abf012ad674da733e4</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.104:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> bc2a17498f1c88f2d827638625e3b998b5d36abf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.108:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> bce31769a218d92d5a3735458e6e479759bdd500</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.105:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:[5461-10922]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (5462 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9cd6418590131bf0b6fa20c046ee9bbb06f56afe</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.106:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 0903a2928d09168fa3cc2f4f74c96fe926eef8ef</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.107:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> fc92b4b941bc55edc638b3ed5570c77649f11124</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.109:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.103:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:[10923-16383]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (5461 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">OK</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> All nodes agree about slots configuration.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Check</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> for</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> open</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slots...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Check</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slots</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> coverage...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">OK</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> All 16384 slots covered.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">How</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> many</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slots</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> do</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> you</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> want</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> move</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (from </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 16384</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">)</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">?</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> 4096 </span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 填入需要新加入集群主节点分配到的槽个数</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 其实这里的目标是让所有主节点平均分配 slots, 计算方式如下：</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 总 slots 数量 = 16384</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 当前主节点数量 = 4</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 每个节点理想的 slots 数量 = 16384 / 4 = 4096</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">What</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> is</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> receiving</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ID?</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5863ebe5623e98c9f405b9da099d0e75990aebce</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 填入新加入节点的 ID, 注意不是 IP:PORT</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Please</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> enter</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> all</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> source</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> IDs.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  Type</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">all</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> use</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> all</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> as</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> source</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> for</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> hash</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slots.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  Type</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">done</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> once</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> you</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> entered</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> all</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> source</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> IDs.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Source</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> #1: all # 填入某个节点的 ID, 就会从某个节点迁移槽给新增加的主节点, 如果填入 all 就把所有现有主节点的槽都均衡迁移到新增加的主节点中</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Ready</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> move</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 4096</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slots.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  Source</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">       slots:[0-5460]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (5461 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">       2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">       slots:[5461-10922]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (5462 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">       2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.103:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">       slots:[10923-16383]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (5461 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">       2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  Destination</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5863ebe5623e98c9f405b9da099d0e75990aebce</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.110:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">       slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  Resharding</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> plan:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    Moving</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slot</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 5461</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> from</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># (省略)...</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：假设您的 <code v-pre>Redis</code> 集群中有 <code v-pre>3</code> 个主节点，它们的 <code v-pre>slots</code> 分配如下：</p>\n<ul>\n<li><strong>节点 A</strong>：<code v-pre>0-5460</code> (共 <code v-pre>5461</code> 个 <code v-pre>slots</code>)</li>\n<li><strong>节点 B</strong>：<code v-pre>5461-10922</code> (共 <code v-pre>5462</code> 个 <code v-pre>slots</code>)</li>\n<li><strong>节点 C</strong>：<code v-pre>10923-16383</code> (共 <code v-pre>5461</code> 个 <code v-pre>slots</code>)</li>\n</ul>\n<p>新增一个节点 <code v-pre>D</code>，您想迁移 <code v-pre>4096</code> 个 <code v-pre>slots</code> 给它，并选择 <code v-pre>all</code>，那么<code v-pre>Redis</code> 会按比例从节点 <code v-pre>A、B、C</code> 中迁移 <code v-pre>slots</code>：</p>\n<ul>\n<li><strong>节点 A</strong>：迁移约 <code v-pre>1365</code> 个 <code v-pre>slots</code></li>\n<li><strong>节点 B</strong>：迁移约 <code v-pre>1366</code> 个 <code v-pre>slots</code></li>\n<li><strong>节点 C</strong>：迁移约 <code v-pre>1365</code> 个 <code v-pre>slots</code></li>\n</ul>\n<p>最终，节点 <code v-pre>A、B、C</code> 的 <code v-pre>slots</code> 数量会减少，负载下降，新节点 <code v-pre>D</code> 接管迁移过来的 <code v-pre>4096</code> 个 <code v-pre>slots</code>，开始分担存储和请求。而如果不选择 <code v-pre>all</code>，明确指定了某个主节点（如节点 <code v-pre>A</code>），那么 <code v-pre>Redis</code> 只会从该节点迁移 <code v-pre>slots</code> 到新节点 <code v-pre>D</code>，这样会导致：</p>\n<ul>\n<li>节点 <code v-pre>A</code> 的负载迅速减轻，但其他节点的负载保持不变</li>\n<li>整体负载分布可能变得不均匀，不利于集群性能</li>\n</ul>\n</div>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：迁移槽管理的过程中也伴随着键值对的迁移，之后就会进行集群的 <code v-pre>key</code> 搬运工作，这个过程涉及到数据搬运，可能需要消耗一定的时间，并且期间不影响新键值对的写入和读出；也不影响不需要迁移的键值对进行正常的读写；但需要迁移的键值对会发生短暂的错误，只有等待一段时间才会恢复（不过我还没有测试过，待补充...）。</p>\n</div>\n<p>加入新的主节点时，扩容的目标已经初步达成，但为了保证集群高可用性，还需要给这个新的主节点添加从节点，保证该主节点宕机之后，有从节点可以进行故障转移。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 提高可用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 添加从节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> --cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> add-node</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.111:6379</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\ </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">#</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 要添加的节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> 172.30.0.101:6379</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\ </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">#</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 集群中存在的任意节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> --cluster-slave</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\ </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">#</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 表示将新节点加入为从节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">--cluster-master-id</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5863ebe5623e98c9f405b9da099d0e75990aebce</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 指定该从节点的主节点的节点 ID</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 完整指令为 redis-cli --cluster add-node 172.30.0.111:6379 172.30.0.101:6379 --cluster-slave --cluster-master-id 5863ebe5623e98c9f405b9da099d0e75990aebce</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Adding</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.111:6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Performing</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Check</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (using </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:[1365-5460]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (4096 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5863ebe5623e98c9f405b9da099d0e75990aebce</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.110:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:[0-1364],[5461-6826],[10923-12287]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (4096 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   1</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 12992b85a92de26dd849f1abf012ad674da733e4</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.104:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> bc2a17498f1c88f2d827638625e3b998b5d36abf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.108:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> bce31769a218d92d5a3735458e6e479759bdd500</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.105:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:[6827-10922]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (4096 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   1</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9cd6418590131bf0b6fa20c046ee9bbb06f56afe</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.106:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 0903a2928d09168fa3cc2f4f74c96fe926eef8ef</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.107:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5863ebe5623e98c9f405b9da099d0e75990aebce</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> fc92b4b941bc55edc638b3ed5570c77649f11124</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.109:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.103:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:[12288-16383]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (4096 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">OK</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> All nodes agree about slots configuration.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Check</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> for</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> open</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slots...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Check</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slots</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> coverage...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">OK</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> All 16384 slots covered.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Send</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> CLUSTER</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> MEET</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.111:6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> make</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> it</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> join</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cluster.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Waiting</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> for</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> join</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Configure</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> as</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> of</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.110:6379.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">OK</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> New node added correctly.</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看新的主从结构</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.101</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -c</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">5863ebe5623e98c9f405b9da099d0e75990aebce</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.110:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733501266902</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 12</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 0-1364</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5461-6826</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 10923-12287</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> myself,master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 11</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 1365-5460</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">12992b85a92de26dd849f1abf012ad674da733e4</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.104:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733501265898</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bc2a17498f1c88f2d827638625e3b998b5d36abf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.108:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733501265000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bce31769a218d92d5a3735458e6e479759bdd500</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.105:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733501265597</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 11</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733501266501</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6827-10922</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9cd6418590131bf0b6fa20c046ee9bbb06f56afe</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.106:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733501266501</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 11</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">0903a2928d09168fa3cc2f4f74c96fe926eef8ef</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.107:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5863ebe5623e98c9f405b9da099d0e75990aebce</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733501266501</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 12</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">fc92b4b941bc55edc638b3ed5570c77649f11124</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.109:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733501266000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">8cbe43de958f2564d95d0d5da51cab654b861036</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.111:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5863ebe5623e98c9f405b9da099d0e75990aebce</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733501265000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 12</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 果然成为了  172.30.0.110:6379 的从节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.103:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733501265597</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 12288-16383</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3 id=\"_2-6-缩容集群\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-6-缩容集群\"><span>2.6.缩容集群</span></a></h3>\n<p>缩容的操作一般比较少见，但是也不是没有，简单演示一下您就明白怎么操作了，假设我们需要把刚刚加入的主从节点剔除（也就是 <code v-pre>172.30.0.110:6379</code> 和 <code v-pre> 172.30.0.111:6379</code>，节点 <code v-pre>ID</code> 分别为 <code v-pre>5863ebe5623e98c9f405b9da099d0e75990aebce</code> 和 <code v-pre>8cbe43de958f2564d95d0d5da51cab654b861036</code>）。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 缩容集群</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 删除从节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> $</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">--cluster</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\ </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">#</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 表示集群操作</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">del-node</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\ </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">#</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 表示要删除节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.110:6379</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\ </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">#</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 集群中任意一个节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">8cbe43de958f2564d95d0d5da51cab654b861036</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 要删除的节点 ID</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 完整指令为 redis-cli --cluster del-node 172.30.0.110:6379 8cbe43de958f2564d95d0d5da51cab654b861036</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Removing</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 8cbe43de958f2564d95d0d5da51cab654b861036</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> from</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.110:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Sending</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> CLUSTER</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> FORGET</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> messages</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cluster...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Sending</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> CLUSTER</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> RESET</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> SOFT</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> deleted</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node.</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 删除主节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 重新分配槽, 把 172.30.0.110:6379 这个待删除的主节点去除前, 需要把其占有的槽均分给其他主节点(大概均分即可, 从需要移除的节点中迁移 1365、1365、1366 到三个主节点)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> --cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> reshard</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 把要剔除的  172.30.0.110:6379 中的 1365 个槽迁移给 172.30.0.101:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Performing</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Check</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (using </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:[1365-5460]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (4096 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5863ebe5623e98c9f405b9da099d0e75990aebce</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.110:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:[0-1364],[5461-6826],[10923-12287]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (4096 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   1</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 12992b85a92de26dd849f1abf012ad674da733e4</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.104:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> bc2a17498f1c88f2d827638625e3b998b5d36abf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.108:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> bce31769a218d92d5a3735458e6e479759bdd500</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.105:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:[6827-10922]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (4096 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   1</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9cd6418590131bf0b6fa20c046ee9bbb06f56afe</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.106:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 0903a2928d09168fa3cc2f4f74c96fe926eef8ef</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.107:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5863ebe5623e98c9f405b9da099d0e75990aebce</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> fc92b4b941bc55edc638b3ed5570c77649f11124</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.109:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.103:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:[12288-16383]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (4096 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">OK</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> All nodes agree about slots configuration.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Check</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> for</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> open</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slots...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Check</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slots</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> coverage...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">OK</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> All 16384 slots covered.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">How</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> many</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slots</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> do</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> you</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> want</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> move</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (from </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 16384</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">)</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">?</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> 1365</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">What</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> is</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> receiving</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ID?</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Please</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> enter</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> all</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> source</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> IDs.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  Type</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">all</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> use</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> all</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> as</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> source</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> for</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> hash</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slots.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  Type</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">done</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> once</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> you</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> entered</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> all</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> source</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> IDs.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Source</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> #1: 5863ebe5623e98c9f405b9da099d0e75990aebce</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Source</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> #2: done</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># (省略)...</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> --cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> reshard</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 把要剔除的  172.30.0.110:6379 中的 1365 个槽迁移给 172.30.0.102:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># (省略)...</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> --cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> reshard</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 把要剔除的  172.30.0.110:6379 中的 1366 个槽迁移给 172.30.0.103:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># (省略)...</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 这里我还观察到此时的 172.30.0.110:6379 自动变为了 172.30.0.103 的从节点, Redis 版本不同可能结果也不同(可能还是主节点, 只不过不持有槽而已, 您可以试一试)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 删除“主”节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> --cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> del-node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5863ebe5623e98c9f405b9da099d0e75990aebce</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Removing</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5863ebe5623e98c9f405b9da099d0e75990aebce</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> from</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Sending</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> CLUSTER</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> FORGET</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> messages</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cluster...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Sending</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> CLUSTER</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> RESET</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> SOFT</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> deleted</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node.</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 重新查看集群中的主从结构</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.101</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -c</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> myself,master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 13</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 0-5460</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">12992b85a92de26dd849f1abf012ad674da733e4</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.104:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733503694213</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 15</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bc2a17498f1c88f2d827638625e3b998b5d36abf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.108:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733503694514</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 14</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bce31769a218d92d5a3735458e6e479759bdd500</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.105:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733503696221</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 13</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733503696523</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 14</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5461-6825</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6827-10922</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9cd6418590131bf0b6fa20c046ee9bbb06f56afe</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.106:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733503696121</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 13</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">0903a2928d09168fa3cc2f4f74c96fe926eef8ef</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.107:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733503695000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 15</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">fc92b4b941bc55edc638b3ed5570c77649f11124</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.109:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733503695518</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 15</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.103:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733503695217</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 15</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6826</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 10923-16383</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2 id=\"_3-redis-常见的问题\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-redis-常见的问题\"><span>3.Redis 常见的问题</span></a></h2>\n<h3 id=\"_3-1-缓存雪崩\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-1-缓存雪崩\"><span>3.1.缓存雪崩</span></a></h3>\n<ul>\n<li>随机缓存过期时间：采用不同的缓存过期时间。</li>\n<li>采用缓存预热：当大量缓存失效时，数据库压力激增。特别是热点数据突然被请求，数据库直接崩溃，应该提前将热点数据加载到缓存。</li>\n<li>采用缓存更新策略：写入数据库时更新缓存时间。</li>\n<li>引入消息队列组件：削峰填谷请求。</li>\n<li>集群相互监督：</li>\n</ul>\n","env":{"base":"/","filePath":"/home/ljp/git/work/work-blog-website/work-blog-website-frontend/docs/4.业务服务/3.缓存服务/003_ljp_2024_12_07_集群架构.md","filePathRelative":"4.业务服务/3.缓存服务/003_ljp_2024_12_07_集群架构.md","frontmatter":{"createTime":"2025/04/24 16:09:13","permalink":"/4.业务服务/ll75051h/","title":"集群架构"},"sfcBlocks":{"template":{"type":"template","content":"<template><h2 id=\"_1-redis-读分离架构-高可用架构\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-redis-读分离架构-高可用架构\"><span>1.Redis 读分离架构/高可用架构</span></a></h2>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：实际上 <code v-pre>Redis</code> 的单机读写性能一般可以达到十万级别的 <code v-pre>QPS</code>，可以 <a href=\"https://redis.io/docs/latest/operate/oss_and_stack/management/optimization/benchmarks/#benchmark-results-on-bare-metal-servers-across-different-redis-versions\" target=\"_blank\" rel=\"noopener noreferrer\">查阅官方文档</a>。</p>\n</div>\n<h3 id=\"_1-1-架构原理\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-1-架构原理\"><span>1.1.架构原理</span></a></h3>\n<p>当客户端足够多时，要减轻 <code v-pre>redis</code> 节点的负担，则可以考虑多个从节点复制主节点的数据，主节点负责读写，从节点只负责读（不过这么做其实是有点问题的，后面一步一步来）。</p>\n<h3 id=\"_1-2-数据节点\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-数据节点\"><span>1.2.数据节点</span></a></h3>\n<h4 id=\"_1-2-1-复制\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-1-复制\"><span>1.2.1.复制</span></a></h4>\n<h5 id=\"_1-2-1-1-复制的建立\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-1-1-复制的建立\"><span>1.2.1.1.复制的建立</span></a></h5>\n<p>首先我们需要建立 <code v-pre>Redis</code> 的集群架构，<code v-pre>Redis</code> 实例之间会进行复制操作，实例划分为主节点和从节点，复制数据流是单向的，只能从主节点流向从节点。复制的配置方式有三种：</p>\n<ul>\n<li>配置文件中写入在 <code v-pre>slaveof {masterHost} {masterPort}</code> 随 <code v-pre>Redis</code> 启动生效</li>\n<li>在 <code v-pre>redis-server</code> 启动命令时加入 <code v-pre>--slaveof {masterHost} {masterPort}</code> 生效</li>\n<li>直接使用 <code v-pre>redis</code> 命令 <code v-pre>slaveof {masterHost} {masterPort}</code> 生效</li>\n</ul>\n<p>我们在启动 <code v-pre>Redis</code> 的时候，其实是可以选择不同的配置文件的，因此我们只需要保持原来的 <code v-pre>Redis</code> 不变（作为主节点），复制原来的配置文件稍作修改为 <code v-pre>redis-slave.conf </code> 即可（确保其中的 <code v-pre>daemonize</code> 为 <code v-pre>yes</code>，如果配置文件中已经设置好了，那其从节点配置文件可以继续使用主节点的配置文件，不做任何修改）。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 复制的建立</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-server</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/redis/redis-slave.conf</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> --port</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6380</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> --slaveof</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 127.0.0.1</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> ## 6379 的主节点就连接上 6380 的次节点</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>然后使用 <code v-pre>redis-server /etc/redis/redis-slave.conf --port 6380 --slaveof 127.0.0.1 6379</code> 启动从节点，并且使用 <code v-pre>netstat -nlpt</code> 检查是否启动，最后按下面的做法查验是否有分布式运行。</p>\n<h5 id=\"_1-2-1-2-复制的现象\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-1-2-复制的现象\"><span>1.2.1.2.复制的现象</span></a></h5>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 复制的过程</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># >>> begin: 连接主节点 >>></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 127.0.0.1</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">set</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> key</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">hello</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">OK</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> key</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"hello\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">info</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replication</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># Replication</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">role:master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">connected_slaves:1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave0:ip</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">=127.0.0.1,port=6380,state=online,offset=700,lag=1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_failover_state:no-failover</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_replid:8280d7308ba672a701170c8eeba15e258546de71</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_replid2:0000000000000000000000000000000000000000</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_repl_offset:700</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">second_repl_offset:-1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_active:1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_size:1048576</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_first_byte_offset:1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_histlen:700</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># &#x3C;&#x3C;&#x3C; end &#x3C;&#x3C;&#x3C;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># >>> begin: 连接从节点 >>></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 127.0.0.1</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6380</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> key</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"hello\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6380</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">info</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replication</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># Replication</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">role:slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_host:127.0.0.1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_port:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_link_status:up</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_last_io_seconds_ago:9</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_sync_in_progress:0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave_read_repl_offset:700</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave_repl_offset:700</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave_priority:100</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave_read_only:1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">replica_announced:1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">connected_slaves:0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_failover_state:no-failover</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_replid:8280d7308ba672a701170c8eeba15e258546de71</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_replid2:0000000000000000000000000000000000000000</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_repl_offset:700</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">second_repl_offset:-1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_active:1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_size:1048576</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_first_byte_offset:15</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_histlen:686</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># &#x3C;&#x3C;&#x3C; end &#x3C;&#x3C;&#x3C;</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>从运行结果中看到复制已经在工作了，针对主节点 <code v-pre>6379</code> 的任何修改都可以同步到从节点 <code v-pre>6380</code> 中，并且也可以使用 <code v-pre>info replication</code> 查看每个节点的复制信息（节点角色、状态等）。</p>\n<h5 id=\"_1-2-1-3-复制的断开\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-1-3-复制的断开\"><span>1.2.1.3.复制的断开</span></a></h5>\n<p>在从节点中可以执行 <code v-pre>slaveof no one</code> 断开和主节点的复制关系，从节点就会晋升为新的主节点，断开复制节点后不会抛弃原有数据，只是无法再获取主节点上的数据变化。断开节点后，还可以使用 <code v-pre>slaveof &lt;newMasterIp&gt; &lt;newMasterPort&gt;</code> 给从节点切换为别的主节点，或者干脆给从节点恢复原本的主节点。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 复制的断开</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># >>> begin: 从节点 >>></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 127.0.0.1</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6380</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6380</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> key</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"hello\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6380</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slaveof</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> no</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> one</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">OK</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># &#x3C;&#x3C;&#x3C; end &#x3C;&#x3C;&#x3C;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># >>> begin: 主节点 >>></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 127.0.0.1</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> key</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"hello\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">set</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> akey</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">OK</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># &#x3C;&#x3C;&#x3C; end &#x3C;&#x3C;&#x3C;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># >>> begin: 从节点 >>></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6380</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> akey</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 这样就无法直接复制主节点的数据了</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">nil</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6380</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slaveof</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 127.0.0.1</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">OK</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># &#x3C;&#x3C;&#x3C; end &#x3C;&#x3C;&#x3C;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># >>> begin: 主节点 >>></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 127.0.0.1</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 访问一次主节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># &#x3C;&#x3C;&#x3C; end &#x3C;&#x3C;&#x3C;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># >>> begin: 主节点 >>></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6380</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> akey</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 就会发现从节点恢复了复制</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"redis\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># &#x3C;&#x3C;&#x3C; end &#x3C;&#x3C;&#x3C;</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h5 id=\"_1-2-1-4-复制的安全\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-1-4-复制的安全\"><span>1.2.1.4.复制的安全</span></a></h5>\n<ul>\n<li><strong>权限校验</strong>：对于数据比较重要的节点，主节点会通过设置 <code v-pre>requirepass &lt;密码&gt;</code> 参数进行密码验证，这时所有的客户端访问进入命令行后必须先使用 <code v-pre>auth</code> 命令实行校验。从节点与主节点的复制连接是通过一个特殊标识的客户端来完成，因此需要配置从节点的 <code v-pre>masterauth &lt;密码&gt;</code> 参数与主节点密码保持一致，这样从节点才可以正确地连接到主节点并发起复制流程。</li>\n<li><strong>只读模式</strong>：只读默认情况下，从节点使用 <code v-pre>slave-read-only=yes</code> 配置为只读模式。由于复制只能从主节点到从节 点，对于从节点的任何修改主节点都无法感知，修改从节点会造成主从数据不一致，所以建议线上不要修改从节点的只读模式。</li>\n</ul>\n<p>为了不影响我原来的配置，我这里复制最原本的配置文件，作为主节点和从节点的配置。</p>\n<ol>\n<li>\n<p>配置主节点</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 配置主节点( redis-master.conf)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cp</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/redis/redis.conf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ~/redis-master.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> vim</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># ...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">port</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6380</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">requirepass</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">主节点密</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">码</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># ...</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></li>\n<li>\n<p>启动主节点</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 启动主节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-server</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis.conf</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></li>\n<li>\n<p>配置从节点</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 配置从节点(redis-slave.conf)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cp</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/redis/redis.conf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ~/redis-slave.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> vim</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-slave.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># ...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">port</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6381</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">requirepass</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">从节点密</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">码</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slaveof</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 127.0.0.1</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6380</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">masterauth</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">填入主节点密</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">码</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave-read-only</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> yes</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># ...</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></li>\n<li>\n<p>启动从节点</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 启动从节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-server</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-slave.conf</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></li>\n<li>\n<p>连接主节点并设置值</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 连接主节点并设置值</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6380</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -a</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">主节点密</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">码</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 或者不使用 -a 选项, 直接回车, 在命令行界面中使用 \"auth 密码\" 即可, 如果验证通过就会返回 OK</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6380</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">set</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> key</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">value1</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">ok</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6380</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> key</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"value1\"</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></li>\n<li>\n<p>验证从节点数据同步</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 验证从节点数据同步</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6381</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6381</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> key</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"value1\"</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></li>\n<li>\n<p>验证从节点只读模式</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 验证从节点只读模式</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6381</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">set</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> key</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">new_value</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">error</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> READONLY</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> You</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> can</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">t write against a read-only replica.</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></li>\n</ol>\n<h5 id=\"_1-2-1-5-复制的延迟\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-1-5-复制的延迟\"><span>1.2.1.5.复制的延迟</span></a></h5>\n<p>主从节点一般部署在不同机器上，复制时的网络延迟就成为需要考虑的问题，<code v-pre>Redis</code> 为我们提供了 <code v-pre>repl-disable-tcp-nodelay</code> 参数用于控制是否关闭 <code v-pre>TCP_NODELAY</code>，默认为 <code v-pre>no</code>，即开启 <code v-pre>tcpnodelay</code> 功能，说明如下：</p>\n<ul>\n<li>当关闭时，主节点产生的命令数据无论大小都会及时地发送给从节点，这样主从之间延迟会变小，但增加了网络带宽的消耗。适用于主从之间的网络环境良好的场景，如同机房部署。</li>\n<li>当开启时，主节点会合并较小的 <code v-pre>TCP</code> 数据包从而节省带宽，默认发送时间间隔取决于 <code v-pre>Linux</code> 的内核，一般默认为 <code v-pre>40</code> 毫秒。这种配置节省了带宽但增大主从之间的延迟。适用于主从网络环境复杂的场景，如跨机房部署。</li>\n</ul>\n<div class=\"hint-container caution\">\n<p class=\"hint-container-title\">警告</p>\n<p>警告：因此除非数据不紧急，否则使用 <code v-pre>Redis</code> 的从节点做读分离其实是有点问题的，因为可能会有较高的延迟，与其说是读分离，不如说从节点的重点是备份数据，方便后续的哨兵节点做故障转移的。</p>\n</div>\n<h4 id=\"_1-2-2-拓扑\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-2-拓扑\"><span>1.2.2.拓扑</span></a></h4>\n<ol>\n<li>\n<p><strong>一主一从结构</strong>：也就是我们之前一直使用的结构</p>\n<ul>\n<li>通常用于主节点出现宕机时，从节点可以提供临时故障转移</li>\n<li>同时写命令较高需要持久化时，就可以在从节点上开启 <code v-pre>AOF</code> 配置</li>\n</ul>\n<p>这样就可以保证数据持久化安全性，也可以避免对主节点性能的干扰。</p>\n</li>\n<li>\n<p><strong>一主多从结构</strong>：在大型电商平台中，商品详情页的访问量通常远高于商品数据的修改量。例如，商品价格、库存等信息修改的频率较低，而用户浏览商品详情的频率极高。因此可以一个主节点负责写入，其他从节点都负责读取（负载均衡读取）。</p>\n</li>\n<li>\n<p><strong>树形主从结构</strong>：树形主从结构（分层结构）使得从节点不但可以复制主节点数据，同时可以作为其他从节点的主节点继续向下层复制。当祖先主节点需要直接挂载的从节点较多时，可以通过引入复制中间层（就是祖先节点只挂载几个从节点后，那几个从节点构成一层中间层），有效降低住系欸按负载和需要传送给从节点的数据量。数据写入节点 <code v-pre>A</code> 之后会同步给 <code v-pre>B</code> 和 <code v-pre>C</code> 节点，<code v-pre>B</code> 节点进一步把数据同步给 <code v-pre>D</code> 和 <code v-pre>E</code> 节 点，这样当主节点 <code v-pre>A</code> 需要挂载多个从节点时，就可以避免对主节点 <code v-pre>A</code> 的过高性能干扰。</p>\n</li>\n</ol>\n<div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>补充：这里 <code v-pre>Redis</code> 只是做了复制和拓扑的工作，并没有使用现有的负载均衡算法，因此我们后面需要补充这类算法，在对应编程语言客户端中实现。</p>\n</div>\n<h4 id=\"_1-2-3-原理\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-3-原理\"><span>1.2.3.原理</span></a></h4>\n<h5 id=\"_1-2-3-1-链接检测\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-3-1-链接检测\"><span>1.2.3.1.链接检测</span></a></h5>\n<p>建立复制链接之前：</p>\n<ol>\n<li>\n<p><strong>保存主节点信息</strong>：当开始配置主从同步关系后，先启动从节点的话，会先保存主节点的地址信息，但复制流程尚未开始。 在从节点（如端口 <code v-pre>6380</code>）执行 <code v-pre>info replication</code>，可以看到以下信息，此时链接尚未建立。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 回显显示的配置</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6381</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">info</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replication</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># Replication</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">role:slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_host:127.0.0.1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_port:6380</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_link_status:up</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_last_io_seconds_ago:2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_sync_in_progress:0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave_read_repl_offset:43163</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave_repl_offset:43163</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave_priority:100</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave_read_only:1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">replica_announced:1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">connected_slaves:0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_failover_state:no-failover</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_replid:63d358c9223002afc5dcc995a235fcc14882c9d3</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_replid2:1c606c458fe22df08bae73d9af9a675cb7b49554</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_repl_offset:43163</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">second_repl_offset:43094</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_active:1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_size:1048576</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_first_byte_offset:43094</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_histlen:70\\</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># master_host 和 master_port 分别表示主节点的 IP 和 PORT</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># master_link_status 表示主节点的连接状态, 此时为 down, 说明尚未建立连接</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></li>\n<li>\n<p><strong>建立 TCP 连接</strong>：从节点会通过每秒运行的定时任务维护复制逻辑。</p>\n<ul>\n<li>如果检测到新的主节点，从节点会尝试与主节点建立基于 <code v-pre>TCP</code> 的网络连接</li>\n<li>若连接失败，定时任务会无限重试，直到连接成功或用户手动停止主从复制。</li>\n</ul>\n</li>\n<li>\n<p><strong>发送 PING 命令</strong>：成功建立连接后，从节点会发送 <code v-pre>PING</code> 命令，验证主节点的应用层状态。</p>\n<ul>\n<li>如果主节点正常，会返回 <code v-pre>PONG</code></li>\n<li>如果 <code v-pre>PONG</code> 超时，从节点会断开 <code v-pre>TCP</code> 连接，并等待下一次定时任务重新连接</li>\n</ul>\n</li>\n<li>\n<p><strong>权限验证</strong>：若主节点配置了 <code v-pre>requirepass</code> 参数，则需要密码验证。</p>\n<ul>\n<li>从节点需在配置文件中设置 <code v-pre>masterauth</code> 参数提供密码</li>\n<li>如果验证失败，主从复制过程将停止</li>\n</ul>\n</li>\n<li>\n<p><strong>同步数据集</strong>：在首次建立复制时，主节点会将其所有数据发送给从节点，分为以下两种情况。</p>\n<ul>\n<li><strong>全量同步</strong>：发送所有数据，耗时较长（后面会提及 <mark>方式、字段、指令</mark>）</li>\n<li><strong>部分同步</strong>：发送增量数据，耗时较短（后面会提及 <mark>方式、字段、指令</mark>）</li>\n</ul>\n</li>\n<li>\n<p><strong>命令持续复制</strong>：完成数据同步后，主节点会将后续所有修改命令发送给从节点，从节点执行这些命令以保持数据一致性。</p>\n</li>\n</ol>\n<p>建立复制链接之后：</p>\n<p>而实际上，为了做到实时复制，主从节点在建立复制链接后，主节点回报自己收到的修改操作，通过 <code v-pre>tcp</code> 长链接的方式，源源不断传输给从节点，从节点就会根据这写请求来同步修改自己的数据，保持和主节点的数据一致性。</p>\n<p>而这样的长链接需要使用心跳检测机制（这里的心跳机制是在 <code v-pre>Redis</code> 应用层实现的，而不是 <code v-pre>TCP</code> 自带的心跳机制）来维护链接状态：</p>\n<ol>\n<li>主从节点彼此之间都有心跳机制，各自模拟为对方的客户端进行通信</li>\n<li>主节点默认每隔 <code v-pre>10 s</code> 对从节点发送 <code v-pre>ping</code> 指令，判断从节点的存活性和链接状态（从节点也可以用这种方式来的只主节点是否掉线）</li>\n<li>从节点默认每隔 <code v-pre>1 s</code> 对主节点发送 <code v-pre>replconf ack {offset}</code> 指令来上报自己的偏移量（主节点会根据该偏移量来知道哪些数据已经被从节点接收并处理）</li>\n</ol>\n<p>如果主节点发现从节点通信延迟超过 <code v-pre>repl-timeout</code> 配置的值（默认 <code v-pre>60</code> 秒），则判定从节点下线，断 开复制客⼾端连接。从节点恢复连接后，⼼跳机制继续进⾏。</p>\n<h5 id=\"_1-2-3-2-复制方式\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-3-2-复制方式\"><span>1.2.3.2.复制方式</span></a></h5>\n<ul>\n<li>早期的<code v-pre> Redis</code> 只支持全量复制，这就导致有新的从节点加入时，如果数据量较大，就会非常消耗网络资源，并且一旦出现网络波动，就会导致数据丢失而重传。</li>\n<li>新版本的 <code v-pre>Redis</code> 支持部分复制，这主要处理在主从复制中网络闪断等原因造成的数据丢失场景，当从节点再次连接上主节点后，如果条件允许，主节点就会自动补发数据给从节点。补发的数量远小于全量复制，因此可以避免过量的开销。</li>\n</ul>\n<p>而同步的指令主要依靠 <code v-pre>psync replicationid &lt;offset&gt;</code>（是 <code v-pre>Redis</code> 内部自动调用的命令，不用我们自己调用），其中 <code v-pre>offset</code> 为 <code v-pre>-1</code> 代表全量复制指令，其他数值均为部分复制。</p>\n<p>触发全量复制，这通常在以下场景发生：</p>\n<ul>\n<li>从节点首次连接到主节点时。</li>\n<li>从节点与主节点数据完全不同步（如从节点为空或主节点 <code v-pre>replicationid</code> 改变）。</li>\n<li>主节点无法满足部分复制条件（如复制积压缓冲区不足）。</li>\n</ul>\n<p>触发部分复制，这通常在以下场景发生：</p>\n<ul>\n<li>从节点重新连接主节点时（短暂网络中断后）。</li>\n<li>从节点的 <code v-pre>replicationid</code> 和偏移量与主节点匹配，且主节点复制积压缓冲区中仍有缺失的数据。</li>\n</ul>\n<h5 id=\"_1-2-3-3-重要字段\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-3-3-重要字段\"><span>1.2.3.3.重要字段</span></a></h5>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：通过 <code v-pre>info replication</code> 可以观察下提及的字段，以及对应值的变化。</p>\n</div>\n<h6 id=\"_1-2-3-3-1-复制标识字段\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-3-3-1-复制标识字段\"><span>1.2.3.3.1.复制标识字段</span></a></h6>\n<p>节点的复制 <code v-pre>id</code>在以下两种情况。</p>\n<ul>\n<li>主节点初始启动时/重新启动时/异常恢复时</li>\n<li>从节点晋级成主节点时</li>\n</ul>\n<p>都会生成一个 <code v-pre>replication id</code>(同一个节点，每次重启，生成的 <code v-pre>replication id</code> 也会变化)，从节点和主节点建立连接之后，就会获取到主节点的 <code v-pre>replication id</code>，通过 <code v-pre>info replication</code> 即可查看 <code v-pre>replication id</code>。</p>\n<p>而每个节点需要记录两组 <code v-pre>master_replid</code>，这个设定解决的问题场景是这样的：</p>\n<ul>\n<li>比如当前有两个节点 <code v-pre>A</code> 和 <code v-pre>B</code>，<code v-pre>A</code> 为 <code v-pre>master</code>，<code v-pre>B</code> 为 <code v-pre>slave</code>。此时 <code v-pre>B</code> 就会记录 <code v-pre>A</code> 的 <code v-pre>master_replid</code>。如果网络出现抖动，<code v-pre>B</code> 以为 <code v-pre>A</code> 挂了，<code v-pre>B</code> 自己就会自动成为主节点。</li>\n<li>于是 <code v-pre>B</code> 给自己分配了新的 <code v-pre>master_replid</code>。此时就会使用 <code v-pre>master_replid2</code> 来保存之前 <code v-pre>A</code> 的 <code v-pre>master_replid</code>。</li>\n<li>如果后续网络恢复了，<code v-pre>B</code> 就可以根据 <code v-pre>master_replid2</code> 找回之前的主节点。</li>\n<li>如果后续网络没有恢复，<code v-pre>B</code> 就按照新的 <code v-pre>master_replid</code> 自成一派，继续处理后续的数据（您可以自己尝试 <code v-pre>kill</code> 掉主节点，重启主节点，查看中间的变化...）。</li>\n</ul>\n<h6 id=\"_1-2-3-3-2-复制偏移字段\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-3-3-2-复制偏移字段\"><span>1.2.3.3.2.复制偏移字段</span></a></h6>\n<p>参与复制的主从节点都会维护自身复制偏移量，主节点（<code v-pre>master</code>）在处理完写入命令后，会把命令的字节长度做累加记录，统计信息在 <code v-pre>info replication</code> 中的 <code v-pre>master_repl_offset</code> 指标中。</p>\n<p>从节点在接受到主节点发送的命令后，也会累加记录自身的偏移量，统计信息在 <code v-pre>info replication</code> 中的 <code v-pre>slave_repl_offset</code> 指标中。</p>\n<p>从节点每秒钟上报自身的复制偏移量给主节点，因此主节点也会保存从节点的复制偏移量，统计指标为 <code v-pre>slavex</code> 中的 <code v-pre>offset</code> 字段。</p>\n<p>因此，通过对比主从节点的复制偏移量，可以判断主从节点数据是否一致。</p>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：<code v-pre>replid + offset</code> 共同标识了一个“数据集”，如果两个节点，他们的 <code v-pre>replid</code> 和 <code v-pre>offset</code> 都相同，则这两个节点上持有的数据，就一定相同。</p>\n</div>\n<div class=\"hint-container note\">\n<p class=\"hint-container-title\">注</p>\n<p>吐槽：偏移量就相当于学习进度。</p>\n</div>\n<h5 id=\"_1-2-3-4-同步指令\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-3-4-同步指令\"><span>1.2.3.4.同步指令</span></a></h5>\n<p>从节点实现复制的原理实际上就是调用 <code v-pre>psync</code> 指令（由于早期不支持部分复制，会使用全量复制指令 <code v-pre>sync</code>，<code v-pre>Redis</code> 会自动根据当前版本来决定使用哪一个指令）。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 数据同步指令</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">psync</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">主节点复制标识replicationi</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">d</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">偏移量offse</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">t</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 如果 replicationid 设为 '?' 并且 offset 设为 '-1' 此时就是在尝试进行全量复制</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">#如果 replicationid offset 设为了具体的数值, 则是尝试进行部分复制</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>从节点使用后，主要发生了以下事情：</p>\n<figure><img src=\"@source/4.业务服务/3.缓存服务/assets/image-20241202145718801.png\" alt=\"\" tabindex=\"0\" loading=\"lazy\"><figcaption></figcaption></figure>\n<ol>\n<li>从节点发送 <code v-pre>psync</code> 命令给主节点，<code v-pre>replid</code> 和 <code v-pre>offset</code> 的默认值分别是 <code v-pre>?</code> 和 <code v-pre>-1</code></li>\n<li>主节点根据 <code v-pre>psync</code> 参数和自身数据情况决定响应结果：\n<ul>\n<li>如果回复 <code v-pre>+FULLRESYNC</code>，从节点进行全量复制流程</li>\n<li>如果回复 <code v-pre>+CONTINEU</code>，从节点进行部分复制流程</li>\n<li>如果回复 <code v-pre>-ERR</code>，说明 <code v-pre>Redis</code> 主节点版本过低，不支持 <code v-pre>psync</code> 命令，从节点可以使用 <code v-pre>sync</code> 命令进行全量复制</li>\n</ul>\n</li>\n</ol>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：当从节点初次连接主节点时，它不知道主节点的 <code v-pre>replicationid</code>（即它没有之前的同步信息）。</p>\n<p>这种情况下，从节点会发送 <code v-pre>PSYNC ? 0</code> 请求，表示它从未与主节点进行过同步，要求主节点进行全量同步。</p>\n</div>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：<code v-pre>psync</code> 一般不需要手动执行，<code v-pre>Redis-server</code> 会在主从复制模式下自动调用执行。</p>\n</div>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：<code v-pre>sync</code> 会阻塞 <code v-pre>redis server</code> 处理其他请求，<code v-pre>psync</code> 则不会。</p>\n</div>\n<h5 id=\"_1-2-3-5-详细过程\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-3-5-详细过程\"><span>1.2.3.5.详细过程</span></a></h5>\n<p>根据我们之前的知识，您也肯定明白两种复制方式的触发情况，但是我我们可以进一步细化这一步复制的概念。</p>\n<h6 id=\"_1-2-3-5-1-全量复制的细节\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-3-5-1-全量复制的细节\"><span>1.2.3.5.1.全量复制的细节</span></a></h6>\n<figure><img src=\"@source/4.业务服务/3.缓存服务/assets/image-20241202152620443.png\" alt=\"\" tabindex=\"0\" loading=\"lazy\"><figcaption></figcaption></figure>\n<ol>\n<li>从节点发送 <code v-pre>psync</code> 命令给主节点进行数据同步，由于是第一次进行复制，从节点没有主节点的运行 <code v-pre>ID</code> 和复制偏移量，所以发送 <code v-pre>psync ? -1</code>（不过有 <code v-pre>IP</code> 和<code v-pre>PORT</code> 所以不愁找不到主节点）。</li>\n<li>主节点根据命令，解析出要进行全量复制，回复 <code v-pre>+FULLRESYNC</code> 响应。</li>\n<li>从节点接收主节点的运行信息进行保存。</li>\n<li>主节点执行 <code v-pre>bgsave</code> 进行 <code v-pre>RDB</code> 文件的持久化。</li>\n<li>主节点发送 <code v-pre>RDB</code> 文件给从节点，从节点保存 <code v-pre>RDB</code> 数据到本地硬盘。</li>\n<li>主节点将从生成 <code v-pre>RDB</code> 到接收完成期间执行的写命令，写入到缓冲区中（不是指积压缓冲区），等从节点保存完 <code v-pre>RDB</code> 文件后，主节点再将缓冲区内的数据补发给从节点，补发的数据仍然按照 <code v-pre>RDB</code> 的二进制格式追加写入到收 到的 <code v-pre>rdb</code> 文件中，保持主从一致性。</li>\n<li>从节点清空自身原有的旧数据。</li>\n<li>从节点加载 <code v-pre>RDB</code> 文件得到与主节点一致的数据。</li>\n<li>如果从节点加载 <code v-pre>RDB</code> 完成之后，并且开启了 <code v-pre>AOF</code> 持久化功能，它会进行 <code v-pre>bgrewriteaof</code> 操作（不阻塞地优化 <code v-pre>AOF</code> 文件），得到最近的 <code v-pre>AOF</code> 文件。</li>\n</ol>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：默认情况下，进行全量复制需要主节点生成 <code v-pre>RDB</code> 文件到主节点的磁盘中, 再把磁盘上的 <code v-pre>RDB</code> 文件通过发送给从节点。<code v-pre>Redis</code> 从 <code v-pre>2.8.18</code> 版本开始支持无磁盘复制。主节点在执行 <code v-pre>RDB</code> 生成流程时, 不会生成 <code v-pre>RDB</code> 文件到磁盘中了，而是直接把生成的 <code v-pre>RDB</code> 数据通过网络发送给从节点，这样就节省了一系列的写硬盘和读硬盘的操作开销。</p>\n</div>\n<h6 id=\"_1-2-3-5-2-部分复制的细节\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-3-5-2-部分复制的细节\"><span>1.2.3.5.2.部分复制的细节</span></a></h6>\n<figure><img src=\"@source/4.业务服务/3.缓存服务/assets/image-20241202152701081.png\" alt=\"\" tabindex=\"0\" loading=\"lazy\"><figcaption></figcaption></figure>\n<ol>\n<li>当主从节点之间出现网络中断时，如果超过 <code v-pre>repl-timeout</code> 时间，主节点会认为从节点故障并终止复制连接。</li>\n<li>主从连接中断期间主节点依然响应命令，但这些复制命令都因网络中断无法及时发送给从节点，所以暂时将这些命令滞留在 <strong>复制积压缓冲区</strong> 中。</li>\n<li>当主从节点网络恢复后，从节点再次连上主节点。</li>\n<li>从节点将之前保存的 <code v-pre>replicationId</code> 和 <code v-pre>offset</code> 作为 <code v-pre>psync</code> 的参数发送给主节点，请求进行部分复制。</li>\n<li>主节点接到 <code v-pre>psync</code> 请求后，进行必要的验证。随后根据 <code v-pre>offset</code> 去复制积压缓冲区查找合适的数据， 并响应 <code v-pre>+CONTINUE</code> 给从节点（如果超出缓冲区的范围就需要切换为全量复制了）。</li>\n<li>主节点将需要从节点同步的数据发送给从节点，最终完成一致性。</li>\n</ol>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：复制积压缓冲区的概念。</p>\n<figure><img src=\"@source/4.业务服务/3.缓存服务/assets/image-20241202153856009.png\" alt=\"\" tabindex=\"0\" loading=\"lazy\"><figcaption></figcaption></figure>\n<p>复制积压缓冲区是保存在主节点上的一个固定长度的队列，默认大小为 <code v-pre>1MB</code>，当主节点有连接的从节点时被创建，这时主节点响应写命令时，不但会把命令发送给从节点，还会写入复制积压缓冲区，</p>\n<p>由于积压缓冲区本质上是先进先出的定长队列，所以能实现保存最近已复制数据的功能，用于补救 <strong>部分复制或复制命令</strong> 中丢失的数据。复制缓冲区相关统计信息可以通过主节点的 <code v-pre>info replication</code> 中。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 积压缓冲区信息</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">info</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replication</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># Replication</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">role:master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_active:1</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 开启复制缓冲区</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_size:1048576</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 缓冲区最大长度 </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_first_byte_offset:7479</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 起始偏移量, 计算当前缓冲区可用范围</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_histlen:1048576</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 已保存数据的有效长度</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 可算出复制积压缓冲区内的可用偏移量范围: [repl_backlog_first_byte_offset, repl_backlog_first_byte_offset + repl_backlog_histlen]</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></div>\n<h3 id=\"_1-3-哨兵节点\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-3-哨兵节点\"><span>1.3.哨兵节点</span></a></h3>\n<h4 id=\"_1-3-1-概念\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-3-1-概念\"><span>1.3.1.概念</span></a></h4>\n<p><code v-pre>Redis</code> 的主从复制模式可以将主节点的数据改变同步给从节点，这样从节点就可以起到两个作用：</p>\n<ul>\n<li>作为主节点的一个备份，一旦主节点出了故障不可达的情况，从节点可以作为后备“顶替”上来，并且保证数据尽量不丢失（主从复制表现为最终一致性）</li>\n<li>从节点可以分担主节点上的读压力，让主节点只承担写请求的处理，将所有的读请求负载均衡到各个从节点上。 但是主从复制模式并不是万能的，它同样遗留下以下几个问题：\n<ul>\n<li>主节点发生故障时，进行主备切换的过程是复杂的，需要完全的人工参与，导致故障恢复时间无法得到保障（这个用哨兵来解决）。</li>\n<li>主节点可以将读压力分散出去，但写压力/存储压力是无法法被分担的，还是受到单机的限制。 其中第一个问题是高可用问题，即 <code v-pre>Redis</code> 哨兵主要解决的问题（这个用集群来解决）。</li>\n</ul>\n</li>\n</ul>\n<p>不过，我们先来观察一个主节点故障后，一名运维工程师是如何 <Plot>在睡梦中惊醒后</Plot> 快速恢复服务 <Plot>然后回去继续补觉</Plot> 的。</p>\n<ol>\n<li>运维工程师监控面板，发现公司应用出现问题，排查后发现是分布式 <code v-pre>Redis</code> 的主节点发生了故障（假设这个应用只使用了一个主节点，多个一级从节点），但是此应用读取数据是没有问题只是无法写入。</li>\n<li>运维工程师在多个从节点中选择一个选择一个节点作为新主节点，修改所有从节点的配置文件，时从节点们指向新主节点，新的主节点也可以继续使用原有的读操作。</li>\n<li>运维工程师再修改应用的配置文件，让应用连接新的主节点，应用恢复写能力。</li>\n<li>运维工程师排除设计的旧主节点的问题后，修改旧主节点转化为新从节点，加入到分布式 <code v-pre>Redis</code> 架构中，以新主节点作为主节点。</li>\n</ol>\n<p>整个过程也被称为 <strong>故障转移</strong>，因此我们认为 <Plot>运维工程师真的很惨...咳咳</Plot> 这个应用并不高可用，我们希望这个过程是自动的，运维工程师只需要观察异常日志和指定分布是架构节点个数即可。</p>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：这里梳理一下概念。</p>\n<ul>\n<li>数据节点包含主节点、从节点，节点内运行 <code v-pre>redis-server</code> 服务</li>\n<li>哨兵集合内包含哨兵节点，节点内运行 <code v-pre>redis-sentinel</code> 服务</li>\n<li>应用方也叫客户端，可以是命令行也可以是语言第三方库</li>\n</ul>\n</div>\n<p>为了解决上面的问题，<code v-pre>Redis</code> 提出了 <code v-pre>Redis Sentinel</code> 这个分布式架构解决方案，其中包含若干个哨兵节点和数据节点。每个哨兵节点会对数据节点和其余 <code v-pre>Sentinel</code> 节点进行监控（在哨兵节点集合中，存在类似循环链表结构的互相监督机制），当它发现节点不可达时，会对节点做下线标识。</p>\n<p>如果下线的是主节点，它还会和其他的 <code v-pre>Sentinel</code> 节点（所有哨兵节点最好保持奇数总数，避免出现无法选举的问题）进行“协商”，当大多数 <code v-pre>Sentinel</code> 节点对主节点不可达这个结论达成共识之后，它们自己会在哨兵节点集合内部“选举”出一个 <strong>领导节点</strong> 来完成自动故障转移的工作，同时将这个变化实时通知给 <code v-pre>Redis</code> 应用方。整个过程是完全自动的，不需要人工介入。因此大体的流程和上面运维工程师做的类似，故障转移的流程大体如下：</p>\n<figure><img src=\"@source/4.业务服务/3.缓存服务/assets/image-20241202215147107.png\" alt=\"\" tabindex=\"0\" loading=\"lazy\"><figcaption></figcaption></figure>\n<ol>\n<li>监控：主节点故障，从节点同步连接中断，主从复制停止。哨兵节点通过定期监控发现主节点出现故障</li>\n<li>故障转移：哨兵节点与其他哨兵节点进行协商，达成多数认同主节点故障的共识（防止出故障的不是主节点，而是负责发现故障的哨兵节点，该情况经常发生于哨兵节点的网络被孤立的场景下）。后哨兵节点之间使用 <code v-pre>Raft</code> 算法选举出一个领导角色，由该节点负责后续的故障转移工作，哨兵领导者开始执行故障转移：\n<ul>\n<li>在从节点集合中选择一个作为新主节点</li>\n<li>让其他从节点同步新主节点</li>\n</ul>\n</li>\n<li>通知：通知应用层转移到新主节点</li>\n</ol>\n<h4 id=\"_1-3-2-部署\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-3-2-部署\"><span>1.3.2.部署</span></a></h4>\n<p>由于带有哨兵节点的分布式架构，直接本机部署多个数据节点和哨兵节点是有些麻烦的，因此为了演示方便，这里将会使用 <code v-pre>Docker Compose</code> 统一管理多个数据节点容器和多个哨兵节点容器。</p>\n<div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>注意：如果您没有学习过 <code v-pre>Docker</code> 相关的知识，其实也很难理解后面的集群知识，因此这里建议学习过一些 <code v-pre>Docker</code> 的操作和原理再来继续查阅本文档...</p>\n</div>\n<h5 id=\"_1-3-2-1-准备工作\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-3-2-1-准备工作\"><span>1.3.2.1.准备工作</span></a></h5>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 准备工作</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 安装编排工具</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> apt</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> install</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker-compose</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker-compose</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -v</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Docker</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Compose</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> version</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> v2.26.1</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 停止原有服务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> stop</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># $ sudo systemctl stop redis-sentinel # 如果有的话</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 拉取最新镜像</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> pull</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis:latest</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"hint-container caution\">\n<p class=\"hint-container-title\">警告</p>\n<p>警告：建议和我相同版本。</p>\n</div>\n<h5 id=\"_1-3-2-2-主从编排\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-3-2-2-主从编排\"><span>1.3.2.2.主从编排</span></a></h5>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 编排主从</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> vim</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/redis/redis-data/docker-compose.yml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/redis/redis-data/docker-compose.yml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">services:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis1:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-node-1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-server</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> --appendonly</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> yes</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6379:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis2:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-node-2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-server</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> --appendonly</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> yes</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> --slaveof</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-node-1</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6380:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis3:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-node-3</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-server</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> --appendonly</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> yes</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> --slaveof</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-node-1</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6381:6379</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>上述配置文件描述了三个节点容器，一个主节点容器，两个从节点容器（都开启 <code v-pre>AOP</code> 持久化）。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 启动指令</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 根据不同编排配置启动分布式</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cd</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/redis/redis-data</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker-compose</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> up</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -d</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看默认的网络</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> network</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ls</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">NETWORK</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ID</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">     NAME</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">                 DRIVER</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    SCOPE</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">efe47f88acdc</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   redis-data_default</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        bridge</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    local</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 注意: 这个网络名称是根据 \"编排配置文件所在目录名称 + _default\" 得到的</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> network</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> inspect</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-data_default</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Name</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-data_default</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Id</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">8533d02081e2576057d6838168e5e1d6e87f5daba69a1ea7d69e51fd4cd151a5</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Created</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">2024-12-05T13:47:48.417830084+08:00</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Scope</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">local</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Driver</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">bridge</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">EnableIPv6</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">false</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPAM</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Driver</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">default</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Options</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: null,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Config</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                    \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Subnet</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.20.0.0/16</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                    \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Gateway</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.20.0.1</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">            ]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Internal</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">false</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Attachable</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">false</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Ingress</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">false</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">ConfigFrom</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Network</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">ConfigOnly</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">false</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Containers</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">5680ccfbbc0ff83424c2472f5993a40d181308919bf6a0d4c5e7629e0d70f986</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Name</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-node-1</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">EndpointID</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">63fb132ccd54ae3cd7aa2c84ca7d66c8b7ea55a2f6945f47ccf42b065f635cc3</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">MacAddress</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">02:42:ac:14:00:03</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv4Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.20.0.3/16</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv6Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">6542ad572406c4a42f4cdc470f7bc7a11efa434709976b961ffb5bca6fb6a9c0</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Name</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-node-2</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">EndpointID</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">23dd68fec78289df8ac836cf4d91b04bc541847339a9a1b2d59d08ab285511ec</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">MacAddress</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">02:42:ac:14:00:04</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv4Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.20.0.4/16</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv6Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">f848db6f4005b6884cfeedbb3fe8beec5d3a51fde536305c2c756e6fa6999f80</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Name</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-node-3</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">EndpointID</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">4b7fe30897519d432fd4ff9a30b7c36baddfa8c8665b847cc109dc4ce1999c98</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">MacAddress</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">02:42:ac:14:00:02</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv4Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.20.0.2/16</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv6Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Options</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {},</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Labels</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">com.docker.compose.network</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">default</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">com.docker.compose.project</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-data</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">com.docker.compose.version</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">2.26.1</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 检查主从运行情况</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">info</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replication</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># Replication</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">role:master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">connected_slaves:2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave0:ip</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">=172.20.0.4,port=6379,state=online,offset=252,lag=0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave1:ip</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">=172.20.0.2,port=6379,state=online,offset=252,lag=0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_failover_state:no-failover</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_replid:8d4657bef20c6a9b9e260f04fe86a919fdc2db1f</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_replid2:0000000000000000000000000000000000000000</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_repl_offset:252</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">second_repl_offset:-1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_active:1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_size:1048576</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_first_byte_offset:1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_histlen:252</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">set</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> my_key</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 114514</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">OK</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> my_key</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"114514\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6380</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6380</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> my_key</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"114514\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6380</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6381</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6381</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> my_key</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"114514\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6381</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h5 id=\"_1-3-2-3-哨兵编排\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-3-2-3-哨兵编排\"><span>1.3.2.3.哨兵编排</span></a></h5>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 编排哨兵</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> vim</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/redis/redis-sentinel/docker-compose.yml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/redis/redis-sentinel/docker-compose.yml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">networks:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis-data_default:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    external:</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> true</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 表示网络来自外部</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">services:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  sentinel1:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-sentinel-1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    networks:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-data_default</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-server /etc/redis-config/redis.conf --sentinel</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    volumes:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">./sentinel2:/etc/redis-config</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 26379:26379</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  sentinel2:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-sentinel-2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    networks:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-data_default</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-server /etc/redis-config/redis.conf --sentinel</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    volumes:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">./sentinel2:/etc/redis-config</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 26380:26379</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  sentinel3:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-sentinel-3</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    networks:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-data_default</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-server /etc/redis-config/redis.conf --sentinel</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    volumes:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">./sentinel3:/etc/redis-config</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 26381:26379</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>每个哨兵节点其实在一开始都使用同一份内容配置文件，但是被我分开为三个配置文件 ，且每个哨兵节点都在监视主节点，三个节点的总票数为 <code v-pre>3</code> 只需要 <code v-pre>2</code> 张票即可判定主节点下线。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">  # 先查看现有的 Redis 主数据节点分配到的 ip 地址</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> network</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> inspect</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-data_default</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># ...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">            \"5680ccfbbc0ff83424c2472f5993a40d181308919bf6a0d4c5e7629e0d70f986\"</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">                \"Name\"</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-node-1</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">                \"EndpointID\"</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">63fb132ccd54ae3cd7aa2c84ca7d66c8b7ea55a2f6945f47ccf42b065f635cc3</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">                \"MacAddress\"</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">02:42:ac:14:00:03</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">                \"IPv4Address\"</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.20.0.3/16</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">                \"IPv6Address\"</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># ...</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 编写配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cd</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/redis/redis-sentinel</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> mkdir</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sentinel1</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sentinel2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sentinel3</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> vim</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sentinel1/redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bind</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0.0.0.0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">port</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 26379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> monitor</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.3</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 警告: 不允许使用容器名称替换 ip 地址</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> down-after-milliseconds</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1000</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 这里标识 sentinel monitor 主节点名 主节点ip 主节点端口 法定票数</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 复制三份配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cp</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  sentinel1/redis.conf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sentinel2/redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cp</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sentinel1/redis.conf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sentinel3/redis.conf</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看文件目录结构</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> $</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> tree</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -L</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker-compose.yml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sentinel1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">│</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sentinel2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">│</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">└──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sentinel3</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    └──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis.conf</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"hint-container caution\">\n<p class=\"hint-container-title\">警告</p>\n<p>警告：<code v-pre>redis-sentinel</code> 在运行过此中可能会对配置进行 <code v-pre>rewrite(重写)</code> 导致文件内容发生修改，如果用一份文件，就可能出现修改混乱的情况（例如三个哨兵节点监视的主节点失效后，就需要更改配置文件中主节点的 <code v-pre>ip</code> 和 <code v-pre>port</code>）。</p>\n</div>\n<div class=\"hint-container caution\">\n<p class=\"hint-container-title\">警告</p>\n<p>警告：将三个 <code v-pre>redis.conf</code> 放在各个目录中是必要的，我也不太清楚原因，但是我确实有搜索到 <a href=\"https://stackoverflow.com/questions/70384566/warning-sentinel-was-not-able-to-save-the-new-configuration-on-disk-device\" target=\"_blank\" rel=\"noopener noreferrer\">相关的资料</a>，不过也没有详细解释原因...</p>\n</div>\n<div class=\"hint-container caution\">\n<p class=\"hint-container-title\">警告</p>\n<p>补充：之前的 <code v-pre>redis</code> 数据节点之所以可以直接使用 <code v-pre>redis-master</code> 名称作为域名解析，是因为编排文件默认生成一个局域网，三个数据节点处于同一个局域网 <code v-pre>redis-data_default</code> 中。因此 <code v-pre>docker</code> 可以根据默认 <code v-pre>DNS</code> 解析得到容器在局域网中的 <code v-pre>ip</code>，但是貌似因为 <code v-pre>Redis</code> 最新版本中没有完全为哨兵节点适配这个问题，因此后面的三份 <code v-pre>redis.conf</code> 配置文件是根据前面分配给主数据节点的 <code v-pre>ip</code> 硬编码进去的，这里也有一些相关资料供您参考...</p>\n<ul>\n<li><a href=\"https://blog.csdn.net/weixin_63028438/article/details/136077092\" target=\"_blank\" rel=\"noopener noreferrer\">CSDN 相关资料</a></li>\n<li><a href=\"https://stackoverflow.com/questions/57464443/redis-sentinel-throws-error-cant-resolve-master-instance-hostname\" target=\"_blank\" rel=\"noopener noreferrer\">堆栈溢出相关资料</a></li>\n<li><a href=\"https://redis.io/docs/latest/operate/oss_and_stack/management/sentinel/#ip-addresses-and-dns-names\" target=\"_blank\" rel=\"noopener noreferrer\">Redis 官方文档</a></li>\n</ul>\n</div>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 启动指令</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> $</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cd</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/redis/redis-sentinel/</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> $</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker-compose</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> up</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -d</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> $</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker-compose</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ls</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> NAME</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">                STATUS</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">              CONFIG</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> FILES</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">redis-data</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">          running</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">3</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">          /etc/redis/redis-data/docker-compose.yml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">redis-sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">      running</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">3</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">          /etc/redis/redis-sentinel/docker-compose.yml</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>上述配置文件描述了三个哨兵节点容器，分别监听配置文件里规定的数据节点容器。</p>\n<h5 id=\"_1-3-2-4-现象观察\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-3-2-4-现象观察\"><span>1.3.2.4.现象观察</span></a></h5>\n<figure><img src=\"@source/4.业务服务/3.缓存服务/assets/未命名文件.png\" alt=\"\" tabindex=\"0\" loading=\"lazy\"><figcaption></figcaption></figure>\n<p>根据配置文件<code v-pre>docker</code> 网络应该符合上图，我们可以简单查看一下。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看网络</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> network</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> inspect</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-data_default</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Name</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-data_default</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Id</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">8533d02081e2576057d6838168e5e1d6e87f5daba69a1ea7d69e51fd4cd151a5</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Created</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">2024-12-05T13:47:48.417830084+08:00</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Scope</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">local</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Driver</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">bridge</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">EnableIPv6</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">false</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPAM</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Driver</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">default</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Options</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: null,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Config</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                    \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Subnet</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.20.0.0/16</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                    \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Gateway</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.20.0.1</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">            ]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Internal</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">false</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Attachable</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">false</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Ingress</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">false</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">ConfigFrom</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Network</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">ConfigOnly</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">false</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Containers</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">30fc3d7275e9e5c3a252c9838af4df3e0dcdb3d7aaa491247117b32c0d1733fd</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Name</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-sentinel-1</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">EndpointID</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">897b230ed7894a039328c8cac06a0eafb28c12b714814873e8693696d2243696</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">MacAddress</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">02:42:ac:14:00:05</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv4Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.20.0.5/16</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv6Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">3b3913ebe84f1997aaed3b4e632b33a62b324c77e614b8ad3bdc0866411f0cc4</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Name</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-sentinel-3</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">EndpointID</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">60092aabd2445d68477326529fe604b6daecc46bb5ddd7dbdc6c63ef1c5eee3b</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">MacAddress</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">02:42:ac:14:00:07</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv4Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.20.0.7/16</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv6Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">5680ccfbbc0ff83424c2472f5993a40d181308919bf6a0d4c5e7629e0d70f986</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Name</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-node-1</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">EndpointID</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">63fb132ccd54ae3cd7aa2c84ca7d66c8b7ea55a2f6945f47ccf42b065f635cc3</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">MacAddress</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">02:42:ac:14:00:03</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv4Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.20.0.3/16</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv6Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">6542ad572406c4a42f4cdc470f7bc7a11efa434709976b961ffb5bca6fb6a9c0</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Name</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-node-2</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">EndpointID</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">23dd68fec78289df8ac836cf4d91b04bc541847339a9a1b2d59d08ab285511ec</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">MacAddress</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">02:42:ac:14:00:04</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv4Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.20.0.4/16</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv6Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">7803c0046b724adcd30524b4241cd0f9d0aa17db187c08a3cf3e3dbd6b147d1b</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Name</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-sentinel-2</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">EndpointID</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">c6186ef8769b3719dfbafbc261471a65717ad88acd4e0571e220c7fd0c906fe5</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">MacAddress</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">02:42:ac:14:00:06</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv4Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.20.0.6/16</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv6Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">f848db6f4005b6884cfeedbb3fe8beec5d3a51fde536305c2c756e6fa6999f80</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Name</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-node-3</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">EndpointID</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">4b7fe30897519d432fd4ff9a30b7c36baddfa8c8665b847cc109dc4ce1999c98</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">MacAddress</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">02:42:ac:14:00:02</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv4Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.20.0.2/16</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv6Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Options</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {},</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Labels</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">com.docker.compose.network</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">default</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">com.docker.compose.project</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-data</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">com.docker.compose.version</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">2.26.1</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 观察现象</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看哨兵节点日志</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> container</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> logs</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-sentinel-1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 06:45:37.907</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> oO0OoO0OoO0Oo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Redis</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> is</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> starting</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> oO0OoO0OoO0Oo</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 06:45:37.907</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Redis</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> version=7.4.1,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> bits=64,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> commit=00000000,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> modified=0,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> pid=1,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> just</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> started</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 06:45:37.907</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Configuration</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> loaded</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 06:45:37.907</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> monotonic</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> clock:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> POSIX</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> clock_gettime</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 06:45:37.908</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Running</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> mode=sentinel,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> port=26379.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 06:45:37.908</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ID</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> is</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 37d3396d0d849849aae8412b320123e38a774f7f</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 06:45:37.908</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # +monitor master redis-master 172.20.0.3 6379 quorum 2 # 开始监控主节点, 并且配置仲裁数量为 2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 06:45:39.973</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> +sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 37d3396d0d849849aae8412b320123e38a774f7f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.6</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 26379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> @</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.3</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 注册一个哨兵节点监控主数据节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 06:45:39.979</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> new</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> configuration</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> saved</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> on</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> disk</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 06:45:39.981</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> +sentinel-address-switch</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.3</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ip</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.5</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> port</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 26379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> for</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 37d3396d0d849849aae8412b320123e38a774f7f</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 注册一个哨兵节点监控主数据节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 06:45:39.983</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> new</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> configuration</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> saved</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> on</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> disk</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 06:45:39.992</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> +sentinel-address-switch</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.3</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ip</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.7</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> port</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 26379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> for</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4ac62e0c7bde83b4acd18aa35bb544a7936f1a30</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 注册一个哨兵节点监控主数据节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 06:45:39.995</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> new</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> configuration</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> saved</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> on</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> disk</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 哨兵节点加载并且保存了新的配置到磁盘中</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sentinel1/redis.conf</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bind</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0.0.0.0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">port</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 26379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> monitor</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.3</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> down-after-milliseconds</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1000</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># Generated by CONFIG REWRITE  # 这一部分也是新增加的部分, 是哨兵节点写入的, 我们需要分开三个配置文件书写的原因就是因为哨兵节点会对配置文件进行修改</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">dir</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/data</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # Redis Sentinel 工作目录</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">latency-tracking-info-percentiles</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 50</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 99</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 99.9</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 配置延迟跟踪的百分位</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">user</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> default</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> on</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nopass</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sanitize-payload</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ~</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">*</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> &#x26;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> +@all </span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 配置默认用户的权限及认证方式</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> myid</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> b6acb72ff13c744f8559c5582f97490af5dfa5c0</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 当前哨兵节点的唯一标识符</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> config-epoch</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 配置主节点的纪元值, 用于主节点选举时的版本控制</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> leader-epoch</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 记录当前哨兵选举过程中被选中的主节点的纪元</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> current-epoch</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 当前哨兵的纪元 </span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> known-replica</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.2</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 声明一个已知的副本节点(从数据节点)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> known-replica</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.4</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 声明一个已知的副本节点(从数据节点)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> known-sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.6</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 26379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4ac62e0c7bde83b4acd18aa35bb544a7936f1a30</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 已知的其他哨兵节点信息</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> known-sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.7</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 26379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 37d3396d0d849849aae8412b320123e38a774f7f</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 已知的其他哨兵节点信息</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 模拟主节点挂掉</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> container</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> stop</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-node-1</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 重新查看日志</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> container</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> logs</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-node-1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># (省略) ...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:32.069</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # +sdown master redis-master 172.20.0.3 6379 # 本哨兵节点检测到主节点失效(主观下线)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:32.131</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # +odown master redis-master 172.20.0.3 6379 #quorum 2/2 # 所有哨兵节点通过投票决定该主数据节点已经完全不可用(客观下线), 这里的 quorum 意为多数同意</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># >>> begin: 开始故障转移 >>></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:32.131</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # +new-epoch 1 # 创建了一个新的选举周期, 标识为 1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:32.131</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # +try-failover master redis-master 172.20.0.3  # 开始尝试进行主节点故障转移</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:32.137</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> new</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> configuration</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> saved</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> on</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> disk</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # Sentinel 已经将新的配置加载的磁盘中</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:32.137</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # +vote-for-leader 37d3396d0d849849aae8412b320123e38a774f7f 1 # 选举新的领导</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:32.137</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 37d3396d0d849849aae8412b320123e38a774f7f</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> voted</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> for</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 37d3396d0d849849aae8412b320123e38a774f7f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:32.141</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4ac62e0c7bde83b4acd18aa35bb544a7936f1a30</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> voted</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> for</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 37d3396d0d849849aae8412b320123e38a774f7f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:32.214</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # +elected-leader master redis-master 172.20.0.3 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:32.214</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # +failover-state-select-slave master redis-master 172.20.0.3 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:32.305</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # +selected-slave slave 172.20.0.2:6379 172.20.0.2 6379 @ redis-master 172.20.0.3 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:32.305</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> +failover-state-send-slaveof-noone</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.20.0.2:6379</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.2</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> @</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.3</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:32.456</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> +failover-state-wait-promotion</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.20.0.2:6379</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.2</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> @</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.3</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:33.393</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> new</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> configuration</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> saved</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> on</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> disk</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:33.393</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # +promoted-slave slave 172.20.0.2:6379 172.20.0.2 6379 @ redis-master 172.20.0.3 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:33.393</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # +failover-state-reconf-slaves master redis-master 172.20.0.3 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:33.449</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> +slave-reconf-sent</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.20.0.4:6379</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.4</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> @</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.3</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:34.393</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> +slave-reconf-inprog</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.20.0.4:6379</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.4</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> @</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.3</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:34.393</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> +slave-reconf-done</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.20.0.4:6379</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.4</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> @</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.3</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:34.455</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # +failover-end master redis-master 172.20.0.3 6379 # 完成故障转移</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># &#x3C;&#x3C;&#x3C; end &#x3C;&#x3C;&#x3C;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:34.455</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # +switch-master redis-master 172.20.0.3 6379 172.20.0.2 6379 # 切换主节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:34.455</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> +slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.20.0.4:6379</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.4</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> @</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.2</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 更新新的从节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:34.455</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> +slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.20.0.3:6379</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.3</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> @</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.2</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 更新新的从节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:34.457</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> new</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> configuration</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> saved</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> on</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> disk</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:35.506</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # +sdown slave 172.20.0.3:6379 172.20.0.3 6379 @ redis-master 172.20.0.2 6379</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 重新访问新的主节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> container</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ls</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> |</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> grep</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">30fc3d7275e9</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">   \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">docker-entrypoint.s…</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">   2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> hours</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ago</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   Up</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> hours</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   6379/tcp,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 0.0.0.0:26379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">-</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">26379/tcp,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> :::26379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">-</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">26379/tcp</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">     redis-sentinel-1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">7803c0046b72</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">   \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">docker-entrypoint.s…</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">   2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> hours</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ago</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   Up</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> hours</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   6379/tcp,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 0.0.0.0:26380</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">-</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">26379/tcp,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [::]:26380-</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">26379/tcp   redis-sentinel-2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">3b3913ebe84f</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">   \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">docker-entrypoint.s…</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">   2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> hours</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ago</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   Up</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> hours</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   6379/tcp,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 0.0.0.0:26381</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">-</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">26379/tcp,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [::]:26381-</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">26379/tcp   redis-sentinel-3</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">6542ad572406</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">   \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">docker-entrypoint.s…</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">   3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> hours</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ago</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   Up</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> hours</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   0.0.0.0:6380</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">-</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">6379/tcp,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [::]:6380-</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">6379/tcp                 redis-node-2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">f848db6f4005</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">   \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">docker-entrypoint.s…</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">   3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> hours</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ago</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   Up</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> hours</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   0.0.0.0:6381</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">-</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">6379/tcp,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [::]:6381-</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">6379/tcp                 redis-node-3</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 进入客户端</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6380</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看最新配置</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6380</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">info</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replication</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># Replication</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">role:slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_host:172.20.0.2</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 容器内部的 id</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_port:6379</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 容器内部的 port</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_link_status:up</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_last_io_seconds_ago:1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_sync_in_progress:0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave_read_repl_offset:1465716</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave_repl_offset:1465716</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave_priority:100</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave_read_only:1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">replica_announced:1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">connected_slaves:0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_failover_state:no-failover</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_replid:d6cda86c05c8b419d7d5a8775c9ee7478d2c451e</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_replid2:8d4657bef20c6a9b9e260f04fe86a919fdc2db1f</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_repl_offset:1465716</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">second_repl_offset:808512</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_active:1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_size:1048576</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_first_byte_offset:408801</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_histlen:1056916</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 检查是否只读</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6381</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">config</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica-read-only</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">replica-read-only</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">yes</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 取消只读配置</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6381</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">config</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> set</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica-read-only</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> no</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">OK</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 测试是否发生主从复制</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6381</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">set</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> my_key</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">1433223</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">OK</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6381</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> my_key</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"1433223\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6381</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6380</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6380</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> my_key</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"1433223\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6380</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 回复旧的主节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> container</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> start</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-node-1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">redis-node-1</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> my_key</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"114514\"</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 还没有更改, 因为是懒加载的</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6381</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6381</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> my_key</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">8848</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6381</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> my_key</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"8848\"</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 这意味着这个旧主节点已经完全变为了新从节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：关于数据节点下线的判断。</p>\n<ul>\n<li>主观下线（<code v-pre>Subjectively Down, SDown</code>）：哨兵感知到主节点没心跳了，判定为主观下线</li>\n<li>客观下线（<code v-pre>Objectively Down, ODown</code>）: 多个哨兵达成一致意见，才能认为 <code v-pre>master</code> 确实下线了</li>\n</ul>\n</div>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：在进行主从切换时，所有参与的哨兵节点都会更新自己的配置，并带上当前的 <code v-pre>epoch</code> 标识，也就是所谓的“选举周期标识”。这样，其他哨兵节点就能知道哪个节点是最新的领导者，避免出现重复的操作。</p>\n</div>\n<div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>注意：哨兵节点最好是有奇数个，方便选举 <code v-pre>leader</code>，故障得票也更容易超过半数。</p>\n</div>\n<div class=\"hint-container caution\">\n<p class=\"hint-container-title\">警告</p>\n<p>警告：“主从复制+哨兵节点”的无人值守模式提高了高可用性，降低的运维成本，但也无法避免极端数据丢失的情况，并且也无法解决内存容量不够的问题，主节点所在的机器能存储的最多数据只和本机内存条有关，和其他从节点所在的机器的内存条是不会叠加的，毕竟从节点只是复制了主节点的数据而已。</p>\n</div>\n<h4 id=\"_1-3-3-原理\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-3-3-原理\"><span>1.3.3.原理</span></a></h4>\n<p>还是根据我们的架构图，<span style=\"text-emphasis:filled red;\">阐述一下 <code v-pre>Raft</code> 选举算法原理，待补充...</span></p>\n<figure><img src=\"@source/4.业务服务/3.缓存服务/assets/image-20241205170206256.png\" alt=\"\" tabindex=\"0\" loading=\"lazy\"><figcaption></figcaption></figure>\n<h2 id=\"_2-redis-写分离架构-多分片架构\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-redis-写分离架构-多分片架构\"><span>2.Redis 写分离架构/多分片架构</span></a></h2>\n<h3 id=\"_2-1-架构原理\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-1-架构原理\"><span>2.1.架构原理</span></a></h3>\n<p>如果我们把上述的读分离结构看作一个小集群，那么多个读分离结构就是一个大集群。这样做就会有多个主节点可以被写入，假定数据是 <code v-pre>1 TB</code> 的话，有三个这样的小集群，就可以根据分片算法，每个小集群存储数据集的 <code v-pre>1/3 TB</code> 即可。这样做既解决了读压力过大的问题又解决了写存储不够的问题。</p>\n<figure><img src=\"@source/4.业务服务/3.缓存服务/assets/高可用集群.png\" alt=\"\" tabindex=\"0\" loading=\"lazy\"><figcaption></figcaption></figure>\n<p><code v-pre>Redis</code> 有什么必要需要这么做么？有，例如搜索引擎，这种需求对读写响应速度是强需求，对海量数据存储也是强需求。</p>\n<h3 id=\"_2-2-分片算法\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-2-分片算法\"><span>2.2.分片算法</span></a></h3>\n<p>一个小集群相当于一个分片，可是直接引入某种机制一定会造成某些问题，假设给定数据全集</p>\n<ul>\n<li>这些数据应该写入到哪一个分片上？</li>\n<li>这些数据应该读出到哪一个分片上？</li>\n</ul>\n<h4 id=\"_2-2-1-哈希求余算法\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-2-1-哈希求余算法\"><span>2.2.1.哈希求余算法</span></a></h4>\n<p>假设有 <code v-pre>N</code> 个分片，使用<code v-pre>[0, N-1]</code> 的顺序进行编号，针对某个键值对，根据键名通过算法（例如 <code v-pre>md5</code> 算法）得到哈希值结果，再使用 <code v-pre>%N</code> 来求余，最终余数就是分片编号，根据计算出来的编号存储键值对即可。而读取的问题也是，根据想要获取键值对的键名，依葫芦画瓢得到对应的分片编号后，最对应的分区中查找即可。</p>\n<p>这种方式简单高效，数据分配相对均匀（其实表现一般），但缺点就是拓展性差，一旦分区数量增加，就会导致原有的映射规则被破坏，一旦需要扩容就需要重新对所有的键值对进行分区，数据在节点之间多次流动以满足新的映射规则，这增加了维护成本。并且在业务中如果发生分区拓展，造成的数据流动会影响业务的正常读写，有可能导致严重的数据一致性问题。迁移的过程中一旦发生数据丢失，就会导致数据丢失的严重情况。</p>\n<h4 id=\"_2-2-2-一致性哈希算法\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-2-2-一致性哈希算法\"><span>2.2.2.一致性哈希算法</span></a></h4>\n<figure><img src=\"@source/4.业务服务/3.缓存服务/assets/yzxhxsf.png\" alt=\"\" tabindex=\"0\" loading=\"lazy\"><figcaption></figcaption></figure>\n<p>换一种思路，我们不再进行简单的求余，把 <span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">[</mo><mn>0</mn><mo separator=\"true\">,</mo><msup><mn>2</mn><mn>32</mn></msup><mo>−</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">[0, 2^{32}-1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">32</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span> 这个数据空间映射到一个圆环上，数据按照顺时针的方向增长，键值对的键名映射为哈希值 <code v-pre>H</code> 后，假设我们有 <code v-pre>N</code> 个分片，人为设置分布在圆环上的 <code v-pre>N</code> 个点的位置上（分片点）。然后根据 <code v-pre>H</code> 在圆环上的位置，顺时针往下寻找分片点，遇到第一个分片点就把键值对存储到对应的分片中。</p>\n<p>这种分配方式相当于把所有的哈希值的可能取值都提前做好了分区，如果需要扩容，就可以在某两个分片之间新建一个分片点，新的分片点将夺取前一个分片点的部分数据（分片点按照顺时针顺序分前后），这样每分一个分片就会增加存储量，减少前一个分片的压力。大大减少了扩容时数据搬运的规模，提高了扩容操作的效率，同时不影响业务读写。但缺点就是有可能发生数据分配不均匀，导致数据倾斜。</p>\n<p>为此 一致性哈希做了更多的优化，也就是 <code v-pre>虚拟节点</code>。 当节点较少的时候，为每个物理节点 <code v-pre>创建多个虚拟节点</code>，使所有的节点 <code v-pre>均匀的分布</code> 在 <code v-pre>Hash</code> 环上 ， 从而使数据<code v-pre>相对均衡</code>。当数据操作请求进来时 ， 如果指向了虚拟节点，就映射到实际的物理节点中。通过这样的方式，就可以保证数据的相对均衡。 当然，这种均衡还是相对的。</p>\n<p>另外，更加严重的问题是，如果某个节点集群发生雪崩（当大量读写涌入时，无论如何更替主从节点，最后整个节点集群还是会刮掉），但是后续的节点集群如果负荷能力甚至都比前面节点集群要小，就会导致后续的节点集群继续承接读写压力，过一段时间再次崩溃，一直往后就会造成雪崩的问题。这种问题轻微会导致数据倾斜、部分数据丢失，严重会导致整个 <code v-pre>Redis</code> 大集群（也就是圆环上所有的节点集群）失去响应。尽管有人提出了虚拟节点的方式来解决这个问题，但是也会增加系统的复杂度和维护难度。</p>\n<h4 id=\"_2-2-3-哈希槽算法\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-2-3-哈希槽算法\"><span>2.2.3.哈希槽算法</span></a></h4>\n<figure><img src=\"@source/4.业务服务/3.缓存服务/assets/img_v3_02ha_93cb8443-7827-4a14-88bf-aec811367b6g.jpg\" alt=\"\" tabindex=\"0\" loading=\"lazy\"><figcaption></figcaption></figure>\n<p>上述两种方式一是导致扩容成本高，二是导致分配不均匀，因此 <code v-pre>Redis cluster</code> 就引入了哈希槽算法（例如使用 <span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>h</mi><mi>a</mi><mi>s</mi><mi>h</mi><mi mathvariant=\"normal\">_</mi><mi>s</mi><mi>l</mi><mi>o</mi><mi>t</mi><mo>=</mo><mi>c</mi><mi>r</mi><mi>c</mi><mn>16</mn><mo stretchy=\"false\">(</mo><mi>k</mi><mi>e</mi><msub><mi>y</mi><mi>n</mi></msub><mi>a</mi><mi>m</mi><mi>e</mi><mo stretchy=\"false\">)</mo><mi mathvariant=\"normal\">%</mi><mn>16384</mn></mrow><annotation encoding=\"application/x-tex\">hash\\_slot = crc16(key_name) \\% 16384</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0044em;vertical-align:-0.31em;\"></span><span class=\"mord mathnormal\">ha</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">h</span><span class=\"mord\" style=\"margin-right:0.02778em;\">_</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">crc</span><span class=\"mord\">16</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mord mathnormal\">e</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\">am</span><span class=\"mord mathnormal\">e</span><span class=\"mclose\">)</span><span class=\"mord\">%16384</span></span></span></span> 的到哈希值）。<code v-pre>Redis cluster</code>采用数据分片的哈希槽来进行数据存储和数据的读取，<code v-pre>Redis cluster</code> 一共有 <span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mn>14</mn></msup><mo>=</mo><mn>16384</mn></mrow><annotation encoding=\"application/x-tex\">2^{14}=16384</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">14</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">16384</span></span></span></span>个槽，所有的 <code v-pre>master</code> 节点都会有一个槽区，比如 <span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">[</mo><mn>0</mn><mo separator=\"true\">,</mo><mn>1000</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">[0, 1000)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">1000</span><span class=\"mclose\">)</span></span></span></span>，槽数是可以迁移的。<code v-pre>master</code>节点的 <code v-pre>slave</code> 节点不分配槽，只拥有读权限。第一次新建 <code v-pre>Redis cluster</code> 时，<code v-pre>16384</code> 个槽是被 <code v-pre>master</code> 节点均匀分布的。</p>\n<p>哈希槽不是闭合的，并且一个键值对的键名计算得到哈希值后，是固定在某一个区域的，不会像一致性算法一样出现大面积雪崩的情况，哪怕是某一个节点集群故障了，也不会导致大量的读写压力转移到别的节点上，仍能保持业务一定的活性。</p>\n<p>并且扩容机制和一致性算法有些类似，但由于映射区域固定（一致性算法是遇到主节点才存储），也可以避免大面积的传输，是兼顾多方面的好手。</p>\n<h3 id=\"_2-3-搭建集群\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-3-搭建集群\"><span>2.3.搭建集群</span></a></h3>\n<p>前面的话太空，这里依旧是使用单机部署集群，真正意义上的跨主机集群，需要使用 <code v-pre>k8s</code> 来操作。在单机部署上，使用 <code v-pre>docker-compose</code> 模拟 <code v-pre>k8s</code> 工具，一个容器就是一台裸机。我们需要 <code v-pre>11</code> 个 <code v-pre>Redis</code> 节点，其中 <code v-pre>9</code> 个用来演示集群的搭建，<code v-pre>2</code> 个用作后续扩容缩容准备。</p>\n<h4 id=\"_2-3-1-设置目录\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-3-1-设置目录\"><span>2.3.1.设置目录</span></a></h4>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 设置目录</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cd</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/redis/</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> mkdir</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cluster</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cd</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cluster</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> touch</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker-compose.yml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> touch</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> generate.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> touch</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> dissipate.sh</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h4 id=\"_2-3-2-脚本文件\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-3-2-脚本文件\"><span>2.3.2.脚本文件</span></a></h4>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 脚本文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cd</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/redis/redis-cluster</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> vim</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> generate.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> generate.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># !/bin/bash</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 集群节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">for</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> port</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> $(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">seq</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 9</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">do</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    mkdir</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">${</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">port</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    touch</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">${</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">port</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    cat</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;&#x3C;</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> EOF</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> ></span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">${</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">port</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">/redis.conf</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 两个 EOF 之间的多行文本会被全部输入到 cat 中</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">port 6379 # 容器内的 PORT</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">bind 0.0.0.0 # 容器内的 IP</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">protected-mode no # 关闭保护模式(原本是会屏蔽掉一些不安全的访问的)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">appendonly yes # 开启 AOF 持久化</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster-enabled yes # 开启集群模式</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster-config-file nodes.conf # 指定集群配置文件的名称, 节点可以通过读取该文件来解集群的状态</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster-node-timeout 5000 # 设置集群节点超时时间</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster-announce-ip 172.30.0.10</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">${</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">port</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> # 向集群中的其他节点宣告自己的集群网络 IP</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster-announce-port 6379 # 向集群中的其他节点宣告自己的集群网络 PORT</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster-announce-bus-port 16379 # 集群内部节点之间的通信总线端口(集群管理的信息交互是通过这个端口进行的)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">EOF</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">done</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 备用节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">for</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> port</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> $(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">seq</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 10</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 11</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">do</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    mkdir</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">${</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">port</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    touch</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">${</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">port</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    cat</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;&#x3C;</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> EOF</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> ></span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">${</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">port</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">/redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">port 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">bind 0.0.0.0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">protected-mode no</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">appendonly yes</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster-enabled yes</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster-config-file nodes.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster-node-timeout 5000</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster-announce-ip 172.30.0.1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">${</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">port</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster-announce-port 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster-announce-bus-port 16379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">EOF</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">done</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> vim</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> dissipate.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> dissipate.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># !/bin/bash</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">rm</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -rf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">*</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 去除上述注释后运行脚本</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> bash</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> generate.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ls</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">dissipate.sh</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  generate.sh</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  redis1</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  redis10</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  redis11</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  redis2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  redis3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  redis4</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  redis5</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  redis6</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  redis7</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  redis8</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  redis9</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> tree</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -L</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> dissipate.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> generate.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">│</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis10</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">│</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis11</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">│</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">│</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis3</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">│</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis4</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">│</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis5</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">│</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis6</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">│</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis7</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">│</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis8</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">│</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">└──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis9</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    └──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis.conf</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">12</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> directories,</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 13</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> files</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看配置内容是否正确</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis1/redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">port</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bind</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0.0.0.0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">protected-mode</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> no</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">appendonly</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> yes</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">cluster-enabled</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> yes</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">cluster-config-file</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">cluster-node-timeout</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 5000</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">cluster-announce-ip</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.101</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">cluster-announce-port</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">cluster-announce-bus-port</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 16379</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"hint-container caution\">\n<p class=\"hint-container-title\">警告</p>\n<p>警告：注意请删除上面脚本中的注释后再运行。</p>\n</div>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：常用目录配置结构就是，使用一个目录来标识一个 <code v-pre>Redis</code> 集群，然后目录中存放多个节点目录（可能是数据节点，也可能是哨兵节点），节点目录中存放配置文件 <code v-pre>redis.conf</code>，我们可以根据 <code v-pre>redis-server</code> 读取不同的配置文件，来决定一个节点是数据节点还是哨兵节点。</p>\n</div>\n<h4 id=\"_2-3-3-编排文件\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-3-3-编排文件\"><span>2.3.3.编排文件</span></a></h4>\n<div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>注意：之前我们使用的网络名称是根据父目录名称来得到的，但是其实我们也可以自己自定义一个，下面的配置文件就事先定义了一个集群网络。</p>\n</div>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 编排容器</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cd</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/redis/redis-cluster</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> vim</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker-compose.yml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker-compose.yml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">#  先自定义集群网络 redis-cluster-net</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">networks:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis-cluster-net:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    driver:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> bridge</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ipam:</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 配置子网 IP 地址分配规则</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      config:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> subnet:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.0/24</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 配置子网范围为 172.30.0.1 到 172.30.0.254</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">services:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis1:</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 服务名</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 指定镜像文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis1</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 生成的容器名</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 设置自动重启策略</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    deploy:</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 部署</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      resources:</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 资源</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        limits:</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 最大额度</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 512M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        reservations:</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 最小额度</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 256M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    volumes:</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 存储映射</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ./redis1:/usr/local/etc/redis</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 端口映射</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6371:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-server</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/usr/local/etc/redis/redis.conf</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">]</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 启动指令</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    networks:</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 网络配置</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      redis-cluster-net:</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 在开头定义的子网网络中</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        ipv4_address:</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.101</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 为容器指定静态的 ipv4 地址, 避免地址改动引起其他地方的修改</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis2:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    deploy:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      resources:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        limits:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 512M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        reservations:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 256M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    volumes:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ./redis2:/usr/local/etc/redis</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6372:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-server</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/usr/local/etc/redis/redis.conf</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    networks:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      redis-cluster-net:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        ipv4_address:</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.102</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis3:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis3</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    deploy:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      resources:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        limits:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 512M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        reservations:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 256M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    volumes:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ./redis3:/usr/local/etc/redis</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6373:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-server</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/usr/local/etc/redis/redis.conf</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    networks:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      redis-cluster-net:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        ipv4_address:</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.103</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis4:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis4</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    deploy:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      resources:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        limits:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 512M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        reservations:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 256M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    volumes:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ./redis4:/usr/local/etc/redis</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6374:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-server</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/usr/local/etc/redis/redis.conf</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    networks:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      redis-cluster-net:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        ipv4_address:</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.104</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis5:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis5</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    deploy:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      resources:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        limits:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 512M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        reservations:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 256M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    volumes:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ./redis5:/usr/local/etc/redis</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6375:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-server</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/usr/local/etc/redis/redis.conf</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    networks:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      redis-cluster-net:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        ipv4_address:</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.105</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis6:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis6</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    deploy:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      resources:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        limits:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 512M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        reservations:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 256M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    volumes:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ./redis6:/usr/local/etc/redis</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6376:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-server</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/usr/local/etc/redis/redis.conf</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    networks:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      redis-cluster-net:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        ipv4_address:</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.106</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis7:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis7</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    deploy:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      resources:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        limits:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 512M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        reservations:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 256M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    volumes:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ./redis7:/usr/local/etc/redis</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6377:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-server</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/usr/local/etc/redis/redis.conf</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    networks:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      redis-cluster-net:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        ipv4_address:</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.107</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis8:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis8</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    deploy:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      resources:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        limits:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 512M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        reservations:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 256M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    volumes:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ./redis8:/usr/local/etc/redis</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6378:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-server</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/usr/local/etc/redis/redis.conf</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    networks:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      redis-cluster-net:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        ipv4_address:</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.108</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis9:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis9</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    deploy:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      resources:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        limits:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 512M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        reservations:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 256M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    volumes:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ./redis9:/usr/local/etc/redis</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6379:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-server</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/usr/local/etc/redis/redis.conf</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    networks:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      redis-cluster-net:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        ipv4_address:</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.109</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis10:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis10</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    deploy:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      resources:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        limits:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 512M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        reservations:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 256M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    volumes:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ./redis10:/usr/local/etc/redis</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6380:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-server</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/usr/local/etc/redis/redis.conf</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    networks:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      redis-cluster-net:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        ipv4_address:</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.110</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis11:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis11</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    deploy:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      resources:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        limits:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 512M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        reservations:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 256M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    volumes:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ./redis11:/usr/local/etc/redis</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6381:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-server</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/usr/local/etc/redis/redis.conf</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    networks:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      redis-cluster-net:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        ipv4_address:</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.111</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h4 id=\"_2-3-4-启动指令\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-3-4-启动指令\"><span>2.3.4.启动指令</span></a></h4>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 启动指令</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 启动编排中的容器</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker-compose</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> up</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -d</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 检查容器日志是否正常</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker-compose</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ls</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">NAME</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">                STATUS</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">              CONFIG</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> FILES</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">redis-cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">       running</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">11</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">         /etc/redis/redis-cluster/docker-compose.yml</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> container</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> logs</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:C</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 06</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 12:47:43.226</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # WARNING: Changing databases number from 16 to 1 since we are in cluster mode # 这个警告表示在 Redis 集群模式下, 数据库的数量已从 16 个减少为 1 个, 在默认的 Redis 单机模式下, Redis 允许使用 16 个数据库(编号从 0 到 15), 但是在集群模式下, Redis 只支持一个数据库(即 0 号数据库)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:C</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 06</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 12:47:43.226</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> oO0OoO0OoO0Oo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Redis</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> is</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> starting</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> oO0OoO0OoO0Oo</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:C</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 06</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 12:47:43.226</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Redis</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> version=7.4.1,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> bits=64,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> commit=00000000,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> modified=0,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> pid=1,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> just</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> started</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:C</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 06</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 12:47:43.226</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Configuration</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> loaded</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:M</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 06</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 12:47:43.226</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> monotonic</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> clock:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> POSIX</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> clock_gettime</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:M</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 06</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 12:47:43.227</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Running</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> mode=cluster,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> port=6379.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:M</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 06</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 12:47:43.227</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> No</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> configuration</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> found,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> I</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">m 9922b4fb888f86437a10912ed4505f86277b6c2e</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">1:M 06 Dec 2024 12:47:43.229 * Server initialized</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">1:M 06 Dec 2024 12:47:43.230 * Creating AOF base file appendonly.aof.1.base.rdb on server start</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">1:M 06 Dec 2024 12:47:43.233 * Creating AOF incr file appendonly.aof.1.incr.aof on server start</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">1:M 06 Dec 2024 12:47:43.233 * Ready to accept connections tcp</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"># 创建集群</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">$ redis-cli --cluster create \\ # 表示创建集群</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.30.0.101:6379 172.30.0.102:6379 172.30.0.103:6379 \\ # 加入集群的节点地址</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.30.0.104:6379 172.30.0.105:6379 172.30.0.106:6379 \\ # 加入集群的节点地址</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.30.0.107:6379 172.30.0.108:6379 172.30.0.109:6379 \\ # 加入集群的节点地址</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">--cluster-replicas 2 # 表示每一个节点需要两个从节点进行备份</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"># 完整指令为 redis-cli --cluster create 172.30.0.101:6379 172.30.0.102:6379 172.30.0.103:6379 172.30.0.104:6379 172.30.0.105:6379 172.30.0.106:6379 172.30.0.107:6379 172.30.0.108:6379 172.30.0.109:6379 --cluster-replicas 2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">>>> Performing hash slots allocation on 9 nodes...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Master[0] -> Slots 0 - 5460</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Master[1] -> Slots 5461 - 10922</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Master[2] -> Slots 10923 - 16383</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Adding replica 172.30.0.105:6379 to 172.30.0.101:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Adding replica 172.30.0.106:6379 to 172.30.0.101:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Adding replica 172.30.0.107:6379 to 172.30.0.102:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Adding replica 172.30.0.108:6379 to 172.30.0.102:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Adding replica 172.30.0.109:6379 to 172.30.0.103:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Adding replica 172.30.0.104:6379 to 172.30.0.103:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">M: 9922b4fb888f86437a10912ed4505f86277b6c2e 172.30.0.101:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   slots:[0-5460] (5461 slots) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">M: e42760e10502691aa9e9791a103ac77cb707c070 172.30.0.102:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   slots:[5461-10922] (5462 slots) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">M: 4544c27547b8392cbd5b2e7afcb80c0066d37e9f 172.30.0.103:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   slots:[10923-16383] (5461 slots) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">S: 12992b85a92de26dd849f1abf012ad674da733e4 172.30.0.104:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   replicates 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">S: bce31769a218d92d5a3735458e6e479759bdd500 172.30.0.105:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   replicates 9922b4fb888f86437a10912ed4505f86277b6c2e</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">S: 9cd6418590131bf0b6fa20c046ee9bbb06f56afe 172.30.0.106:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   replicates 9922b4fb888f86437a10912ed4505f86277b6c2e</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">S: 0903a2928d09168fa3cc2f4f74c96fe926eef8ef 172.30.0.107:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   replicates e42760e10502691aa9e9791a103ac77cb707c070</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">S: bc2a17498f1c88f2d827638625e3b998b5d36abf 172.30.0.108:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   replicates e42760e10502691aa9e9791a103ac77cb707c070</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">S: fc92b4b941bc55edc638b3ed5570c77649f11124 172.30.0.109:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   replicates 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Can I set the above configuration? (type </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">yes</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to accept): yes # 这里需要输入 yes 后回车</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">>>> Nodes configuration updated</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">>>> Assign a different config epoch to each node</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">>>> Sending CLUSTER MEET messages to join the cluster</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Waiting for the cluster to join</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">>>> Performing Cluster Check (using node 172.30.0.101:6379)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">M: 9922b4fb888f86437a10912ed4505f86277b6c2e 172.30.0.101:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   slots:[0-5460] (5461 slots) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   2 additional replica(s)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">S: 0903a2928d09168fa3cc2f4f74c96fe926eef8ef 172.30.0.107:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   slots: (0 slots) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   replicates e42760e10502691aa9e9791a103ac77cb707c070</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">M: e42760e10502691aa9e9791a103ac77cb707c070 172.30.0.102:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   slots:[5461-10922] (5462 slots) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   2 additional replica(s)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">S: bc2a17498f1c88f2d827638625e3b998b5d36abf 172.30.0.108:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   slots: (0 slots) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   replicates e42760e10502691aa9e9791a103ac77cb707c070</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">S: 9cd6418590131bf0b6fa20c046ee9bbb06f56afe 172.30.0.106:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   slots: (0 slots) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   replicates 9922b4fb888f86437a10912ed4505f86277b6c2e</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">S: 12992b85a92de26dd849f1abf012ad674da733e4 172.30.0.104:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   slots: (0 slots) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   replicates 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">S: bce31769a218d92d5a3735458e6e479759bdd500 172.30.0.105:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   slots: (0 slots) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   replicates 9922b4fb888f86437a10912ed4505f86277b6c2e</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">M: 4544c27547b8392cbd5b2e7afcb80c0066d37e9f 172.30.0.103:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   slots:[10923-16383] (5461 slots) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   2 additional replica(s)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">S: fc92b4b941bc55edc638b3ed5570c77649f11124 172.30.0.109:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   slots: (0 slots) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   replicates 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">[OK] All nodes agree about slots configuration.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">>>> Check for open slots...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">>>> Check slots coverage...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">[OK] All 16384 slots covered.</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"># 查看正在运行的容器</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">$ docker container ls</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">CONTAINER ID   IMAGE          COMMAND                   CREATED          STATUS          PORTS                                         NAMES</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">25ec15dde362   redis:latest   \"docker-entrypoint.s…\"   23 minutes ago   Up 23 minutes   0.0.0.0:6377->6379/tcp, [::]:6377->6379/tcp   redis7</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">77414c90b6ea   redis:latest   \"docker-entrypoint.s…\"   23 minutes ago   Up 23 minutes   0.0.0.0:6380->6379/tcp, [::]:6380->6379/tcp   redis10</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">41dacddb4ac3   redis:latest   \"docker-entrypoint.s…\"   23 minutes ago   Up 23 minutes   0.0.0.0:6371->6379/tcp, [::]:6371->6379/tcp   redis1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">573c13c744ca   redis:latest   \"docker-entrypoint.s…\"   23 minutes ago   Up 23 minutes   0.0.0.0:6373->6379/tcp, [::]:6373->6379/tcp   redis3</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">6aa2609836c7   redis:latest   \"docker-entrypoint.s…\"   23 minutes ago   Up 23 minutes   0.0.0.0:6379->6379/tcp, :::6379->6379/tcp     redis9</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">bcbd5203f15c   redis:latest   \"docker-entrypoint.s…\"   23 minutes ago   Up 23 minutes   0.0.0.0:6381->6379/tcp, [::]:6381->6379/tcp   redis11</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">67e1aeef7b1d   redis:latest   \"docker-entrypoint.s…\"   23 minutes ago   Up 23 minutes   0.0.0.0:6378->6379/tcp, [::]:6378->6379/tcp   redis8</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">9fa7e3fb21bc   redis:latest   \"docker-entrypoint.s…\"   23 minutes ago   Up 23 minutes   0.0.0.0:6374->6379/tcp, [::]:6374->6379/tcp   redis4</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">ec8d07d38191   redis:latest   \"docker-entrypoint.s…\"   23 minutes ago   Up 23 minutes   0.0.0.0:6376->6379/tcp, [::]:6376->6379/tcp   redis6</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">5031b98a28d5   redis:latest   \"docker-entrypoint.s…\"   23 minutes ago   Up 23 minutes   0.0.0.0:6375->6379/tcp, [::]:6375->6379/tcp   redis5</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">1acb75345d10   redis:latest   \"docker-entrypoint.s…\"   23 minutes ago   Up 23 minutes   0.0.0.0:6372->6379/tcp, [::]:6372->6379/tcp   redis2</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：创建集群这一步完全可以使用</p>\n</div>\n<p>从上面的输出来看，<code v-pre>redis-cli</code> 的 <code v-pre>--cluster create</code> 命令成功地将 <code v-pre>9</code> 个 <code v-pre>Redis</code> 节点配置为一个 <code v-pre>Redis</code> 集群，并且已经自动完成了分配槽位、添加副本、以及节点之间的通信（使用的正式哈希槽算法）。回显显示的信息如下：</p>\n<ul>\n<li><strong>槽位分配</strong>：集群被划分为 <code v-pre>16384</code> 个槽位，三个主节点分别负责分配槽位：\n<ul>\n<li><code v-pre>172.30.0.101:6379</code>：负责 <code v-pre>0-5460</code> 号槽位</li>\n<li><code v-pre>172.30.0.102:6379</code>：负责 <code v-pre>5461-10922</code> 号槽位</li>\n<li><code v-pre>172.30.0.103:6379</code>：负责 <code v-pre>10923-16383</code> 号槽位</li>\n</ul>\n</li>\n<li><strong>副本添加</strong>：每个主节点都有两个副本节点：\n<ul>\n<li><code v-pre>172.30.0.101:6379</code> 有两个副本：<code v-pre>172.30.0.105:6379</code> 和 <code v-pre>172.30.0.106:6379</code></li>\n<li><code v-pre>172.30.0.102:6379</code> 有两个副本：<code v-pre>172.30.0.107:6379</code> 和 <code v-pre>172.30.0.108:6379</code></li>\n<li><code v-pre>172.30.0.103:6379</code> 有两个副本：<code v-pre>172.30.0.109:6379</code> 和 <code v-pre>172.30.0.104:6379</code></li>\n</ul>\n</li>\n<li><strong>节点信息</strong>：每个主节点和副本的状态都列出，并确认了副本正确地复制了主节点的数据。</li>\n<li><strong>集群检查</strong>：\n<ul>\n<li>所有 <code v-pre>16384</code> 个槽位都已经被覆盖和分配。</li>\n<li>所有节点和槽位配置一致，没有发现未分配的槽位。</li>\n</ul>\n</li>\n</ul>\n<p>此时,使用客户端连上集群中的任何一个节点，都相当于连上了整个集群。那么由于有分片的的存在，我们访问的主节点不一定就是数据所在的节点怎么办呢？客户端后面要加上 <code v-pre>-c</code> 选项，否则 <code v-pre>key</code> 如果没有落到当前节点上，是不能进行操作的，<code v-pre>-c</code> 会自动把请求重定向到对应节点。</p>\n<p>不过我们不急着操作先，先来使用 <code v-pre> cluster nodes</code> 来查看整个集群的信息，然后再来使用集群。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 使用集群</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.101</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -c</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 注意携带 -c 选项</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">0903a2928d09168fa3cc2f4f74c96fe926eef8ef</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.107:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733490348922</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> myself,master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 0-5460</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733490348000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5461-10922</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bc2a17498f1c88f2d827638625e3b998b5d36abf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.108:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733490347917</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9cd6418590131bf0b6fa20c046ee9bbb06f56afe</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.106:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733490349525</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">12992b85a92de26dd849f1abf012ad674da733e4</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.104:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733490348419</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bce31769a218d92d5a3735458e6e479759bdd500</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.105:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733490349023</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.103:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733490348520</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 10923-16383</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">fc92b4b941bc55edc638b3ed5570c77649f11124</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.109:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733490348520</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">set</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> akey</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">666</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">-</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Redirected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slot</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [8093] located at 172.30.0.102:6379 </span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 这句话表示您发送的请求被重定向到一个位于 172.30.0.102:6379 的主节点，该节点负责处理槽位编号为 8093 的数据。</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">OK</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.102:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> akey</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"666\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.102:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 尝试不带 -c 选项直接进行访问</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.101</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> akey</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">error</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> MOVED</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 8093</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 果然访问不到了...并且提示到另外一个主节点进行寻找</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 尝试不带 -c 选项直接进行访问</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.103</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.103:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> akey</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">error</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> MOVED</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 8093</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 果然还是不行</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.103:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 尝试不带 -c 选项直接进行访问</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.102</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.102:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> akey</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"666\"</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 说明数据确实进行了分片</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.102:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 使用从节点访问试一试</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.107</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.107:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> akey</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">error</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> MOVED</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 8093</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 欸? 这是怎么回事呢? 难道从节点没有把主节点数据拷贝过来?</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.107:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">readonly</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 打开只读试试</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">OK</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.107:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> akey</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"666\"</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 欸果然可以了</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.107:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 不过每次退出都需要重新执行 readonly, 除非我们修改所有节点的 redis.conf 配置文件中的配置选项为 \"slave-read-only no\", 这种设置不会对主节点产生影响(待补充...)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"hint-container caution\">\n<p class=\"hint-container-title\">警告</p>\n<p>警告：<code v-pre>Redis</code> 默认从节点只是拿来数据备份和进行故障转移的，默热不推荐我们使用从节点进行数据读取，因为复制带来的延迟在集群状态下可能会很高，导致读取到旧数据（这个备份过此是异步的）。在有集群的情况下，我们可以不用再向之前的主从架构一样，将主节点用来写，从节点都用来读。而是主节点都用来读写，从节点用来做数据备份和故障转移即可。因此与其说分片把写分离，不如说分片让读写都分离了。</p>\n<p>因此在业务架构中，最好一个项目使用一个 <code v-pre>Redis</code> 集群，然后如果该项目本身就是分布式的（例如后端是分布式的，则可以让后端分别寻找对应的主节点进行读取，这样读写压力会被不同机器分摊）。</p>\n<ul>\n<li>写入被不同机器分摊</li>\n<li>读出被不同机器分摊</li>\n<li>数据被负载均衡存入</li>\n<li>数据被主从结构备份</li>\n<li>避免读从节点旧数据</li>\n</ul>\n</div>\n<div class=\"hint-container caution\">\n<p class=\"hint-container-title\">警告</p>\n<p>警告：在集群状态下，会不会出现，写入过程中（还没写入完）进行读取导致失败的情况呢？不可能，为什么？因为一个 <code v-pre>Redis</code>节点是单线程的，在集群中，写入和读出一定是同一个槽，而管理这个槽的 <code v-pre>Redis</code> 分片一定会单线程执行写入和读取这两个命令，如果很确定写入比读出早，那么读出是百分百有数据，不会有意外情况。</p>\n</div>\n<h3 id=\"_2-4-故障转移\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-4-故障转移\"><span>2.4.故障转移</span></a></h3>\n<p>手动停止一个主节点，看看会发生什么现象。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 故障转移</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 查看节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> $</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.102</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -c</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.102:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">fc92b4b941bc55edc638b3ed5570c77649f11124</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.109:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492320000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bce31769a218d92d5a3735458e6e479759bdd500</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.105:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492319548</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.103:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492320553</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 10923-16383</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492319548</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 0-5460</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bc2a17498f1c88f2d827638625e3b998b5d36abf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.108:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492319950</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> myself,master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5461-10922</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">12992b85a92de26dd849f1abf012ad674da733e4</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.104:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492319000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">0903a2928d09168fa3cc2f4f74c96fe926eef8ef</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.107:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492320000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9cd6418590131bf0b6fa20c046ee9bbb06f56afe</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.106:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492319000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.102:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 手动停止</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> stop</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">redis1</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 观察节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> $</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.102</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -c</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.102:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">fc92b4b941bc55edc638b3ed5570c77649f11124</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.109:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492469571</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bce31769a218d92d5a3735458e6e479759bdd500</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.105:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492469000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 10</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 0-5460</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 原本是从节点的 172.30.0.105:6379 变为了主节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.103:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492468566</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 10923-16383</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master,fail</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492324572</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492322000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 可以看到这一个主节点爆 fail 以及发生故障</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bc2a17498f1c88f2d827638625e3b998b5d36abf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.108:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492469000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> myself,master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5461-10922</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">12992b85a92de26dd849f1abf012ad674da733e4</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.104:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492469571</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">0903a2928d09168fa3cc2f4f74c96fe926eef8ef</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.107:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492469000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9cd6418590131bf0b6fa20c046ee9bbb06f56afe</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.106:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> bce31769a218d92d5a3735458e6e479759bdd500</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492470073</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 10</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.102:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 手动恢复</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> start</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">redis1</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 观察节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> $</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.102</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -c</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.102:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">fc92b4b941bc55edc638b3ed5570c77649f11124</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.109:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492665569</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bce31769a218d92d5a3735458e6e479759bdd500</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.105:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492665368</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 10</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 0-5460</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 这个 172.30.0.105:6379 节点依旧是主节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.103:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492666000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 10923-16383</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> bce31769a218d92d5a3735458e6e479759bdd500</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492666573</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 10</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 172.30.0.101:6379 从原本的主节点变为了从节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bc2a17498f1c88f2d827638625e3b998b5d36abf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.108:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492666372</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> myself,master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5461-10922</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">12992b85a92de26dd849f1abf012ad674da733e4</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.104:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492666000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">0903a2928d09168fa3cc2f4f74c96fe926eef8ef</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.107:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492664866</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9cd6418590131bf0b6fa20c046ee9bbb06f56afe</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.106:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> bce31769a218d92d5a3735458e6e479759bdd500</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492665000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 10</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.102:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：另外，可以使用 <code v-pre>cluster failover</code> 进行集群恢复，例如上述的主节点因为故障变为从节点，可以使用这个指令继续恢复回主节点的位置，不过需要恢复谁就需要登陆谁进行恢复。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 恢复集群</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> failover</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">OK</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> myself,master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 11</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 0-5460</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">12992b85a92de26dd849f1abf012ad674da733e4</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.104:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492921973</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bc2a17498f1c88f2d827638625e3b998b5d36abf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.108:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492920000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bce31769a218d92d5a3735458e6e479759bdd500</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.105:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492919563</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 11</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492921070</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5461-10922</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9cd6418590131bf0b6fa20c046ee9bbb06f56afe</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.106:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492921000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 11</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">0903a2928d09168fa3cc2f4f74c96fe926eef8ef</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.107:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492920000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">fc92b4b941bc55edc638b3ed5570c77649f11124</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.109:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492920568</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.103:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492920969</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 10923-16383</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></div>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：故障判定处理流程。集群中的所有节点, 都会周期性的使用心跳包进行通信。</p>\n<ol>\n<li>节点 <code v-pre>A</code> 给 节点 <code v-pre>B</code> 发送 <code v-pre>ping</code> 包，<code v-pre>B</code> 就会给 <code v-pre>A</code> 返回一个 <code v-pre>pong</code> 包。<code v-pre>ping</code> 和 <code v-pre>pong</code> 除了 <code v-pre>message type</code> 属性之外，其他部分都是一样的，这里包含了集群的配置信息（该节点的 <code v-pre>id</code>，该节点从属于哪个分片，是主节点还是从节点，从属于谁，持有哪些 <code v-pre>slots</code> 的位图...）</li>\n<li>每个节点每秒钟，都会给一些随机的节点发起 <code v-pre>ping</code> 包，而不是全发一遍。这样设定是为了避免在节点很多的时候，心跳包也非常多（比如有 <code v-pre>9</code> 个节点，如果全发，就是 <code v-pre>9 * 8 == 72</code> 组心跳了，而且这是按照 <code v-pre>N^2</code> 这样的级别增长的）</li>\n<li>当节点 <code v-pre>A</code> 给节点 <code v-pre>B</code> 发起 <code v-pre>ping</code> 包，<code v-pre>B</code> 不能如期回应的时候，此时 <code v-pre>A</code> 就会尝试重置和 <code v-pre>B</code> 的 <code v-pre>tcp</code> 连接，看能否连接成功。如果仍然连接失败，<code v-pre>A</code> 就会把 <code v-pre>B</code> 设为 <code v-pre>PFAIL</code> 状态（相当于主观下线）</li>\n<li><code v-pre>A</code> 判定 <code v-pre>B</code> 为 <code v-pre>PFAIL</code> 之后，会通过 <code v-pre>redis</code> 内置的 <code v-pre>Gossip</code> 协议，和其他节点进行沟通，向其他节点确认 <code v-pre>B</code> 的状态（每个节点都会维护一个自己的“下线列表”，由于视角不同，每个节点的下线列表也不一定相同）</li>\n<li>此时 <code v-pre>A</code> 发现其他很多节点，也认为 <code v-pre>B</code> 为 <code v-pre>PFAIL</code>，并且数目超过总集群个数的一半，那么 <code v-pre>A</code> 就会把 <code v-pre>B</code> 标记成 <code v-pre>FAIL</code>（相当于客观下线），并且把这个消息同步给其他节点（其他节点收到之后，也会把 <code v-pre>B</code> 标记成 <code v-pre>FAIL</code>)</li>\n<li>至此 <code v-pre>B</code> 就彻底被判定为故障节点了</li>\n</ol>\n<p>另外，在 <code v-pre>Redis</code> 集群中，出现集群宕机（比主节点故障更加严重的情况）的情况通常是由以下三种情况引起的：</p>\n<ul>\n<li><strong>某个分片的所有主节点和从节点都挂了</strong>：如果一个分片的主节点和从节点都宕机，<code v-pre>Redis</code> 集群将无法处理该分片的数据请求，导致整个集群处于 <code v-pre>fail</code> 状态。</li>\n<li><strong>某个分片的主节点挂了，但没有从节点</strong>：如果某个分片的主节点宕机，而该分片没有从节点，<code v-pre>Redis</code> 集群无法进行故障转移，导致该分片无法正常服务，进而可能导致集群 <code v-pre>fail</code>。</li>\n<li><strong>超过半数的主节点挂了</strong>：如果集群中的主节点宕机超过一半，<code v-pre>Redis</code> 集群无法保证数据的完整性和可用性，这时集群会进入 <code v-pre>fail</code> 状态。</li>\n</ul>\n</div>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：故障转移处理流程。</p>\n<ol>\n<li>故障判断：\n<ul>\n<li><strong>如果故障节点是从节点</strong>：无需进行故障迁移，因为从节点只是备份数据，不会影响集群的整体功能。</li>\n<li><strong>如果故障节点是主节点</strong>：需要进行故障迁移，选举从节点中的一个作为新的主节点。</li>\n</ul>\n</li>\n<li>从节点资格判定：从节点首先要判断自己是否具备成为主节点的资格。如果从节点和主节点的通信已经中断太久，导致数据差异过大，超过了预定的阈值，则该从节点将失去竞选资格。</li>\n<li>休眠时间：有资格的从节点（如 <code v-pre>C</code> 和 <code v-pre>D</code>）会先进行短暂的休眠，休眠时间为“基础时间<code v-pre>500ms</code> + 随机时间：<code v-pre>[0, 500ms]</code> + 排名时间（根据节点的排名，越靠前的节点休眠时间越短，排名越靠后的节点休眠时间越长，<code v-pre>排名 * 1000ms</code>）”</li>\n<li>投票阶段：如 <code v-pre>C</code> 休眠结束后，<code v-pre>C</code> 会向集群中的所有节点发起拉票操作，并且只有主节点有投票资格。每个主节点只能投一票，投票给其认为最合适的从节点。<code v-pre>C</code> 需要获得集群中超过一半的主节点的支持票，才能晋升为主节点。</li>\n<li>提升为主节点：一旦 <code v-pre>C</code> 获得超过一半的主节点投票，它就会被晋升为主节点。<code v-pre>C</code> 会执行 <code v-pre>slaveof no one</code> 来成为独立的主节点，同时让 <code v-pre>D</code> 成为 <code v-pre>C</code> 的从节点（<code v-pre>slaveof C</code>）。</li>\n<li>更新集群信息：<code v-pre>C</code> 会将自己晋升为主节点的消息同步给其他节点，其他节点会更新自己的集群结构信息，确保集群中各节点的信息一致。</li>\n</ol>\n<p>这个过程更加细致，也就是之前提到过的著名选举算法，<code v-pre>Raft</code> 算法。</p>\n</div>\n<h3 id=\"_2-5-扩容集群\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-5-扩容集群\"><span>2.5.扩容集群</span></a></h3>\n<p>接下来需要把 <code v-pre>redis10</code> 和 <code v-pre>redis11</code> 也加入到集群中，应该怎么做呢？很简单，我们之前使用 <code v-pre>redis-cli --cluster create &lt;节点列表&gt;</code> 创建集群，就可以使用 <code v-pre>redis-cli --cluster add-node &lt;单个节点&gt; &lt;集群中任意节点地址&gt;</code> 来添加新的节点（默认）。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 扩容集群</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> --cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> add-node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.110:6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Adding</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.110:6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Performing</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Check</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (using </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:[0-5460]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (5461 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 12992b85a92de26dd849f1abf012ad674da733e4</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.104:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> bc2a17498f1c88f2d827638625e3b998b5d36abf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.108:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> bce31769a218d92d5a3735458e6e479759bdd500</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.105:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:[5461-10922]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (5462 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9cd6418590131bf0b6fa20c046ee9bbb06f56afe</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.106:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 0903a2928d09168fa3cc2f4f74c96fe926eef8ef</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.107:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> fc92b4b941bc55edc638b3ed5570c77649f11124</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.109:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.103:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:[10923-16383]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (5461 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">OK</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> All nodes agree about slots configuration.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Check</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> for</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> open</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slots...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Check</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slots</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> coverage...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">OK</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> All 16384 slots covered.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Getting</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> functions</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> from</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cluster</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Send</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> FUNCTION</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> LIST</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.110:6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> verify</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> there</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> is</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> no</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> functions</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> in</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> it</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Send</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> FUNCTION</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> RESTORE</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.110:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Send</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> CLUSTER</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> MEET</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.110:6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> make</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> it</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> join</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cluster.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">OK</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> New node added correctly.</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 然后进入集群查看主从关系</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> $</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.101</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -c</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">5863ebe5623e98c9f405b9da099d0e75990aebce</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.110:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733494939225</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 可以看到 172.30.0.110:6379 成为了集群中新的主节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> myself,master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 11</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 0-5460</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">12992b85a92de26dd849f1abf012ad674da733e4</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.104:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733494938000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bc2a17498f1c88f2d827638625e3b998b5d36abf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.108:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733494939023</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bce31769a218d92d5a3735458e6e479759bdd500</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.105:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733494938522</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 11</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733494938522</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5461-10922</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9cd6418590131bf0b6fa20c046ee9bbb06f56afe</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.106:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733494938000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 11</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">0903a2928d09168fa3cc2f4f74c96fe926eef8ef</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.107:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733494939000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">fc92b4b941bc55edc638b3ed5570c77649f11124</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.109:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733494938722</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.103:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733494939727</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 10923-16383</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 不过虽然节点已经成功加入集群, 但是新的节点并不会自动接管已有的槽(slots), 除非明确执行了槽迁移操作</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 进行槽迁移操作</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> --cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> reshard</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 只需要任意集群中的节点即可完成槽迁移操作</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Performing</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Check</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (using </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) </span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 注意下面生成的信息, 里面的节点携带有 id 信息的存在, 后面用得到</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:[0-5460]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (5461 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5863ebe5623e98c9f405b9da099d0e75990aebce</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.110:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 12992b85a92de26dd849f1abf012ad674da733e4</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.104:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> bc2a17498f1c88f2d827638625e3b998b5d36abf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.108:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> bce31769a218d92d5a3735458e6e479759bdd500</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.105:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:[5461-10922]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (5462 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9cd6418590131bf0b6fa20c046ee9bbb06f56afe</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.106:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 0903a2928d09168fa3cc2f4f74c96fe926eef8ef</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.107:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> fc92b4b941bc55edc638b3ed5570c77649f11124</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.109:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.103:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:[10923-16383]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (5461 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">OK</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> All nodes agree about slots configuration.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Check</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> for</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> open</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slots...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Check</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slots</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> coverage...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">OK</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> All 16384 slots covered.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">How</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> many</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slots</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> do</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> you</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> want</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> move</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (from </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 16384</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">)</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">?</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> 4096 </span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 填入需要新加入集群主节点分配到的槽个数</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 其实这里的目标是让所有主节点平均分配 slots, 计算方式如下：</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 总 slots 数量 = 16384</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 当前主节点数量 = 4</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 每个节点理想的 slots 数量 = 16384 / 4 = 4096</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">What</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> is</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> receiving</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ID?</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5863ebe5623e98c9f405b9da099d0e75990aebce</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 填入新加入节点的 ID, 注意不是 IP:PORT</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Please</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> enter</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> all</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> source</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> IDs.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  Type</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">all</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> use</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> all</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> as</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> source</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> for</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> hash</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slots.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  Type</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">done</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> once</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> you</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> entered</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> all</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> source</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> IDs.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Source</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> #1: all # 填入某个节点的 ID, 就会从某个节点迁移槽给新增加的主节点, 如果填入 all 就把所有现有主节点的槽都均衡迁移到新增加的主节点中</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Ready</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> move</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 4096</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slots.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  Source</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">       slots:[0-5460]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (5461 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">       2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">       slots:[5461-10922]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (5462 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">       2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.103:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">       slots:[10923-16383]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (5461 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">       2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  Destination</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5863ebe5623e98c9f405b9da099d0e75990aebce</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.110:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">       slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  Resharding</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> plan:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    Moving</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slot</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 5461</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> from</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># (省略)...</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：假设您的 <code v-pre>Redis</code> 集群中有 <code v-pre>3</code> 个主节点，它们的 <code v-pre>slots</code> 分配如下：</p>\n<ul>\n<li><strong>节点 A</strong>：<code v-pre>0-5460</code> (共 <code v-pre>5461</code> 个 <code v-pre>slots</code>)</li>\n<li><strong>节点 B</strong>：<code v-pre>5461-10922</code> (共 <code v-pre>5462</code> 个 <code v-pre>slots</code>)</li>\n<li><strong>节点 C</strong>：<code v-pre>10923-16383</code> (共 <code v-pre>5461</code> 个 <code v-pre>slots</code>)</li>\n</ul>\n<p>新增一个节点 <code v-pre>D</code>，您想迁移 <code v-pre>4096</code> 个 <code v-pre>slots</code> 给它，并选择 <code v-pre>all</code>，那么<code v-pre>Redis</code> 会按比例从节点 <code v-pre>A、B、C</code> 中迁移 <code v-pre>slots</code>：</p>\n<ul>\n<li><strong>节点 A</strong>：迁移约 <code v-pre>1365</code> 个 <code v-pre>slots</code></li>\n<li><strong>节点 B</strong>：迁移约 <code v-pre>1366</code> 个 <code v-pre>slots</code></li>\n<li><strong>节点 C</strong>：迁移约 <code v-pre>1365</code> 个 <code v-pre>slots</code></li>\n</ul>\n<p>最终，节点 <code v-pre>A、B、C</code> 的 <code v-pre>slots</code> 数量会减少，负载下降，新节点 <code v-pre>D</code> 接管迁移过来的 <code v-pre>4096</code> 个 <code v-pre>slots</code>，开始分担存储和请求。而如果不选择 <code v-pre>all</code>，明确指定了某个主节点（如节点 <code v-pre>A</code>），那么 <code v-pre>Redis</code> 只会从该节点迁移 <code v-pre>slots</code> 到新节点 <code v-pre>D</code>，这样会导致：</p>\n<ul>\n<li>节点 <code v-pre>A</code> 的负载迅速减轻，但其他节点的负载保持不变</li>\n<li>整体负载分布可能变得不均匀，不利于集群性能</li>\n</ul>\n</div>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：迁移槽管理的过程中也伴随着键值对的迁移，之后就会进行集群的 <code v-pre>key</code> 搬运工作，这个过程涉及到数据搬运，可能需要消耗一定的时间，并且期间不影响新键值对的写入和读出；也不影响不需要迁移的键值对进行正常的读写；但需要迁移的键值对会发生短暂的错误，只有等待一段时间才会恢复（不过我还没有测试过，待补充...）。</p>\n</div>\n<p>加入新的主节点时，扩容的目标已经初步达成，但为了保证集群高可用性，还需要给这个新的主节点添加从节点，保证该主节点宕机之后，有从节点可以进行故障转移。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 提高可用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 添加从节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> --cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> add-node</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.111:6379</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\ </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">#</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 要添加的节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> 172.30.0.101:6379</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\ </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">#</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 集群中存在的任意节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> --cluster-slave</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\ </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">#</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 表示将新节点加入为从节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">--cluster-master-id</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5863ebe5623e98c9f405b9da099d0e75990aebce</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 指定该从节点的主节点的节点 ID</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 完整指令为 redis-cli --cluster add-node 172.30.0.111:6379 172.30.0.101:6379 --cluster-slave --cluster-master-id 5863ebe5623e98c9f405b9da099d0e75990aebce</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Adding</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.111:6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Performing</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Check</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (using </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:[1365-5460]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (4096 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5863ebe5623e98c9f405b9da099d0e75990aebce</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.110:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:[0-1364],[5461-6826],[10923-12287]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (4096 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   1</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 12992b85a92de26dd849f1abf012ad674da733e4</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.104:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> bc2a17498f1c88f2d827638625e3b998b5d36abf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.108:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> bce31769a218d92d5a3735458e6e479759bdd500</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.105:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:[6827-10922]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (4096 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   1</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9cd6418590131bf0b6fa20c046ee9bbb06f56afe</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.106:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 0903a2928d09168fa3cc2f4f74c96fe926eef8ef</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.107:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5863ebe5623e98c9f405b9da099d0e75990aebce</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> fc92b4b941bc55edc638b3ed5570c77649f11124</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.109:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.103:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:[12288-16383]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (4096 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">OK</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> All nodes agree about slots configuration.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Check</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> for</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> open</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slots...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Check</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slots</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> coverage...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">OK</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> All 16384 slots covered.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Send</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> CLUSTER</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> MEET</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.111:6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> make</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> it</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> join</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cluster.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Waiting</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> for</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> join</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Configure</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> as</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> of</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.110:6379.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">OK</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> New node added correctly.</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看新的主从结构</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.101</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -c</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">5863ebe5623e98c9f405b9da099d0e75990aebce</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.110:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733501266902</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 12</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 0-1364</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5461-6826</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 10923-12287</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> myself,master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 11</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 1365-5460</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">12992b85a92de26dd849f1abf012ad674da733e4</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.104:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733501265898</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bc2a17498f1c88f2d827638625e3b998b5d36abf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.108:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733501265000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bce31769a218d92d5a3735458e6e479759bdd500</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.105:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733501265597</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 11</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733501266501</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6827-10922</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9cd6418590131bf0b6fa20c046ee9bbb06f56afe</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.106:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733501266501</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 11</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">0903a2928d09168fa3cc2f4f74c96fe926eef8ef</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.107:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5863ebe5623e98c9f405b9da099d0e75990aebce</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733501266501</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 12</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">fc92b4b941bc55edc638b3ed5570c77649f11124</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.109:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733501266000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">8cbe43de958f2564d95d0d5da51cab654b861036</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.111:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5863ebe5623e98c9f405b9da099d0e75990aebce</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733501265000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 12</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 果然成为了  172.30.0.110:6379 的从节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.103:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733501265597</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 12288-16383</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3 id=\"_2-6-缩容集群\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-6-缩容集群\"><span>2.6.缩容集群</span></a></h3>\n<p>缩容的操作一般比较少见，但是也不是没有，简单演示一下您就明白怎么操作了，假设我们需要把刚刚加入的主从节点剔除（也就是 <code v-pre>172.30.0.110:6379</code> 和 <code v-pre> 172.30.0.111:6379</code>，节点 <code v-pre>ID</code> 分别为 <code v-pre>5863ebe5623e98c9f405b9da099d0e75990aebce</code> 和 <code v-pre>8cbe43de958f2564d95d0d5da51cab654b861036</code>）。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 缩容集群</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 删除从节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> $</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">--cluster</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\ </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">#</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 表示集群操作</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">del-node</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\ </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">#</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 表示要删除节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.110:6379</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\ </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">#</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 集群中任意一个节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">8cbe43de958f2564d95d0d5da51cab654b861036</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 要删除的节点 ID</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 完整指令为 redis-cli --cluster del-node 172.30.0.110:6379 8cbe43de958f2564d95d0d5da51cab654b861036</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Removing</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 8cbe43de958f2564d95d0d5da51cab654b861036</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> from</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.110:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Sending</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> CLUSTER</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> FORGET</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> messages</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cluster...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Sending</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> CLUSTER</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> RESET</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> SOFT</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> deleted</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node.</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 删除主节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 重新分配槽, 把 172.30.0.110:6379 这个待删除的主节点去除前, 需要把其占有的槽均分给其他主节点(大概均分即可, 从需要移除的节点中迁移 1365、1365、1366 到三个主节点)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> --cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> reshard</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 把要剔除的  172.30.0.110:6379 中的 1365 个槽迁移给 172.30.0.101:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Performing</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Check</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (using </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:[1365-5460]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (4096 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5863ebe5623e98c9f405b9da099d0e75990aebce</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.110:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:[0-1364],[5461-6826],[10923-12287]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (4096 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   1</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 12992b85a92de26dd849f1abf012ad674da733e4</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.104:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> bc2a17498f1c88f2d827638625e3b998b5d36abf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.108:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> bce31769a218d92d5a3735458e6e479759bdd500</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.105:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:[6827-10922]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (4096 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   1</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9cd6418590131bf0b6fa20c046ee9bbb06f56afe</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.106:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 0903a2928d09168fa3cc2f4f74c96fe926eef8ef</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.107:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5863ebe5623e98c9f405b9da099d0e75990aebce</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> fc92b4b941bc55edc638b3ed5570c77649f11124</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.109:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.103:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:[12288-16383]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (4096 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">OK</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> All nodes agree about slots configuration.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Check</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> for</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> open</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slots...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Check</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slots</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> coverage...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">OK</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> All 16384 slots covered.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">How</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> many</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slots</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> do</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> you</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> want</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> move</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (from </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 16384</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">)</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">?</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> 1365</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">What</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> is</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> receiving</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ID?</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Please</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> enter</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> all</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> source</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> IDs.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  Type</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">all</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> use</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> all</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> as</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> source</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> for</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> hash</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slots.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  Type</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">done</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> once</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> you</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> entered</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> all</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> source</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> IDs.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Source</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> #1: 5863ebe5623e98c9f405b9da099d0e75990aebce</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Source</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> #2: done</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># (省略)...</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> --cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> reshard</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 把要剔除的  172.30.0.110:6379 中的 1365 个槽迁移给 172.30.0.102:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># (省略)...</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> --cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> reshard</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 把要剔除的  172.30.0.110:6379 中的 1366 个槽迁移给 172.30.0.103:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># (省略)...</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 这里我还观察到此时的 172.30.0.110:6379 自动变为了 172.30.0.103 的从节点, Redis 版本不同可能结果也不同(可能还是主节点, 只不过不持有槽而已, 您可以试一试)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 删除“主”节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> --cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> del-node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5863ebe5623e98c9f405b9da099d0e75990aebce</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Removing</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5863ebe5623e98c9f405b9da099d0e75990aebce</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> from</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Sending</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> CLUSTER</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> FORGET</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> messages</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cluster...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Sending</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> CLUSTER</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> RESET</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> SOFT</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> deleted</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node.</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 重新查看集群中的主从结构</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.101</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -c</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> myself,master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 13</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 0-5460</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">12992b85a92de26dd849f1abf012ad674da733e4</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.104:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733503694213</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 15</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bc2a17498f1c88f2d827638625e3b998b5d36abf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.108:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733503694514</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 14</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bce31769a218d92d5a3735458e6e479759bdd500</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.105:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733503696221</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 13</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733503696523</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 14</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5461-6825</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6827-10922</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9cd6418590131bf0b6fa20c046ee9bbb06f56afe</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.106:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733503696121</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 13</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">0903a2928d09168fa3cc2f4f74c96fe926eef8ef</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.107:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733503695000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 15</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">fc92b4b941bc55edc638b3ed5570c77649f11124</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.109:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733503695518</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 15</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.103:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733503695217</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 15</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6826</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 10923-16383</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2 id=\"_3-redis-常见的问题\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-redis-常见的问题\"><span>3.Redis 常见的问题</span></a></h2>\n<h3 id=\"_3-1-缓存雪崩\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-1-缓存雪崩\"><span>3.1.缓存雪崩</span></a></h3>\n<ul>\n<li>随机缓存过期时间：采用不同的缓存过期时间。</li>\n<li>采用缓存预热：当大量缓存失效时，数据库压力激增。特别是热点数据突然被请求，数据库直接崩溃，应该提前将热点数据加载到缓存。</li>\n<li>采用缓存更新策略：写入数据库时更新缓存时间。</li>\n<li>引入消息队列组件：削峰填谷请求。</li>\n<li>集群相互监督：</li>\n</ul>\n</template>","contentStripped":"<h2 id=\"_1-redis-读分离架构-高可用架构\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-redis-读分离架构-高可用架构\"><span>1.Redis 读分离架构/高可用架构</span></a></h2>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：实际上 <code v-pre>Redis</code> 的单机读写性能一般可以达到十万级别的 <code v-pre>QPS</code>，可以 <a href=\"https://redis.io/docs/latest/operate/oss_and_stack/management/optimization/benchmarks/#benchmark-results-on-bare-metal-servers-across-different-redis-versions\" target=\"_blank\" rel=\"noopener noreferrer\">查阅官方文档</a>。</p>\n</div>\n<h3 id=\"_1-1-架构原理\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-1-架构原理\"><span>1.1.架构原理</span></a></h3>\n<p>当客户端足够多时，要减轻 <code v-pre>redis</code> 节点的负担，则可以考虑多个从节点复制主节点的数据，主节点负责读写，从节点只负责读（不过这么做其实是有点问题的，后面一步一步来）。</p>\n<h3 id=\"_1-2-数据节点\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-数据节点\"><span>1.2.数据节点</span></a></h3>\n<h4 id=\"_1-2-1-复制\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-1-复制\"><span>1.2.1.复制</span></a></h4>\n<h5 id=\"_1-2-1-1-复制的建立\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-1-1-复制的建立\"><span>1.2.1.1.复制的建立</span></a></h5>\n<p>首先我们需要建立 <code v-pre>Redis</code> 的集群架构，<code v-pre>Redis</code> 实例之间会进行复制操作，实例划分为主节点和从节点，复制数据流是单向的，只能从主节点流向从节点。复制的配置方式有三种：</p>\n<ul>\n<li>配置文件中写入在 <code v-pre>slaveof {masterHost} {masterPort}</code> 随 <code v-pre>Redis</code> 启动生效</li>\n<li>在 <code v-pre>redis-server</code> 启动命令时加入 <code v-pre>--slaveof {masterHost} {masterPort}</code> 生效</li>\n<li>直接使用 <code v-pre>redis</code> 命令 <code v-pre>slaveof {masterHost} {masterPort}</code> 生效</li>\n</ul>\n<p>我们在启动 <code v-pre>Redis</code> 的时候，其实是可以选择不同的配置文件的，因此我们只需要保持原来的 <code v-pre>Redis</code> 不变（作为主节点），复制原来的配置文件稍作修改为 <code v-pre>redis-slave.conf </code> 即可（确保其中的 <code v-pre>daemonize</code> 为 <code v-pre>yes</code>，如果配置文件中已经设置好了，那其从节点配置文件可以继续使用主节点的配置文件，不做任何修改）。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 复制的建立</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-server</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/redis/redis-slave.conf</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> --port</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6380</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> --slaveof</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 127.0.0.1</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> ## 6379 的主节点就连接上 6380 的次节点</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>然后使用 <code v-pre>redis-server /etc/redis/redis-slave.conf --port 6380 --slaveof 127.0.0.1 6379</code> 启动从节点，并且使用 <code v-pre>netstat -nlpt</code> 检查是否启动，最后按下面的做法查验是否有分布式运行。</p>\n<h5 id=\"_1-2-1-2-复制的现象\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-1-2-复制的现象\"><span>1.2.1.2.复制的现象</span></a></h5>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 复制的过程</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># >>> begin: 连接主节点 >>></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 127.0.0.1</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">set</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> key</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">hello</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">OK</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> key</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"hello\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">info</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replication</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># Replication</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">role:master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">connected_slaves:1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave0:ip</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">=127.0.0.1,port=6380,state=online,offset=700,lag=1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_failover_state:no-failover</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_replid:8280d7308ba672a701170c8eeba15e258546de71</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_replid2:0000000000000000000000000000000000000000</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_repl_offset:700</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">second_repl_offset:-1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_active:1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_size:1048576</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_first_byte_offset:1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_histlen:700</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># &#x3C;&#x3C;&#x3C; end &#x3C;&#x3C;&#x3C;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># >>> begin: 连接从节点 >>></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 127.0.0.1</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6380</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> key</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"hello\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6380</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">info</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replication</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># Replication</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">role:slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_host:127.0.0.1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_port:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_link_status:up</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_last_io_seconds_ago:9</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_sync_in_progress:0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave_read_repl_offset:700</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave_repl_offset:700</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave_priority:100</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave_read_only:1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">replica_announced:1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">connected_slaves:0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_failover_state:no-failover</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_replid:8280d7308ba672a701170c8eeba15e258546de71</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_replid2:0000000000000000000000000000000000000000</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_repl_offset:700</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">second_repl_offset:-1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_active:1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_size:1048576</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_first_byte_offset:15</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_histlen:686</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># &#x3C;&#x3C;&#x3C; end &#x3C;&#x3C;&#x3C;</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>从运行结果中看到复制已经在工作了，针对主节点 <code v-pre>6379</code> 的任何修改都可以同步到从节点 <code v-pre>6380</code> 中，并且也可以使用 <code v-pre>info replication</code> 查看每个节点的复制信息（节点角色、状态等）。</p>\n<h5 id=\"_1-2-1-3-复制的断开\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-1-3-复制的断开\"><span>1.2.1.3.复制的断开</span></a></h5>\n<p>在从节点中可以执行 <code v-pre>slaveof no one</code> 断开和主节点的复制关系，从节点就会晋升为新的主节点，断开复制节点后不会抛弃原有数据，只是无法再获取主节点上的数据变化。断开节点后，还可以使用 <code v-pre>slaveof &lt;newMasterIp&gt; &lt;newMasterPort&gt;</code> 给从节点切换为别的主节点，或者干脆给从节点恢复原本的主节点。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 复制的断开</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># >>> begin: 从节点 >>></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 127.0.0.1</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6380</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6380</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> key</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"hello\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6380</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slaveof</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> no</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> one</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">OK</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># &#x3C;&#x3C;&#x3C; end &#x3C;&#x3C;&#x3C;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># >>> begin: 主节点 >>></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 127.0.0.1</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> key</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"hello\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">set</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> akey</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">OK</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># &#x3C;&#x3C;&#x3C; end &#x3C;&#x3C;&#x3C;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># >>> begin: 从节点 >>></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6380</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> akey</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 这样就无法直接复制主节点的数据了</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">nil</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6380</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slaveof</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 127.0.0.1</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">OK</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># &#x3C;&#x3C;&#x3C; end &#x3C;&#x3C;&#x3C;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># >>> begin: 主节点 >>></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 127.0.0.1</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 访问一次主节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># &#x3C;&#x3C;&#x3C; end &#x3C;&#x3C;&#x3C;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># >>> begin: 主节点 >>></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6380</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> akey</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 就会发现从节点恢复了复制</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"redis\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># &#x3C;&#x3C;&#x3C; end &#x3C;&#x3C;&#x3C;</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h5 id=\"_1-2-1-4-复制的安全\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-1-4-复制的安全\"><span>1.2.1.4.复制的安全</span></a></h5>\n<ul>\n<li><strong>权限校验</strong>：对于数据比较重要的节点，主节点会通过设置 <code v-pre>requirepass &lt;密码&gt;</code> 参数进行密码验证，这时所有的客户端访问进入命令行后必须先使用 <code v-pre>auth</code> 命令实行校验。从节点与主节点的复制连接是通过一个特殊标识的客户端来完成，因此需要配置从节点的 <code v-pre>masterauth &lt;密码&gt;</code> 参数与主节点密码保持一致，这样从节点才可以正确地连接到主节点并发起复制流程。</li>\n<li><strong>只读模式</strong>：只读默认情况下，从节点使用 <code v-pre>slave-read-only=yes</code> 配置为只读模式。由于复制只能从主节点到从节 点，对于从节点的任何修改主节点都无法感知，修改从节点会造成主从数据不一致，所以建议线上不要修改从节点的只读模式。</li>\n</ul>\n<p>为了不影响我原来的配置，我这里复制最原本的配置文件，作为主节点和从节点的配置。</p>\n<ol>\n<li>\n<p>配置主节点</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 配置主节点( redis-master.conf)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cp</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/redis/redis.conf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ~/redis-master.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> vim</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># ...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">port</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6380</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">requirepass</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">主节点密</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">码</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># ...</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></li>\n<li>\n<p>启动主节点</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 启动主节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-server</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis.conf</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></li>\n<li>\n<p>配置从节点</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 配置从节点(redis-slave.conf)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cp</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/redis/redis.conf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ~/redis-slave.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> vim</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-slave.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># ...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">port</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6381</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">requirepass</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">从节点密</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">码</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slaveof</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 127.0.0.1</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6380</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">masterauth</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">填入主节点密</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">码</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave-read-only</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> yes</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># ...</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></li>\n<li>\n<p>启动从节点</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 启动从节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-server</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-slave.conf</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></li>\n<li>\n<p>连接主节点并设置值</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 连接主节点并设置值</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6380</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -a</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">主节点密</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">码</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 或者不使用 -a 选项, 直接回车, 在命令行界面中使用 \"auth 密码\" 即可, 如果验证通过就会返回 OK</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6380</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">set</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> key</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">value1</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">ok</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6380</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> key</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"value1\"</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></li>\n<li>\n<p>验证从节点数据同步</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 验证从节点数据同步</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6381</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6381</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> key</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"value1\"</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></li>\n<li>\n<p>验证从节点只读模式</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 验证从节点只读模式</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6381</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">set</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> key</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">new_value</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">error</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> READONLY</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> You</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> can</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">t write against a read-only replica.</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></li>\n</ol>\n<h5 id=\"_1-2-1-5-复制的延迟\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-1-5-复制的延迟\"><span>1.2.1.5.复制的延迟</span></a></h5>\n<p>主从节点一般部署在不同机器上，复制时的网络延迟就成为需要考虑的问题，<code v-pre>Redis</code> 为我们提供了 <code v-pre>repl-disable-tcp-nodelay</code> 参数用于控制是否关闭 <code v-pre>TCP_NODELAY</code>，默认为 <code v-pre>no</code>，即开启 <code v-pre>tcpnodelay</code> 功能，说明如下：</p>\n<ul>\n<li>当关闭时，主节点产生的命令数据无论大小都会及时地发送给从节点，这样主从之间延迟会变小，但增加了网络带宽的消耗。适用于主从之间的网络环境良好的场景，如同机房部署。</li>\n<li>当开启时，主节点会合并较小的 <code v-pre>TCP</code> 数据包从而节省带宽，默认发送时间间隔取决于 <code v-pre>Linux</code> 的内核，一般默认为 <code v-pre>40</code> 毫秒。这种配置节省了带宽但增大主从之间的延迟。适用于主从网络环境复杂的场景，如跨机房部署。</li>\n</ul>\n<div class=\"hint-container caution\">\n<p class=\"hint-container-title\">警告</p>\n<p>警告：因此除非数据不紧急，否则使用 <code v-pre>Redis</code> 的从节点做读分离其实是有点问题的，因为可能会有较高的延迟，与其说是读分离，不如说从节点的重点是备份数据，方便后续的哨兵节点做故障转移的。</p>\n</div>\n<h4 id=\"_1-2-2-拓扑\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-2-拓扑\"><span>1.2.2.拓扑</span></a></h4>\n<ol>\n<li>\n<p><strong>一主一从结构</strong>：也就是我们之前一直使用的结构</p>\n<ul>\n<li>通常用于主节点出现宕机时，从节点可以提供临时故障转移</li>\n<li>同时写命令较高需要持久化时，就可以在从节点上开启 <code v-pre>AOF</code> 配置</li>\n</ul>\n<p>这样就可以保证数据持久化安全性，也可以避免对主节点性能的干扰。</p>\n</li>\n<li>\n<p><strong>一主多从结构</strong>：在大型电商平台中，商品详情页的访问量通常远高于商品数据的修改量。例如，商品价格、库存等信息修改的频率较低，而用户浏览商品详情的频率极高。因此可以一个主节点负责写入，其他从节点都负责读取（负载均衡读取）。</p>\n</li>\n<li>\n<p><strong>树形主从结构</strong>：树形主从结构（分层结构）使得从节点不但可以复制主节点数据，同时可以作为其他从节点的主节点继续向下层复制。当祖先主节点需要直接挂载的从节点较多时，可以通过引入复制中间层（就是祖先节点只挂载几个从节点后，那几个从节点构成一层中间层），有效降低住系欸按负载和需要传送给从节点的数据量。数据写入节点 <code v-pre>A</code> 之后会同步给 <code v-pre>B</code> 和 <code v-pre>C</code> 节点，<code v-pre>B</code> 节点进一步把数据同步给 <code v-pre>D</code> 和 <code v-pre>E</code> 节 点，这样当主节点 <code v-pre>A</code> 需要挂载多个从节点时，就可以避免对主节点 <code v-pre>A</code> 的过高性能干扰。</p>\n</li>\n</ol>\n<div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>补充：这里 <code v-pre>Redis</code> 只是做了复制和拓扑的工作，并没有使用现有的负载均衡算法，因此我们后面需要补充这类算法，在对应编程语言客户端中实现。</p>\n</div>\n<h4 id=\"_1-2-3-原理\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-3-原理\"><span>1.2.3.原理</span></a></h4>\n<h5 id=\"_1-2-3-1-链接检测\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-3-1-链接检测\"><span>1.2.3.1.链接检测</span></a></h5>\n<p>建立复制链接之前：</p>\n<ol>\n<li>\n<p><strong>保存主节点信息</strong>：当开始配置主从同步关系后，先启动从节点的话，会先保存主节点的地址信息，但复制流程尚未开始。 在从节点（如端口 <code v-pre>6380</code>）执行 <code v-pre>info replication</code>，可以看到以下信息，此时链接尚未建立。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 回显显示的配置</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6381</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">info</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replication</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># Replication</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">role:slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_host:127.0.0.1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_port:6380</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_link_status:up</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_last_io_seconds_ago:2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_sync_in_progress:0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave_read_repl_offset:43163</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave_repl_offset:43163</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave_priority:100</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave_read_only:1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">replica_announced:1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">connected_slaves:0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_failover_state:no-failover</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_replid:63d358c9223002afc5dcc995a235fcc14882c9d3</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_replid2:1c606c458fe22df08bae73d9af9a675cb7b49554</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_repl_offset:43163</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">second_repl_offset:43094</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_active:1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_size:1048576</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_first_byte_offset:43094</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_histlen:70\\</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># master_host 和 master_port 分别表示主节点的 IP 和 PORT</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># master_link_status 表示主节点的连接状态, 此时为 down, 说明尚未建立连接</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></li>\n<li>\n<p><strong>建立 TCP 连接</strong>：从节点会通过每秒运行的定时任务维护复制逻辑。</p>\n<ul>\n<li>如果检测到新的主节点，从节点会尝试与主节点建立基于 <code v-pre>TCP</code> 的网络连接</li>\n<li>若连接失败，定时任务会无限重试，直到连接成功或用户手动停止主从复制。</li>\n</ul>\n</li>\n<li>\n<p><strong>发送 PING 命令</strong>：成功建立连接后，从节点会发送 <code v-pre>PING</code> 命令，验证主节点的应用层状态。</p>\n<ul>\n<li>如果主节点正常，会返回 <code v-pre>PONG</code></li>\n<li>如果 <code v-pre>PONG</code> 超时，从节点会断开 <code v-pre>TCP</code> 连接，并等待下一次定时任务重新连接</li>\n</ul>\n</li>\n<li>\n<p><strong>权限验证</strong>：若主节点配置了 <code v-pre>requirepass</code> 参数，则需要密码验证。</p>\n<ul>\n<li>从节点需在配置文件中设置 <code v-pre>masterauth</code> 参数提供密码</li>\n<li>如果验证失败，主从复制过程将停止</li>\n</ul>\n</li>\n<li>\n<p><strong>同步数据集</strong>：在首次建立复制时，主节点会将其所有数据发送给从节点，分为以下两种情况。</p>\n<ul>\n<li><strong>全量同步</strong>：发送所有数据，耗时较长（后面会提及 <mark>方式、字段、指令</mark>）</li>\n<li><strong>部分同步</strong>：发送增量数据，耗时较短（后面会提及 <mark>方式、字段、指令</mark>）</li>\n</ul>\n</li>\n<li>\n<p><strong>命令持续复制</strong>：完成数据同步后，主节点会将后续所有修改命令发送给从节点，从节点执行这些命令以保持数据一致性。</p>\n</li>\n</ol>\n<p>建立复制链接之后：</p>\n<p>而实际上，为了做到实时复制，主从节点在建立复制链接后，主节点回报自己收到的修改操作，通过 <code v-pre>tcp</code> 长链接的方式，源源不断传输给从节点，从节点就会根据这写请求来同步修改自己的数据，保持和主节点的数据一致性。</p>\n<p>而这样的长链接需要使用心跳检测机制（这里的心跳机制是在 <code v-pre>Redis</code> 应用层实现的，而不是 <code v-pre>TCP</code> 自带的心跳机制）来维护链接状态：</p>\n<ol>\n<li>主从节点彼此之间都有心跳机制，各自模拟为对方的客户端进行通信</li>\n<li>主节点默认每隔 <code v-pre>10 s</code> 对从节点发送 <code v-pre>ping</code> 指令，判断从节点的存活性和链接状态（从节点也可以用这种方式来的只主节点是否掉线）</li>\n<li>从节点默认每隔 <code v-pre>1 s</code> 对主节点发送 <code v-pre>replconf ack {offset}</code> 指令来上报自己的偏移量（主节点会根据该偏移量来知道哪些数据已经被从节点接收并处理）</li>\n</ol>\n<p>如果主节点发现从节点通信延迟超过 <code v-pre>repl-timeout</code> 配置的值（默认 <code v-pre>60</code> 秒），则判定从节点下线，断 开复制客⼾端连接。从节点恢复连接后，⼼跳机制继续进⾏。</p>\n<h5 id=\"_1-2-3-2-复制方式\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-3-2-复制方式\"><span>1.2.3.2.复制方式</span></a></h5>\n<ul>\n<li>早期的<code v-pre> Redis</code> 只支持全量复制，这就导致有新的从节点加入时，如果数据量较大，就会非常消耗网络资源，并且一旦出现网络波动，就会导致数据丢失而重传。</li>\n<li>新版本的 <code v-pre>Redis</code> 支持部分复制，这主要处理在主从复制中网络闪断等原因造成的数据丢失场景，当从节点再次连接上主节点后，如果条件允许，主节点就会自动补发数据给从节点。补发的数量远小于全量复制，因此可以避免过量的开销。</li>\n</ul>\n<p>而同步的指令主要依靠 <code v-pre>psync replicationid &lt;offset&gt;</code>（是 <code v-pre>Redis</code> 内部自动调用的命令，不用我们自己调用），其中 <code v-pre>offset</code> 为 <code v-pre>-1</code> 代表全量复制指令，其他数值均为部分复制。</p>\n<p>触发全量复制，这通常在以下场景发生：</p>\n<ul>\n<li>从节点首次连接到主节点时。</li>\n<li>从节点与主节点数据完全不同步（如从节点为空或主节点 <code v-pre>replicationid</code> 改变）。</li>\n<li>主节点无法满足部分复制条件（如复制积压缓冲区不足）。</li>\n</ul>\n<p>触发部分复制，这通常在以下场景发生：</p>\n<ul>\n<li>从节点重新连接主节点时（短暂网络中断后）。</li>\n<li>从节点的 <code v-pre>replicationid</code> 和偏移量与主节点匹配，且主节点复制积压缓冲区中仍有缺失的数据。</li>\n</ul>\n<h5 id=\"_1-2-3-3-重要字段\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-3-3-重要字段\"><span>1.2.3.3.重要字段</span></a></h5>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：通过 <code v-pre>info replication</code> 可以观察下提及的字段，以及对应值的变化。</p>\n</div>\n<h6 id=\"_1-2-3-3-1-复制标识字段\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-3-3-1-复制标识字段\"><span>1.2.3.3.1.复制标识字段</span></a></h6>\n<p>节点的复制 <code v-pre>id</code>在以下两种情况。</p>\n<ul>\n<li>主节点初始启动时/重新启动时/异常恢复时</li>\n<li>从节点晋级成主节点时</li>\n</ul>\n<p>都会生成一个 <code v-pre>replication id</code>(同一个节点，每次重启，生成的 <code v-pre>replication id</code> 也会变化)，从节点和主节点建立连接之后，就会获取到主节点的 <code v-pre>replication id</code>，通过 <code v-pre>info replication</code> 即可查看 <code v-pre>replication id</code>。</p>\n<p>而每个节点需要记录两组 <code v-pre>master_replid</code>，这个设定解决的问题场景是这样的：</p>\n<ul>\n<li>比如当前有两个节点 <code v-pre>A</code> 和 <code v-pre>B</code>，<code v-pre>A</code> 为 <code v-pre>master</code>，<code v-pre>B</code> 为 <code v-pre>slave</code>。此时 <code v-pre>B</code> 就会记录 <code v-pre>A</code> 的 <code v-pre>master_replid</code>。如果网络出现抖动，<code v-pre>B</code> 以为 <code v-pre>A</code> 挂了，<code v-pre>B</code> 自己就会自动成为主节点。</li>\n<li>于是 <code v-pre>B</code> 给自己分配了新的 <code v-pre>master_replid</code>。此时就会使用 <code v-pre>master_replid2</code> 来保存之前 <code v-pre>A</code> 的 <code v-pre>master_replid</code>。</li>\n<li>如果后续网络恢复了，<code v-pre>B</code> 就可以根据 <code v-pre>master_replid2</code> 找回之前的主节点。</li>\n<li>如果后续网络没有恢复，<code v-pre>B</code> 就按照新的 <code v-pre>master_replid</code> 自成一派，继续处理后续的数据（您可以自己尝试 <code v-pre>kill</code> 掉主节点，重启主节点，查看中间的变化...）。</li>\n</ul>\n<h6 id=\"_1-2-3-3-2-复制偏移字段\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-3-3-2-复制偏移字段\"><span>1.2.3.3.2.复制偏移字段</span></a></h6>\n<p>参与复制的主从节点都会维护自身复制偏移量，主节点（<code v-pre>master</code>）在处理完写入命令后，会把命令的字节长度做累加记录，统计信息在 <code v-pre>info replication</code> 中的 <code v-pre>master_repl_offset</code> 指标中。</p>\n<p>从节点在接受到主节点发送的命令后，也会累加记录自身的偏移量，统计信息在 <code v-pre>info replication</code> 中的 <code v-pre>slave_repl_offset</code> 指标中。</p>\n<p>从节点每秒钟上报自身的复制偏移量给主节点，因此主节点也会保存从节点的复制偏移量，统计指标为 <code v-pre>slavex</code> 中的 <code v-pre>offset</code> 字段。</p>\n<p>因此，通过对比主从节点的复制偏移量，可以判断主从节点数据是否一致。</p>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：<code v-pre>replid + offset</code> 共同标识了一个“数据集”，如果两个节点，他们的 <code v-pre>replid</code> 和 <code v-pre>offset</code> 都相同，则这两个节点上持有的数据，就一定相同。</p>\n</div>\n<div class=\"hint-container note\">\n<p class=\"hint-container-title\">注</p>\n<p>吐槽：偏移量就相当于学习进度。</p>\n</div>\n<h5 id=\"_1-2-3-4-同步指令\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-3-4-同步指令\"><span>1.2.3.4.同步指令</span></a></h5>\n<p>从节点实现复制的原理实际上就是调用 <code v-pre>psync</code> 指令（由于早期不支持部分复制，会使用全量复制指令 <code v-pre>sync</code>，<code v-pre>Redis</code> 会自动根据当前版本来决定使用哪一个指令）。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 数据同步指令</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">psync</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">主节点复制标识replicationi</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">d</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">偏移量offse</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">t</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 如果 replicationid 设为 '?' 并且 offset 设为 '-1' 此时就是在尝试进行全量复制</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">#如果 replicationid offset 设为了具体的数值, 则是尝试进行部分复制</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>从节点使用后，主要发生了以下事情：</p>\n<figure><img src=\"@source/4.业务服务/3.缓存服务/assets/image-20241202145718801.png\" alt=\"\" tabindex=\"0\" loading=\"lazy\"><figcaption></figcaption></figure>\n<ol>\n<li>从节点发送 <code v-pre>psync</code> 命令给主节点，<code v-pre>replid</code> 和 <code v-pre>offset</code> 的默认值分别是 <code v-pre>?</code> 和 <code v-pre>-1</code></li>\n<li>主节点根据 <code v-pre>psync</code> 参数和自身数据情况决定响应结果：\n<ul>\n<li>如果回复 <code v-pre>+FULLRESYNC</code>，从节点进行全量复制流程</li>\n<li>如果回复 <code v-pre>+CONTINEU</code>，从节点进行部分复制流程</li>\n<li>如果回复 <code v-pre>-ERR</code>，说明 <code v-pre>Redis</code> 主节点版本过低，不支持 <code v-pre>psync</code> 命令，从节点可以使用 <code v-pre>sync</code> 命令进行全量复制</li>\n</ul>\n</li>\n</ol>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：当从节点初次连接主节点时，它不知道主节点的 <code v-pre>replicationid</code>（即它没有之前的同步信息）。</p>\n<p>这种情况下，从节点会发送 <code v-pre>PSYNC ? 0</code> 请求，表示它从未与主节点进行过同步，要求主节点进行全量同步。</p>\n</div>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：<code v-pre>psync</code> 一般不需要手动执行，<code v-pre>Redis-server</code> 会在主从复制模式下自动调用执行。</p>\n</div>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：<code v-pre>sync</code> 会阻塞 <code v-pre>redis server</code> 处理其他请求，<code v-pre>psync</code> 则不会。</p>\n</div>\n<h5 id=\"_1-2-3-5-详细过程\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-3-5-详细过程\"><span>1.2.3.5.详细过程</span></a></h5>\n<p>根据我们之前的知识，您也肯定明白两种复制方式的触发情况，但是我我们可以进一步细化这一步复制的概念。</p>\n<h6 id=\"_1-2-3-5-1-全量复制的细节\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-3-5-1-全量复制的细节\"><span>1.2.3.5.1.全量复制的细节</span></a></h6>\n<figure><img src=\"@source/4.业务服务/3.缓存服务/assets/image-20241202152620443.png\" alt=\"\" tabindex=\"0\" loading=\"lazy\"><figcaption></figcaption></figure>\n<ol>\n<li>从节点发送 <code v-pre>psync</code> 命令给主节点进行数据同步，由于是第一次进行复制，从节点没有主节点的运行 <code v-pre>ID</code> 和复制偏移量，所以发送 <code v-pre>psync ? -1</code>（不过有 <code v-pre>IP</code> 和<code v-pre>PORT</code> 所以不愁找不到主节点）。</li>\n<li>主节点根据命令，解析出要进行全量复制，回复 <code v-pre>+FULLRESYNC</code> 响应。</li>\n<li>从节点接收主节点的运行信息进行保存。</li>\n<li>主节点执行 <code v-pre>bgsave</code> 进行 <code v-pre>RDB</code> 文件的持久化。</li>\n<li>主节点发送 <code v-pre>RDB</code> 文件给从节点，从节点保存 <code v-pre>RDB</code> 数据到本地硬盘。</li>\n<li>主节点将从生成 <code v-pre>RDB</code> 到接收完成期间执行的写命令，写入到缓冲区中（不是指积压缓冲区），等从节点保存完 <code v-pre>RDB</code> 文件后，主节点再将缓冲区内的数据补发给从节点，补发的数据仍然按照 <code v-pre>RDB</code> 的二进制格式追加写入到收 到的 <code v-pre>rdb</code> 文件中，保持主从一致性。</li>\n<li>从节点清空自身原有的旧数据。</li>\n<li>从节点加载 <code v-pre>RDB</code> 文件得到与主节点一致的数据。</li>\n<li>如果从节点加载 <code v-pre>RDB</code> 完成之后，并且开启了 <code v-pre>AOF</code> 持久化功能，它会进行 <code v-pre>bgrewriteaof</code> 操作（不阻塞地优化 <code v-pre>AOF</code> 文件），得到最近的 <code v-pre>AOF</code> 文件。</li>\n</ol>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：默认情况下，进行全量复制需要主节点生成 <code v-pre>RDB</code> 文件到主节点的磁盘中, 再把磁盘上的 <code v-pre>RDB</code> 文件通过发送给从节点。<code v-pre>Redis</code> 从 <code v-pre>2.8.18</code> 版本开始支持无磁盘复制。主节点在执行 <code v-pre>RDB</code> 生成流程时, 不会生成 <code v-pre>RDB</code> 文件到磁盘中了，而是直接把生成的 <code v-pre>RDB</code> 数据通过网络发送给从节点，这样就节省了一系列的写硬盘和读硬盘的操作开销。</p>\n</div>\n<h6 id=\"_1-2-3-5-2-部分复制的细节\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-3-5-2-部分复制的细节\"><span>1.2.3.5.2.部分复制的细节</span></a></h6>\n<figure><img src=\"@source/4.业务服务/3.缓存服务/assets/image-20241202152701081.png\" alt=\"\" tabindex=\"0\" loading=\"lazy\"><figcaption></figcaption></figure>\n<ol>\n<li>当主从节点之间出现网络中断时，如果超过 <code v-pre>repl-timeout</code> 时间，主节点会认为从节点故障并终止复制连接。</li>\n<li>主从连接中断期间主节点依然响应命令，但这些复制命令都因网络中断无法及时发送给从节点，所以暂时将这些命令滞留在 <strong>复制积压缓冲区</strong> 中。</li>\n<li>当主从节点网络恢复后，从节点再次连上主节点。</li>\n<li>从节点将之前保存的 <code v-pre>replicationId</code> 和 <code v-pre>offset</code> 作为 <code v-pre>psync</code> 的参数发送给主节点，请求进行部分复制。</li>\n<li>主节点接到 <code v-pre>psync</code> 请求后，进行必要的验证。随后根据 <code v-pre>offset</code> 去复制积压缓冲区查找合适的数据， 并响应 <code v-pre>+CONTINUE</code> 给从节点（如果超出缓冲区的范围就需要切换为全量复制了）。</li>\n<li>主节点将需要从节点同步的数据发送给从节点，最终完成一致性。</li>\n</ol>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：复制积压缓冲区的概念。</p>\n<figure><img src=\"@source/4.业务服务/3.缓存服务/assets/image-20241202153856009.png\" alt=\"\" tabindex=\"0\" loading=\"lazy\"><figcaption></figcaption></figure>\n<p>复制积压缓冲区是保存在主节点上的一个固定长度的队列，默认大小为 <code v-pre>1MB</code>，当主节点有连接的从节点时被创建，这时主节点响应写命令时，不但会把命令发送给从节点，还会写入复制积压缓冲区，</p>\n<p>由于积压缓冲区本质上是先进先出的定长队列，所以能实现保存最近已复制数据的功能，用于补救 <strong>部分复制或复制命令</strong> 中丢失的数据。复制缓冲区相关统计信息可以通过主节点的 <code v-pre>info replication</code> 中。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 积压缓冲区信息</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">info</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replication</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># Replication</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">role:master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_active:1</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 开启复制缓冲区</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_size:1048576</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 缓冲区最大长度 </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_first_byte_offset:7479</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 起始偏移量, 计算当前缓冲区可用范围</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_histlen:1048576</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 已保存数据的有效长度</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 可算出复制积压缓冲区内的可用偏移量范围: [repl_backlog_first_byte_offset, repl_backlog_first_byte_offset + repl_backlog_histlen]</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></div>\n<h3 id=\"_1-3-哨兵节点\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-3-哨兵节点\"><span>1.3.哨兵节点</span></a></h3>\n<h4 id=\"_1-3-1-概念\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-3-1-概念\"><span>1.3.1.概念</span></a></h4>\n<p><code v-pre>Redis</code> 的主从复制模式可以将主节点的数据改变同步给从节点，这样从节点就可以起到两个作用：</p>\n<ul>\n<li>作为主节点的一个备份，一旦主节点出了故障不可达的情况，从节点可以作为后备“顶替”上来，并且保证数据尽量不丢失（主从复制表现为最终一致性）</li>\n<li>从节点可以分担主节点上的读压力，让主节点只承担写请求的处理，将所有的读请求负载均衡到各个从节点上。 但是主从复制模式并不是万能的，它同样遗留下以下几个问题：\n<ul>\n<li>主节点发生故障时，进行主备切换的过程是复杂的，需要完全的人工参与，导致故障恢复时间无法得到保障（这个用哨兵来解决）。</li>\n<li>主节点可以将读压力分散出去，但写压力/存储压力是无法法被分担的，还是受到单机的限制。 其中第一个问题是高可用问题，即 <code v-pre>Redis</code> 哨兵主要解决的问题（这个用集群来解决）。</li>\n</ul>\n</li>\n</ul>\n<p>不过，我们先来观察一个主节点故障后，一名运维工程师是如何 <Plot>在睡梦中惊醒后</Plot> 快速恢复服务 <Plot>然后回去继续补觉</Plot> 的。</p>\n<ol>\n<li>运维工程师监控面板，发现公司应用出现问题，排查后发现是分布式 <code v-pre>Redis</code> 的主节点发生了故障（假设这个应用只使用了一个主节点，多个一级从节点），但是此应用读取数据是没有问题只是无法写入。</li>\n<li>运维工程师在多个从节点中选择一个选择一个节点作为新主节点，修改所有从节点的配置文件，时从节点们指向新主节点，新的主节点也可以继续使用原有的读操作。</li>\n<li>运维工程师再修改应用的配置文件，让应用连接新的主节点，应用恢复写能力。</li>\n<li>运维工程师排除设计的旧主节点的问题后，修改旧主节点转化为新从节点，加入到分布式 <code v-pre>Redis</code> 架构中，以新主节点作为主节点。</li>\n</ol>\n<p>整个过程也被称为 <strong>故障转移</strong>，因此我们认为 <Plot>运维工程师真的很惨...咳咳</Plot> 这个应用并不高可用，我们希望这个过程是自动的，运维工程师只需要观察异常日志和指定分布是架构节点个数即可。</p>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：这里梳理一下概念。</p>\n<ul>\n<li>数据节点包含主节点、从节点，节点内运行 <code v-pre>redis-server</code> 服务</li>\n<li>哨兵集合内包含哨兵节点，节点内运行 <code v-pre>redis-sentinel</code> 服务</li>\n<li>应用方也叫客户端，可以是命令行也可以是语言第三方库</li>\n</ul>\n</div>\n<p>为了解决上面的问题，<code v-pre>Redis</code> 提出了 <code v-pre>Redis Sentinel</code> 这个分布式架构解决方案，其中包含若干个哨兵节点和数据节点。每个哨兵节点会对数据节点和其余 <code v-pre>Sentinel</code> 节点进行监控（在哨兵节点集合中，存在类似循环链表结构的互相监督机制），当它发现节点不可达时，会对节点做下线标识。</p>\n<p>如果下线的是主节点，它还会和其他的 <code v-pre>Sentinel</code> 节点（所有哨兵节点最好保持奇数总数，避免出现无法选举的问题）进行“协商”，当大多数 <code v-pre>Sentinel</code> 节点对主节点不可达这个结论达成共识之后，它们自己会在哨兵节点集合内部“选举”出一个 <strong>领导节点</strong> 来完成自动故障转移的工作，同时将这个变化实时通知给 <code v-pre>Redis</code> 应用方。整个过程是完全自动的，不需要人工介入。因此大体的流程和上面运维工程师做的类似，故障转移的流程大体如下：</p>\n<figure><img src=\"@source/4.业务服务/3.缓存服务/assets/image-20241202215147107.png\" alt=\"\" tabindex=\"0\" loading=\"lazy\"><figcaption></figcaption></figure>\n<ol>\n<li>监控：主节点故障，从节点同步连接中断，主从复制停止。哨兵节点通过定期监控发现主节点出现故障</li>\n<li>故障转移：哨兵节点与其他哨兵节点进行协商，达成多数认同主节点故障的共识（防止出故障的不是主节点，而是负责发现故障的哨兵节点，该情况经常发生于哨兵节点的网络被孤立的场景下）。后哨兵节点之间使用 <code v-pre>Raft</code> 算法选举出一个领导角色，由该节点负责后续的故障转移工作，哨兵领导者开始执行故障转移：\n<ul>\n<li>在从节点集合中选择一个作为新主节点</li>\n<li>让其他从节点同步新主节点</li>\n</ul>\n</li>\n<li>通知：通知应用层转移到新主节点</li>\n</ol>\n<h4 id=\"_1-3-2-部署\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-3-2-部署\"><span>1.3.2.部署</span></a></h4>\n<p>由于带有哨兵节点的分布式架构，直接本机部署多个数据节点和哨兵节点是有些麻烦的，因此为了演示方便，这里将会使用 <code v-pre>Docker Compose</code> 统一管理多个数据节点容器和多个哨兵节点容器。</p>\n<div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>注意：如果您没有学习过 <code v-pre>Docker</code> 相关的知识，其实也很难理解后面的集群知识，因此这里建议学习过一些 <code v-pre>Docker</code> 的操作和原理再来继续查阅本文档...</p>\n</div>\n<h5 id=\"_1-3-2-1-准备工作\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-3-2-1-准备工作\"><span>1.3.2.1.准备工作</span></a></h5>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 准备工作</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 安装编排工具</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> apt</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> install</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker-compose</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker-compose</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -v</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Docker</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Compose</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> version</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> v2.26.1</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 停止原有服务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> stop</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># $ sudo systemctl stop redis-sentinel # 如果有的话</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 拉取最新镜像</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> pull</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis:latest</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"hint-container caution\">\n<p class=\"hint-container-title\">警告</p>\n<p>警告：建议和我相同版本。</p>\n</div>\n<h5 id=\"_1-3-2-2-主从编排\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-3-2-2-主从编排\"><span>1.3.2.2.主从编排</span></a></h5>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 编排主从</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> vim</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/redis/redis-data/docker-compose.yml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/redis/redis-data/docker-compose.yml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">services:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis1:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-node-1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-server</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> --appendonly</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> yes</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6379:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis2:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-node-2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-server</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> --appendonly</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> yes</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> --slaveof</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-node-1</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6380:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">  </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis3:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-node-3</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-server</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> --appendonly</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> yes</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> --slaveof</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-node-1</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6381:6379</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>上述配置文件描述了三个节点容器，一个主节点容器，两个从节点容器（都开启 <code v-pre>AOP</code> 持久化）。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 启动指令</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 根据不同编排配置启动分布式</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cd</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/redis/redis-data</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker-compose</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> up</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -d</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看默认的网络</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> network</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ls</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">NETWORK</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ID</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">     NAME</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">                 DRIVER</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    SCOPE</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">efe47f88acdc</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   redis-data_default</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">        bridge</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">    local</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 注意: 这个网络名称是根据 \"编排配置文件所在目录名称 + _default\" 得到的</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> network</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> inspect</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-data_default</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Name</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-data_default</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Id</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">8533d02081e2576057d6838168e5e1d6e87f5daba69a1ea7d69e51fd4cd151a5</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Created</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">2024-12-05T13:47:48.417830084+08:00</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Scope</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">local</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Driver</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">bridge</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">EnableIPv6</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">false</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPAM</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Driver</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">default</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Options</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: null,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Config</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                    \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Subnet</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.20.0.0/16</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                    \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Gateway</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.20.0.1</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">            ]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Internal</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">false</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Attachable</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">false</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Ingress</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">false</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">ConfigFrom</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Network</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">ConfigOnly</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">false</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Containers</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">5680ccfbbc0ff83424c2472f5993a40d181308919bf6a0d4c5e7629e0d70f986</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Name</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-node-1</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">EndpointID</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">63fb132ccd54ae3cd7aa2c84ca7d66c8b7ea55a2f6945f47ccf42b065f635cc3</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">MacAddress</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">02:42:ac:14:00:03</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv4Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.20.0.3/16</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv6Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">6542ad572406c4a42f4cdc470f7bc7a11efa434709976b961ffb5bca6fb6a9c0</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Name</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-node-2</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">EndpointID</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">23dd68fec78289df8ac836cf4d91b04bc541847339a9a1b2d59d08ab285511ec</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">MacAddress</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">02:42:ac:14:00:04</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv4Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.20.0.4/16</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv6Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">f848db6f4005b6884cfeedbb3fe8beec5d3a51fde536305c2c756e6fa6999f80</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Name</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-node-3</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">EndpointID</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">4b7fe30897519d432fd4ff9a30b7c36baddfa8c8665b847cc109dc4ce1999c98</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">MacAddress</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">02:42:ac:14:00:02</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv4Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.20.0.2/16</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv6Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Options</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {},</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Labels</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">com.docker.compose.network</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">default</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">com.docker.compose.project</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-data</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">com.docker.compose.version</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">2.26.1</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 检查主从运行情况</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">info</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replication</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># Replication</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">role:master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">connected_slaves:2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave0:ip</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">=172.20.0.4,port=6379,state=online,offset=252,lag=0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave1:ip</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">=172.20.0.2,port=6379,state=online,offset=252,lag=0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_failover_state:no-failover</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_replid:8d4657bef20c6a9b9e260f04fe86a919fdc2db1f</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_replid2:0000000000000000000000000000000000000000</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_repl_offset:252</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">second_repl_offset:-1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_active:1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_size:1048576</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_first_byte_offset:1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_histlen:252</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">set</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> my_key</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 114514</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">OK</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> my_key</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"114514\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6380</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6380</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> my_key</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"114514\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6380</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6381</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6381</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> my_key</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"114514\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6381</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h5 id=\"_1-3-2-3-哨兵编排\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-3-2-3-哨兵编排\"><span>1.3.2.3.哨兵编排</span></a></h5>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 编排哨兵</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> vim</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/redis/redis-sentinel/docker-compose.yml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/redis/redis-sentinel/docker-compose.yml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">networks:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis-data_default:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    external:</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> true</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 表示网络来自外部</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">services:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  sentinel1:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-sentinel-1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    networks:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-data_default</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-server /etc/redis-config/redis.conf --sentinel</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    volumes:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">./sentinel2:/etc/redis-config</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 26379:26379</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  sentinel2:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-sentinel-2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    networks:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-data_default</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-server /etc/redis-config/redis.conf --sentinel</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    volumes:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">./sentinel2:/etc/redis-config</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 26380:26379</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  sentinel3:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-sentinel-3</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    networks:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-data_default</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-server /etc/redis-config/redis.conf --sentinel</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    volumes:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">./sentinel3:/etc/redis-config</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 26381:26379</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>每个哨兵节点其实在一开始都使用同一份内容配置文件，但是被我分开为三个配置文件 ，且每个哨兵节点都在监视主节点，三个节点的总票数为 <code v-pre>3</code> 只需要 <code v-pre>2</code> 张票即可判定主节点下线。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">  # 先查看现有的 Redis 主数据节点分配到的 ip 地址</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> network</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> inspect</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-data_default</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># ...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">            \"5680ccfbbc0ff83424c2472f5993a40d181308919bf6a0d4c5e7629e0d70f986\"</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">                \"Name\"</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-node-1</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">                \"EndpointID\"</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">63fb132ccd54ae3cd7aa2c84ca7d66c8b7ea55a2f6945f47ccf42b065f635cc3</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">                \"MacAddress\"</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">02:42:ac:14:00:03</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">                \"IPv4Address\"</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.20.0.3/16</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">                \"IPv6Address\"</span><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># ...</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 编写配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cd</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/redis/redis-sentinel</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> mkdir</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sentinel1</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sentinel2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sentinel3</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> vim</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sentinel1/redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bind</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0.0.0.0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">port</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 26379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> monitor</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.3</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 警告: 不允许使用容器名称替换 ip 地址</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> down-after-milliseconds</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1000</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 这里标识 sentinel monitor 主节点名 主节点ip 主节点端口 法定票数</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 复制三份配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cp</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  sentinel1/redis.conf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sentinel2/redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cp</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sentinel1/redis.conf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sentinel3/redis.conf</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看文件目录结构</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> $</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> tree</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -L</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker-compose.yml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sentinel1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">│</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sentinel2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">│</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">└──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sentinel3</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    └──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis.conf</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"hint-container caution\">\n<p class=\"hint-container-title\">警告</p>\n<p>警告：<code v-pre>redis-sentinel</code> 在运行过此中可能会对配置进行 <code v-pre>rewrite(重写)</code> 导致文件内容发生修改，如果用一份文件，就可能出现修改混乱的情况（例如三个哨兵节点监视的主节点失效后，就需要更改配置文件中主节点的 <code v-pre>ip</code> 和 <code v-pre>port</code>）。</p>\n</div>\n<div class=\"hint-container caution\">\n<p class=\"hint-container-title\">警告</p>\n<p>警告：将三个 <code v-pre>redis.conf</code> 放在各个目录中是必要的，我也不太清楚原因，但是我确实有搜索到 <a href=\"https://stackoverflow.com/questions/70384566/warning-sentinel-was-not-able-to-save-the-new-configuration-on-disk-device\" target=\"_blank\" rel=\"noopener noreferrer\">相关的资料</a>，不过也没有详细解释原因...</p>\n</div>\n<div class=\"hint-container caution\">\n<p class=\"hint-container-title\">警告</p>\n<p>补充：之前的 <code v-pre>redis</code> 数据节点之所以可以直接使用 <code v-pre>redis-master</code> 名称作为域名解析，是因为编排文件默认生成一个局域网，三个数据节点处于同一个局域网 <code v-pre>redis-data_default</code> 中。因此 <code v-pre>docker</code> 可以根据默认 <code v-pre>DNS</code> 解析得到容器在局域网中的 <code v-pre>ip</code>，但是貌似因为 <code v-pre>Redis</code> 最新版本中没有完全为哨兵节点适配这个问题，因此后面的三份 <code v-pre>redis.conf</code> 配置文件是根据前面分配给主数据节点的 <code v-pre>ip</code> 硬编码进去的，这里也有一些相关资料供您参考...</p>\n<ul>\n<li><a href=\"https://blog.csdn.net/weixin_63028438/article/details/136077092\" target=\"_blank\" rel=\"noopener noreferrer\">CSDN 相关资料</a></li>\n<li><a href=\"https://stackoverflow.com/questions/57464443/redis-sentinel-throws-error-cant-resolve-master-instance-hostname\" target=\"_blank\" rel=\"noopener noreferrer\">堆栈溢出相关资料</a></li>\n<li><a href=\"https://redis.io/docs/latest/operate/oss_and_stack/management/sentinel/#ip-addresses-and-dns-names\" target=\"_blank\" rel=\"noopener noreferrer\">Redis 官方文档</a></li>\n</ul>\n</div>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 启动指令</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> $</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cd</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/redis/redis-sentinel/</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> $</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker-compose</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> up</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -d</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> $</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker-compose</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ls</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> NAME</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">                STATUS</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">              CONFIG</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> FILES</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">redis-data</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">          running</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">3</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">          /etc/redis/redis-data/docker-compose.yml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">redis-sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">      running</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">3</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">          /etc/redis/redis-sentinel/docker-compose.yml</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>上述配置文件描述了三个哨兵节点容器，分别监听配置文件里规定的数据节点容器。</p>\n<h5 id=\"_1-3-2-4-现象观察\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-3-2-4-现象观察\"><span>1.3.2.4.现象观察</span></a></h5>\n<figure><img src=\"@source/4.业务服务/3.缓存服务/assets/未命名文件.png\" alt=\"\" tabindex=\"0\" loading=\"lazy\"><figcaption></figcaption></figure>\n<p>根据配置文件<code v-pre>docker</code> 网络应该符合上图，我们可以简单查看一下。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看网络</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> network</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> inspect</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-data_default</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Name</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-data_default</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Id</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">8533d02081e2576057d6838168e5e1d6e87f5daba69a1ea7d69e51fd4cd151a5</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Created</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">2024-12-05T13:47:48.417830084+08:00</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Scope</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">local</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Driver</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">bridge</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">EnableIPv6</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">false</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPAM</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Driver</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">default</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Options</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: null,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Config</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                    \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Subnet</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.20.0.0/16</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                    \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Gateway</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.20.0.1</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">                }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">            ]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Internal</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">false</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Attachable</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">false</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Ingress</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">false</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">ConfigFrom</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Network</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">ConfigOnly</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">false</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Containers</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">30fc3d7275e9e5c3a252c9838af4df3e0dcdb3d7aaa491247117b32c0d1733fd</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Name</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-sentinel-1</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">EndpointID</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">897b230ed7894a039328c8cac06a0eafb28c12b714814873e8693696d2243696</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">MacAddress</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">02:42:ac:14:00:05</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv4Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.20.0.5/16</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv6Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">3b3913ebe84f1997aaed3b4e632b33a62b324c77e614b8ad3bdc0866411f0cc4</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Name</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-sentinel-3</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">EndpointID</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">60092aabd2445d68477326529fe604b6daecc46bb5ddd7dbdc6c63ef1c5eee3b</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">MacAddress</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">02:42:ac:14:00:07</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv4Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.20.0.7/16</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv6Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">5680ccfbbc0ff83424c2472f5993a40d181308919bf6a0d4c5e7629e0d70f986</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Name</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-node-1</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">EndpointID</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">63fb132ccd54ae3cd7aa2c84ca7d66c8b7ea55a2f6945f47ccf42b065f635cc3</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">MacAddress</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">02:42:ac:14:00:03</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv4Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.20.0.3/16</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv6Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">6542ad572406c4a42f4cdc470f7bc7a11efa434709976b961ffb5bca6fb6a9c0</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Name</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-node-2</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">EndpointID</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">23dd68fec78289df8ac836cf4d91b04bc541847339a9a1b2d59d08ab285511ec</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">MacAddress</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">02:42:ac:14:00:04</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv4Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.20.0.4/16</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv6Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">7803c0046b724adcd30524b4241cd0f9d0aa17db187c08a3cf3e3dbd6b147d1b</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Name</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-sentinel-2</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">EndpointID</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">c6186ef8769b3719dfbafbc261471a65717ad88acd4e0571e220c7fd0c906fe5</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">MacAddress</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">02:42:ac:14:00:06</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv4Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.20.0.6/16</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv6Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">f848db6f4005b6884cfeedbb3fe8beec5d3a51fde536305c2c756e6fa6999f80</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Name</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-node-3</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">EndpointID</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">4b7fe30897519d432fd4ff9a30b7c36baddfa8c8665b847cc109dc4ce1999c98</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">MacAddress</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">02:42:ac:14:00:02</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv4Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.20.0.2/16</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">                \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">IPv6Address</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">            }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        },</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Options</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {},</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">        \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Labels</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">com.docker.compose.network</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">default</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">com.docker.compose.project</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-data</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">            \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">com.docker.compose.version</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">2.26.1</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 观察现象</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看哨兵节点日志</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> container</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> logs</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-sentinel-1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 06:45:37.907</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> oO0OoO0OoO0Oo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Redis</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> is</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> starting</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> oO0OoO0OoO0Oo</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 06:45:37.907</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Redis</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> version=7.4.1,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> bits=64,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> commit=00000000,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> modified=0,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> pid=1,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> just</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> started</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 06:45:37.907</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Configuration</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> loaded</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 06:45:37.907</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> monotonic</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> clock:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> POSIX</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> clock_gettime</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 06:45:37.908</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Running</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> mode=sentinel,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> port=26379.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 06:45:37.908</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ID</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> is</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 37d3396d0d849849aae8412b320123e38a774f7f</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 06:45:37.908</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # +monitor master redis-master 172.20.0.3 6379 quorum 2 # 开始监控主节点, 并且配置仲裁数量为 2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 06:45:39.973</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> +sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 37d3396d0d849849aae8412b320123e38a774f7f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.6</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 26379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> @</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.3</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 注册一个哨兵节点监控主数据节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 06:45:39.979</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> new</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> configuration</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> saved</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> on</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> disk</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 06:45:39.981</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> +sentinel-address-switch</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.3</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ip</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.5</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> port</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 26379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> for</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 37d3396d0d849849aae8412b320123e38a774f7f</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 注册一个哨兵节点监控主数据节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 06:45:39.983</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> new</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> configuration</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> saved</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> on</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> disk</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 06:45:39.992</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> +sentinel-address-switch</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.3</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ip</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.7</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> port</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 26379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> for</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4ac62e0c7bde83b4acd18aa35bb544a7936f1a30</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 注册一个哨兵节点监控主数据节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 06:45:39.995</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> new</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> configuration</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> saved</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> on</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> disk</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 哨兵节点加载并且保存了新的配置到磁盘中</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sentinel1/redis.conf</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bind</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0.0.0.0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">port</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 26379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> monitor</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.3</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> down-after-milliseconds</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1000</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># Generated by CONFIG REWRITE  # 这一部分也是新增加的部分, 是哨兵节点写入的, 我们需要分开三个配置文件书写的原因就是因为哨兵节点会对配置文件进行修改</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">dir</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/data</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # Redis Sentinel 工作目录</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">latency-tracking-info-percentiles</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 50</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 99</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 99.9</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 配置延迟跟踪的百分位</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">user</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> default</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> on</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nopass</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sanitize-payload</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ~</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">*</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> &#x26;</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> +@all </span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 配置默认用户的权限及认证方式</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> myid</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> b6acb72ff13c744f8559c5582f97490af5dfa5c0</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 当前哨兵节点的唯一标识符</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> config-epoch</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 配置主节点的纪元值, 用于主节点选举时的版本控制</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> leader-epoch</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 记录当前哨兵选举过程中被选中的主节点的纪元</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> current-epoch</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 当前哨兵的纪元 </span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> known-replica</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.2</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 声明一个已知的副本节点(从数据节点)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> known-replica</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.4</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 声明一个已知的副本节点(从数据节点)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> known-sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.6</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 26379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4ac62e0c7bde83b4acd18aa35bb544a7936f1a30</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 已知的其他哨兵节点信息</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> known-sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.7</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 26379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 37d3396d0d849849aae8412b320123e38a774f7f</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 已知的其他哨兵节点信息</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 模拟主节点挂掉</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> container</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> stop</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-node-1</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 重新查看日志</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> container</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> logs</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-node-1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># (省略) ...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:32.069</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # +sdown master redis-master 172.20.0.3 6379 # 本哨兵节点检测到主节点失效(主观下线)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:32.131</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # +odown master redis-master 172.20.0.3 6379 #quorum 2/2 # 所有哨兵节点通过投票决定该主数据节点已经完全不可用(客观下线), 这里的 quorum 意为多数同意</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># >>> begin: 开始故障转移 >>></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:32.131</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # +new-epoch 1 # 创建了一个新的选举周期, 标识为 1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:32.131</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # +try-failover master redis-master 172.20.0.3  # 开始尝试进行主节点故障转移</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:32.137</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> new</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> configuration</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> saved</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> on</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> disk</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # Sentinel 已经将新的配置加载的磁盘中</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:32.137</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # +vote-for-leader 37d3396d0d849849aae8412b320123e38a774f7f 1 # 选举新的领导</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:32.137</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 37d3396d0d849849aae8412b320123e38a774f7f</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> voted</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> for</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 37d3396d0d849849aae8412b320123e38a774f7f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:32.141</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4ac62e0c7bde83b4acd18aa35bb544a7936f1a30</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> voted</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> for</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 37d3396d0d849849aae8412b320123e38a774f7f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:32.214</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # +elected-leader master redis-master 172.20.0.3 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:32.214</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # +failover-state-select-slave master redis-master 172.20.0.3 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:32.305</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # +selected-slave slave 172.20.0.2:6379 172.20.0.2 6379 @ redis-master 172.20.0.3 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:32.305</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> +failover-state-send-slaveof-noone</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.20.0.2:6379</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.2</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> @</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.3</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:32.456</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> +failover-state-wait-promotion</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.20.0.2:6379</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.2</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> @</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.3</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:33.393</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> new</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> configuration</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> saved</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> on</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> disk</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:33.393</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # +promoted-slave slave 172.20.0.2:6379 172.20.0.2 6379 @ redis-master 172.20.0.3 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:33.393</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # +failover-state-reconf-slaves master redis-master 172.20.0.3 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:33.449</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> +slave-reconf-sent</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.20.0.4:6379</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.4</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> @</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.3</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:34.393</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> +slave-reconf-inprog</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.20.0.4:6379</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.4</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> @</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.3</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:34.393</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> +slave-reconf-done</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.20.0.4:6379</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.4</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> @</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.3</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:34.455</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # +failover-end master redis-master 172.20.0.3 6379 # 完成故障转移</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># &#x3C;&#x3C;&#x3C; end &#x3C;&#x3C;&#x3C;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:34.455</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # +switch-master redis-master 172.20.0.3 6379 172.20.0.2 6379 # 切换主节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:34.455</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> +slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.20.0.4:6379</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.4</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> @</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.2</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 更新新的从节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:34.455</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> +slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.20.0.3:6379</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.3</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> @</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-master</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.20.0.2</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 更新新的从节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:34.457</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Sentinel</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> new</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> configuration</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> saved</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> on</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> disk</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:X</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 05</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 07:27:35.506</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # +sdown slave 172.20.0.3:6379 172.20.0.3 6379 @ redis-master 172.20.0.2 6379</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 重新访问新的主节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> container</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ls</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> |</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> grep</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">30fc3d7275e9</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">   \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">docker-entrypoint.s…</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">   2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> hours</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ago</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   Up</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> hours</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   6379/tcp,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 0.0.0.0:26379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">-</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">26379/tcp,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> :::26379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">-</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">26379/tcp</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">     redis-sentinel-1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">7803c0046b72</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">   \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">docker-entrypoint.s…</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">   2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> hours</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ago</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   Up</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> hours</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   6379/tcp,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 0.0.0.0:26380</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">-</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">26379/tcp,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [::]:26380-</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">26379/tcp   redis-sentinel-2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">3b3913ebe84f</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">   \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">docker-entrypoint.s…</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">   2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> hours</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ago</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   Up</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> hours</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   6379/tcp,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 0.0.0.0:26381</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">-</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">26379/tcp,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [::]:26381-</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">26379/tcp   redis-sentinel-3</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">6542ad572406</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">   \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">docker-entrypoint.s…</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">   3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> hours</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ago</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   Up</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> hours</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   0.0.0.0:6380</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">-</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">6379/tcp,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [::]:6380-</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">6379/tcp                 redis-node-2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">f848db6f4005</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">   \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">docker-entrypoint.s…</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">   3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> hours</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ago</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   Up</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> hours</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   0.0.0.0:6381</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">-</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">6379/tcp,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [::]:6381-</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">6379/tcp                 redis-node-3</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 进入客户端</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6380</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看最新配置</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6380</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">info</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replication</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># Replication</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">role:slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_host:172.20.0.2</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 容器内部的 id</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_port:6379</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 容器内部的 port</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_link_status:up</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_last_io_seconds_ago:1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_sync_in_progress:0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave_read_repl_offset:1465716</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave_repl_offset:1465716</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave_priority:100</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">slave_read_only:1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">replica_announced:1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">connected_slaves:0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_failover_state:no-failover</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_replid:d6cda86c05c8b419d7d5a8775c9ee7478d2c451e</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_replid2:8d4657bef20c6a9b9e260f04fe86a919fdc2db1f</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">master_repl_offset:1465716</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">second_repl_offset:808512</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_active:1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_size:1048576</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_first_byte_offset:408801</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">repl_backlog_histlen:1056916</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 检查是否只读</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6381</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">config</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica-read-only</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">replica-read-only</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">2</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">yes</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 取消只读配置</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6381</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">config</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> set</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica-read-only</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> no</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">OK</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 测试是否发生主从复制</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6381</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">set</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> my_key</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">1433223</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">OK</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6381</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> my_key</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"1433223\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6381</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6380</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6380</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> my_key</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"1433223\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6380</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 回复旧的主节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> container</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> start</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-node-1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">redis-node-1</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> my_key</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"114514\"</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 还没有更改, 因为是懒加载的</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6381</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6381</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> my_key</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">8848</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6381</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> my_key</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"8848\"</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 这意味着这个旧主节点已经完全变为了新从节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">127.0.0.1:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：关于数据节点下线的判断。</p>\n<ul>\n<li>主观下线（<code v-pre>Subjectively Down, SDown</code>）：哨兵感知到主节点没心跳了，判定为主观下线</li>\n<li>客观下线（<code v-pre>Objectively Down, ODown</code>）: 多个哨兵达成一致意见，才能认为 <code v-pre>master</code> 确实下线了</li>\n</ul>\n</div>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：在进行主从切换时，所有参与的哨兵节点都会更新自己的配置，并带上当前的 <code v-pre>epoch</code> 标识，也就是所谓的“选举周期标识”。这样，其他哨兵节点就能知道哪个节点是最新的领导者，避免出现重复的操作。</p>\n</div>\n<div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>注意：哨兵节点最好是有奇数个，方便选举 <code v-pre>leader</code>，故障得票也更容易超过半数。</p>\n</div>\n<div class=\"hint-container caution\">\n<p class=\"hint-container-title\">警告</p>\n<p>警告：“主从复制+哨兵节点”的无人值守模式提高了高可用性，降低的运维成本，但也无法避免极端数据丢失的情况，并且也无法解决内存容量不够的问题，主节点所在的机器能存储的最多数据只和本机内存条有关，和其他从节点所在的机器的内存条是不会叠加的，毕竟从节点只是复制了主节点的数据而已。</p>\n</div>\n<h4 id=\"_1-3-3-原理\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-3-3-原理\"><span>1.3.3.原理</span></a></h4>\n<p>还是根据我们的架构图，<span style=\"text-emphasis:filled red;\">阐述一下 <code v-pre>Raft</code> 选举算法原理，待补充...</span></p>\n<figure><img src=\"@source/4.业务服务/3.缓存服务/assets/image-20241205170206256.png\" alt=\"\" tabindex=\"0\" loading=\"lazy\"><figcaption></figcaption></figure>\n<h2 id=\"_2-redis-写分离架构-多分片架构\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-redis-写分离架构-多分片架构\"><span>2.Redis 写分离架构/多分片架构</span></a></h2>\n<h3 id=\"_2-1-架构原理\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-1-架构原理\"><span>2.1.架构原理</span></a></h3>\n<p>如果我们把上述的读分离结构看作一个小集群，那么多个读分离结构就是一个大集群。这样做就会有多个主节点可以被写入，假定数据是 <code v-pre>1 TB</code> 的话，有三个这样的小集群，就可以根据分片算法，每个小集群存储数据集的 <code v-pre>1/3 TB</code> 即可。这样做既解决了读压力过大的问题又解决了写存储不够的问题。</p>\n<figure><img src=\"@source/4.业务服务/3.缓存服务/assets/高可用集群.png\" alt=\"\" tabindex=\"0\" loading=\"lazy\"><figcaption></figcaption></figure>\n<p><code v-pre>Redis</code> 有什么必要需要这么做么？有，例如搜索引擎，这种需求对读写响应速度是强需求，对海量数据存储也是强需求。</p>\n<h3 id=\"_2-2-分片算法\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-2-分片算法\"><span>2.2.分片算法</span></a></h3>\n<p>一个小集群相当于一个分片，可是直接引入某种机制一定会造成某些问题，假设给定数据全集</p>\n<ul>\n<li>这些数据应该写入到哪一个分片上？</li>\n<li>这些数据应该读出到哪一个分片上？</li>\n</ul>\n<h4 id=\"_2-2-1-哈希求余算法\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-2-1-哈希求余算法\"><span>2.2.1.哈希求余算法</span></a></h4>\n<p>假设有 <code v-pre>N</code> 个分片，使用<code v-pre>[0, N-1]</code> 的顺序进行编号，针对某个键值对，根据键名通过算法（例如 <code v-pre>md5</code> 算法）得到哈希值结果，再使用 <code v-pre>%N</code> 来求余，最终余数就是分片编号，根据计算出来的编号存储键值对即可。而读取的问题也是，根据想要获取键值对的键名，依葫芦画瓢得到对应的分片编号后，最对应的分区中查找即可。</p>\n<p>这种方式简单高效，数据分配相对均匀（其实表现一般），但缺点就是拓展性差，一旦分区数量增加，就会导致原有的映射规则被破坏，一旦需要扩容就需要重新对所有的键值对进行分区，数据在节点之间多次流动以满足新的映射规则，这增加了维护成本。并且在业务中如果发生分区拓展，造成的数据流动会影响业务的正常读写，有可能导致严重的数据一致性问题。迁移的过程中一旦发生数据丢失，就会导致数据丢失的严重情况。</p>\n<h4 id=\"_2-2-2-一致性哈希算法\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-2-2-一致性哈希算法\"><span>2.2.2.一致性哈希算法</span></a></h4>\n<figure><img src=\"@source/4.业务服务/3.缓存服务/assets/yzxhxsf.png\" alt=\"\" tabindex=\"0\" loading=\"lazy\"><figcaption></figcaption></figure>\n<p>换一种思路，我们不再进行简单的求余，把 <span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">[</mo><mn>0</mn><mo separator=\"true\">,</mo><msup><mn>2</mn><mn>32</mn></msup><mo>−</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">[0, 2^{32}-1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0641em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">32</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span> 这个数据空间映射到一个圆环上，数据按照顺时针的方向增长，键值对的键名映射为哈希值 <code v-pre>H</code> 后，假设我们有 <code v-pre>N</code> 个分片，人为设置分布在圆环上的 <code v-pre>N</code> 个点的位置上（分片点）。然后根据 <code v-pre>H</code> 在圆环上的位置，顺时针往下寻找分片点，遇到第一个分片点就把键值对存储到对应的分片中。</p>\n<p>这种分配方式相当于把所有的哈希值的可能取值都提前做好了分区，如果需要扩容，就可以在某两个分片之间新建一个分片点，新的分片点将夺取前一个分片点的部分数据（分片点按照顺时针顺序分前后），这样每分一个分片就会增加存储量，减少前一个分片的压力。大大减少了扩容时数据搬运的规模，提高了扩容操作的效率，同时不影响业务读写。但缺点就是有可能发生数据分配不均匀，导致数据倾斜。</p>\n<p>为此 一致性哈希做了更多的优化，也就是 <code v-pre>虚拟节点</code>。 当节点较少的时候，为每个物理节点 <code v-pre>创建多个虚拟节点</code>，使所有的节点 <code v-pre>均匀的分布</code> 在 <code v-pre>Hash</code> 环上 ， 从而使数据<code v-pre>相对均衡</code>。当数据操作请求进来时 ， 如果指向了虚拟节点，就映射到实际的物理节点中。通过这样的方式，就可以保证数据的相对均衡。 当然，这种均衡还是相对的。</p>\n<p>另外，更加严重的问题是，如果某个节点集群发生雪崩（当大量读写涌入时，无论如何更替主从节点，最后整个节点集群还是会刮掉），但是后续的节点集群如果负荷能力甚至都比前面节点集群要小，就会导致后续的节点集群继续承接读写压力，过一段时间再次崩溃，一直往后就会造成雪崩的问题。这种问题轻微会导致数据倾斜、部分数据丢失，严重会导致整个 <code v-pre>Redis</code> 大集群（也就是圆环上所有的节点集群）失去响应。尽管有人提出了虚拟节点的方式来解决这个问题，但是也会增加系统的复杂度和维护难度。</p>\n<h4 id=\"_2-2-3-哈希槽算法\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-2-3-哈希槽算法\"><span>2.2.3.哈希槽算法</span></a></h4>\n<figure><img src=\"@source/4.业务服务/3.缓存服务/assets/img_v3_02ha_93cb8443-7827-4a14-88bf-aec811367b6g.jpg\" alt=\"\" tabindex=\"0\" loading=\"lazy\"><figcaption></figcaption></figure>\n<p>上述两种方式一是导致扩容成本高，二是导致分配不均匀，因此 <code v-pre>Redis cluster</code> 就引入了哈希槽算法（例如使用 <span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>h</mi><mi>a</mi><mi>s</mi><mi>h</mi><mi mathvariant=\"normal\">_</mi><mi>s</mi><mi>l</mi><mi>o</mi><mi>t</mi><mo>=</mo><mi>c</mi><mi>r</mi><mi>c</mi><mn>16</mn><mo stretchy=\"false\">(</mo><mi>k</mi><mi>e</mi><msub><mi>y</mi><mi>n</mi></msub><mi>a</mi><mi>m</mi><mi>e</mi><mo stretchy=\"false\">)</mo><mi mathvariant=\"normal\">%</mi><mn>16384</mn></mrow><annotation encoding=\"application/x-tex\">hash\\_slot = crc16(key_name) \\% 16384</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0044em;vertical-align:-0.31em;\"></span><span class=\"mord mathnormal\">ha</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">h</span><span class=\"mord\" style=\"margin-right:0.02778em;\">_</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">crc</span><span class=\"mord\">16</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mord mathnormal\">e</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.1514em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\">am</span><span class=\"mord mathnormal\">e</span><span class=\"mclose\">)</span><span class=\"mord\">%16384</span></span></span></span> 的到哈希值）。<code v-pre>Redis cluster</code>采用数据分片的哈希槽来进行数据存储和数据的读取，<code v-pre>Redis cluster</code> 一共有 <span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mn>14</mn></msup><mo>=</mo><mn>16384</mn></mrow><annotation encoding=\"application/x-tex\">2^{14}=16384</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">14</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">16384</span></span></span></span>个槽，所有的 <code v-pre>master</code> 节点都会有一个槽区，比如 <span v-pre class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">[</mo><mn>0</mn><mo separator=\"true\">,</mo><mn>1000</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">[0, 1000)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">[</span><span class=\"mord\">0</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\">1000</span><span class=\"mclose\">)</span></span></span></span>，槽数是可以迁移的。<code v-pre>master</code>节点的 <code v-pre>slave</code> 节点不分配槽，只拥有读权限。第一次新建 <code v-pre>Redis cluster</code> 时，<code v-pre>16384</code> 个槽是被 <code v-pre>master</code> 节点均匀分布的。</p>\n<p>哈希槽不是闭合的，并且一个键值对的键名计算得到哈希值后，是固定在某一个区域的，不会像一致性算法一样出现大面积雪崩的情况，哪怕是某一个节点集群故障了，也不会导致大量的读写压力转移到别的节点上，仍能保持业务一定的活性。</p>\n<p>并且扩容机制和一致性算法有些类似，但由于映射区域固定（一致性算法是遇到主节点才存储），也可以避免大面积的传输，是兼顾多方面的好手。</p>\n<h3 id=\"_2-3-搭建集群\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-3-搭建集群\"><span>2.3.搭建集群</span></a></h3>\n<p>前面的话太空，这里依旧是使用单机部署集群，真正意义上的跨主机集群，需要使用 <code v-pre>k8s</code> 来操作。在单机部署上，使用 <code v-pre>docker-compose</code> 模拟 <code v-pre>k8s</code> 工具，一个容器就是一台裸机。我们需要 <code v-pre>11</code> 个 <code v-pre>Redis</code> 节点，其中 <code v-pre>9</code> 个用来演示集群的搭建，<code v-pre>2</code> 个用作后续扩容缩容准备。</p>\n<h4 id=\"_2-3-1-设置目录\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-3-1-设置目录\"><span>2.3.1.设置目录</span></a></h4>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 设置目录</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cd</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/redis/</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> mkdir</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cluster</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cd</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cluster</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> touch</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker-compose.yml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> touch</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> generate.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> touch</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> dissipate.sh</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h4 id=\"_2-3-2-脚本文件\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-3-2-脚本文件\"><span>2.3.2.脚本文件</span></a></h4>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 脚本文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cd</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/redis/redis-cluster</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> vim</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> generate.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> generate.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># !/bin/bash</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 集群节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">for</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> port</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> $(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">seq</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 9</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">do</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    mkdir</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">${</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">port</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    touch</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">${</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">port</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    cat</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;&#x3C;</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> EOF</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> ></span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">${</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">port</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">/redis.conf</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 两个 EOF 之间的多行文本会被全部输入到 cat 中</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">port 6379 # 容器内的 PORT</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">bind 0.0.0.0 # 容器内的 IP</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">protected-mode no # 关闭保护模式(原本是会屏蔽掉一些不安全的访问的)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">appendonly yes # 开启 AOF 持久化</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster-enabled yes # 开启集群模式</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster-config-file nodes.conf # 指定集群配置文件的名称, 节点可以通过读取该文件来解集群的状态</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster-node-timeout 5000 # 设置集群节点超时时间</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster-announce-ip 172.30.0.10</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">${</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">port</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> # 向集群中的其他节点宣告自己的集群网络 IP</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster-announce-port 6379 # 向集群中的其他节点宣告自己的集群网络 PORT</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster-announce-bus-port 16379 # 集群内部节点之间的通信总线端口(集群管理的信息交互是通过这个端口进行的)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">EOF</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">done</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 备用节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">for</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> port</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> $(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">seq</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 10</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 11</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">do</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    mkdir</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">${</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">port</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    touch</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">${</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">port</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    cat</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;&#x3C;</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> EOF</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> ></span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">${</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">port</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">/redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">port 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">bind 0.0.0.0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">protected-mode no</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">appendonly yes</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster-enabled yes</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster-config-file nodes.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster-node-timeout 5000</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster-announce-ip 172.30.0.1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">${</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">port</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster-announce-port 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster-announce-bus-port 16379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">EOF</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">done</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> vim</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> dissipate.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> dissipate.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># !/bin/bash</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">rm</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -rf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\">*</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 去除上述注释后运行脚本</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> bash</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> generate.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ls</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">dissipate.sh</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  generate.sh</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  redis1</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  redis10</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  redis11</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  redis2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  redis3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  redis4</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  redis5</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  redis6</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  redis7</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  redis8</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  redis9</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> tree</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -L</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> dissipate.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> generate.sh</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">│</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis10</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">│</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis11</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">│</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">│</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis3</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">│</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis4</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">│</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis5</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">│</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis6</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">│</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis7</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">│</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis8</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">│</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   └──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">└──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis9</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    └──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis.conf</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">12</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> directories,</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 13</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> files</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看配置内容是否正确</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis1/redis.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">port</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bind</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0.0.0.0</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">protected-mode</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> no</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">appendonly</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> yes</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">cluster-enabled</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> yes</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">cluster-config-file</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes.conf</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">cluster-node-timeout</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 5000</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">cluster-announce-ip</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.101</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">cluster-announce-port</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">cluster-announce-bus-port</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 16379</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"hint-container caution\">\n<p class=\"hint-container-title\">警告</p>\n<p>警告：注意请删除上面脚本中的注释后再运行。</p>\n</div>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：常用目录配置结构就是，使用一个目录来标识一个 <code v-pre>Redis</code> 集群，然后目录中存放多个节点目录（可能是数据节点，也可能是哨兵节点），节点目录中存放配置文件 <code v-pre>redis.conf</code>，我们可以根据 <code v-pre>redis-server</code> 读取不同的配置文件，来决定一个节点是数据节点还是哨兵节点。</p>\n</div>\n<h4 id=\"_2-3-3-编排文件\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-3-3-编排文件\"><span>2.3.3.编排文件</span></a></h4>\n<div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>注意：之前我们使用的网络名称是根据父目录名称来得到的，但是其实我们也可以自己自定义一个，下面的配置文件就事先定义了一个集群网络。</p>\n</div>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 编排容器</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cd</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/redis/redis-cluster</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> vim</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker-compose.yml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker-compose.yml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">#  先自定义集群网络 redis-cluster-net</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">networks:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis-cluster-net:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    driver:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> bridge</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ipam:</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 配置子网 IP 地址分配规则</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      config:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> subnet:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.0/24</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 配置子网范围为 172.30.0.1 到 172.30.0.254</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">services:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis1:</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 服务名</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 指定镜像文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis1</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 生成的容器名</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 设置自动重启策略</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    deploy:</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 部署</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      resources:</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 资源</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        limits:</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 最大额度</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 512M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        reservations:</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 最小额度</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 256M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    volumes:</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 存储映射</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ./redis1:/usr/local/etc/redis</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 端口映射</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6371:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-server</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/usr/local/etc/redis/redis.conf</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">]</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 启动指令</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    networks:</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 网络配置</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      redis-cluster-net:</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 在开头定义的子网网络中</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        ipv4_address:</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.101</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 为容器指定静态的 ipv4 地址, 避免地址改动引起其他地方的修改</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis2:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    deploy:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      resources:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        limits:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 512M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        reservations:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 256M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    volumes:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ./redis2:/usr/local/etc/redis</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6372:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-server</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/usr/local/etc/redis/redis.conf</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    networks:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      redis-cluster-net:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        ipv4_address:</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.102</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis3:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis3</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    deploy:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      resources:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        limits:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 512M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        reservations:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 256M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    volumes:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ./redis3:/usr/local/etc/redis</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6373:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-server</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/usr/local/etc/redis/redis.conf</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    networks:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      redis-cluster-net:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        ipv4_address:</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.103</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis4:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis4</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    deploy:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      resources:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        limits:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 512M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        reservations:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 256M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    volumes:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ./redis4:/usr/local/etc/redis</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6374:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-server</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/usr/local/etc/redis/redis.conf</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    networks:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      redis-cluster-net:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        ipv4_address:</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.104</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis5:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis5</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    deploy:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      resources:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        limits:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 512M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        reservations:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 256M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    volumes:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ./redis5:/usr/local/etc/redis</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6375:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-server</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/usr/local/etc/redis/redis.conf</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    networks:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      redis-cluster-net:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        ipv4_address:</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.105</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis6:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis6</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    deploy:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      resources:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        limits:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 512M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        reservations:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 256M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    volumes:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ./redis6:/usr/local/etc/redis</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6376:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-server</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/usr/local/etc/redis/redis.conf</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    networks:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      redis-cluster-net:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        ipv4_address:</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.106</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis7:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis7</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    deploy:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      resources:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        limits:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 512M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        reservations:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 256M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    volumes:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ./redis7:/usr/local/etc/redis</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6377:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-server</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/usr/local/etc/redis/redis.conf</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    networks:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      redis-cluster-net:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        ipv4_address:</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.107</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis8:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis8</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    deploy:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      resources:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        limits:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 512M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        reservations:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 256M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    volumes:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ./redis8:/usr/local/etc/redis</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6378:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-server</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/usr/local/etc/redis/redis.conf</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    networks:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      redis-cluster-net:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        ipv4_address:</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.108</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis9:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis9</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    deploy:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      resources:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        limits:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 512M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        reservations:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 256M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    volumes:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ./redis9:/usr/local/etc/redis</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6379:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-server</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/usr/local/etc/redis/redis.conf</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    networks:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      redis-cluster-net:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        ipv4_address:</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.109</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis10:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis10</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    deploy:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      resources:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        limits:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 512M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        reservations:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 256M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    volumes:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ./redis10:/usr/local/etc/redis</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6380:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-server</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/usr/local/etc/redis/redis.conf</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    networks:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      redis-cluster-net:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        ipv4_address:</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.110</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  redis11:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    image:</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis:latest</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    container_name:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis11</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    restart:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> always</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    deploy:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      resources:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        limits:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 512M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        reservations:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">          memory:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 256M</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    volumes:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ./redis11:/usr/local/etc/redis</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    ports:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      -</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6381:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">    command</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">redis-server</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">/usr/local/etc/redis/redis.conf</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    networks:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">      redis-cluster-net:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">        ipv4_address:</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.111</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h4 id=\"_2-3-4-启动指令\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-3-4-启动指令\"><span>2.3.4.启动指令</span></a></h4>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 启动指令</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 启动编排中的容器</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker-compose</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> up</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -d</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 检查容器日志是否正常</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker-compose</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ls</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">NAME</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">                STATUS</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">              CONFIG</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> FILES</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">redis-cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">       running</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">11</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">         /etc/redis/redis-cluster/docker-compose.yml</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> container</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> logs</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:C</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 06</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 12:47:43.226</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # WARNING: Changing databases number from 16 to 1 since we are in cluster mode # 这个警告表示在 Redis 集群模式下, 数据库的数量已从 16 个减少为 1 个, 在默认的 Redis 单机模式下, Redis 允许使用 16 个数据库(编号从 0 到 15), 但是在集群模式下, Redis 只支持一个数据库(即 0 号数据库)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:C</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 06</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 12:47:43.226</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> oO0OoO0OoO0Oo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Redis</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> is</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> starting</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> oO0OoO0OoO0Oo</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:C</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 06</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 12:47:43.226</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Redis</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> version=7.4.1,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> bits=64,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> commit=00000000,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> modified=0,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> pid=1,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> just</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> started</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:C</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 06</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 12:47:43.226</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Configuration</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> loaded</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:M</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 06</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 12:47:43.226</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> monotonic</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> clock:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> POSIX</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> clock_gettime</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:M</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 06</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 12:47:43.227</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Running</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> mode=cluster,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> port=6379.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">1:M</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 06</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Dec</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2024</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 12:47:43.227</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> No</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> configuration</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> found,</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> I</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">m 9922b4fb888f86437a10912ed4505f86277b6c2e</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">1:M 06 Dec 2024 12:47:43.229 * Server initialized</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">1:M 06 Dec 2024 12:47:43.230 * Creating AOF base file appendonly.aof.1.base.rdb on server start</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">1:M 06 Dec 2024 12:47:43.233 * Creating AOF incr file appendonly.aof.1.incr.aof on server start</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">1:M 06 Dec 2024 12:47:43.233 * Ready to accept connections tcp</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"># 创建集群</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">$ redis-cli --cluster create \\ # 表示创建集群</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.30.0.101:6379 172.30.0.102:6379 172.30.0.103:6379 \\ # 加入集群的节点地址</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.30.0.104:6379 172.30.0.105:6379 172.30.0.106:6379 \\ # 加入集群的节点地址</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">172.30.0.107:6379 172.30.0.108:6379 172.30.0.109:6379 \\ # 加入集群的节点地址</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">--cluster-replicas 2 # 表示每一个节点需要两个从节点进行备份</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"># 完整指令为 redis-cli --cluster create 172.30.0.101:6379 172.30.0.102:6379 172.30.0.103:6379 172.30.0.104:6379 172.30.0.105:6379 172.30.0.106:6379 172.30.0.107:6379 172.30.0.108:6379 172.30.0.109:6379 --cluster-replicas 2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">>>> Performing hash slots allocation on 9 nodes...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Master[0] -> Slots 0 - 5460</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Master[1] -> Slots 5461 - 10922</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Master[2] -> Slots 10923 - 16383</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Adding replica 172.30.0.105:6379 to 172.30.0.101:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Adding replica 172.30.0.106:6379 to 172.30.0.101:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Adding replica 172.30.0.107:6379 to 172.30.0.102:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Adding replica 172.30.0.108:6379 to 172.30.0.102:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Adding replica 172.30.0.109:6379 to 172.30.0.103:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Adding replica 172.30.0.104:6379 to 172.30.0.103:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">M: 9922b4fb888f86437a10912ed4505f86277b6c2e 172.30.0.101:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   slots:[0-5460] (5461 slots) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">M: e42760e10502691aa9e9791a103ac77cb707c070 172.30.0.102:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   slots:[5461-10922] (5462 slots) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">M: 4544c27547b8392cbd5b2e7afcb80c0066d37e9f 172.30.0.103:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   slots:[10923-16383] (5461 slots) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">S: 12992b85a92de26dd849f1abf012ad674da733e4 172.30.0.104:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   replicates 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">S: bce31769a218d92d5a3735458e6e479759bdd500 172.30.0.105:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   replicates 9922b4fb888f86437a10912ed4505f86277b6c2e</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">S: 9cd6418590131bf0b6fa20c046ee9bbb06f56afe 172.30.0.106:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   replicates 9922b4fb888f86437a10912ed4505f86277b6c2e</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">S: 0903a2928d09168fa3cc2f4f74c96fe926eef8ef 172.30.0.107:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   replicates e42760e10502691aa9e9791a103ac77cb707c070</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">S: bc2a17498f1c88f2d827638625e3b998b5d36abf 172.30.0.108:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   replicates e42760e10502691aa9e9791a103ac77cb707c070</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">S: fc92b4b941bc55edc638b3ed5570c77649f11124 172.30.0.109:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   replicates 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Can I set the above configuration? (type </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">yes</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to accept): yes # 这里需要输入 yes 后回车</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">>>> Nodes configuration updated</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">>>> Assign a different config epoch to each node</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">>>> Sending CLUSTER MEET messages to join the cluster</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Waiting for the cluster to join</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">>>> Performing Cluster Check (using node 172.30.0.101:6379)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">M: 9922b4fb888f86437a10912ed4505f86277b6c2e 172.30.0.101:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   slots:[0-5460] (5461 slots) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   2 additional replica(s)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">S: 0903a2928d09168fa3cc2f4f74c96fe926eef8ef 172.30.0.107:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   slots: (0 slots) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   replicates e42760e10502691aa9e9791a103ac77cb707c070</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">M: e42760e10502691aa9e9791a103ac77cb707c070 172.30.0.102:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   slots:[5461-10922] (5462 slots) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   2 additional replica(s)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">S: bc2a17498f1c88f2d827638625e3b998b5d36abf 172.30.0.108:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   slots: (0 slots) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   replicates e42760e10502691aa9e9791a103ac77cb707c070</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">S: 9cd6418590131bf0b6fa20c046ee9bbb06f56afe 172.30.0.106:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   slots: (0 slots) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   replicates 9922b4fb888f86437a10912ed4505f86277b6c2e</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">S: 12992b85a92de26dd849f1abf012ad674da733e4 172.30.0.104:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   slots: (0 slots) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   replicates 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">S: bce31769a218d92d5a3735458e6e479759bdd500 172.30.0.105:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   slots: (0 slots) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   replicates 9922b4fb888f86437a10912ed4505f86277b6c2e</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">M: 4544c27547b8392cbd5b2e7afcb80c0066d37e9f 172.30.0.103:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   slots:[10923-16383] (5461 slots) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   2 additional replica(s)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">S: fc92b4b941bc55edc638b3ed5570c77649f11124 172.30.0.109:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   slots: (0 slots) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">   replicates 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">[OK] All nodes agree about slots configuration.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">>>> Check for open slots...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">>>> Check slots coverage...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">[OK] All 16384 slots covered.</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"># 查看正在运行的容器</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">$ docker container ls</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">CONTAINER ID   IMAGE          COMMAND                   CREATED          STATUS          PORTS                                         NAMES</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">25ec15dde362   redis:latest   \"docker-entrypoint.s…\"   23 minutes ago   Up 23 minutes   0.0.0.0:6377->6379/tcp, [::]:6377->6379/tcp   redis7</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">77414c90b6ea   redis:latest   \"docker-entrypoint.s…\"   23 minutes ago   Up 23 minutes   0.0.0.0:6380->6379/tcp, [::]:6380->6379/tcp   redis10</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">41dacddb4ac3   redis:latest   \"docker-entrypoint.s…\"   23 minutes ago   Up 23 minutes   0.0.0.0:6371->6379/tcp, [::]:6371->6379/tcp   redis1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">573c13c744ca   redis:latest   \"docker-entrypoint.s…\"   23 minutes ago   Up 23 minutes   0.0.0.0:6373->6379/tcp, [::]:6373->6379/tcp   redis3</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">6aa2609836c7   redis:latest   \"docker-entrypoint.s…\"   23 minutes ago   Up 23 minutes   0.0.0.0:6379->6379/tcp, :::6379->6379/tcp     redis9</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">bcbd5203f15c   redis:latest   \"docker-entrypoint.s…\"   23 minutes ago   Up 23 minutes   0.0.0.0:6381->6379/tcp, [::]:6381->6379/tcp   redis11</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">67e1aeef7b1d   redis:latest   \"docker-entrypoint.s…\"   23 minutes ago   Up 23 minutes   0.0.0.0:6378->6379/tcp, [::]:6378->6379/tcp   redis8</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">9fa7e3fb21bc   redis:latest   \"docker-entrypoint.s…\"   23 minutes ago   Up 23 minutes   0.0.0.0:6374->6379/tcp, [::]:6374->6379/tcp   redis4</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">ec8d07d38191   redis:latest   \"docker-entrypoint.s…\"   23 minutes ago   Up 23 minutes   0.0.0.0:6376->6379/tcp, [::]:6376->6379/tcp   redis6</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">5031b98a28d5   redis:latest   \"docker-entrypoint.s…\"   23 minutes ago   Up 23 minutes   0.0.0.0:6375->6379/tcp, [::]:6375->6379/tcp   redis5</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">1acb75345d10   redis:latest   \"docker-entrypoint.s…\"   23 minutes ago   Up 23 minutes   0.0.0.0:6372->6379/tcp, [::]:6372->6379/tcp   redis2</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：创建集群这一步完全可以使用</p>\n</div>\n<p>从上面的输出来看，<code v-pre>redis-cli</code> 的 <code v-pre>--cluster create</code> 命令成功地将 <code v-pre>9</code> 个 <code v-pre>Redis</code> 节点配置为一个 <code v-pre>Redis</code> 集群，并且已经自动完成了分配槽位、添加副本、以及节点之间的通信（使用的正式哈希槽算法）。回显显示的信息如下：</p>\n<ul>\n<li><strong>槽位分配</strong>：集群被划分为 <code v-pre>16384</code> 个槽位，三个主节点分别负责分配槽位：\n<ul>\n<li><code v-pre>172.30.0.101:6379</code>：负责 <code v-pre>0-5460</code> 号槽位</li>\n<li><code v-pre>172.30.0.102:6379</code>：负责 <code v-pre>5461-10922</code> 号槽位</li>\n<li><code v-pre>172.30.0.103:6379</code>：负责 <code v-pre>10923-16383</code> 号槽位</li>\n</ul>\n</li>\n<li><strong>副本添加</strong>：每个主节点都有两个副本节点：\n<ul>\n<li><code v-pre>172.30.0.101:6379</code> 有两个副本：<code v-pre>172.30.0.105:6379</code> 和 <code v-pre>172.30.0.106:6379</code></li>\n<li><code v-pre>172.30.0.102:6379</code> 有两个副本：<code v-pre>172.30.0.107:6379</code> 和 <code v-pre>172.30.0.108:6379</code></li>\n<li><code v-pre>172.30.0.103:6379</code> 有两个副本：<code v-pre>172.30.0.109:6379</code> 和 <code v-pre>172.30.0.104:6379</code></li>\n</ul>\n</li>\n<li><strong>节点信息</strong>：每个主节点和副本的状态都列出，并确认了副本正确地复制了主节点的数据。</li>\n<li><strong>集群检查</strong>：\n<ul>\n<li>所有 <code v-pre>16384</code> 个槽位都已经被覆盖和分配。</li>\n<li>所有节点和槽位配置一致，没有发现未分配的槽位。</li>\n</ul>\n</li>\n</ul>\n<p>此时,使用客户端连上集群中的任何一个节点，都相当于连上了整个集群。那么由于有分片的的存在，我们访问的主节点不一定就是数据所在的节点怎么办呢？客户端后面要加上 <code v-pre>-c</code> 选项，否则 <code v-pre>key</code> 如果没有落到当前节点上，是不能进行操作的，<code v-pre>-c</code> 会自动把请求重定向到对应节点。</p>\n<p>不过我们不急着操作先，先来使用 <code v-pre> cluster nodes</code> 来查看整个集群的信息，然后再来使用集群。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 使用集群</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.101</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -c</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 注意携带 -c 选项</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">0903a2928d09168fa3cc2f4f74c96fe926eef8ef</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.107:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733490348922</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> myself,master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 0-5460</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733490348000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5461-10922</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bc2a17498f1c88f2d827638625e3b998b5d36abf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.108:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733490347917</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9cd6418590131bf0b6fa20c046ee9bbb06f56afe</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.106:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733490349525</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">12992b85a92de26dd849f1abf012ad674da733e4</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.104:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733490348419</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bce31769a218d92d5a3735458e6e479759bdd500</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.105:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733490349023</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.103:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733490348520</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 10923-16383</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">fc92b4b941bc55edc638b3ed5570c77649f11124</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.109:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733490348520</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">set</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> akey</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">666</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">-</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Redirected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slot</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [8093] located at 172.30.0.102:6379 </span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 这句话表示您发送的请求被重定向到一个位于 172.30.0.102:6379 的主节点，该节点负责处理槽位编号为 8093 的数据。</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">OK</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.102:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> akey</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"666\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.102:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 尝试不带 -c 选项直接进行访问</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.101</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> akey</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">error</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> MOVED</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 8093</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 果然访问不到了...并且提示到另外一个主节点进行寻找</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 尝试不带 -c 选项直接进行访问</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.103</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.103:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> akey</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">error</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> MOVED</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 8093</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 果然还是不行</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.103:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 尝试不带 -c 选项直接进行访问</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.102</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.102:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> akey</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"666\"</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 说明数据确实进行了分片</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.102:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 使用从节点访问试一试</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.107</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.107:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> akey</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">error</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> MOVED</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 8093</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 欸? 这是怎么回事呢? 难道从节点没有把主节点数据拷贝过来?</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.107:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">readonly</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 打开只读试试</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">OK</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.107:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">get</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> akey</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">\"666\"</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 欸果然可以了</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.107:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 不过每次退出都需要重新执行 readonly, 除非我们修改所有节点的 redis.conf 配置文件中的配置选项为 \"slave-read-only no\", 这种设置不会对主节点产生影响(待补充...)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"hint-container caution\">\n<p class=\"hint-container-title\">警告</p>\n<p>警告：<code v-pre>Redis</code> 默认从节点只是拿来数据备份和进行故障转移的，默热不推荐我们使用从节点进行数据读取，因为复制带来的延迟在集群状态下可能会很高，导致读取到旧数据（这个备份过此是异步的）。在有集群的情况下，我们可以不用再向之前的主从架构一样，将主节点用来写，从节点都用来读。而是主节点都用来读写，从节点用来做数据备份和故障转移即可。因此与其说分片把写分离，不如说分片让读写都分离了。</p>\n<p>因此在业务架构中，最好一个项目使用一个 <code v-pre>Redis</code> 集群，然后如果该项目本身就是分布式的（例如后端是分布式的，则可以让后端分别寻找对应的主节点进行读取，这样读写压力会被不同机器分摊）。</p>\n<ul>\n<li>写入被不同机器分摊</li>\n<li>读出被不同机器分摊</li>\n<li>数据被负载均衡存入</li>\n<li>数据被主从结构备份</li>\n<li>避免读从节点旧数据</li>\n</ul>\n</div>\n<div class=\"hint-container caution\">\n<p class=\"hint-container-title\">警告</p>\n<p>警告：在集群状态下，会不会出现，写入过程中（还没写入完）进行读取导致失败的情况呢？不可能，为什么？因为一个 <code v-pre>Redis</code>节点是单线程的，在集群中，写入和读出一定是同一个槽，而管理这个槽的 <code v-pre>Redis</code> 分片一定会单线程执行写入和读取这两个命令，如果很确定写入比读出早，那么读出是百分百有数据，不会有意外情况。</p>\n</div>\n<h3 id=\"_2-4-故障转移\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-4-故障转移\"><span>2.4.故障转移</span></a></h3>\n<p>手动停止一个主节点，看看会发生什么现象。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 故障转移</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 查看节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> $</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.102</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -c</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.102:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">fc92b4b941bc55edc638b3ed5570c77649f11124</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.109:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492320000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bce31769a218d92d5a3735458e6e479759bdd500</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.105:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492319548</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.103:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492320553</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 10923-16383</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492319548</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 0-5460</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bc2a17498f1c88f2d827638625e3b998b5d36abf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.108:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492319950</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> myself,master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5461-10922</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">12992b85a92de26dd849f1abf012ad674da733e4</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.104:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492319000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">0903a2928d09168fa3cc2f4f74c96fe926eef8ef</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.107:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492320000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9cd6418590131bf0b6fa20c046ee9bbb06f56afe</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.106:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492319000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.102:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 手动停止</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> stop</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">redis1</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 观察节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> $</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.102</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -c</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.102:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">fc92b4b941bc55edc638b3ed5570c77649f11124</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.109:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492469571</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bce31769a218d92d5a3735458e6e479759bdd500</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.105:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492469000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 10</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 0-5460</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 原本是从节点的 172.30.0.105:6379 变为了主节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.103:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492468566</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 10923-16383</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master,fail</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492324572</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492322000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 可以看到这一个主节点爆 fail 以及发生故障</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bc2a17498f1c88f2d827638625e3b998b5d36abf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.108:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492469000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> myself,master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5461-10922</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">12992b85a92de26dd849f1abf012ad674da733e4</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.104:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492469571</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">0903a2928d09168fa3cc2f4f74c96fe926eef8ef</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.107:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492469000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9cd6418590131bf0b6fa20c046ee9bbb06f56afe</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.106:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> bce31769a218d92d5a3735458e6e479759bdd500</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492470073</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 10</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.102:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 手动恢复</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> docker</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> start</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis1</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">redis1</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 观察节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> $</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.102</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -c</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.102:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">fc92b4b941bc55edc638b3ed5570c77649f11124</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.109:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492665569</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bce31769a218d92d5a3735458e6e479759bdd500</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.105:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492665368</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 10</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 0-5460</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 这个 172.30.0.105:6379 节点依旧是主节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.103:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492666000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 10923-16383</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> bce31769a218d92d5a3735458e6e479759bdd500</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492666573</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 10</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 172.30.0.101:6379 从原本的主节点变为了从节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bc2a17498f1c88f2d827638625e3b998b5d36abf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.108:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492666372</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> myself,master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5461-10922</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">12992b85a92de26dd849f1abf012ad674da733e4</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.104:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492666000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">0903a2928d09168fa3cc2f4f74c96fe926eef8ef</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.107:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492664866</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9cd6418590131bf0b6fa20c046ee9bbb06f56afe</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.106:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> bce31769a218d92d5a3735458e6e479759bdd500</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492665000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 10</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.102:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：另外，可以使用 <code v-pre>cluster failover</code> 进行集群恢复，例如上述的主节点因为故障变为从节点，可以使用这个指令继续恢复回主节点的位置，不过需要恢复谁就需要登陆谁进行恢复。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 恢复集群</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> failover</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">OK</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> myself,master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 11</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 0-5460</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">12992b85a92de26dd849f1abf012ad674da733e4</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.104:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492921973</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bc2a17498f1c88f2d827638625e3b998b5d36abf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.108:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492920000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bce31769a218d92d5a3735458e6e479759bdd500</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.105:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492919563</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 11</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492921070</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5461-10922</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9cd6418590131bf0b6fa20c046ee9bbb06f56afe</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.106:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492921000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 11</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">0903a2928d09168fa3cc2f4f74c96fe926eef8ef</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.107:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492920000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">fc92b4b941bc55edc638b3ed5570c77649f11124</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.109:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492920568</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.103:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733492920969</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 10923-16383</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></div>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：故障判定处理流程。集群中的所有节点, 都会周期性的使用心跳包进行通信。</p>\n<ol>\n<li>节点 <code v-pre>A</code> 给 节点 <code v-pre>B</code> 发送 <code v-pre>ping</code> 包，<code v-pre>B</code> 就会给 <code v-pre>A</code> 返回一个 <code v-pre>pong</code> 包。<code v-pre>ping</code> 和 <code v-pre>pong</code> 除了 <code v-pre>message type</code> 属性之外，其他部分都是一样的，这里包含了集群的配置信息（该节点的 <code v-pre>id</code>，该节点从属于哪个分片，是主节点还是从节点，从属于谁，持有哪些 <code v-pre>slots</code> 的位图...）</li>\n<li>每个节点每秒钟，都会给一些随机的节点发起 <code v-pre>ping</code> 包，而不是全发一遍。这样设定是为了避免在节点很多的时候，心跳包也非常多（比如有 <code v-pre>9</code> 个节点，如果全发，就是 <code v-pre>9 * 8 == 72</code> 组心跳了，而且这是按照 <code v-pre>N^2</code> 这样的级别增长的）</li>\n<li>当节点 <code v-pre>A</code> 给节点 <code v-pre>B</code> 发起 <code v-pre>ping</code> 包，<code v-pre>B</code> 不能如期回应的时候，此时 <code v-pre>A</code> 就会尝试重置和 <code v-pre>B</code> 的 <code v-pre>tcp</code> 连接，看能否连接成功。如果仍然连接失败，<code v-pre>A</code> 就会把 <code v-pre>B</code> 设为 <code v-pre>PFAIL</code> 状态（相当于主观下线）</li>\n<li><code v-pre>A</code> 判定 <code v-pre>B</code> 为 <code v-pre>PFAIL</code> 之后，会通过 <code v-pre>redis</code> 内置的 <code v-pre>Gossip</code> 协议，和其他节点进行沟通，向其他节点确认 <code v-pre>B</code> 的状态（每个节点都会维护一个自己的“下线列表”，由于视角不同，每个节点的下线列表也不一定相同）</li>\n<li>此时 <code v-pre>A</code> 发现其他很多节点，也认为 <code v-pre>B</code> 为 <code v-pre>PFAIL</code>，并且数目超过总集群个数的一半，那么 <code v-pre>A</code> 就会把 <code v-pre>B</code> 标记成 <code v-pre>FAIL</code>（相当于客观下线），并且把这个消息同步给其他节点（其他节点收到之后，也会把 <code v-pre>B</code> 标记成 <code v-pre>FAIL</code>)</li>\n<li>至此 <code v-pre>B</code> 就彻底被判定为故障节点了</li>\n</ol>\n<p>另外，在 <code v-pre>Redis</code> 集群中，出现集群宕机（比主节点故障更加严重的情况）的情况通常是由以下三种情况引起的：</p>\n<ul>\n<li><strong>某个分片的所有主节点和从节点都挂了</strong>：如果一个分片的主节点和从节点都宕机，<code v-pre>Redis</code> 集群将无法处理该分片的数据请求，导致整个集群处于 <code v-pre>fail</code> 状态。</li>\n<li><strong>某个分片的主节点挂了，但没有从节点</strong>：如果某个分片的主节点宕机，而该分片没有从节点，<code v-pre>Redis</code> 集群无法进行故障转移，导致该分片无法正常服务，进而可能导致集群 <code v-pre>fail</code>。</li>\n<li><strong>超过半数的主节点挂了</strong>：如果集群中的主节点宕机超过一半，<code v-pre>Redis</code> 集群无法保证数据的完整性和可用性，这时集群会进入 <code v-pre>fail</code> 状态。</li>\n</ul>\n</div>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：故障转移处理流程。</p>\n<ol>\n<li>故障判断：\n<ul>\n<li><strong>如果故障节点是从节点</strong>：无需进行故障迁移，因为从节点只是备份数据，不会影响集群的整体功能。</li>\n<li><strong>如果故障节点是主节点</strong>：需要进行故障迁移，选举从节点中的一个作为新的主节点。</li>\n</ul>\n</li>\n<li>从节点资格判定：从节点首先要判断自己是否具备成为主节点的资格。如果从节点和主节点的通信已经中断太久，导致数据差异过大，超过了预定的阈值，则该从节点将失去竞选资格。</li>\n<li>休眠时间：有资格的从节点（如 <code v-pre>C</code> 和 <code v-pre>D</code>）会先进行短暂的休眠，休眠时间为“基础时间<code v-pre>500ms</code> + 随机时间：<code v-pre>[0, 500ms]</code> + 排名时间（根据节点的排名，越靠前的节点休眠时间越短，排名越靠后的节点休眠时间越长，<code v-pre>排名 * 1000ms</code>）”</li>\n<li>投票阶段：如 <code v-pre>C</code> 休眠结束后，<code v-pre>C</code> 会向集群中的所有节点发起拉票操作，并且只有主节点有投票资格。每个主节点只能投一票，投票给其认为最合适的从节点。<code v-pre>C</code> 需要获得集群中超过一半的主节点的支持票，才能晋升为主节点。</li>\n<li>提升为主节点：一旦 <code v-pre>C</code> 获得超过一半的主节点投票，它就会被晋升为主节点。<code v-pre>C</code> 会执行 <code v-pre>slaveof no one</code> 来成为独立的主节点，同时让 <code v-pre>D</code> 成为 <code v-pre>C</code> 的从节点（<code v-pre>slaveof C</code>）。</li>\n<li>更新集群信息：<code v-pre>C</code> 会将自己晋升为主节点的消息同步给其他节点，其他节点会更新自己的集群结构信息，确保集群中各节点的信息一致。</li>\n</ol>\n<p>这个过程更加细致，也就是之前提到过的著名选举算法，<code v-pre>Raft</code> 算法。</p>\n</div>\n<h3 id=\"_2-5-扩容集群\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-5-扩容集群\"><span>2.5.扩容集群</span></a></h3>\n<p>接下来需要把 <code v-pre>redis10</code> 和 <code v-pre>redis11</code> 也加入到集群中，应该怎么做呢？很简单，我们之前使用 <code v-pre>redis-cli --cluster create &lt;节点列表&gt;</code> 创建集群，就可以使用 <code v-pre>redis-cli --cluster add-node &lt;单个节点&gt; &lt;集群中任意节点地址&gt;</code> 来添加新的节点（默认）。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 扩容集群</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> --cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> add-node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.110:6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Adding</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.110:6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Performing</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Check</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (using </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:[0-5460]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (5461 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 12992b85a92de26dd849f1abf012ad674da733e4</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.104:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> bc2a17498f1c88f2d827638625e3b998b5d36abf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.108:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> bce31769a218d92d5a3735458e6e479759bdd500</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.105:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:[5461-10922]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (5462 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9cd6418590131bf0b6fa20c046ee9bbb06f56afe</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.106:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 0903a2928d09168fa3cc2f4f74c96fe926eef8ef</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.107:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> fc92b4b941bc55edc638b3ed5570c77649f11124</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.109:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.103:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:[10923-16383]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (5461 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">OK</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> All nodes agree about slots configuration.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Check</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> for</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> open</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slots...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Check</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slots</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> coverage...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">OK</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> All 16384 slots covered.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Getting</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> functions</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> from</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cluster</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Send</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> FUNCTION</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> LIST</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.110:6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> verify</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> there</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> is</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> no</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> functions</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> in</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> it</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Send</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> FUNCTION</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> RESTORE</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.110:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Send</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> CLUSTER</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> MEET</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.110:6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> make</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> it</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> join</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cluster.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">OK</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> New node added correctly.</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 然后进入集群查看主从关系</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> $</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.101</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -c</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">5863ebe5623e98c9f405b9da099d0e75990aebce</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.110:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733494939225</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 可以看到 172.30.0.110:6379 成为了集群中新的主节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> myself,master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 11</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 0-5460</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">12992b85a92de26dd849f1abf012ad674da733e4</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.104:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733494938000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bc2a17498f1c88f2d827638625e3b998b5d36abf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.108:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733494939023</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bce31769a218d92d5a3735458e6e479759bdd500</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.105:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733494938522</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 11</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733494938522</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5461-10922</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9cd6418590131bf0b6fa20c046ee9bbb06f56afe</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.106:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733494938000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 11</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">0903a2928d09168fa3cc2f4f74c96fe926eef8ef</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.107:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733494939000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">fc92b4b941bc55edc638b3ed5570c77649f11124</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.109:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733494938722</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.103:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733494939727</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 10923-16383</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 不过虽然节点已经成功加入集群, 但是新的节点并不会自动接管已有的槽(slots), 除非明确执行了槽迁移操作</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 进行槽迁移操作</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> --cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> reshard</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 只需要任意集群中的节点即可完成槽迁移操作</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Performing</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Check</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (using </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) </span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 注意下面生成的信息, 里面的节点携带有 id 信息的存在, 后面用得到</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:[0-5460]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (5461 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5863ebe5623e98c9f405b9da099d0e75990aebce</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.110:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 12992b85a92de26dd849f1abf012ad674da733e4</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.104:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> bc2a17498f1c88f2d827638625e3b998b5d36abf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.108:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> bce31769a218d92d5a3735458e6e479759bdd500</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.105:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:[5461-10922]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (5462 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9cd6418590131bf0b6fa20c046ee9bbb06f56afe</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.106:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 0903a2928d09168fa3cc2f4f74c96fe926eef8ef</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.107:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> fc92b4b941bc55edc638b3ed5570c77649f11124</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.109:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.103:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:[10923-16383]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (5461 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">OK</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> All nodes agree about slots configuration.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Check</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> for</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> open</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slots...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Check</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slots</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> coverage...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">OK</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> All 16384 slots covered.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">How</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> many</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slots</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> do</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> you</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> want</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> move</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (from </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 16384</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">)</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">?</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> 4096 </span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 填入需要新加入集群主节点分配到的槽个数</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 其实这里的目标是让所有主节点平均分配 slots, 计算方式如下：</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 总 slots 数量 = 16384</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 当前主节点数量 = 4</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 每个节点理想的 slots 数量 = 16384 / 4 = 4096</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">What</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> is</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> receiving</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ID?</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5863ebe5623e98c9f405b9da099d0e75990aebce</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 填入新加入节点的 ID, 注意不是 IP:PORT</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Please</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> enter</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> all</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> source</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> IDs.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  Type</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">all</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> use</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> all</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> as</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> source</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> for</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> hash</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slots.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  Type</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">done</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> once</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> you</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> entered</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> all</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> source</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> IDs.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Source</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> #1: all # 填入某个节点的 ID, 就会从某个节点迁移槽给新增加的主节点, 如果填入 all 就把所有现有主节点的槽都均衡迁移到新增加的主节点中</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Ready</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> move</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 4096</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slots.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  Source</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">       slots:[0-5460]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (5461 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">       2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">       slots:[5461-10922]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (5462 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">       2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.103:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">       slots:[10923-16383]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (5461 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">       2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  Destination</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5863ebe5623e98c9f405b9da099d0e75990aebce</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.110:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">       slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  Resharding</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> plan:</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">    Moving</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slot</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 5461</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> from</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># (省略)...</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：假设您的 <code v-pre>Redis</code> 集群中有 <code v-pre>3</code> 个主节点，它们的 <code v-pre>slots</code> 分配如下：</p>\n<ul>\n<li><strong>节点 A</strong>：<code v-pre>0-5460</code> (共 <code v-pre>5461</code> 个 <code v-pre>slots</code>)</li>\n<li><strong>节点 B</strong>：<code v-pre>5461-10922</code> (共 <code v-pre>5462</code> 个 <code v-pre>slots</code>)</li>\n<li><strong>节点 C</strong>：<code v-pre>10923-16383</code> (共 <code v-pre>5461</code> 个 <code v-pre>slots</code>)</li>\n</ul>\n<p>新增一个节点 <code v-pre>D</code>，您想迁移 <code v-pre>4096</code> 个 <code v-pre>slots</code> 给它，并选择 <code v-pre>all</code>，那么<code v-pre>Redis</code> 会按比例从节点 <code v-pre>A、B、C</code> 中迁移 <code v-pre>slots</code>：</p>\n<ul>\n<li><strong>节点 A</strong>：迁移约 <code v-pre>1365</code> 个 <code v-pre>slots</code></li>\n<li><strong>节点 B</strong>：迁移约 <code v-pre>1366</code> 个 <code v-pre>slots</code></li>\n<li><strong>节点 C</strong>：迁移约 <code v-pre>1365</code> 个 <code v-pre>slots</code></li>\n</ul>\n<p>最终，节点 <code v-pre>A、B、C</code> 的 <code v-pre>slots</code> 数量会减少，负载下降，新节点 <code v-pre>D</code> 接管迁移过来的 <code v-pre>4096</code> 个 <code v-pre>slots</code>，开始分担存储和请求。而如果不选择 <code v-pre>all</code>，明确指定了某个主节点（如节点 <code v-pre>A</code>），那么 <code v-pre>Redis</code> 只会从该节点迁移 <code v-pre>slots</code> 到新节点 <code v-pre>D</code>，这样会导致：</p>\n<ul>\n<li>节点 <code v-pre>A</code> 的负载迅速减轻，但其他节点的负载保持不变</li>\n<li>整体负载分布可能变得不均匀，不利于集群性能</li>\n</ul>\n</div>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：迁移槽管理的过程中也伴随着键值对的迁移，之后就会进行集群的 <code v-pre>key</code> 搬运工作，这个过程涉及到数据搬运，可能需要消耗一定的时间，并且期间不影响新键值对的写入和读出；也不影响不需要迁移的键值对进行正常的读写；但需要迁移的键值对会发生短暂的错误，只有等待一段时间才会恢复（不过我还没有测试过，待补充...）。</p>\n</div>\n<p>加入新的主节点时，扩容的目标已经初步达成，但为了保证集群高可用性，还需要给这个新的主节点添加从节点，保证该主节点宕机之后，有从节点可以进行故障转移。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 提高可用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 添加从节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> --cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> add-node</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.111:6379</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\ </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">#</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 要添加的节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> 172.30.0.101:6379</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\ </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">#</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 集群中存在的任意节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> --cluster-slave</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\ </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">#</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 表示将新节点加入为从节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">--cluster-master-id</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5863ebe5623e98c9f405b9da099d0e75990aebce</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 指定该从节点的主节点的节点 ID</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 完整指令为 redis-cli --cluster add-node 172.30.0.111:6379 172.30.0.101:6379 --cluster-slave --cluster-master-id 5863ebe5623e98c9f405b9da099d0e75990aebce</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Adding</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.111:6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Performing</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Check</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (using </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:[1365-5460]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (4096 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5863ebe5623e98c9f405b9da099d0e75990aebce</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.110:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:[0-1364],[5461-6826],[10923-12287]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (4096 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   1</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 12992b85a92de26dd849f1abf012ad674da733e4</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.104:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> bc2a17498f1c88f2d827638625e3b998b5d36abf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.108:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> bce31769a218d92d5a3735458e6e479759bdd500</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.105:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:[6827-10922]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (4096 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   1</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9cd6418590131bf0b6fa20c046ee9bbb06f56afe</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.106:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 0903a2928d09168fa3cc2f4f74c96fe926eef8ef</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.107:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5863ebe5623e98c9f405b9da099d0e75990aebce</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> fc92b4b941bc55edc638b3ed5570c77649f11124</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.109:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.103:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:[12288-16383]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (4096 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">OK</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> All nodes agree about slots configuration.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Check</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> for</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> open</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slots...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Check</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slots</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> coverage...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">OK</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> All 16384 slots covered.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Send</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> CLUSTER</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> MEET</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.111:6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> make</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> it</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> join</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cluster.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Waiting</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> for</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> join</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Configure</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> as</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> of</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.110:6379.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">OK</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> New node added correctly.</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看新的主从结构</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.101</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -c</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">5863ebe5623e98c9f405b9da099d0e75990aebce</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.110:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733501266902</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 12</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 0-1364</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5461-6826</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 10923-12287</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> myself,master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 11</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 1365-5460</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">12992b85a92de26dd849f1abf012ad674da733e4</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.104:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733501265898</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bc2a17498f1c88f2d827638625e3b998b5d36abf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.108:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733501265000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bce31769a218d92d5a3735458e6e479759bdd500</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.105:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733501265597</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 11</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733501266501</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6827-10922</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9cd6418590131bf0b6fa20c046ee9bbb06f56afe</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.106:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733501266501</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 11</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">0903a2928d09168fa3cc2f4f74c96fe926eef8ef</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.107:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5863ebe5623e98c9f405b9da099d0e75990aebce</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733501266501</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 12</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">fc92b4b941bc55edc638b3ed5570c77649f11124</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.109:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733501266000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">8cbe43de958f2564d95d0d5da51cab654b861036</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.111:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5863ebe5623e98c9f405b9da099d0e75990aebce</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733501265000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 12</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 果然成为了  172.30.0.110:6379 的从节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.103:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733501265597</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 12288-16383</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3 id=\"_2-6-缩容集群\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-6-缩容集群\"><span>2.6.缩容集群</span></a></h3>\n<p>缩容的操作一般比较少见，但是也不是没有，简单演示一下您就明白怎么操作了，假设我们需要把刚刚加入的主从节点剔除（也就是 <code v-pre>172.30.0.110:6379</code> 和 <code v-pre> 172.30.0.111:6379</code>，节点 <code v-pre>ID</code> 分别为 <code v-pre>5863ebe5623e98c9f405b9da099d0e75990aebce</code> 和 <code v-pre>8cbe43de958f2564d95d0d5da51cab654b861036</code>）。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 缩容集群</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 删除从节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> $</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">--cluster</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\ </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">#</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 表示集群操作</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">del-node</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\ </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">#</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 表示要删除节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.110:6379</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> \\ </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">#</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 集群中任意一个节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">8cbe43de958f2564d95d0d5da51cab654b861036</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 要删除的节点 ID</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 完整指令为 redis-cli --cluster del-node 172.30.0.110:6379 8cbe43de958f2564d95d0d5da51cab654b861036</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Removing</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 8cbe43de958f2564d95d0d5da51cab654b861036</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> from</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.110:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Sending</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> CLUSTER</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> FORGET</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> messages</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cluster...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Sending</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> CLUSTER</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> RESET</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> SOFT</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> deleted</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node.</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 删除主节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 重新分配槽, 把 172.30.0.110:6379 这个待删除的主节点去除前, 需要把其占有的槽均分给其他主节点(大概均分即可, 从需要移除的节点中迁移 1365、1365、1366 到三个主节点)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> --cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> reshard</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 把要剔除的  172.30.0.110:6379 中的 1365 个槽迁移给 172.30.0.101:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Performing</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> Check</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (using </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:[1365-5460]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (4096 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5863ebe5623e98c9f405b9da099d0e75990aebce</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.110:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:[0-1364],[5461-6826],[10923-12287]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (4096 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   1</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 12992b85a92de26dd849f1abf012ad674da733e4</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.104:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> bc2a17498f1c88f2d827638625e3b998b5d36abf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.108:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> bce31769a218d92d5a3735458e6e479759bdd500</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.105:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:[6827-10922]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (4096 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   1</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9cd6418590131bf0b6fa20c046ee9bbb06f56afe</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.106:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 0903a2928d09168fa3cc2f4f74c96fe926eef8ef</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.107:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5863ebe5623e98c9f405b9da099d0e75990aebce</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">S:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> fc92b4b941bc55edc638b3ed5570c77649f11124</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.109:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (0 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) slave</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   replicates</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">M:</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.103:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   slots:[12288-16383]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (4096 </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">slots</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">) master</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">   2</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> additional</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> replica</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">s</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">OK</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> All nodes agree about slots configuration.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Check</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> for</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> open</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slots...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Check</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slots</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> coverage...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">OK</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> All 16384 slots covered.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">How</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> many</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slots</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> do</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> you</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> want</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> move</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> (from </span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 16384</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">)</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">?</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> 1365</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">What</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> is</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> receiving</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ID?</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Please</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> enter</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> all</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> source</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> IDs.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  Type</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">all</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> use</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> all</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> as</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> source</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> for</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> hash</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slots.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">  Type</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">done</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> once</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> you</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> entered</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> all</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> source</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> IDs.</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Source</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> #1: 5863ebe5623e98c9f405b9da099d0e75990aebce</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Source</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> #2: done</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># (省略)...</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> --cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> reshard</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 把要剔除的  172.30.0.110:6379 中的 1365 个槽迁移给 172.30.0.102:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># (省略)...</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> --cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> reshard</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 把要剔除的  172.30.0.110:6379 中的 1366 个槽迁移给 172.30.0.103:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># (省略)...</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 这里我还观察到此时的 172.30.0.110:6379 自动变为了 172.30.0.103 的从节点, Redis 版本不同可能结果也不同(可能还是主节点, 只不过不持有槽而已, 您可以试一试)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 删除“主”节点</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> --cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> del-node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5863ebe5623e98c9f405b9da099d0e75990aebce</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Removing</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5863ebe5623e98c9f405b9da099d0e75990aebce</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> from</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Sending</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> CLUSTER</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> FORGET</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> messages</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cluster...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">>>> </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Sending</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> CLUSTER</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> RESET</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> SOFT</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> to</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> the</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> deleted</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> node.</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 重新查看集群中的主从结构</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> redis-cli</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -h</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 172.30.0.101</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6379</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -c</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">cluster</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> nodes</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.101:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> myself,master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 13</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 0-5460</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">12992b85a92de26dd849f1abf012ad674da733e4</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.104:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733503694213</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 15</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bc2a17498f1c88f2d827638625e3b998b5d36abf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.108:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733503694514</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 14</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bce31769a218d92d5a3735458e6e479759bdd500</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.105:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733503696221</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 13</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">e42760e10502691aa9e9791a103ac77cb707c070</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.102:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733503696523</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 14</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 5461-6825</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 6827-10922</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">9cd6418590131bf0b6fa20c046ee9bbb06f56afe</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.106:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 9922b4fb888f86437a10912ed4505f86277b6c2e</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733503696121</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 13</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">0903a2928d09168fa3cc2f4f74c96fe926eef8ef</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.107:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733503695000</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 15</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">fc92b4b941bc55edc638b3ed5570c77649f11124</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.109:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> slave</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733503695518</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 15</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">4544c27547b8392cbd5b2e7afcb80c0066d37e9f</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 172.30.0.103:6379@16379</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> master</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 1733503695217</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 15</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> connected</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6826</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 10923-16383</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">172.30.0.101:6379</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">> </span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">exit</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2 id=\"_3-redis-常见的问题\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-redis-常见的问题\"><span>3.Redis 常见的问题</span></a></h2>\n<h3 id=\"_3-1-缓存雪崩\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-1-缓存雪崩\"><span>3.1.缓存雪崩</span></a></h3>\n<ul>\n<li>随机缓存过期时间：采用不同的缓存过期时间。</li>\n<li>采用缓存预热：当大量缓存失效时，数据库压力激增。特别是热点数据突然被请求，数据库直接崩溃，应该提前将热点数据加载到缓存。</li>\n<li>采用缓存更新策略：写入数据库时更新缓存时间。</li>\n<li>引入消息队列组件：削峰填谷请求。</li>\n<li>集群相互监督：</li>\n</ul>\n","tagOpen":"<template>","tagClose":"</template>"},"script":null,"scriptSetup":null,"scripts":[],"styles":[],"customBlocks":[]},"content":"\n## 1.Redis 读分离架构/高可用架构\n\n>   [!IMPORTANT]\n>\n>   补充：实际上 `Redis` 的单机读写性能一般可以达到十万级别的 `QPS`，可以 [查阅官方文档](https://redis.io/docs/latest/operate/oss_and_stack/management/optimization/benchmarks/#benchmark-results-on-bare-metal-servers-across-different-redis-versions)。\n\n### 1.1.架构原理\n\n当客户端足够多时，要减轻 `redis` 节点的负担，则可以考虑多个从节点复制主节点的数据，主节点负责读写，从节点只负责读（不过这么做其实是有点问题的，后面一步一步来）。\n\n### 1.2.数据节点\n\n#### 1.2.1.复制\n\n##### 1.2.1.1.复制的建立\n\n首先我们需要建立 `Redis` 的集群架构，`Redis` 实例之间会进行复制操作，实例划分为主节点和从节点，复制数据流是单向的，只能从主节点流向从节点。复制的配置方式有三种：\n\n- 配置文件中写入在 `slaveof {masterHost} {masterPort}` 随 `Redis` 启动生效\n- 在 `redis-server` 启动命令时加入 `--slaveof {masterHost} {masterPort}` 生效\n- 直接使用 `redis` 命令 `slaveof {masterHost} {masterPort}` 生效\n\n我们在启动 `Redis` 的时候，其实是可以选择不同的配置文件的，因此我们只需要保持原来的 `Redis` 不变（作为主节点），复制原来的配置文件稍作修改为 `redis-slave.conf ` 即可（确保其中的 `daemonize` 为 `yes`，如果配置文件中已经设置好了，那其从节点配置文件可以继续使用主节点的配置文件，不做任何修改）。\n\n```shell\n# 复制的建立\n$ sudo redis-server /etc/redis/redis-slave.conf --port 6380 --slaveof 127.0.0.1 6379 ## 6379 的主节点就连接上 6380 的次节点\n\n```\n\n然后使用 `redis-server /etc/redis/redis-slave.conf --port 6380 --slaveof 127.0.0.1 6379` 启动从节点，并且使用 `netstat -nlpt` 检查是否启动，最后按下面的做法查验是否有分布式运行。\n\n##### 1.2.1.2.复制的现象\n\n```shell\n# 复制的过程\n# >>> begin: 连接主节点 >>>\n$ redis-cli -h 127.0.0.1 -p 6379\n127.0.0.1:6379> set key \"hello\"\nOK\n\n127.0.0.1:6379> get key\n\"hello\"\n\n127.0.0.1:6379> info replication\n# Replication\nrole:master\nconnected_slaves:1\nslave0:ip=127.0.0.1,port=6380,state=online,offset=700,lag=1\nmaster_failover_state:no-failover\nmaster_replid:8280d7308ba672a701170c8eeba15e258546de71\nmaster_replid2:0000000000000000000000000000000000000000\nmaster_repl_offset:700\nsecond_repl_offset:-1\nrepl_backlog_active:1\nrepl_backlog_size:1048576\nrepl_backlog_first_byte_offset:1\nrepl_backlog_histlen:700\n# <<< end <<<\n\n# >>> begin: 连接从节点 >>>\n$ redis-cli -h 127.0.0.1 -p 6380\n127.0.0.1:6379> get key\n\"hello\"\n\n127.0.0.1:6380> info replication\n# Replication\nrole:slave\nmaster_host:127.0.0.1\nmaster_port:6379\nmaster_link_status:up\nmaster_last_io_seconds_ago:9\nmaster_sync_in_progress:0\nslave_read_repl_offset:700\nslave_repl_offset:700\nslave_priority:100\nslave_read_only:1\nreplica_announced:1\nconnected_slaves:0\nmaster_failover_state:no-failover\nmaster_replid:8280d7308ba672a701170c8eeba15e258546de71\nmaster_replid2:0000000000000000000000000000000000000000\nmaster_repl_offset:700\nsecond_repl_offset:-1\nrepl_backlog_active:1\nrepl_backlog_size:1048576\nrepl_backlog_first_byte_offset:15\nrepl_backlog_histlen:686\n# <<< end <<<\n\n```\n\n从运行结果中看到复制已经在工作了，针对主节点 `6379` 的任何修改都可以同步到从节点 `6380` 中，并且也可以使用 `info replication` 查看每个节点的复制信息（节点角色、状态等）。\n\n##### 1.2.1.3.复制的断开\n\n在从节点中可以执行 `slaveof no one` 断开和主节点的复制关系，从节点就会晋升为新的主节点，断开复制节点后不会抛弃原有数据，只是无法再获取主节点上的数据变化。断开节点后，还可以使用 `slaveof <newMasterIp> <newMasterPort>` 给从节点切换为别的主节点，或者干脆给从节点恢复原本的主节点。\n\n```shell\n# 复制的断开\n# >>> begin: 从节点 >>>\n$ redis-cli -h 127.0.0.1 -p 6380\n\n127.0.0.1:6380> get key\n\"hello\"\n\n127.0.0.1:6380> slaveof no one\nOK\n\n# <<< end <<<\n\n# >>> begin: 主节点 >>>\n$ redis-cli -h 127.0.0.1 -p 6379\n\n127.0.0.1:6379> get key\n\"hello\"\n\n127.0.0.1:6379> set akey \"redis\"\nOK\n# <<< end <<<\n\n# >>> begin: 从节点 >>>\n127.0.0.1:6380> get akey # 这样就无法直接复制主节点的数据了\n(nil)\n\n127.0.0.1:6380> slaveof 127.0.0.1 6379\nOK\n# <<< end <<<\n\n# >>> begin: 主节点 >>>\n$ redis-cli -h 127.0.0.1 -p 6379 # 访问一次主节点\n# <<< end <<<\n\n# >>> begin: 主节点 >>>\n127.0.0.1:6380> get akey # 就会发现从节点恢复了复制\n\"redis\"\n# <<< end <<<\n\n```\n\n##### 1.2.1.4.复制的安全\n\n- **权限校验**：对于数据比较重要的节点，主节点会通过设置 `requirepass <密码>` 参数进行密码验证，这时所有的客户端访问进入命令行后必须先使用 `auth` 命令实行校验。从节点与主节点的复制连接是通过一个特殊标识的客户端来完成，因此需要配置从节点的 `masterauth <密码>` 参数与主节点密码保持一致，这样从节点才可以正确地连接到主节点并发起复制流程。 \n- **只读模式**：只读默认情况下，从节点使用 `slave-read-only=yes` 配置为只读模式。由于复制只能从主节点到从节 点，对于从节点的任何修改主节点都无法感知，修改从节点会造成主从数据不一致，所以建议线上不要修改从节点的只读模式。\n\n为了不影响我原来的配置，我这里复制最原本的配置文件，作为主节点和从节点的配置。\n\n1. 配置主节点\n\n   ```shell\n   # 配置主节点( redis-master.conf)\n   $ sudo cp /etc/redis/redis.conf ~/redis-master.conf\n   $ vim redis-master.conf\n   # ...\n   port 6380\n   requirepass <主节点密码>\n   # ...\n   \n   ```\n\n2. 启动主节点\n\n   ```shell\n   # 启动主节点\n   $ redis-server redis.conf\n   \n   ```\n\n3. 配置从节点\n\n   ```shell\n   # 配置从节点(redis-slave.conf)\n   $ sudo cp /etc/redis/redis.conf ~/redis-slave.conf\n   $ vim redis-slave.conf\n   # ...\n   port 6381\n   requirepass <从节点密码>\n   slaveof 127.0.0.1 6380\n   masterauth <填入主节点密码>\n   slave-read-only yes\n   # ...\n   \n   ```\n\n4. 启动从节点\n\n   ```shell\n   # 启动从节点\n   $ redis-server redis-slave.conf\n   \n   ```\n\n5. 连接主节点并设置值\n\n   ```shell\n   # 连接主节点并设置值\n   $ redis-cli -p 6380 -a <主节点密码> # 或者不使用 -a 选项, 直接回车, 在命令行界面中使用 \"auth 密码\" 即可, 如果验证通过就会返回 OK\n   127.0.0.1:6380> set key \"value1\"\n   ok\n   \n   127.0.0.1:6380> get key\n   \"value1\"\n   \n   ```\n\n6. 验证从节点数据同步\n\n   ```shell\n   # 验证从节点数据同步\n   $ redis-cli -p 6381\n   127.0.0.1:6381> get key\n   \"value1\"\n   \n   ```\n\n7. 验证从节点只读模式\n\n   ```shell\n   # 验证从节点只读模式\n   127.0.0.1:6381> set key \"new_value\"\n   (error) READONLY You can't write against a read-only replica.\n   \n   ```\n\n##### 1.2.1.5.复制的延迟\n\n主从节点一般部署在不同机器上，复制时的网络延迟就成为需要考虑的问题，`Redis` 为我们提供了 `repl-disable-tcp-nodelay` 参数用于控制是否关闭 `TCP_NODELAY`，默认为 `no`，即开启 `tcpnodelay` 功能，说明如下：\n\n- 当关闭时，主节点产生的命令数据无论大小都会及时地发送给从节点，这样主从之间延迟会变小，但增加了网络带宽的消耗。适用于主从之间的网络环境良好的场景，如同机房部署。\n- 当开启时，主节点会合并较小的 `TCP` 数据包从而节省带宽，默认发送时间间隔取决于 `Linux` 的内核，一般默认为 `40` 毫秒。这种配置节省了带宽但增大主从之间的延迟。适用于主从网络环境复杂的场景，如跨机房部署。\n\n> [!CAUTION]\n>\n> 警告：因此除非数据不紧急，否则使用 `Redis` 的从节点做读分离其实是有点问题的，因为可能会有较高的延迟，与其说是读分离，不如说从节点的重点是备份数据，方便后续的哨兵节点做故障转移的。\n\n#### 1.2.2.拓扑\n\n1. **一主一从结构**：也就是我们之前一直使用的结构\n\n   - 通常用于主节点出现宕机时，从节点可以提供临时故障转移\n   - 同时写命令较高需要持久化时，就可以在从节点上开启 `AOF` 配置\n\n   这样就可以保证数据持久化安全性，也可以避免对主节点性能的干扰。\n\n2. **一主多从结构**：在大型电商平台中，商品详情页的访问量通常远高于商品数据的修改量。例如，商品价格、库存等信息修改的频率较低，而用户浏览商品详情的频率极高。因此可以一个主节点负责写入，其他从节点都负责读取（负载均衡读取）。\n\n3. **树形主从结构**：树形主从结构（分层结构）使得从节点不但可以复制主节点数据，同时可以作为其他从节点的主节点继续向下层复制。当祖先主节点需要直接挂载的从节点较多时，可以通过引入复制中间层（就是祖先节点只挂载几个从节点后，那几个从节点构成一层中间层），有效降低住系欸按负载和需要传送给从节点的数据量。数据写入节点 `A` 之后会同步给 `B` 和 `C` 节点，`B` 节点进一步把数据同步给 `D` 和 `E` 节 点，这样当主节点 `A` 需要挂载多个从节点时，就可以避免对主节点 `A` 的过高性能干扰。\n\n> [!WARNING]\n>\n> 补充：这里 `Redis` 只是做了复制和拓扑的工作，并没有使用现有的负载均衡算法，因此我们后面需要补充这类算法，在对应编程语言客户端中实现。\n\n#### 1.2.3.原理\n\n##### 1.2.3.1.链接检测\n\n建立复制链接之前：\n\n1. **保存主节点信息**：当开始配置主从同步关系后，先启动从节点的话，会先保存主节点的地址信息，但复制流程尚未开始。 在从节点（如端口 `6380`）执行 `info replication`，可以看到以下信息，此时链接尚未建立。\n\n   ```shell\n   # 回显显示的配置\n   127.0.0.1:6381> info replication\n   # Replication\n   role:slave\n   master_host:127.0.0.1\n   master_port:6380\n   master_link_status:up\n   master_last_io_seconds_ago:2\n   master_sync_in_progress:0\n   slave_read_repl_offset:43163\n   slave_repl_offset:43163\n   slave_priority:100\n   slave_read_only:1\n   replica_announced:1\n   connected_slaves:0\n   master_failover_state:no-failover\n   master_replid:63d358c9223002afc5dcc995a235fcc14882c9d3\n   master_replid2:1c606c458fe22df08bae73d9af9a675cb7b49554\n   master_repl_offset:43163\n   second_repl_offset:43094\n   repl_backlog_active:1\n   repl_backlog_size:1048576\n   repl_backlog_first_byte_offset:43094\n   repl_backlog_histlen:70\\\n   \n   # master_host 和 master_port 分别表示主节点的 IP 和 PORT\n   # master_link_status 表示主节点的连接状态, 此时为 down, 说明尚未建立连接\n   \n   ```\n\n2. **建立 TCP 连接**：从节点会通过每秒运行的定时任务维护复制逻辑。\n\n   - 如果检测到新的主节点，从节点会尝试与主节点建立基于 `TCP` 的网络连接\n   - 若连接失败，定时任务会无限重试，直到连接成功或用户手动停止主从复制。\n\n3. **发送 PING 命令**：成功建立连接后，从节点会发送 `PING` 命令，验证主节点的应用层状态。\n\n   - 如果主节点正常，会返回 `PONG`\n   - 如果 `PONG` 超时，从节点会断开 `TCP` 连接，并等待下一次定时任务重新连接\n\n4. **权限验证**：若主节点配置了 `requirepass` 参数，则需要密码验证。\n\n   - 从节点需在配置文件中设置 `masterauth` 参数提供密码\n   - 如果验证失败，主从复制过程将停止\n\n5. **同步数据集**：在首次建立复制时，主节点会将其所有数据发送给从节点，分为以下两种情况。\n\n   - **全量同步**：发送所有数据，耗时较长（后面会提及 ==方式、字段、指令==）\n   - **部分同步**：发送增量数据，耗时较短（后面会提及 ==方式、字段、指令==）\n\n6. **命令持续复制**：完成数据同步后，主节点会将后续所有修改命令发送给从节点，从节点执行这些命令以保持数据一致性。\n\n建立复制链接之后：\n\n而实际上，为了做到实时复制，主从节点在建立复制链接后，主节点回报自己收到的修改操作，通过 `tcp` 长链接的方式，源源不断传输给从节点，从节点就会根据这写请求来同步修改自己的数据，保持和主节点的数据一致性。\n\n而这样的长链接需要使用心跳检测机制（这里的心跳机制是在 `Redis` 应用层实现的，而不是 `TCP` 自带的心跳机制）来维护链接状态：\n\n1. 主从节点彼此之间都有心跳机制，各自模拟为对方的客户端进行通信\n2. 主节点默认每隔 `10 s` 对从节点发送 `ping` 指令，判断从节点的存活性和链接状态（从节点也可以用这种方式来的只主节点是否掉线）\n3. 从节点默认每隔 `1 s` 对主节点发送 `replconf ack {offset}` 指令来上报自己的偏移量（主节点会根据该偏移量来知道哪些数据已经被从节点接收并处理）\n\n如果主节点发现从节点通信延迟超过 `repl-timeout` 配置的值（默认 `60` 秒），则判定从节点下线，断 开复制客⼾端连接。从节点恢复连接后，⼼跳机制继续进⾏。\n\n##### 1.2.3.2.复制方式\n\n- 早期的` Redis` 只支持全量复制，这就导致有新的从节点加入时，如果数据量较大，就会非常消耗网络资源，并且一旦出现网络波动，就会导致数据丢失而重传。\n- 新版本的 `Redis` 支持部分复制，这主要处理在主从复制中网络闪断等原因造成的数据丢失场景，当从节点再次连接上主节点后，如果条件允许，主节点就会自动补发数据给从节点。补发的数量远小于全量复制，因此可以避免过量的开销。\n\n而同步的指令主要依靠 `psync replicationid <offset>`（是 `Redis` 内部自动调用的命令，不用我们自己调用），其中 `offset` 为 `-1` 代表全量复制指令，其他数值均为部分复制。\n\n触发全量复制，这通常在以下场景发生：\n\n- 从节点首次连接到主节点时。\n- 从节点与主节点数据完全不同步（如从节点为空或主节点 `replicationid` 改变）。\n- 主节点无法满足部分复制条件（如复制积压缓冲区不足）。\n\n触发部分复制，这通常在以下场景发生：\n\n- 从节点重新连接主节点时（短暂网络中断后）。\n- 从节点的 `replicationid` 和偏移量与主节点匹配，且主节点复制积压缓冲区中仍有缺失的数据。\n\n##### 1.2.3.3.重要字段\n\n> [!IMPORTANT]\n>\n> 补充：通过 `info replication` 可以观察下提及的字段，以及对应值的变化。\n\n###### 1.2.3.3.1.复制标识字段\n\n节点的复制 `id`在以下两种情况。\n\n- 主节点初始启动时/重新启动时/异常恢复时\n- 从节点晋级成主节点时\n\n都会生成一个 `replication id`(同一个节点，每次重启，生成的 `replication id` 也会变化)，从节点和主节点建立连接之后，就会获取到主节点的 `replication id`，通过 `info replication` 即可查看 `replication id`。\n\n而每个节点需要记录两组 `master_replid`，这个设定解决的问题场景是这样的：\n\n- 比如当前有两个节点 `A` 和 `B`，`A` 为 `master`，`B` 为 `slave`。此时 `B` 就会记录 `A` 的 `master_replid`。如果网络出现抖动，`B` 以为 `A` 挂了，`B` 自己就会自动成为主节点。\n- 于是 `B` 给自己分配了新的 `master_replid`。此时就会使用 `master_replid2` 来保存之前 `A` 的 `master_replid`。\n- 如果后续网络恢复了，`B` 就可以根据 `master_replid2` 找回之前的主节点。\n- 如果后续网络没有恢复，`B` 就按照新的 `master_replid` 自成一派，继续处理后续的数据（您可以自己尝试 `kill` 掉主节点，重启主节点，查看中间的变化...）。\n\n###### 1.2.3.3.2.复制偏移字段\n\n参与复制的主从节点都会维护自身复制偏移量，主节点（`master`）在处理完写入命令后，会把命令的字节长度做累加记录，统计信息在 `info replication` 中的 `master_repl_offset` 指标中。\n\n从节点在接受到主节点发送的命令后，也会累加记录自身的偏移量，统计信息在 `info replication` 中的 `slave_repl_offset` 指标中。\n\n从节点每秒钟上报自身的复制偏移量给主节点，因此主节点也会保存从节点的复制偏移量，统计指标为 `slavex` 中的 `offset` 字段。\n\n因此，通过对比主从节点的复制偏移量，可以判断主从节点数据是否一致。\n\n> [!IMPORTANT]\n>\n> 补充：`replid + offset` 共同标识了一个“数据集”，如果两个节点，他们的 `replid` 和 `offset` 都相同，则这两个节点上持有的数据，就一定相同。\n\n> [!NOTE]\n>\n> 吐槽：偏移量就相当于学习进度。\n\n##### 1.2.3.4.同步指令\n\n从节点实现复制的原理实际上就是调用 `psync` 指令（由于早期不支持部分复制，会使用全量复制指令 `sync`，`Redis` 会自动根据当前版本来决定使用哪一个指令）。\n\n```shell\n# 数据同步指令\npsync <主节点复制标识replicationid> <偏移量offset>\n# 如果 replicationid 设为 '?' 并且 offset 设为 '-1' 此时就是在尝试进行全量复制\n#如果 replicationid offset 设为了具体的数值, 则是尝试进行部分复制\n\n```\n\n从节点使用后，主要发生了以下事情：\n\n![](./assets/image-20241202145718801.png)\n\n1. 从节点发送 `psync` 命令给主节点，`replid` 和 `offset` 的默认值分别是 `?` 和 `-1`\n2. 主节点根据 `psync` 参数和自身数据情况决定响应结果：\n   - 如果回复 `+FULLRESYNC`，从节点进行全量复制流程\n   - 如果回复 `+CONTINEU`，从节点进行部分复制流程\n   - 如果回复 `-ERR`，说明 `Redis` 主节点版本过低，不支持 `psync` 命令，从节点可以使用 `sync` 命令进行全量复制\n\n> [!IMPORTANT]\n>\n> 补充：当从节点初次连接主节点时，它不知道主节点的 `replicationid`（即它没有之前的同步信息）。\n>\n> 这种情况下，从节点会发送 `PSYNC ? 0` 请求，表示它从未与主节点进行过同步，要求主节点进行全量同步。\n\n> [!IMPORTANT]\n>\n> 补充：`psync` 一般不需要手动执行，`Redis-server` 会在主从复制模式下自动调用执行。\n\n> [!IMPORTANT]\n>\n> 补充：`sync` 会阻塞 `redis server` 处理其他请求，`psync` 则不会。\n\n##### 1.2.3.5.详细过程\n\n根据我们之前的知识，您也肯定明白两种复制方式的触发情况，但是我我们可以进一步细化这一步复制的概念。\n\n###### 1.2.3.5.1.全量复制的细节\n\n![](./assets/image-20241202152620443.png)\n\n1. 从节点发送 `psync` 命令给主节点进行数据同步，由于是第一次进行复制，从节点没有主节点的运行 `ID` 和复制偏移量，所以发送 `psync ? -1`（不过有 `IP` 和`PORT` 所以不愁找不到主节点）。\n2. 主节点根据命令，解析出要进行全量复制，回复 `+FULLRESYNC` 响应。\n3. 从节点接收主节点的运行信息进行保存。\n4. 主节点执行 `bgsave` 进行 `RDB` 文件的持久化。\n5. 主节点发送 `RDB` 文件给从节点，从节点保存 `RDB` 数据到本地硬盘。\n6. 主节点将从生成 `RDB` 到接收完成期间执行的写命令，写入到缓冲区中（不是指积压缓冲区），等从节点保存完 `RDB` 文件后，主节点再将缓冲区内的数据补发给从节点，补发的数据仍然按照 `RDB` 的二进制格式追加写入到收 到的 `rdb` 文件中，保持主从一致性。\n7. 从节点清空自身原有的旧数据。\n8. 从节点加载 `RDB` 文件得到与主节点一致的数据。\n9. 如果从节点加载 `RDB` 完成之后，并且开启了 `AOF` 持久化功能，它会进行 `bgrewriteaof` 操作（不阻塞地优化 `AOF` 文件），得到最近的 `AOF` 文件。\n\n> [!IMPORTANT]\n>\n> 补充：默认情况下，进行全量复制需要主节点生成 `RDB` 文件到主节点的磁盘中, 再把磁盘上的 `RDB` 文件通过发送给从节点。`Redis` 从 `2.8.18` 版本开始支持无磁盘复制。主节点在执行 `RDB` 生成流程时, 不会生成 `RDB` 文件到磁盘中了，而是直接把生成的 `RDB` 数据通过网络发送给从节点，这样就节省了一系列的写硬盘和读硬盘的操作开销。\n\n###### 1.2.3.5.2.部分复制的细节\n\n![](./assets/image-20241202152701081.png)\n\n1. 当主从节点之间出现网络中断时，如果超过 `repl-timeout` 时间，主节点会认为从节点故障并终止复制连接。\n2. 主从连接中断期间主节点依然响应命令，但这些复制命令都因网络中断无法及时发送给从节点，所以暂时将这些命令滞留在 **复制积压缓冲区** 中。\n3. 当主从节点网络恢复后，从节点再次连上主节点。\n4. 从节点将之前保存的 `replicationId` 和 `offset` 作为 `psync` 的参数发送给主节点，请求进行部分复制。\n5. 主节点接到 `psync` 请求后，进行必要的验证。随后根据 `offset` 去复制积压缓冲区查找合适的数据， 并响应 `+CONTINUE` 给从节点（如果超出缓冲区的范围就需要切换为全量复制了）。\n6. 主节点将需要从节点同步的数据发送给从节点，最终完成一致性。\n\n> [!IMPORTANT]\n>\n> 补充：复制积压缓冲区的概念。\n>\n> ![](./assets/image-20241202153856009.png)\n>\n> 复制积压缓冲区是保存在主节点上的一个固定长度的队列，默认大小为 `1MB`，当主节点有连接的从节点时被创建，这时主节点响应写命令时，不但会把命令发送给从节点，还会写入复制积压缓冲区，\n>\n> 由于积压缓冲区本质上是先进先出的定长队列，所以能实现保存最近已复制数据的功能，用于补救 **部分复制或复制命令** 中丢失的数据。复制缓冲区相关统计信息可以通过主节点的 `info replication` 中。\n>\n> ```shell\n> # 积压缓冲区信息\n> 127.0.0.1:6379> info replication\n> # Replication\n> role:master\n> ...\n> repl_backlog_active:1 # 开启复制缓冲区\n> repl_backlog_size:1048576 # 缓冲区最大长度 \n> repl_backlog_first_byte_offset:7479 # 起始偏移量, 计算当前缓冲区可用范围\n> repl_backlog_histlen:1048576 # 已保存数据的有效长度\n> # 可算出复制积压缓冲区内的可用偏移量范围: [repl_backlog_first_byte_offset, repl_backlog_first_byte_offset + repl_backlog_histlen]\n> \n> ```\n\n### 1.3.哨兵节点\n\n#### 1.3.1.概念\n\n`Redis` 的主从复制模式可以将主节点的数据改变同步给从节点，这样从节点就可以起到两个作用：\n\n- 作为主节点的一个备份，一旦主节点出了故障不可达的情况，从节点可以作为后备“顶替”上来，并且保证数据尽量不丢失（主从复制表现为最终一致性）\n- 从节点可以分担主节点上的读压力，让主节点只承担写请求的处理，将所有的读请求负载均衡到各个从节点上。 但是主从复制模式并不是万能的，它同样遗留下以下几个问题： \n  - 主节点发生故障时，进行主备切换的过程是复杂的，需要完全的人工参与，导致故障恢复时间无法得到保障（这个用哨兵来解决）。\n  - 主节点可以将读压力分散出去，但写压力/存储压力是无法法被分担的，还是受到单机的限制。 其中第一个问题是高可用问题，即 `Redis` 哨兵主要解决的问题（这个用集群来解决）。\n\n不过，我们先来观察一个主节点故障后，一名运维工程师是如何 !!在睡梦中惊醒后!! 快速恢复服务 !!然后回去继续补觉!! 的。\n\n1. 运维工程师监控面板，发现公司应用出现问题，排查后发现是分布式 `Redis` 的主节点发生了故障（假设这个应用只使用了一个主节点，多个一级从节点），但是此应用读取数据是没有问题只是无法写入。\n2. 运维工程师在多个从节点中选择一个选择一个节点作为新主节点，修改所有从节点的配置文件，时从节点们指向新主节点，新的主节点也可以继续使用原有的读操作。\n3. 运维工程师再修改应用的配置文件，让应用连接新的主节点，应用恢复写能力。\n4. 运维工程师排除设计的旧主节点的问题后，修改旧主节点转化为新从节点，加入到分布式 `Redis` 架构中，以新主节点作为主节点。\n\n整个过程也被称为 **故障转移**，因此我们认为 !!运维工程师真的很惨...咳咳!! 这个应用并不高可用，我们希望这个过程是自动的，运维工程师只需要观察异常日志和指定分布是架构节点个数即可。\n\n> [!IMPORTANT]\n>\n> 补充：这里梳理一下概念。\n>\n> - 数据节点包含主节点、从节点，节点内运行 `redis-server` 服务\n> - 哨兵集合内包含哨兵节点，节点内运行 `redis-sentinel` 服务\n> - 应用方也叫客户端，可以是命令行也可以是语言第三方库\n\n为了解决上面的问题，`Redis` 提出了 `Redis Sentinel` 这个分布式架构解决方案，其中包含若干个哨兵节点和数据节点。每个哨兵节点会对数据节点和其余 `Sentinel` 节点进行监控（在哨兵节点集合中，存在类似循环链表结构的互相监督机制），当它发现节点不可达时，会对节点做下线标识。\n\n如果下线的是主节点，它还会和其他的 `Sentinel` 节点（所有哨兵节点最好保持奇数总数，避免出现无法选举的问题）进行“协商”，当大多数 `Sentinel` 节点对主节点不可达这个结论达成共识之后，它们自己会在哨兵节点集合内部“选举”出一个 **领导节点** 来完成自动故障转移的工作，同时将这个变化实时通知给 `Redis` 应用方。整个过程是完全自动的，不需要人工介入。因此大体的流程和上面运维工程师做的类似，故障转移的流程大体如下：\n\n![](./assets/image-20241202215147107.png)\n\n1. 监控：主节点故障，从节点同步连接中断，主从复制停止。哨兵节点通过定期监控发现主节点出现故障\n2. 故障转移：哨兵节点与其他哨兵节点进行协商，达成多数认同主节点故障的共识（防止出故障的不是主节点，而是负责发现故障的哨兵节点，该情况经常发生于哨兵节点的网络被孤立的场景下）。后哨兵节点之间使用 `Raft` 算法选举出一个领导角色，由该节点负责后续的故障转移工作，哨兵领导者开始执行故障转移：\n   - 在从节点集合中选择一个作为新主节点\n   - 让其他从节点同步新主节点\n3. 通知：通知应用层转移到新主节点\n\n#### 1.3.2.部署\n\n由于带有哨兵节点的分布式架构，直接本机部署多个数据节点和哨兵节点是有些麻烦的，因此为了演示方便，这里将会使用 `Docker Compose` 统一管理多个数据节点容器和多个哨兵节点容器。\n\n> [!WARNING]\n>\n> 注意：如果您没有学习过 `Docker` 相关的知识，其实也很难理解后面的集群知识，因此这里建议学习过一些 `Docker` 的操作和原理再来继续查阅本文档...\n\n##### 1.3.2.1.准备工作\n\n```shell\n # 准备工作\n # 安装编排工具\n$ sudo apt install docker-compose \n$ docker-compose -v\nDocker Compose version v2.26.1\n\n# 停止原有服务\n$ sudo systemctl stop redis\n# $ sudo systemctl stop redis-sentinel # 如果有的话\n\n# 拉取最新镜像\n$ docker pull redis:latest\n\n```\n\n> [!CAUTION]\n>\n> 警告：建议和我相同版本。\n\n##### 1.3.2.2.主从编排\n\n```shell\n# 编排主从\n$ sudo vim /etc/redis/redis-data/docker-compose.yml\n$ sudo cat /etc/redis/redis-data/docker-compose.yml\nservices:\n  redis1:\n    image: 'redis:latest'\n    container_name: redis-node-1\n    restart: always\n    command: redis-server --appendonly yes\n    ports:\n      - 6379:6379\n  \n  redis2:\n    image: 'redis:latest'\n    container_name: redis-node-2\n    restart: always\n    command: redis-server --appendonly yes --slaveof redis-node-1 6379\n    ports:\n      - 6380:6379\n  \n  redis3:\n    image: 'redis:latest'\n    container_name: redis-node-3\n    restart: always\n    command: redis-server --appendonly yes --slaveof redis-node-1 6379\n    ports:\n      - 6381:6379\n      \n```\n\n上述配置文件描述了三个节点容器，一个主节点容器，两个从节点容器（都开启 `AOP` 持久化）。\n\n```shell\n# 启动指令\n# 根据不同编排配置启动分布式\n$ cd /etc/redis/redis-data\n$ docker-compose up -d\n\n# 查看默认的网络\n$ docker network ls\nNETWORK ID     NAME                 DRIVER    SCOPE\nefe47f88acdc   redis-data_default        bridge    local # 注意: 这个网络名称是根据 \"编排配置文件所在目录名称 + _default\" 得到的\n\n$ docker network inspect redis-data_default\n[\n    {\n        \"Name\": \"redis-data_default\",\n        \"Id\": \"8533d02081e2576057d6838168e5e1d6e87f5daba69a1ea7d69e51fd4cd151a5\",\n        \"Created\": \"2024-12-05T13:47:48.417830084+08:00\",\n        \"Scope\": \"local\",\n        \"Driver\": \"bridge\",\n        \"EnableIPv6\": false,\n        \"IPAM\": {\n            \"Driver\": \"default\",\n            \"Options\": null,\n            \"Config\": [\n                {\n                    \"Subnet\": \"172.20.0.0/16\",\n                    \"Gateway\": \"172.20.0.1\"\n                }\n            ]\n        },\n        \"Internal\": false,\n        \"Attachable\": false,\n        \"Ingress\": false,\n        \"ConfigFrom\": {\n            \"Network\": \"\"\n        },\n        \"ConfigOnly\": false,\n        \"Containers\": {\n            \"5680ccfbbc0ff83424c2472f5993a40d181308919bf6a0d4c5e7629e0d70f986\": {\n                \"Name\": \"redis-node-1\",\n                \"EndpointID\": \"63fb132ccd54ae3cd7aa2c84ca7d66c8b7ea55a2f6945f47ccf42b065f635cc3\",\n                \"MacAddress\": \"02:42:ac:14:00:03\",\n                \"IPv4Address\": \"172.20.0.3/16\",\n                \"IPv6Address\": \"\"\n            },\n            \"6542ad572406c4a42f4cdc470f7bc7a11efa434709976b961ffb5bca6fb6a9c0\": {\n                \"Name\": \"redis-node-2\",\n                \"EndpointID\": \"23dd68fec78289df8ac836cf4d91b04bc541847339a9a1b2d59d08ab285511ec\",\n                \"MacAddress\": \"02:42:ac:14:00:04\",\n                \"IPv4Address\": \"172.20.0.4/16\",\n                \"IPv6Address\": \"\"\n            },\n            \"f848db6f4005b6884cfeedbb3fe8beec5d3a51fde536305c2c756e6fa6999f80\": {\n                \"Name\": \"redis-node-3\",\n                \"EndpointID\": \"4b7fe30897519d432fd4ff9a30b7c36baddfa8c8665b847cc109dc4ce1999c98\",\n                \"MacAddress\": \"02:42:ac:14:00:02\",\n                \"IPv4Address\": \"172.20.0.2/16\",\n                \"IPv6Address\": \"\"\n            }\n        },\n        \"Options\": {},\n        \"Labels\": {\n            \"com.docker.compose.network\": \"default\",\n            \"com.docker.compose.project\": \"redis-data\",\n            \"com.docker.compose.version\": \"2.26.1\"\n        }\n    }\n]\n\n# 检查主从运行情况\n$ redis-cli -p 6379\n127.0.0.1:6379> info replication\n# Replication\nrole:master\nconnected_slaves:2\nslave0:ip=172.20.0.4,port=6379,state=online,offset=252,lag=0\nslave1:ip=172.20.0.2,port=6379,state=online,offset=252,lag=0\nmaster_failover_state:no-failover\nmaster_replid:8d4657bef20c6a9b9e260f04fe86a919fdc2db1f\nmaster_replid2:0000000000000000000000000000000000000000\nmaster_repl_offset:252\nsecond_repl_offset:-1\nrepl_backlog_active:1\nrepl_backlog_size:1048576\nrepl_backlog_first_byte_offset:1\nrepl_backlog_histlen:252\n127.0.0.1:6379> set my_key 114514\nOK\n127.0.0.1:6379> get my_key\n\"114514\"\n127.0.0.1:6379> exit\n\n$ redis-cli -p 6380\n127.0.0.1:6380> get my_key\n\"114514\"\n127.0.0.1:6380> exit\n\n$ redis-cli -p 6381\n127.0.0.1:6381> get my_key\n\"114514\"\n127.0.0.1:6381> exit\n\n```\n\n##### 1.3.2.3.哨兵编排\n\n```shell\n# 编排哨兵\n$ sudo vim /etc/redis/redis-sentinel/docker-compose.yml\n$ sudo cat /etc/redis/redis-sentinel/docker-compose.yml\nnetworks:\n  redis-data_default:\n    external: true # 表示网络来自外部\n\nservices:\n  sentinel1:\n    image: 'redis:latest'\n    container_name: redis-sentinel-1\n    networks:\n      - redis-data_default\n    restart: always\n    command: \"redis-server /etc/redis-config/redis.conf --sentinel\"\n    volumes:\n      - \"./sentinel2:/etc/redis-config\"\n    ports:\n      - 26379:26379\n\n  sentinel2:\n    image: 'redis:latest'\n    container_name: redis-sentinel-2\n    networks:\n      - redis-data_default\n    restart: always\n    command: \"redis-server /etc/redis-config/redis.conf --sentinel\"\n    volumes:\n      - \"./sentinel2:/etc/redis-config\"\n    ports:\n      - 26380:26379\n\n  sentinel3:\n    image: 'redis:latest'\n    container_name: redis-sentinel-3\n    networks:\n      - redis-data_default\n    restart: always\n    command: \"redis-server /etc/redis-config/redis.conf --sentinel\"\n    volumes:\n      - \"./sentinel3:/etc/redis-config\"\n    ports:\n      - 26381:26379\n```\n\n每个哨兵节点其实在一开始都使用同一份内容配置文件，但是被我分开为三个配置文件 ，且每个哨兵节点都在监视主节点，三个节点的总票数为 `3` 只需要 `2` 张票即可判定主节点下线。\n\n```shell\n# 配置文件\n  # 先查看现有的 Redis 主数据节点分配到的 ip 地址\n$ docker network inspect redis-data_default\n# ...\n            \"5680ccfbbc0ff83424c2472f5993a40d181308919bf6a0d4c5e7629e0d70f986\": {\n                \"Name\": \"redis-node-1\",\n                \"EndpointID\": \"63fb132ccd54ae3cd7aa2c84ca7d66c8b7ea55a2f6945f47ccf42b065f635cc3\",\n                \"MacAddress\": \"02:42:ac:14:00:03\",\n                \"IPv4Address\": \"172.20.0.3/16\",\n                \"IPv6Address\": \"\"\n            },\n# ...\n\n# 编写配置文件\n$ cd /etc/redis/redis-sentinel\n$ mkdir sentinel1 sentinel2 sentinel3\n$ sudo vim sentinel1/redis.conf\nbind 0.0.0.0\nport 26379\nsentinel monitor redis-master 172.20.0.3 6379 2 # 警告: 不允许使用容器名称替换 ip 地址\nsentinel down-after-milliseconds redis-master 1000\n# 这里标识 sentinel monitor 主节点名 主节点ip 主节点端口 法定票数\n\n# 复制三份配置文件\n$ sudo cp  sentinel1/redis.conf sentinel2/redis.conf\n$ sudo cp sentinel1/redis.conf sentinel3/redis.conf\n\n# 查看文件目录结构\n $ tree -L 2\n.\n├── docker-compose.yml\n├── sentinel1\n│   └── redis.conf\n├── sentinel2\n│   └── redis.conf\n└── sentinel3\n    └── redis.conf\n\n```\n\n> [!CAUTION]\n>\n> 警告：`redis-sentinel` 在运行过此中可能会对配置进行 `rewrite(重写)` 导致文件内容发生修改，如果用一份文件，就可能出现修改混乱的情况（例如三个哨兵节点监视的主节点失效后，就需要更改配置文件中主节点的 `ip` 和 `port`）。\n\n> [!CAUTION]\n>\n> 警告：将三个 `redis.conf` 放在各个目录中是必要的，我也不太清楚原因，但是我确实有搜索到 [相关的资料](https://stackoverflow.com/questions/70384566/warning-sentinel-was-not-able-to-save-the-new-configuration-on-disk-device)，不过也没有详细解释原因...\n\n> [!CAUTION]\n>\n> 补充：之前的 `redis` 数据节点之所以可以直接使用 `redis-master` 名称作为域名解析，是因为编排文件默认生成一个局域网，三个数据节点处于同一个局域网 `redis-data_default` 中。因此 `docker` 可以根据默认 `DNS` 解析得到容器在局域网中的 `ip`，但是貌似因为 `Redis` 最新版本中没有完全为哨兵节点适配这个问题，因此后面的三份 `redis.conf` 配置文件是根据前面分配给主数据节点的 `ip` 硬编码进去的，这里也有一些相关资料供您参考...\n>\n> - [CSDN 相关资料](https://blog.csdn.net/weixin_63028438/article/details/136077092)\n> - [堆栈溢出相关资料](https://stackoverflow.com/questions/57464443/redis-sentinel-throws-error-cant-resolve-master-instance-hostname)\n> - [Redis 官方文档](https://redis.io/docs/latest/operate/oss_and_stack/management/sentinel/#ip-addresses-and-dns-names)\n\n```shell\n# 启动指令\n $ cd /etc/redis/redis-sentinel/\n $ docker-compose up -d\n $ docker-compose ls\n NAME                STATUS              CONFIG FILES\nredis-data          running(3)          /etc/redis/redis-data/docker-compose.yml\nredis-sentinel      running(3)          /etc/redis/redis-sentinel/docker-compose.yml\n\n```\n\n上述配置文件描述了三个哨兵节点容器，分别监听配置文件里规定的数据节点容器。\n\n##### 1.3.2.4.现象观察\n\n![](./assets/未命名文件.png)\n\n根据配置文件`docker` 网络应该符合上图，我们可以简单查看一下。\n\n```shell\n# 查看网络\n$ docker network inspect redis-data_default\n[\n    {\n        \"Name\": \"redis-data_default\",\n        \"Id\": \"8533d02081e2576057d6838168e5e1d6e87f5daba69a1ea7d69e51fd4cd151a5\",\n        \"Created\": \"2024-12-05T13:47:48.417830084+08:00\",\n        \"Scope\": \"local\",\n        \"Driver\": \"bridge\",\n        \"EnableIPv6\": false,\n        \"IPAM\": {\n            \"Driver\": \"default\",\n            \"Options\": null,\n            \"Config\": [\n                {\n                    \"Subnet\": \"172.20.0.0/16\",\n                    \"Gateway\": \"172.20.0.1\"\n                }\n            ]\n        },\n        \"Internal\": false,\n        \"Attachable\": false,\n        \"Ingress\": false,\n        \"ConfigFrom\": {\n            \"Network\": \"\"\n        },\n        \"ConfigOnly\": false,\n        \"Containers\": {\n            \"30fc3d7275e9e5c3a252c9838af4df3e0dcdb3d7aaa491247117b32c0d1733fd\": {\n                \"Name\": \"redis-sentinel-1\",\n                \"EndpointID\": \"897b230ed7894a039328c8cac06a0eafb28c12b714814873e8693696d2243696\",\n                \"MacAddress\": \"02:42:ac:14:00:05\",\n                \"IPv4Address\": \"172.20.0.5/16\",\n                \"IPv6Address\": \"\"\n            },\n            \"3b3913ebe84f1997aaed3b4e632b33a62b324c77e614b8ad3bdc0866411f0cc4\": {\n                \"Name\": \"redis-sentinel-3\",\n                \"EndpointID\": \"60092aabd2445d68477326529fe604b6daecc46bb5ddd7dbdc6c63ef1c5eee3b\",\n                \"MacAddress\": \"02:42:ac:14:00:07\",\n                \"IPv4Address\": \"172.20.0.7/16\",\n                \"IPv6Address\": \"\"\n            },\n            \"5680ccfbbc0ff83424c2472f5993a40d181308919bf6a0d4c5e7629e0d70f986\": {\n                \"Name\": \"redis-node-1\",\n                \"EndpointID\": \"63fb132ccd54ae3cd7aa2c84ca7d66c8b7ea55a2f6945f47ccf42b065f635cc3\",\n                \"MacAddress\": \"02:42:ac:14:00:03\",\n                \"IPv4Address\": \"172.20.0.3/16\",\n                \"IPv6Address\": \"\"\n            },\n            \"6542ad572406c4a42f4cdc470f7bc7a11efa434709976b961ffb5bca6fb6a9c0\": {\n                \"Name\": \"redis-node-2\",\n                \"EndpointID\": \"23dd68fec78289df8ac836cf4d91b04bc541847339a9a1b2d59d08ab285511ec\",\n                \"MacAddress\": \"02:42:ac:14:00:04\",\n                \"IPv4Address\": \"172.20.0.4/16\",\n                \"IPv6Address\": \"\"\n            },\n            \"7803c0046b724adcd30524b4241cd0f9d0aa17db187c08a3cf3e3dbd6b147d1b\": {\n                \"Name\": \"redis-sentinel-2\",\n                \"EndpointID\": \"c6186ef8769b3719dfbafbc261471a65717ad88acd4e0571e220c7fd0c906fe5\",\n                \"MacAddress\": \"02:42:ac:14:00:06\",\n                \"IPv4Address\": \"172.20.0.6/16\",\n                \"IPv6Address\": \"\"\n            },\n            \"f848db6f4005b6884cfeedbb3fe8beec5d3a51fde536305c2c756e6fa6999f80\": {\n                \"Name\": \"redis-node-3\",\n                \"EndpointID\": \"4b7fe30897519d432fd4ff9a30b7c36baddfa8c8665b847cc109dc4ce1999c98\",\n                \"MacAddress\": \"02:42:ac:14:00:02\",\n                \"IPv4Address\": \"172.20.0.2/16\",\n                \"IPv6Address\": \"\"\n            }\n        },\n        \"Options\": {},\n        \"Labels\": {\n            \"com.docker.compose.network\": \"default\",\n            \"com.docker.compose.project\": \"redis-data\",\n            \"com.docker.compose.version\": \"2.26.1\"\n        }\n    }\n]\n\n```\n\n```shell\n# 观察现象\n# 查看哨兵节点日志\n$ docker container logs redis-sentinel-1\n1:X 05 Dec 2024 06:45:37.907 * oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo\n1:X 05 Dec 2024 06:45:37.907 * Redis version=7.4.1, bits=64, commit=00000000, modified=0, pid=1, just started\n1:X 05 Dec 2024 06:45:37.907 * Configuration loaded\n1:X 05 Dec 2024 06:45:37.907 * monotonic clock: POSIX clock_gettime\n1:X 05 Dec 2024 06:45:37.908 * Running mode=sentinel, port=26379.\n1:X 05 Dec 2024 06:45:37.908 * Sentinel ID is 37d3396d0d849849aae8412b320123e38a774f7f\n1:X 05 Dec 2024 06:45:37.908 # +monitor master redis-master 172.20.0.3 6379 quorum 2 # 开始监控主节点, 并且配置仲裁数量为 2\n1:X 05 Dec 2024 06:45:39.973 * +sentinel sentinel 37d3396d0d849849aae8412b320123e38a774f7f 172.20.0.6 26379 @ redis-master 172.20.0.3 6379 # 注册一个哨兵节点监控主数据节点\n1:X 05 Dec 2024 06:45:39.979 * Sentinel new configuration saved on disk\n1:X 05 Dec 2024 06:45:39.981 * +sentinel-address-switch master redis-master 172.20.0.3 6379 ip 172.20.0.5 port 26379 for 37d3396d0d849849aae8412b320123e38a774f7f # 注册一个哨兵节点监控主数据节点\n1:X 05 Dec 2024 06:45:39.983 * Sentinel new configuration saved on disk\n1:X 05 Dec 2024 06:45:39.992 * +sentinel-address-switch master redis-master 172.20.0.3 6379 ip 172.20.0.7 port 26379 for 4ac62e0c7bde83b4acd18aa35bb544a7936f1a30 # 注册一个哨兵节点监控主数据节点\n1:X 05 Dec 2024 06:45:39.995 * Sentinel new configuration saved on disk # 哨兵节点加载并且保存了新的配置到磁盘中\n\n# 查看配置文件\n$ sudo cat sentinel1/redis.conf \nbind 0.0.0.0\nport 26379\nsentinel monitor redis-master 172.20.0.3 6379 2\nsentinel down-after-milliseconds redis-master 1000\n\n# Generated by CONFIG REWRITE  # 这一部分也是新增加的部分, 是哨兵节点写入的, 我们需要分开三个配置文件书写的原因就是因为哨兵节点会对配置文件进行修改\ndir \"/data\" # Redis Sentinel 工作目录\nlatency-tracking-info-percentiles 50 99 99.9 # 配置延迟跟踪的百分位\nuser default on nopass sanitize-payload ~* &* +@all # 配置默认用户的权限及认证方式\nsentinel myid b6acb72ff13c744f8559c5582f97490af5dfa5c0 # 当前哨兵节点的唯一标识符\nsentinel config-epoch redis-master 0 # 配置主节点的纪元值, 用于主节点选举时的版本控制\nsentinel leader-epoch redis-master 0 # 记录当前哨兵选举过程中被选中的主节点的纪元\nsentinel current-epoch 0 # 当前哨兵的纪元 \n\nsentinel known-replica redis-master 172.20.0.2 6379 # 声明一个已知的副本节点(从数据节点)\n\nsentinel known-replica redis-master 172.20.0.4 6379 # 声明一个已知的副本节点(从数据节点)\n\nsentinel known-sentinel redis-master 172.20.0.6 26379 4ac62e0c7bde83b4acd18aa35bb544a7936f1a30 # 已知的其他哨兵节点信息\n\nsentinel known-sentinel redis-master 172.20.0.7 26379 37d3396d0d849849aae8412b320123e38a774f7f # 已知的其他哨兵节点信息\n\n# 模拟主节点挂掉\n$ docker container stop redis-node-1\n\n# 重新查看日志\n$ docker container logs redis-node-1\n# (省略) ...\n1:X 05 Dec 2024 07:27:32.069 # +sdown master redis-master 172.20.0.3 6379 # 本哨兵节点检测到主节点失效(主观下线)\n1:X 05 Dec 2024 07:27:32.131 # +odown master redis-master 172.20.0.3 6379 #quorum 2/2 # 所有哨兵节点通过投票决定该主数据节点已经完全不可用(客观下线), 这里的 quorum 意为多数同意\n# >>> begin: 开始故障转移 >>>\n1:X 05 Dec 2024 07:27:32.131 # +new-epoch 1 # 创建了一个新的选举周期, 标识为 1\n1:X 05 Dec 2024 07:27:32.131 # +try-failover master redis-master 172.20.0.3  # 开始尝试进行主节点故障转移\n1:X 05 Dec 2024 07:27:32.137 * Sentinel new configuration saved on disk # Sentinel 已经将新的配置加载的磁盘中\n1:X 05 Dec 2024 07:27:32.137 # +vote-for-leader 37d3396d0d849849aae8412b320123e38a774f7f 1 # 选举新的领导\n1:X 05 Dec 2024 07:27:32.137 * 37d3396d0d849849aae8412b320123e38a774f7f voted for 37d3396d0d849849aae8412b320123e38a774f7f 1 \n1:X 05 Dec 2024 07:27:32.141 * 4ac62e0c7bde83b4acd18aa35bb544a7936f1a30 voted for 37d3396d0d849849aae8412b320123e38a774f7f 1\n1:X 05 Dec 2024 07:27:32.214 # +elected-leader master redis-master 172.20.0.3 6379\n1:X 05 Dec 2024 07:27:32.214 # +failover-state-select-slave master redis-master 172.20.0.3 6379\n1:X 05 Dec 2024 07:27:32.305 # +selected-slave slave 172.20.0.2:6379 172.20.0.2 6379 @ redis-master 172.20.0.3 6379\n1:X 05 Dec 2024 07:27:32.305 * +failover-state-send-slaveof-noone slave 172.20.0.2:6379 172.20.0.2 6379 @ redis-master 172.20.0.3 6379\n1:X 05 Dec 2024 07:27:32.456 * +failover-state-wait-promotion slave 172.20.0.2:6379 172.20.0.2 6379 @ redis-master 172.20.0.3 6379\n1:X 05 Dec 2024 07:27:33.393 * Sentinel new configuration saved on disk\n1:X 05 Dec 2024 07:27:33.393 # +promoted-slave slave 172.20.0.2:6379 172.20.0.2 6379 @ redis-master 172.20.0.3 6379\n1:X 05 Dec 2024 07:27:33.393 # +failover-state-reconf-slaves master redis-master 172.20.0.3 6379\n1:X 05 Dec 2024 07:27:33.449 * +slave-reconf-sent slave 172.20.0.4:6379 172.20.0.4 6379 @ redis-master 172.20.0.3 6379\n1:X 05 Dec 2024 07:27:34.393 * +slave-reconf-inprog slave 172.20.0.4:6379 172.20.0.4 6379 @ redis-master 172.20.0.3 6379\n1:X 05 Dec 2024 07:27:34.393 * +slave-reconf-done slave 172.20.0.4:6379 172.20.0.4 6379 @ redis-master 172.20.0.3 6379\n1:X 05 Dec 2024 07:27:34.455 # +failover-end master redis-master 172.20.0.3 6379 # 完成故障转移\n# <<< end <<<\n1:X 05 Dec 2024 07:27:34.455 # +switch-master redis-master 172.20.0.3 6379 172.20.0.2 6379 # 切换主节点\n1:X 05 Dec 2024 07:27:34.455 * +slave slave 172.20.0.4:6379 172.20.0.4 6379 @ redis-master 172.20.0.2 6379 # 更新新的从节点\n1:X 05 Dec 2024 07:27:34.455 * +slave slave 172.20.0.3:6379 172.20.0.3 6379 @ redis-master 172.20.0.2 6379 # 更新新的从节点\n1:X 05 Dec 2024 07:27:34.457 * Sentinel new configuration saved on disk\n1:X 05 Dec 2024 07:27:35.506 # +sdown slave 172.20.0.3:6379 172.20.0.3 6379 @ redis-master 172.20.0.2 6379\n\n# 重新访问新的主节点\n$ docker container ls | grep redis\n30fc3d7275e9   redis:latest   \"docker-entrypoint.s…\"   2 hours ago   Up 2 hours   6379/tcp, 0.0.0.0:26379->26379/tcp, :::26379->26379/tcp     redis-sentinel-1\n7803c0046b72   redis:latest   \"docker-entrypoint.s…\"   2 hours ago   Up 2 hours   6379/tcp, 0.0.0.0:26380->26379/tcp, [::]:26380->26379/tcp   redis-sentinel-2\n3b3913ebe84f   redis:latest   \"docker-entrypoint.s…\"   2 hours ago   Up 2 hours   6379/tcp, 0.0.0.0:26381->26379/tcp, [::]:26381->26379/tcp   redis-sentinel-3\n6542ad572406   redis:latest   \"docker-entrypoint.s…\"   3 hours ago   Up 3 hours   0.0.0.0:6380->6379/tcp, [::]:6380->6379/tcp                 redis-node-2\nf848db6f4005   redis:latest   \"docker-entrypoint.s…\"   3 hours ago   Up 3 hours   0.0.0.0:6381->6379/tcp, [::]:6381->6379/tcp                 redis-node-3\n\n# 进入客户端\n$ redis-cli -p 6380\n# 查看最新配置\n127.0.0.1:6380> info replication\n# Replication\nrole:slave\nmaster_host:172.20.0.2 # 容器内部的 id\nmaster_port:6379 # 容器内部的 port\nmaster_link_status:up\nmaster_last_io_seconds_ago:1\nmaster_sync_in_progress:0\nslave_read_repl_offset:1465716\nslave_repl_offset:1465716\nslave_priority:100\nslave_read_only:1\nreplica_announced:1\nconnected_slaves:0\nmaster_failover_state:no-failover\nmaster_replid:d6cda86c05c8b419d7d5a8775c9ee7478d2c451e\nmaster_replid2:8d4657bef20c6a9b9e260f04fe86a919fdc2db1f\nmaster_repl_offset:1465716\nsecond_repl_offset:808512\nrepl_backlog_active:1\nrepl_backlog_size:1048576\nrepl_backlog_first_byte_offset:408801\nrepl_backlog_histlen:1056916\n\n# 检查是否只读\n127.0.0.1:6381> config get replica-read-only\n1) \"replica-read-only\"\n2) \"yes\"\n\n# 取消只读配置\n127.0.0.1:6381> config set replica-read-only no\nOK\n\n# 测试是否发生主从复制\n127.0.0.1:6381> set my_key \"1433223\"\nOK\n\n127.0.0.1:6381> get my_key\n\"1433223\"\n\n127.0.0.1:6381> exit\n\n$ redis-cli -p 6380\n127.0.0.1:6380> get my_key\n\"1433223\"\n127.0.0.1:6380> exit\n\n# 回复旧的主节点\n$ docker container start redis-node-1\nredis-node-1\n\n$ redis-cli -p 6379\n127.0.0.1:6379> get my_key\n\"114514\" # 还没有更改, 因为是懒加载的\n127.0.0.1:6379> exit\n\n$ redis-cli -p 6381\n127.0.0.1:6381> get my_key \"8848\"\n127.0.0.1:6381> exit\n\n$ redis-cli -p 6379\n127.0.0.1:6379> get my_key\n\"8848\" # 这意味着这个旧主节点已经完全变为了新从节点\n127.0.0.1:6379> exit\n\n```\n\n> [!IMPORTANT]\n>\n> 补充：关于数据节点下线的判断。\n>\n> - 主观下线（`Subjectively Down, SDown`）：哨兵感知到主节点没心跳了，判定为主观下线\n> - 客观下线（`Objectively Down, ODown`）: 多个哨兵达成一致意见，才能认为 `master` 确实下线了\n\n> [!IMPORTANT]\n>\n> 补充：在进行主从切换时，所有参与的哨兵节点都会更新自己的配置，并带上当前的 `epoch` 标识，也就是所谓的“选举周期标识”。这样，其他哨兵节点就能知道哪个节点是最新的领导者，避免出现重复的操作。\n\n> [!WARNING]\n>\n> 注意：哨兵节点最好是有奇数个，方便选举 `leader`，故障得票也更容易超过半数。\n\n> [!CAUTION]\n>\n> 警告：“主从复制+哨兵节点”的无人值守模式提高了高可用性，降低的运维成本，但也无法避免极端数据丢失的情况，并且也无法解决内存容量不够的问题，主节点所在的机器能存储的最多数据只和本机内存条有关，和其他从节点所在的机器的内存条是不会叠加的，毕竟从节点只是复制了主节点的数据而已。\n\n#### 1.3.3.原理\n\n还是根据我们的架构图，<span style=\"text-emphasis:filled red;\">阐述一下 `Raft` 选举算法原理，待补充...</span>\n\n![](./assets/image-20241205170206256.png)\n\n## 2.Redis 写分离架构/多分片架构\n\n### 2.1.架构原理\n\n如果我们把上述的读分离结构看作一个小集群，那么多个读分离结构就是一个大集群。这样做就会有多个主节点可以被写入，假定数据是 `1 TB` 的话，有三个这样的小集群，就可以根据分片算法，每个小集群存储数据集的 `1/3 TB` 即可。这样做既解决了读压力过大的问题又解决了写存储不够的问题。\n\n![](./assets/高可用集群.png)\n\n`Redis` 有什么必要需要这么做么？有，例如搜索引擎，这种需求对读写响应速度是强需求，对海量数据存储也是强需求。\n\n### 2.2.分片算法\n\n一个小集群相当于一个分片，可是直接引入某种机制一定会造成某些问题，假设给定数据全集\n\n- 这些数据应该写入到哪一个分片上？\n- 这些数据应该读出到哪一个分片上？\n\n#### 2.2.1.哈希求余算法\n\n假设有 `N` 个分片，使用`[0, N-1]` 的顺序进行编号，针对某个键值对，根据键名通过算法（例如 `md5` 算法）得到哈希值结果，再使用 `%N` 来求余，最终余数就是分片编号，根据计算出来的编号存储键值对即可。而读取的问题也是，根据想要获取键值对的键名，依葫芦画瓢得到对应的分片编号后，最对应的分区中查找即可。\n\n这种方式简单高效，数据分配相对均匀（其实表现一般），但缺点就是拓展性差，一旦分区数量增加，就会导致原有的映射规则被破坏，一旦需要扩容就需要重新对所有的键值对进行分区，数据在节点之间多次流动以满足新的映射规则，这增加了维护成本。并且在业务中如果发生分区拓展，造成的数据流动会影响业务的正常读写，有可能导致严重的数据一致性问题。迁移的过程中一旦发生数据丢失，就会导致数据丢失的严重情况。\n\n#### 2.2.2.一致性哈希算法\n\n![](./assets/yzxhxsf.png)\n\n换一种思路，我们不再进行简单的求余，把 $[0, 2^{32}-1)$ 这个数据空间映射到一个圆环上，数据按照顺时针的方向增长，键值对的键名映射为哈希值 `H` 后，假设我们有 `N` 个分片，人为设置分布在圆环上的 `N` 个点的位置上（分片点）。然后根据 `H` 在圆环上的位置，顺时针往下寻找分片点，遇到第一个分片点就把键值对存储到对应的分片中。\n\n这种分配方式相当于把所有的哈希值的可能取值都提前做好了分区，如果需要扩容，就可以在某两个分片之间新建一个分片点，新的分片点将夺取前一个分片点的部分数据（分片点按照顺时针顺序分前后），这样每分一个分片就会增加存储量，减少前一个分片的压力。大大减少了扩容时数据搬运的规模，提高了扩容操作的效率，同时不影响业务读写。但缺点就是有可能发生数据分配不均匀，导致数据倾斜。\n\n为此 一致性哈希做了更多的优化，也就是 `虚拟节点`。 当节点较少的时候，为每个物理节点 `创建多个虚拟节点`，使所有的节点 `均匀的分布` 在 `Hash` 环上 ， 从而使数据`相对均衡`。当数据操作请求进来时 ， 如果指向了虚拟节点，就映射到实际的物理节点中。通过这样的方式，就可以保证数据的相对均衡。 当然，这种均衡还是相对的。\n\n另外，更加严重的问题是，如果某个节点集群发生雪崩（当大量读写涌入时，无论如何更替主从节点，最后整个节点集群还是会刮掉），但是后续的节点集群如果负荷能力甚至都比前面节点集群要小，就会导致后续的节点集群继续承接读写压力，过一段时间再次崩溃，一直往后就会造成雪崩的问题。这种问题轻微会导致数据倾斜、部分数据丢失，严重会导致整个 `Redis` 大集群（也就是圆环上所有的节点集群）失去响应。尽管有人提出了虚拟节点的方式来解决这个问题，但是也会增加系统的复杂度和维护难度。\n\n#### 2.2.3.哈希槽算法\n\n![](./assets/img_v3_02ha_93cb8443-7827-4a14-88bf-aec811367b6g.jpg)\n\n上述两种方式一是导致扩容成本高，二是导致分配不均匀，因此 `Redis cluster` 就引入了哈希槽算法（例如使用 $hash\\_slot = crc16(key_name) \\% 16384$ 的到哈希值）。`Redis cluster`采用数据分片的哈希槽来进行数据存储和数据的读取，`Redis cluster` 一共有 $2^{14}=16384$个槽，所有的 `master` 节点都会有一个槽区，比如 $[0, 1000)$，槽数是可以迁移的。`master`节点的 `slave` 节点不分配槽，只拥有读权限。第一次新建 `Redis cluster` 时，`16384` 个槽是被 `master` 节点均匀分布的。\n\n哈希槽不是闭合的，并且一个键值对的键名计算得到哈希值后，是固定在某一个区域的，不会像一致性算法一样出现大面积雪崩的情况，哪怕是某一个节点集群故障了，也不会导致大量的读写压力转移到别的节点上，仍能保持业务一定的活性。\n\n并且扩容机制和一致性算法有些类似，但由于映射区域固定（一致性算法是遇到主节点才存储），也可以避免大面积的传输，是兼顾多方面的好手。\n\n### 2.3.搭建集群\n\n前面的话太空，这里依旧是使用单机部署集群，真正意义上的跨主机集群，需要使用 `k8s` 来操作。在单机部署上，使用 `docker-compose` 模拟 `k8s` 工具，一个容器就是一台裸机。我们需要 `11` 个 `Redis` 节点，其中 `9` 个用来演示集群的搭建，`2` 个用作后续扩容缩容准备。\n\n#### 2.3.1.设置目录\n\n```shell\n# 设置目录\n$ cd /etc/redis/\n$ mkdir redis-cluster\n$ cd redis-cluster\n$ touch docker-compose.yml\n$ touch generate.sh\n$ touch dissipate.sh\n\n```\n\n#### 2.3.2.脚本文件\n\n```shell\n# 脚本文件\n$ cd /etc/redis/redis-cluster\n$ vim generate.sh\n$ cat generate.sh\n# !/bin/bash\n# 集群节点\nfor port in $(seq 1 9); \\\ndo \\\n    mkdir -p redis${port}/\n    touch redis${port}/redis.conf\n    cat << EOF > redis${port}/redis.conf # 两个 EOF 之间的多行文本会被全部输入到 cat 中\nport 6379 # 容器内的 PORT\nbind 0.0.0.0 # 容器内的 IP\nprotected-mode no # 关闭保护模式(原本是会屏蔽掉一些不安全的访问的)\nappendonly yes # 开启 AOF 持久化\ncluster-enabled yes # 开启集群模式\ncluster-config-file nodes.conf # 指定集群配置文件的名称, 节点可以通过读取该文件来解集群的状态\ncluster-node-timeout 5000 # 设置集群节点超时时间\ncluster-announce-ip 172.30.0.10${port} # 向集群中的其他节点宣告自己的集群网络 IP\ncluster-announce-port 6379 # 向集群中的其他节点宣告自己的集群网络 PORT\ncluster-announce-bus-port 16379 # 集群内部节点之间的通信总线端口(集群管理的信息交互是通过这个端口进行的)\nEOF\ndone\n\n# 备用节点\nfor port in $(seq 10 11); \\\ndo \\\n    mkdir -p redis${port}/\n    touch redis${port}/redis.conf\n    cat << EOF > redis${port}/redis.conf\nport 6379\nbind 0.0.0.0\nprotected-mode no\nappendonly yes\ncluster-enabled yes\ncluster-config-file nodes.conf\ncluster-node-timeout 5000\ncluster-announce-ip 172.30.0.1${port}\ncluster-announce-port 6379\ncluster-announce-bus-port 16379\nEOF\ndone\n\n$ vim dissipate.sh\n$ cat dissipate.sh\n# !/bin/bash\nrm -rf redis*\n\n# 去除上述注释后运行脚本\n$ bash generate.sh\n$ ls\ndissipate.sh  generate.sh  redis1  redis10  redis11  redis2  redis3  redis4  redis5  redis6  redis7  redis8  redis9\n$ tree -L 2\n.\n├── dissipate.sh\n├── generate.sh\n├── redis1\n│   └── redis.conf\n├── redis10\n│   └── redis.conf\n├── redis11\n│   └── redis.conf\n├── redis2\n│   └── redis.conf\n├── redis3\n│   └── redis.conf\n├── redis4\n│   └── redis.conf\n├── redis5\n│   └── redis.conf\n├── redis6\n│   └── redis.conf\n├── redis7\n│   └── redis.conf\n├── redis8\n│   └── redis.conf\n└── redis9\n    └── redis.conf\n\n12 directories, 13 files\n\n# 查看配置内容是否正确\n$ cat redis1/redis.conf\nport 6379\nbind 0.0.0.0\nprotected-mode no\nappendonly yes\ncluster-enabled yes\ncluster-config-file nodes.conf\ncluster-node-timeout 5000\ncluster-announce-ip 172.30.0.101\ncluster-announce-port 6379\ncluster-announce-bus-port 16379\n\n```\n\n> [!CAUTION]\n>\n> 警告：注意请删除上面脚本中的注释后再运行。\n\n> [!IMPORTANT]\n>\n> 补充：常用目录配置结构就是，使用一个目录来标识一个 `Redis` 集群，然后目录中存放多个节点目录（可能是数据节点，也可能是哨兵节点），节点目录中存放配置文件 `redis.conf`，我们可以根据 `redis-server` 读取不同的配置文件，来决定一个节点是数据节点还是哨兵节点。\n\n#### 2.3.3.编排文件\n\n> [!WARNING]\n>\n> 注意：之前我们使用的网络名称是根据父目录名称来得到的，但是其实我们也可以自己自定义一个，下面的配置文件就事先定义了一个集群网络。\n\n```shell\n# 编排容器\n$ cd /etc/redis/redis-cluster\n$ vim docker-compose.yml\n$ cat docker-compose.yml\n#  先自定义集群网络 redis-cluster-net\nnetworks:\n  redis-cluster-net:\n    driver: bridge\n    ipam: # 配置子网 IP 地址分配规则\n      config:\n        - subnet: 172.30.0.0/24 # 配置子网范围为 172.30.0.1 到 172.30.0.254\n\nservices:\n  redis1: # 服务名\n    image: 'redis:latest' # 指定镜像文件\n    container_name: redis1 # 生成的容器名\n    restart: always # 设置自动重启策略\n    deploy: # 部署\n      resources: # 资源\n        limits: # 最大额度\n          memory: 512M\n        reservations: # 最小额度\n          memory: 256M\n    volumes: # 存储映射\n      - ./redis1:/usr/local/etc/redis\n    ports: # 端口映射\n      - 6371:6379\n    command: [\"redis-server\", \"/usr/local/etc/redis/redis.conf\"] # 启动指令\n    networks: # 网络配置\n      redis-cluster-net: # 在开头定义的子网网络中\n        ipv4_address: 172.30.0.101 # 为容器指定静态的 ipv4 地址, 避免地址改动引起其他地方的修改\n\n  redis2:\n    image: 'redis:latest'\n    container_name: redis2\n    restart: always\n    deploy:\n      resources:\n        limits:\n          memory: 512M\n        reservations:\n          memory: 256M\n    volumes:\n      - ./redis2:/usr/local/etc/redis\n    ports:\n      - 6372:6379\n    command: [\"redis-server\", \"/usr/local/etc/redis/redis.conf\"]\n    networks:\n      redis-cluster-net:\n        ipv4_address: 172.30.0.102\n\n  redis3:\n    image: 'redis:latest'\n    container_name: redis3\n    restart: always\n    deploy:\n      resources:\n        limits:\n          memory: 512M\n        reservations:\n          memory: 256M\n    volumes:\n      - ./redis3:/usr/local/etc/redis\n    ports:\n      - 6373:6379\n    command: [\"redis-server\", \"/usr/local/etc/redis/redis.conf\"]\n    networks:\n      redis-cluster-net:\n        ipv4_address: 172.30.0.103\n        \n  redis4:\n    image: 'redis:latest'\n    container_name: redis4\n    restart: always\n    deploy:\n      resources:\n        limits:\n          memory: 512M\n        reservations:\n          memory: 256M\n    volumes:\n      - ./redis4:/usr/local/etc/redis\n    ports:\n      - 6374:6379\n    command: [\"redis-server\", \"/usr/local/etc/redis/redis.conf\"]\n    networks:\n      redis-cluster-net:\n        ipv4_address: 172.30.0.104\n        \n  redis5:\n    image: 'redis:latest'\n    container_name: redis5\n    restart: always\n    deploy:\n      resources:\n        limits:\n          memory: 512M\n        reservations:\n          memory: 256M\n    volumes:\n      - ./redis5:/usr/local/etc/redis\n    ports:\n      - 6375:6379\n    command: [\"redis-server\", \"/usr/local/etc/redis/redis.conf\"]\n    networks:\n      redis-cluster-net:\n        ipv4_address: 172.30.0.105\n        \n  redis6:\n    image: 'redis:latest'\n    container_name: redis6\n    restart: always\n    deploy:\n      resources:\n        limits:\n          memory: 512M\n        reservations:\n          memory: 256M\n    volumes:\n      - ./redis6:/usr/local/etc/redis\n    ports:\n      - 6376:6379\n    command: [\"redis-server\", \"/usr/local/etc/redis/redis.conf\"]\n    networks:\n      redis-cluster-net:\n        ipv4_address: 172.30.0.106\n\n  redis7:\n    image: 'redis:latest'\n    container_name: redis7\n    restart: always\n    deploy:\n      resources:\n        limits:\n          memory: 512M\n        reservations:\n          memory: 256M\n    volumes:\n      - ./redis7:/usr/local/etc/redis\n    ports:\n      - 6377:6379\n    command: [\"redis-server\", \"/usr/local/etc/redis/redis.conf\"]\n    networks:\n      redis-cluster-net:\n        ipv4_address: 172.30.0.107\n\n  redis8:\n    image: 'redis:latest'\n    container_name: redis8\n    restart: always\n    deploy:\n      resources:\n        limits:\n          memory: 512M\n        reservations:\n          memory: 256M\n    volumes:\n      - ./redis8:/usr/local/etc/redis\n    ports:\n      - 6378:6379\n    command: [\"redis-server\", \"/usr/local/etc/redis/redis.conf\"]\n    networks:\n      redis-cluster-net:\n        ipv4_address: 172.30.0.108\n\n  redis9:\n    image: 'redis:latest'\n    container_name: redis9\n    restart: always\n    deploy:\n      resources:\n        limits:\n          memory: 512M\n        reservations:\n          memory: 256M\n    volumes:\n      - ./redis9:/usr/local/etc/redis\n    ports:\n      - 6379:6379\n    command: [\"redis-server\", \"/usr/local/etc/redis/redis.conf\"]\n    networks:\n      redis-cluster-net:\n        ipv4_address: 172.30.0.109\n\n  redis10:\n    image: 'redis:latest'\n    container_name: redis10\n    restart: always\n    deploy:\n      resources:\n        limits:\n          memory: 512M\n        reservations:\n          memory: 256M\n    volumes:\n      - ./redis10:/usr/local/etc/redis\n    ports:\n      - 6380:6379\n    command: [\"redis-server\", \"/usr/local/etc/redis/redis.conf\"]\n    networks:\n      redis-cluster-net:\n        ipv4_address: 172.30.0.110\n\n  redis11:\n    image: 'redis:latest'\n    container_name: redis11\n    restart: always\n    deploy:\n      resources:\n        limits:\n          memory: 512M\n        reservations:\n          memory: 256M\n    volumes:\n      - ./redis11:/usr/local/etc/redis\n    ports:\n      - 6381:6379\n    command: [\"redis-server\", \"/usr/local/etc/redis/redis.conf\"]\n    networks:\n      redis-cluster-net:\n        ipv4_address: 172.30.0.111\n\n```\n\n#### 2.3.4.启动指令\n\n```shell\n# 启动指令\n# 启动编排中的容器\n$ docker-compose up -d\n\n# 检查容器日志是否正常\n$ docker-compose ls\nNAME                STATUS              CONFIG FILES\nredis-cluster       running(11)         /etc/redis/redis-cluster/docker-compose.yml\n\n$ docker container logs redis1\n1:C 06 Dec 2024 12:47:43.226 # WARNING: Changing databases number from 16 to 1 since we are in cluster mode # 这个警告表示在 Redis 集群模式下, 数据库的数量已从 16 个减少为 1 个, 在默认的 Redis 单机模式下, Redis 允许使用 16 个数据库(编号从 0 到 15), 但是在集群模式下, Redis 只支持一个数据库(即 0 号数据库)\n1:C 06 Dec 2024 12:47:43.226 * oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo\n1:C 06 Dec 2024 12:47:43.226 * Redis version=7.4.1, bits=64, commit=00000000, modified=0, pid=1, just started\n1:C 06 Dec 2024 12:47:43.226 * Configuration loaded\n1:M 06 Dec 2024 12:47:43.226 * monotonic clock: POSIX clock_gettime\n1:M 06 Dec 2024 12:47:43.227 * Running mode=cluster, port=6379.\n1:M 06 Dec 2024 12:47:43.227 * No cluster configuration found, I'm 9922b4fb888f86437a10912ed4505f86277b6c2e\n1:M 06 Dec 2024 12:47:43.229 * Server initialized\n1:M 06 Dec 2024 12:47:43.230 * Creating AOF base file appendonly.aof.1.base.rdb on server start\n1:M 06 Dec 2024 12:47:43.233 * Creating AOF incr file appendonly.aof.1.incr.aof on server start\n1:M 06 Dec 2024 12:47:43.233 * Ready to accept connections tcp\n\n# 创建集群\n$ redis-cli --cluster create \\ # 表示创建集群\n172.30.0.101:6379 172.30.0.102:6379 172.30.0.103:6379 \\ # 加入集群的节点地址\n172.30.0.104:6379 172.30.0.105:6379 172.30.0.106:6379 \\ # 加入集群的节点地址\n172.30.0.107:6379 172.30.0.108:6379 172.30.0.109:6379 \\ # 加入集群的节点地址\n--cluster-replicas 2 # 表示每一个节点需要两个从节点进行备份\n# 完整指令为 redis-cli --cluster create 172.30.0.101:6379 172.30.0.102:6379 172.30.0.103:6379 172.30.0.104:6379 172.30.0.105:6379 172.30.0.106:6379 172.30.0.107:6379 172.30.0.108:6379 172.30.0.109:6379 --cluster-replicas 2\n>>> Performing hash slots allocation on 9 nodes...\nMaster[0] -> Slots 0 - 5460\nMaster[1] -> Slots 5461 - 10922\nMaster[2] -> Slots 10923 - 16383\nAdding replica 172.30.0.105:6379 to 172.30.0.101:6379\nAdding replica 172.30.0.106:6379 to 172.30.0.101:6379\nAdding replica 172.30.0.107:6379 to 172.30.0.102:6379\nAdding replica 172.30.0.108:6379 to 172.30.0.102:6379\nAdding replica 172.30.0.109:6379 to 172.30.0.103:6379\nAdding replica 172.30.0.104:6379 to 172.30.0.103:6379\nM: 9922b4fb888f86437a10912ed4505f86277b6c2e 172.30.0.101:6379\n   slots:[0-5460] (5461 slots) master\nM: e42760e10502691aa9e9791a103ac77cb707c070 172.30.0.102:6379\n   slots:[5461-10922] (5462 slots) master\nM: 4544c27547b8392cbd5b2e7afcb80c0066d37e9f 172.30.0.103:6379\n   slots:[10923-16383] (5461 slots) master\nS: 12992b85a92de26dd849f1abf012ad674da733e4 172.30.0.104:6379\n   replicates 4544c27547b8392cbd5b2e7afcb80c0066d37e9f\nS: bce31769a218d92d5a3735458e6e479759bdd500 172.30.0.105:6379\n   replicates 9922b4fb888f86437a10912ed4505f86277b6c2e\nS: 9cd6418590131bf0b6fa20c046ee9bbb06f56afe 172.30.0.106:6379\n   replicates 9922b4fb888f86437a10912ed4505f86277b6c2e\nS: 0903a2928d09168fa3cc2f4f74c96fe926eef8ef 172.30.0.107:6379\n   replicates e42760e10502691aa9e9791a103ac77cb707c070\nS: bc2a17498f1c88f2d827638625e3b998b5d36abf 172.30.0.108:6379\n   replicates e42760e10502691aa9e9791a103ac77cb707c070\nS: fc92b4b941bc55edc638b3ed5570c77649f11124 172.30.0.109:6379\n   replicates 4544c27547b8392cbd5b2e7afcb80c0066d37e9f\nCan I set the above configuration? (type 'yes' to accept): yes # 这里需要输入 yes 后回车\n>>> Nodes configuration updated\n>>> Assign a different config epoch to each node\n>>> Sending CLUSTER MEET messages to join the cluster\nWaiting for the cluster to join\n\n>>> Performing Cluster Check (using node 172.30.0.101:6379)\nM: 9922b4fb888f86437a10912ed4505f86277b6c2e 172.30.0.101:6379\n   slots:[0-5460] (5461 slots) master\n   2 additional replica(s)\nS: 0903a2928d09168fa3cc2f4f74c96fe926eef8ef 172.30.0.107:6379\n   slots: (0 slots) slave\n   replicates e42760e10502691aa9e9791a103ac77cb707c070\nM: e42760e10502691aa9e9791a103ac77cb707c070 172.30.0.102:6379\n   slots:[5461-10922] (5462 slots) master\n   2 additional replica(s)\nS: bc2a17498f1c88f2d827638625e3b998b5d36abf 172.30.0.108:6379\n   slots: (0 slots) slave\n   replicates e42760e10502691aa9e9791a103ac77cb707c070\nS: 9cd6418590131bf0b6fa20c046ee9bbb06f56afe 172.30.0.106:6379\n   slots: (0 slots) slave\n   replicates 9922b4fb888f86437a10912ed4505f86277b6c2e\nS: 12992b85a92de26dd849f1abf012ad674da733e4 172.30.0.104:6379\n   slots: (0 slots) slave\n   replicates 4544c27547b8392cbd5b2e7afcb80c0066d37e9f\nS: bce31769a218d92d5a3735458e6e479759bdd500 172.30.0.105:6379\n   slots: (0 slots) slave\n   replicates 9922b4fb888f86437a10912ed4505f86277b6c2e\nM: 4544c27547b8392cbd5b2e7afcb80c0066d37e9f 172.30.0.103:6379\n   slots:[10923-16383] (5461 slots) master\n   2 additional replica(s)\nS: fc92b4b941bc55edc638b3ed5570c77649f11124 172.30.0.109:6379\n   slots: (0 slots) slave\n   replicates 4544c27547b8392cbd5b2e7afcb80c0066d37e9f\n[OK] All nodes agree about slots configuration.\n>>> Check for open slots...\n>>> Check slots coverage...\n[OK] All 16384 slots covered.\n\n# 查看正在运行的容器\n$ docker container ls\nCONTAINER ID   IMAGE          COMMAND                   CREATED          STATUS          PORTS                                         NAMES\n25ec15dde362   redis:latest   \"docker-entrypoint.s…\"   23 minutes ago   Up 23 minutes   0.0.0.0:6377->6379/tcp, [::]:6377->6379/tcp   redis7\n77414c90b6ea   redis:latest   \"docker-entrypoint.s…\"   23 minutes ago   Up 23 minutes   0.0.0.0:6380->6379/tcp, [::]:6380->6379/tcp   redis10\n41dacddb4ac3   redis:latest   \"docker-entrypoint.s…\"   23 minutes ago   Up 23 minutes   0.0.0.0:6371->6379/tcp, [::]:6371->6379/tcp   redis1\n573c13c744ca   redis:latest   \"docker-entrypoint.s…\"   23 minutes ago   Up 23 minutes   0.0.0.0:6373->6379/tcp, [::]:6373->6379/tcp   redis3\n6aa2609836c7   redis:latest   \"docker-entrypoint.s…\"   23 minutes ago   Up 23 minutes   0.0.0.0:6379->6379/tcp, :::6379->6379/tcp     redis9\nbcbd5203f15c   redis:latest   \"docker-entrypoint.s…\"   23 minutes ago   Up 23 minutes   0.0.0.0:6381->6379/tcp, [::]:6381->6379/tcp   redis11\n67e1aeef7b1d   redis:latest   \"docker-entrypoint.s…\"   23 minutes ago   Up 23 minutes   0.0.0.0:6378->6379/tcp, [::]:6378->6379/tcp   redis8\n9fa7e3fb21bc   redis:latest   \"docker-entrypoint.s…\"   23 minutes ago   Up 23 minutes   0.0.0.0:6374->6379/tcp, [::]:6374->6379/tcp   redis4\nec8d07d38191   redis:latest   \"docker-entrypoint.s…\"   23 minutes ago   Up 23 minutes   0.0.0.0:6376->6379/tcp, [::]:6376->6379/tcp   redis6\n5031b98a28d5   redis:latest   \"docker-entrypoint.s…\"   23 minutes ago   Up 23 minutes   0.0.0.0:6375->6379/tcp, [::]:6375->6379/tcp   redis5\n1acb75345d10   redis:latest   \"docker-entrypoint.s…\"   23 minutes ago   Up 23 minutes   0.0.0.0:6372->6379/tcp, [::]:6372->6379/tcp   redis2\n\n```\n\n> [!IMPORTANT]\n>\n> 补充：创建集群这一步完全可以使用\n\n从上面的输出来看，`redis-cli` 的 `--cluster create` 命令成功地将 `9` 个 `Redis` 节点配置为一个 `Redis` 集群，并且已经自动完成了分配槽位、添加副本、以及节点之间的通信（使用的正式哈希槽算法）。回显显示的信息如下：\n\n- **槽位分配**：集群被划分为 `16384` 个槽位，三个主节点分别负责分配槽位：\n  - `172.30.0.101:6379`：负责 `0-5460` 号槽位\n  - `172.30.0.102:6379`：负责 `5461-10922` 号槽位\n  - `172.30.0.103:6379`：负责 `10923-16383` 号槽位\n- **副本添加**：每个主节点都有两个副本节点：\n  - `172.30.0.101:6379` 有两个副本：`172.30.0.105:6379` 和 `172.30.0.106:6379`\n  - `172.30.0.102:6379` 有两个副本：`172.30.0.107:6379` 和 `172.30.0.108:6379`\n  - `172.30.0.103:6379` 有两个副本：`172.30.0.109:6379` 和 `172.30.0.104:6379`\n- **节点信息**：每个主节点和副本的状态都列出，并确认了副本正确地复制了主节点的数据。\n- **集群检查**：\n  - 所有 `16384` 个槽位都已经被覆盖和分配。\n  - 所有节点和槽位配置一致，没有发现未分配的槽位。\n\n此时,使用客户端连上集群中的任何一个节点，都相当于连上了整个集群。那么由于有分片的的存在，我们访问的主节点不一定就是数据所在的节点怎么办呢？客户端后面要加上 `-c` 选项，否则 `key` 如果没有落到当前节点上，是不能进行操作的，`-c` 会自动把请求重定向到对应节点。\n\n不过我们不急着操作先，先来使用 ` cluster nodes` 来查看整个集群的信息，然后再来使用集群。\n\n```shell\n# 使用集群\n$ redis-cli -h 172.30.0.101 -p 6379 -c # 注意携带 -c 选项\n172.30.0.101:6379> cluster nodes\n0903a2928d09168fa3cc2f4f74c96fe926eef8ef 172.30.0.107:6379@16379 slave e42760e10502691aa9e9791a103ac77cb707c070 0 1733490348922 2 connected\n9922b4fb888f86437a10912ed4505f86277b6c2e 172.30.0.101:6379@16379 myself,master - 0 0 1 connected 0-5460\ne42760e10502691aa9e9791a103ac77cb707c070 172.30.0.102:6379@16379 master - 0 1733490348000 2 connected 5461-10922\nbc2a17498f1c88f2d827638625e3b998b5d36abf 172.30.0.108:6379@16379 slave e42760e10502691aa9e9791a103ac77cb707c070 0 1733490347917 2 connected\n9cd6418590131bf0b6fa20c046ee9bbb06f56afe 172.30.0.106:6379@16379 slave 9922b4fb888f86437a10912ed4505f86277b6c2e 0 1733490349525 1 connected\n12992b85a92de26dd849f1abf012ad674da733e4 172.30.0.104:6379@16379 slave 4544c27547b8392cbd5b2e7afcb80c0066d37e9f 0 1733490348419 3 connected\nbce31769a218d92d5a3735458e6e479759bdd500 172.30.0.105:6379@16379 slave 9922b4fb888f86437a10912ed4505f86277b6c2e 0 1733490349023 1 connected\n4544c27547b8392cbd5b2e7afcb80c0066d37e9f 172.30.0.103:6379@16379 master - 0 1733490348520 3 connected 10923-16383\nfc92b4b941bc55edc638b3ed5570c77649f11124 172.30.0.109:6379@16379 slave 4544c27547b8392cbd5b2e7afcb80c0066d37e9f 0 1733490348520 3 connected\n172.30.0.101:6379> set akey \"666\"\n-> Redirected to slot [8093] located at 172.30.0.102:6379 # 这句话表示您发送的请求被重定向到一个位于 172.30.0.102:6379 的主节点，该节点负责处理槽位编号为 8093 的数据。\nOK\n\n172.30.0.102:6379> get akey\n\"666\"\n172.30.0.102:6379> exit\n\n# 尝试不带 -c 选项直接进行访问\nredis-cli -h 172.30.0.101 -p 6379\n172.30.0.101:6379> get akey\n(error) MOVED 8093 172.30.0.102:6379 # 果然访问不到了...并且提示到另外一个主节点进行寻找\n172.30.0.101:6379> exit\n\n# 尝试不带 -c 选项直接进行访问\nredis-cli -h 172.30.0.103 -p 6379\n172.30.0.103:6379> get akey\n(error) MOVED 8093 172.30.0.102:6379 # 果然还是不行\n172.30.0.103:6379> exit\n\n# 尝试不带 -c 选项直接进行访问\n$ redis-cli -h 172.30.0.102 -p 6379\n172.30.0.102:6379> get akey\n\"666\" # 说明数据确实进行了分片\n172.30.0.102:6379> exit\n\n# 使用从节点访问试一试\n$ redis-cli -h 172.30.0.107 -p 6379\n172.30.0.107:6379> get akey\n(error) MOVED 8093 172.30.0.102:6379 # 欸? 这是怎么回事呢? 难道从节点没有把主节点数据拷贝过来?\n172.30.0.107:6379> readonly # 打开只读试试\nOK\n172.30.0.107:6379> get akey\n\"666\" # 欸果然可以了\n172.30.0.107:6379> exit # 不过每次退出都需要重新执行 readonly, 除非我们修改所有节点的 redis.conf 配置文件中的配置选项为 \"slave-read-only no\", 这种设置不会对主节点产生影响(待补充...)\n\n```\n\n> [!CAUTION]\n>\n> 警告：`Redis` 默认从节点只是拿来数据备份和进行故障转移的，默热不推荐我们使用从节点进行数据读取，因为复制带来的延迟在集群状态下可能会很高，导致读取到旧数据（这个备份过此是异步的）。在有集群的情况下，我们可以不用再向之前的主从架构一样，将主节点用来写，从节点都用来读。而是主节点都用来读写，从节点用来做数据备份和故障转移即可。因此与其说分片把写分离，不如说分片让读写都分离了。\n>\n> 因此在业务架构中，最好一个项目使用一个 `Redis` 集群，然后如果该项目本身就是分布式的（例如后端是分布式的，则可以让后端分别寻找对应的主节点进行读取，这样读写压力会被不同机器分摊）。\n>\n> - 写入被不同机器分摊\n> - 读出被不同机器分摊\n> - 数据被负载均衡存入\n> - 数据被主从结构备份\n> - 避免读从节点旧数据\n\n> [!CAUTION]\n>\n> 警告：在集群状态下，会不会出现，写入过程中（还没写入完）进行读取导致失败的情况呢？不可能，为什么？因为一个 `Redis`节点是单线程的，在集群中，写入和读出一定是同一个槽，而管理这个槽的 `Redis` 分片一定会单线程执行写入和读取这两个命令，如果很确定写入比读出早，那么读出是百分百有数据，不会有意外情况。\n\n### 2.4.故障转移\n\n手动停止一个主节点，看看会发生什么现象。\n\n```shell\n # 故障转移\n # 查看节点\n $ redis-cli -h 172.30.0.102 -p 6379 -c\n172.30.0.102:6379> cluster nodes\nfc92b4b941bc55edc638b3ed5570c77649f11124 172.30.0.109:6379@16379 slave 4544c27547b8392cbd5b2e7afcb80c0066d37e9f 0 1733492320000 3 connected\nbce31769a218d92d5a3735458e6e479759bdd500 172.30.0.105:6379@16379 slave 9922b4fb888f86437a10912ed4505f86277b6c2e 0 1733492319548 1 connected\n4544c27547b8392cbd5b2e7afcb80c0066d37e9f 172.30.0.103:6379@16379 master - 0 1733492320553 3 connected 10923-16383\n9922b4fb888f86437a10912ed4505f86277b6c2e 172.30.0.101:6379@16379 master - 0 1733492319548 1 connected 0-5460\nbc2a17498f1c88f2d827638625e3b998b5d36abf 172.30.0.108:6379@16379 slave e42760e10502691aa9e9791a103ac77cb707c070 0 1733492319950 2 connected\ne42760e10502691aa9e9791a103ac77cb707c070 172.30.0.102:6379@16379 myself,master - 0 0 2 connected 5461-10922\n12992b85a92de26dd849f1abf012ad674da733e4 172.30.0.104:6379@16379 slave 4544c27547b8392cbd5b2e7afcb80c0066d37e9f 0 1733492319000 3 connected\n0903a2928d09168fa3cc2f4f74c96fe926eef8ef 172.30.0.107:6379@16379 slave e42760e10502691aa9e9791a103ac77cb707c070 0 1733492320000 2 connected\n9cd6418590131bf0b6fa20c046ee9bbb06f56afe 172.30.0.106:6379@16379 slave 9922b4fb888f86437a10912ed4505f86277b6c2e 0 1733492319000 1 connected\n172.30.0.102:6379> exit\n\n# 手动停止\n$ docker stop redis1\nredis1\n\n # 观察节点\n $ redis-cli -h 172.30.0.102 -p 6379 -c\n172.30.0.102:6379> cluster nodes\nfc92b4b941bc55edc638b3ed5570c77649f11124 172.30.0.109:6379@16379 slave 4544c27547b8392cbd5b2e7afcb80c0066d37e9f 0 1733492469571 3 connected\nbce31769a218d92d5a3735458e6e479759bdd500 172.30.0.105:6379@16379 master - 0 1733492469000 10 connected 0-5460 # 原本是从节点的 172.30.0.105:6379 变为了主节点\n4544c27547b8392cbd5b2e7afcb80c0066d37e9f 172.30.0.103:6379@16379 master - 0 1733492468566 3 connected 10923-16383\n9922b4fb888f86437a10912ed4505f86277b6c2e 172.30.0.101:6379@16379 master,fail - 1733492324572 1733492322000 1 connected # 可以看到这一个主节点爆 fail 以及发生故障\nbc2a17498f1c88f2d827638625e3b998b5d36abf 172.30.0.108:6379@16379 slave e42760e10502691aa9e9791a103ac77cb707c070 0 1733492469000 2 connected\ne42760e10502691aa9e9791a103ac77cb707c070 172.30.0.102:6379@16379 myself,master - 0 0 2 connected 5461-10922\n12992b85a92de26dd849f1abf012ad674da733e4 172.30.0.104:6379@16379 slave 4544c27547b8392cbd5b2e7afcb80c0066d37e9f 0 1733492469571 3 connected\n0903a2928d09168fa3cc2f4f74c96fe926eef8ef 172.30.0.107:6379@16379 slave e42760e10502691aa9e9791a103ac77cb707c070 0 1733492469000 2 connected\n9cd6418590131bf0b6fa20c046ee9bbb06f56afe 172.30.0.106:6379@16379 slave bce31769a218d92d5a3735458e6e479759bdd500 0 1733492470073 10 connected\n172.30.0.102:6379> exit\n\n# 手动恢复\n$ docker start redis1\nredis1\n\n # 观察节点\n $ redis-cli -h 172.30.0.102 -p 6379 -c\n172.30.0.102:6379> cluster nodes\nfc92b4b941bc55edc638b3ed5570c77649f11124 172.30.0.109:6379@16379 slave 4544c27547b8392cbd5b2e7afcb80c0066d37e9f 0 1733492665569 3 connected\nbce31769a218d92d5a3735458e6e479759bdd500 172.30.0.105:6379@16379 master - 0 1733492665368 10 connected 0-5460 # 这个 172.30.0.105:6379 节点依旧是主节点\n4544c27547b8392cbd5b2e7afcb80c0066d37e9f 172.30.0.103:6379@16379 master - 0 1733492666000 3 connected 10923-16383\n9922b4fb888f86437a10912ed4505f86277b6c2e 172.30.0.101:6379@16379 slave bce31769a218d92d5a3735458e6e479759bdd500 0 1733492666573 10 connected # 172.30.0.101:6379 从原本的主节点变为了从节点\nbc2a17498f1c88f2d827638625e3b998b5d36abf 172.30.0.108:6379@16379 slave e42760e10502691aa9e9791a103ac77cb707c070 0 1733492666372 2 connected\ne42760e10502691aa9e9791a103ac77cb707c070 172.30.0.102:6379@16379 myself,master - 0 0 2 connected 5461-10922\n12992b85a92de26dd849f1abf012ad674da733e4 172.30.0.104:6379@16379 slave 4544c27547b8392cbd5b2e7afcb80c0066d37e9f 0 1733492666000 3 connected\n0903a2928d09168fa3cc2f4f74c96fe926eef8ef 172.30.0.107:6379@16379 slave e42760e10502691aa9e9791a103ac77cb707c070 0 1733492664866 2 connected\n9cd6418590131bf0b6fa20c046ee9bbb06f56afe 172.30.0.106:6379@16379 slave bce31769a218d92d5a3735458e6e479759bdd500 0 1733492665000 10 connected\n172.30.0.102:6379> exit\n\n```\n\n> [!IMPORTANT]\n>\n> 补充：另外，可以使用 `cluster failover` 进行集群恢复，例如上述的主节点因为故障变为从节点，可以使用这个指令继续恢复回主节点的位置，不过需要恢复谁就需要登陆谁进行恢复。\n>\n> ```shell\n> # 恢复集群\n> 172.30.0.101:6379> cluster failover\n> OK\n> 172.30.0.101:6379> cluster nodes\n> 9922b4fb888f86437a10912ed4505f86277b6c2e 172.30.0.101:6379@16379 myself,master - 0 0 11 connected 0-5460\n> 12992b85a92de26dd849f1abf012ad674da733e4 172.30.0.104:6379@16379 slave 4544c27547b8392cbd5b2e7afcb80c0066d37e9f 0 1733492921973 3 connected\n> bc2a17498f1c88f2d827638625e3b998b5d36abf 172.30.0.108:6379@16379 slave e42760e10502691aa9e9791a103ac77cb707c070 0 1733492920000 2 connected\n> bce31769a218d92d5a3735458e6e479759bdd500 172.30.0.105:6379@16379 slave 9922b4fb888f86437a10912ed4505f86277b6c2e 0 1733492919563 11 connected\n> e42760e10502691aa9e9791a103ac77cb707c070 172.30.0.102:6379@16379 master - 0 1733492921070 2 connected 5461-10922\n> 9cd6418590131bf0b6fa20c046ee9bbb06f56afe 172.30.0.106:6379@16379 slave 9922b4fb888f86437a10912ed4505f86277b6c2e 0 1733492921000 11 connected\n> 0903a2928d09168fa3cc2f4f74c96fe926eef8ef 172.30.0.107:6379@16379 slave e42760e10502691aa9e9791a103ac77cb707c070 0 1733492920000 2 connected\n> fc92b4b941bc55edc638b3ed5570c77649f11124 172.30.0.109:6379@16379 slave 4544c27547b8392cbd5b2e7afcb80c0066d37e9f 0 1733492920568 3 connected\n> 4544c27547b8392cbd5b2e7afcb80c0066d37e9f 172.30.0.103:6379@16379 master - 0 1733492920969 3 connected 10923-16383\n> 172.30.0.101:6379> exit\n> ```\n\n> [!IMPORTANT]\n>\n> 补充：故障判定处理流程。集群中的所有节点, 都会周期性的使用心跳包进行通信。\n>\n> 1. 节点 `A` 给 节点 `B` 发送 `ping` 包，`B` 就会给 `A` 返回一个 `pong` 包。`ping` 和 `pong` 除了 `message type` 属性之外，其他部分都是一样的，这里包含了集群的配置信息（该节点的 `id`，该节点从属于哪个分片，是主节点还是从节点，从属于谁，持有哪些 `slots` 的位图...）\n> 2. 每个节点每秒钟，都会给一些随机的节点发起 `ping` 包，而不是全发一遍。这样设定是为了避免在节点很多的时候，心跳包也非常多（比如有 `9` 个节点，如果全发，就是 `9 * 8 == 72` 组心跳了，而且这是按照 `N^2` 这样的级别增长的）\n> 3. 当节点 `A` 给节点 `B` 发起 `ping` 包，`B` 不能如期回应的时候，此时 `A` 就会尝试重置和 `B` 的 `tcp` 连接，看能否连接成功。如果仍然连接失败，`A` 就会把 `B` 设为 `PFAIL` 状态（相当于主观下线）\n> 4. `A` 判定 `B` 为 `PFAIL` 之后，会通过 `redis` 内置的 `Gossip` 协议，和其他节点进行沟通，向其他节点确认 `B` 的状态（每个节点都会维护一个自己的“下线列表”，由于视角不同，每个节点的下线列表也不一定相同）\n> 5. 此时 `A` 发现其他很多节点，也认为 `B` 为 `PFAIL`，并且数目超过总集群个数的一半，那么 `A` 就会把 `B` 标记成 `FAIL`（相当于客观下线），并且把这个消息同步给其他节点（其他节点收到之后，也会把 `B` 标记成 `FAIL`)\n> 6. 至此 `B` 就彻底被判定为故障节点了\n>\n> 另外，在 `Redis` 集群中，出现集群宕机（比主节点故障更加严重的情况）的情况通常是由以下三种情况引起的：\n>\n> - **某个分片的所有主节点和从节点都挂了**：如果一个分片的主节点和从节点都宕机，`Redis` 集群将无法处理该分片的数据请求，导致整个集群处于 `fail` 状态。\n> - **某个分片的主节点挂了，但没有从节点**：如果某个分片的主节点宕机，而该分片没有从节点，`Redis` 集群无法进行故障转移，导致该分片无法正常服务，进而可能导致集群 `fail`。\n> - **超过半数的主节点挂了**：如果集群中的主节点宕机超过一半，`Redis` 集群无法保证数据的完整性和可用性，这时集群会进入 `fail` 状态。\n\n> [!IMPORTANT]\n>\n> 补充：故障转移处理流程。\n>\n> 1. 故障判断：\n>    - **如果故障节点是从节点**：无需进行故障迁移，因为从节点只是备份数据，不会影响集群的整体功能。\n>    - **如果故障节点是主节点**：需要进行故障迁移，选举从节点中的一个作为新的主节点。\n> 2. 从节点资格判定：从节点首先要判断自己是否具备成为主节点的资格。如果从节点和主节点的通信已经中断太久，导致数据差异过大，超过了预定的阈值，则该从节点将失去竞选资格。\n> 3. 休眠时间：有资格的从节点（如 `C` 和 `D`）会先进行短暂的休眠，休眠时间为“基础时间`500ms` + 随机时间：`[0, 500ms]` + 排名时间（根据节点的排名，越靠前的节点休眠时间越短，排名越靠后的节点休眠时间越长，`排名 * 1000ms`）”\n> 4. 投票阶段：如 `C` 休眠结束后，`C` 会向集群中的所有节点发起拉票操作，并且只有主节点有投票资格。每个主节点只能投一票，投票给其认为最合适的从节点。`C` 需要获得集群中超过一半的主节点的支持票，才能晋升为主节点。\n> 5. 提升为主节点：一旦 `C` 获得超过一半的主节点投票，它就会被晋升为主节点。`C` 会执行 `slaveof no one` 来成为独立的主节点，同时让 `D` 成为 `C` 的从节点（`slaveof C`）。\n> 6. 更新集群信息：`C` 会将自己晋升为主节点的消息同步给其他节点，其他节点会更新自己的集群结构信息，确保集群中各节点的信息一致。\n>\n> 这个过程更加细致，也就是之前提到过的著名选举算法，`Raft` 算法。\n\n### 2.5.扩容集群\n\n接下来需要把 `redis10` 和 `redis11` 也加入到集群中，应该怎么做呢？很简单，我们之前使用 `redis-cli --cluster create <节点列表>` 创建集群，就可以使用 `redis-cli --cluster add-node <单个节点> <集群中任意节点地址>` 来添加新的节点（默认）。\n\n```shell\n# 扩容集群\nredis-cli --cluster add-node 172.30.0.110:6379 172.30.0.101:6379\n>>> Adding node 172.30.0.110:6379 to cluster 172.30.0.101:6379\n>>> Performing Cluster Check (using node 172.30.0.101:6379)\nM: 9922b4fb888f86437a10912ed4505f86277b6c2e 172.30.0.101:6379\n   slots:[0-5460] (5461 slots) master\n   2 additional replica(s)\nS: 12992b85a92de26dd849f1abf012ad674da733e4 172.30.0.104:6379\n   slots: (0 slots) slave\n   replicates 4544c27547b8392cbd5b2e7afcb80c0066d37e9f\nS: bc2a17498f1c88f2d827638625e3b998b5d36abf 172.30.0.108:6379\n   slots: (0 slots) slave\n   replicates e42760e10502691aa9e9791a103ac77cb707c070\nS: bce31769a218d92d5a3735458e6e479759bdd500 172.30.0.105:6379\n   slots: (0 slots) slave\n   replicates 9922b4fb888f86437a10912ed4505f86277b6c2e\nM: e42760e10502691aa9e9791a103ac77cb707c070 172.30.0.102:6379\n   slots:[5461-10922] (5462 slots) master\n   2 additional replica(s)\nS: 9cd6418590131bf0b6fa20c046ee9bbb06f56afe 172.30.0.106:6379\n   slots: (0 slots) slave\n   replicates 9922b4fb888f86437a10912ed4505f86277b6c2e\nS: 0903a2928d09168fa3cc2f4f74c96fe926eef8ef 172.30.0.107:6379\n   slots: (0 slots) slave\n   replicates e42760e10502691aa9e9791a103ac77cb707c070\nS: fc92b4b941bc55edc638b3ed5570c77649f11124 172.30.0.109:6379\n   slots: (0 slots) slave\n   replicates 4544c27547b8392cbd5b2e7afcb80c0066d37e9f\nM: 4544c27547b8392cbd5b2e7afcb80c0066d37e9f 172.30.0.103:6379\n   slots:[10923-16383] (5461 slots) master\n   2 additional replica(s)\n[OK] All nodes agree about slots configuration.\n>>> Check for open slots...\n>>> Check slots coverage...\n[OK] All 16384 slots covered.\n>>> Getting functions from cluster\n>>> Send FUNCTION LIST to 172.30.0.110:6379 to verify there is no functions in it\n>>> Send FUNCTION RESTORE to 172.30.0.110:6379\n>>> Send CLUSTER MEET to node 172.30.0.110:6379 to make it join the cluster.\n[OK] New node added correctly.\n\n# 然后进入集群查看主从关系\n $ redis-cli -h 172.30.0.101 -p 6379 -c\n172.30.0.101:6379> cluster nodes\n5863ebe5623e98c9f405b9da099d0e75990aebce 172.30.0.110:6379@16379 master - 0 1733494939225 0 connected # 可以看到 172.30.0.110:6379 成为了集群中新的主节点\n9922b4fb888f86437a10912ed4505f86277b6c2e 172.30.0.101:6379@16379 myself,master - 0 0 11 connected 0-5460\n12992b85a92de26dd849f1abf012ad674da733e4 172.30.0.104:6379@16379 slave 4544c27547b8392cbd5b2e7afcb80c0066d37e9f 0 1733494938000 3 connected\nbc2a17498f1c88f2d827638625e3b998b5d36abf 172.30.0.108:6379@16379 slave e42760e10502691aa9e9791a103ac77cb707c070 0 1733494939023 2 connected\nbce31769a218d92d5a3735458e6e479759bdd500 172.30.0.105:6379@16379 slave 9922b4fb888f86437a10912ed4505f86277b6c2e 0 1733494938522 11 connected\ne42760e10502691aa9e9791a103ac77cb707c070 172.30.0.102:6379@16379 master - 0 1733494938522 2 connected 5461-10922\n9cd6418590131bf0b6fa20c046ee9bbb06f56afe 172.30.0.106:6379@16379 slave 9922b4fb888f86437a10912ed4505f86277b6c2e 0 1733494938000 11 connected\n0903a2928d09168fa3cc2f4f74c96fe926eef8ef 172.30.0.107:6379@16379 slave e42760e10502691aa9e9791a103ac77cb707c070 0 1733494939000 2 connected\nfc92b4b941bc55edc638b3ed5570c77649f11124 172.30.0.109:6379@16379 slave 4544c27547b8392cbd5b2e7afcb80c0066d37e9f 0 1733494938722 3 connected\n4544c27547b8392cbd5b2e7afcb80c0066d37e9f 172.30.0.103:6379@16379 master - 0 1733494939727 3 connected 10923-16383\n# 不过虽然节点已经成功加入集群, 但是新的节点并不会自动接管已有的槽(slots), 除非明确执行了槽迁移操作\n172.30.0.101:6379> exit\n\n# 进行槽迁移操作\n$ redis-cli --cluster reshard 172.30.0.101:6379 # 只需要任意集群中的节点即可完成槽迁移操作\n>>> Performing Cluster Check (using node 172.30.0.101:6379) # 注意下面生成的信息, 里面的节点携带有 id 信息的存在, 后面用得到\nM: 9922b4fb888f86437a10912ed4505f86277b6c2e 172.30.0.101:6379\n   slots:[0-5460] (5461 slots) master\n   2 additional replica(s)\nM: 5863ebe5623e98c9f405b9da099d0e75990aebce 172.30.0.110:6379\n   slots: (0 slots) master\nS: 12992b85a92de26dd849f1abf012ad674da733e4 172.30.0.104:6379\n   slots: (0 slots) slave\n   replicates 4544c27547b8392cbd5b2e7afcb80c0066d37e9f\nS: bc2a17498f1c88f2d827638625e3b998b5d36abf 172.30.0.108:6379\n   slots: (0 slots) slave\n   replicates e42760e10502691aa9e9791a103ac77cb707c070\nS: bce31769a218d92d5a3735458e6e479759bdd500 172.30.0.105:6379\n   slots: (0 slots) slave\n   replicates 9922b4fb888f86437a10912ed4505f86277b6c2e\nM: e42760e10502691aa9e9791a103ac77cb707c070 172.30.0.102:6379\n   slots:[5461-10922] (5462 slots) master\n   2 additional replica(s)\nS: 9cd6418590131bf0b6fa20c046ee9bbb06f56afe 172.30.0.106:6379\n   slots: (0 slots) slave\n   replicates 9922b4fb888f86437a10912ed4505f86277b6c2e\nS: 0903a2928d09168fa3cc2f4f74c96fe926eef8ef 172.30.0.107:6379\n   slots: (0 slots) slave\n   replicates e42760e10502691aa9e9791a103ac77cb707c070\nS: fc92b4b941bc55edc638b3ed5570c77649f11124 172.30.0.109:6379\n   slots: (0 slots) slave\n   replicates 4544c27547b8392cbd5b2e7afcb80c0066d37e9f\nM: 4544c27547b8392cbd5b2e7afcb80c0066d37e9f 172.30.0.103:6379\n   slots:[10923-16383] (5461 slots) master\n   2 additional replica(s)\n[OK] All nodes agree about slots configuration.\n>>> Check for open slots...\n>>> Check slots coverage...\n[OK] All 16384 slots covered.\nHow many slots do you want to move (from 1 to 16384)? 4096 # 填入需要新加入集群主节点分配到的槽个数\n# 其实这里的目标是让所有主节点平均分配 slots, 计算方式如下：\n# 总 slots 数量 = 16384\n# 当前主节点数量 = 4\n# 每个节点理想的 slots 数量 = 16384 / 4 = 4096\nWhat is the receiving node ID? 5863ebe5623e98c9f405b9da099d0e75990aebce # 填入新加入节点的 ID, 注意不是 IP:PORT\nPlease enter all the source node IDs.\n  Type 'all' to use all the nodes as source nodes for the hash slots.\n  Type 'done' once you entered all the source nodes IDs.\nSource node #1: all # 填入某个节点的 ID, 就会从某个节点迁移槽给新增加的主节点, 如果填入 all 就把所有现有主节点的槽都均衡迁移到新增加的主节点中\n\nReady to move 4096 slots.\n  Source nodes:\n    M: 9922b4fb888f86437a10912ed4505f86277b6c2e 172.30.0.101:6379\n       slots:[0-5460] (5461 slots) master\n       2 additional replica(s)\n    M: e42760e10502691aa9e9791a103ac77cb707c070 172.30.0.102:6379\n       slots:[5461-10922] (5462 slots) master\n       2 additional replica(s)\n    M: 4544c27547b8392cbd5b2e7afcb80c0066d37e9f 172.30.0.103:6379\n       slots:[10923-16383] (5461 slots) master\n       2 additional replica(s)\n  Destination node:\n    M: 5863ebe5623e98c9f405b9da099d0e75990aebce 172.30.0.110:6379\n       slots: (0 slots) master\n  Resharding plan:\n    Moving slot 5461 from e42760e10502691aa9e9791a103ac77cb707c070\n# (省略)...\n\n```\n\n> [!IMPORTANT]\n>\n> 补充：假设您的 `Redis` 集群中有 `3` 个主节点，它们的 `slots` 分配如下：\n>\n> - **节点 A**：`0-5460` (共 `5461` 个 `slots`)\n> - **节点 B**：`5461-10922` (共 `5462` 个 `slots`)\n> - **节点 C**：`10923-16383` (共 `5461` 个 `slots`)\n>\n> 新增一个节点 `D`，您想迁移 `4096` 个 `slots` 给它，并选择 `all`，那么`Redis` 会按比例从节点 `A、B、C` 中迁移 `slots`：\n>\n> - **节点 A**：迁移约 `1365` 个 `slots`\n> - **节点 B**：迁移约 `1366` 个 `slots`\n> - **节点 C**：迁移约 `1365` 个 `slots`\n>\n> 最终，节点 `A、B、C` 的 `slots` 数量会减少，负载下降，新节点 `D` 接管迁移过来的 `4096` 个 `slots`，开始分担存储和请求。而如果不选择 `all`，明确指定了某个主节点（如节点 `A`），那么 `Redis` 只会从该节点迁移 `slots` 到新节点 `D`，这样会导致：\n>\n> - 节点 `A` 的负载迅速减轻，但其他节点的负载保持不变\n> - 整体负载分布可能变得不均匀，不利于集群性能\n\n> [!IMPORTANT]\n>\n> 补充：迁移槽管理的过程中也伴随着键值对的迁移，之后就会进行集群的 `key` 搬运工作，这个过程涉及到数据搬运，可能需要消耗一定的时间，并且期间不影响新键值对的写入和读出；也不影响不需要迁移的键值对进行正常的读写；但需要迁移的键值对会发生短暂的错误，只有等待一段时间才会恢复（不过我还没有测试过，待补充...）。\n\n加入新的主节点时，扩容的目标已经初步达成，但为了保证集群高可用性，还需要给这个新的主节点添加从节点，保证该主节点宕机之后，有从节点可以进行故障转移。\n\n```shell\n# 提高可用\n# 添加从节点\nredis-cli --cluster add-node \\\n 172.30.0.111:6379 \\ # 要添加的节点\n 172.30.0.101:6379 \\ # 集群中存在的任意节点\n --cluster-slave \\ # 表示将新节点加入为从节点\n--cluster-master-id 5863ebe5623e98c9f405b9da099d0e75990aebce # 指定该从节点的主节点的节点 ID\n# 完整指令为 redis-cli --cluster add-node 172.30.0.111:6379 172.30.0.101:6379 --cluster-slave --cluster-master-id 5863ebe5623e98c9f405b9da099d0e75990aebce\n>>> Adding node 172.30.0.111:6379 to cluster 172.30.0.101:6379\n>>> Performing Cluster Check (using node 172.30.0.101:6379)\nM: 9922b4fb888f86437a10912ed4505f86277b6c2e 172.30.0.101:6379\n   slots:[1365-5460] (4096 slots) master\n   2 additional replica(s)\nM: 5863ebe5623e98c9f405b9da099d0e75990aebce 172.30.0.110:6379\n   slots:[0-1364],[5461-6826],[10923-12287] (4096 slots) master\n   1 additional replica(s)\nS: 12992b85a92de26dd849f1abf012ad674da733e4 172.30.0.104:6379\n   slots: (0 slots) slave\n   replicates 4544c27547b8392cbd5b2e7afcb80c0066d37e9f\nS: bc2a17498f1c88f2d827638625e3b998b5d36abf 172.30.0.108:6379\n   slots: (0 slots) slave\n   replicates e42760e10502691aa9e9791a103ac77cb707c070\nS: bce31769a218d92d5a3735458e6e479759bdd500 172.30.0.105:6379\n   slots: (0 slots) slave\n   replicates 9922b4fb888f86437a10912ed4505f86277b6c2e\nM: e42760e10502691aa9e9791a103ac77cb707c070 172.30.0.102:6379\n   slots:[6827-10922] (4096 slots) master\n   1 additional replica(s)\nS: 9cd6418590131bf0b6fa20c046ee9bbb06f56afe 172.30.0.106:6379\n   slots: (0 slots) slave\n   replicates 9922b4fb888f86437a10912ed4505f86277b6c2e\nS: 0903a2928d09168fa3cc2f4f74c96fe926eef8ef 172.30.0.107:6379\n   slots: (0 slots) slave\n   replicates 5863ebe5623e98c9f405b9da099d0e75990aebce\nS: fc92b4b941bc55edc638b3ed5570c77649f11124 172.30.0.109:6379\n   slots: (0 slots) slave\n   replicates 4544c27547b8392cbd5b2e7afcb80c0066d37e9f\nM: 4544c27547b8392cbd5b2e7afcb80c0066d37e9f 172.30.0.103:6379\n   slots:[12288-16383] (4096 slots) master\n   2 additional replica(s)\n[OK] All nodes agree about slots configuration.\n>>> Check for open slots...\n>>> Check slots coverage...\n[OK] All 16384 slots covered.\n>>> Send CLUSTER MEET to node 172.30.0.111:6379 to make it join the cluster.\nWaiting for the cluster to join\n\n>>> Configure node as replica of 172.30.0.110:6379.\n[OK] New node added correctly.\n\n# 查看新的主从结构\n redis-cli -h 172.30.0.101 -p 6379 -c\n172.30.0.101:6379> cluster nodes\n5863ebe5623e98c9f405b9da099d0e75990aebce 172.30.0.110:6379@16379 master - 0 1733501266902 12 connected 0-1364 5461-6826 10923-12287\n9922b4fb888f86437a10912ed4505f86277b6c2e 172.30.0.101:6379@16379 myself,master - 0 0 11 connected 1365-5460\n12992b85a92de26dd849f1abf012ad674da733e4 172.30.0.104:6379@16379 slave 4544c27547b8392cbd5b2e7afcb80c0066d37e9f 0 1733501265898 3 connected\nbc2a17498f1c88f2d827638625e3b998b5d36abf 172.30.0.108:6379@16379 slave e42760e10502691aa9e9791a103ac77cb707c070 0 1733501265000 2 connected\nbce31769a218d92d5a3735458e6e479759bdd500 172.30.0.105:6379@16379 slave 9922b4fb888f86437a10912ed4505f86277b6c2e 0 1733501265597 11 connected\ne42760e10502691aa9e9791a103ac77cb707c070 172.30.0.102:6379@16379 master - 0 1733501266501 2 connected 6827-10922\n9cd6418590131bf0b6fa20c046ee9bbb06f56afe 172.30.0.106:6379@16379 slave 9922b4fb888f86437a10912ed4505f86277b6c2e 0 1733501266501 11 connected\n0903a2928d09168fa3cc2f4f74c96fe926eef8ef 172.30.0.107:6379@16379 slave 5863ebe5623e98c9f405b9da099d0e75990aebce 0 1733501266501 12 connected\nfc92b4b941bc55edc638b3ed5570c77649f11124 172.30.0.109:6379@16379 slave 4544c27547b8392cbd5b2e7afcb80c0066d37e9f 0 1733501266000 3 connected\n8cbe43de958f2564d95d0d5da51cab654b861036 172.30.0.111:6379@16379 slave 5863ebe5623e98c9f405b9da099d0e75990aebce 0 1733501265000 12 connected # 果然成为了  172.30.0.110:6379 的从节点\n4544c27547b8392cbd5b2e7afcb80c0066d37e9f 172.30.0.103:6379@16379 master - 0 1733501265597 3 connected 12288-16383\n172.30.0.101:6379> exit\n\n```\n\n### 2.6.缩容集群\n\n缩容的操作一般比较少见，但是也不是没有，简单演示一下您就明白怎么操作了，假设我们需要把刚刚加入的主从节点剔除（也就是 `172.30.0.110:6379` 和 ` 172.30.0.111:6379`，节点 `ID` 分别为 `5863ebe5623e98c9f405b9da099d0e75990aebce` 和 `8cbe43de958f2564d95d0d5da51cab654b861036`）。\n\n```shell\n # 缩容集群\n # 删除从节点\n $ redis-cli \n--cluster \\ # 表示集群操作 \ndel-node \\ # 表示要删除节点\n172.30.0.110:6379 \\ # 集群中任意一个节点\n8cbe43de958f2564d95d0d5da51cab654b861036 # 要删除的节点 ID\n# 完整指令为 redis-cli --cluster del-node 172.30.0.110:6379 8cbe43de958f2564d95d0d5da51cab654b861036\n>>> Removing node 8cbe43de958f2564d95d0d5da51cab654b861036 from cluster 172.30.0.110:6379\n>>> Sending CLUSTER FORGET messages to the cluster...\n>>> Sending CLUSTER RESET SOFT to the deleted node.\n\n# 删除主节点\n# 重新分配槽, 把 172.30.0.110:6379 这个待删除的主节点去除前, 需要把其占有的槽均分给其他主节点(大概均分即可, 从需要移除的节点中迁移 1365、1365、1366 到三个主节点)\n$ redis-cli --cluster reshard 172.30.0.101:6379 # 把要剔除的  172.30.0.110:6379 中的 1365 个槽迁移给 172.30.0.101:6379\n>>> Performing Cluster Check (using node 172.30.0.101:6379)\nM: 9922b4fb888f86437a10912ed4505f86277b6c2e 172.30.0.101:6379\n   slots:[1365-5460] (4096 slots) master\n   2 additional replica(s)\nM: 5863ebe5623e98c9f405b9da099d0e75990aebce 172.30.0.110:6379\n   slots:[0-1364],[5461-6826],[10923-12287] (4096 slots) master\n   1 additional replica(s)\nS: 12992b85a92de26dd849f1abf012ad674da733e4 172.30.0.104:6379\n   slots: (0 slots) slave\n   replicates 4544c27547b8392cbd5b2e7afcb80c0066d37e9f\nS: bc2a17498f1c88f2d827638625e3b998b5d36abf 172.30.0.108:6379\n   slots: (0 slots) slave\n   replicates e42760e10502691aa9e9791a103ac77cb707c070\nS: bce31769a218d92d5a3735458e6e479759bdd500 172.30.0.105:6379\n   slots: (0 slots) slave\n   replicates 9922b4fb888f86437a10912ed4505f86277b6c2e\nM: e42760e10502691aa9e9791a103ac77cb707c070 172.30.0.102:6379\n   slots:[6827-10922] (4096 slots) master\n   1 additional replica(s)\nS: 9cd6418590131bf0b6fa20c046ee9bbb06f56afe 172.30.0.106:6379\n   slots: (0 slots) slave\n   replicates 9922b4fb888f86437a10912ed4505f86277b6c2e\nS: 0903a2928d09168fa3cc2f4f74c96fe926eef8ef 172.30.0.107:6379\n   slots: (0 slots) slave\n   replicates 5863ebe5623e98c9f405b9da099d0e75990aebce\nS: fc92b4b941bc55edc638b3ed5570c77649f11124 172.30.0.109:6379\n   slots: (0 slots) slave\n   replicates 4544c27547b8392cbd5b2e7afcb80c0066d37e9f\nM: 4544c27547b8392cbd5b2e7afcb80c0066d37e9f 172.30.0.103:6379\n   slots:[12288-16383] (4096 slots) master\n   2 additional replica(s)\n[OK] All nodes agree about slots configuration.\n>>> Check for open slots...\n>>> Check slots coverage...\n[OK] All 16384 slots covered.\nHow many slots do you want to move (from 1 to 16384)? 1365\nWhat is the receiving node ID? 9922b4fb888f86437a10912ed4505f86277b6c2e\nPlease enter all the source node IDs.\n  Type 'all' to use all the nodes as source nodes for the hash slots.\n  Type 'done' once you entered all the source nodes IDs.\nSource node #1: 5863ebe5623e98c9f405b9da099d0e75990aebce\nSource node #2: done\n# (省略)...\n\n$ redis-cli --cluster reshard 172.30.0.101:6379 # 把要剔除的  172.30.0.110:6379 中的 1365 个槽迁移给 172.30.0.102:6379\n# (省略)...\n\n$ redis-cli --cluster reshard 172.30.0.101:6379 # 把要剔除的  172.30.0.110:6379 中的 1366 个槽迁移给 172.30.0.103:6379\n# (省略)...\n\n# 这里我还观察到此时的 172.30.0.110:6379 自动变为了 172.30.0.103 的从节点, Redis 版本不同可能结果也不同(可能还是主节点, 只不过不持有槽而已, 您可以试一试)\n\n# 删除“主”节点\n$ redis-cli --cluster del-node 172.30.0.101:6379 5863ebe5623e98c9f405b9da099d0e75990aebce \n>>> Removing node 5863ebe5623e98c9f405b9da099d0e75990aebce from cluster 172.30.0.101:6379\n>>> Sending CLUSTER FORGET messages to the cluster...\n>>> Sending CLUSTER RESET SOFT to the deleted node.\n\n# 重新查看集群中的主从结构\n$ redis-cli -h 172.30.0.101 -p 6379 -c\n172.30.0.101:6379> cluster nodes\n9922b4fb888f86437a10912ed4505f86277b6c2e 172.30.0.101:6379@16379 myself,master - 0 0 13 connected 0-5460\n12992b85a92de26dd849f1abf012ad674da733e4 172.30.0.104:6379@16379 slave 4544c27547b8392cbd5b2e7afcb80c0066d37e9f 0 1733503694213 15 connected\nbc2a17498f1c88f2d827638625e3b998b5d36abf 172.30.0.108:6379@16379 slave e42760e10502691aa9e9791a103ac77cb707c070 0 1733503694514 14 connected\nbce31769a218d92d5a3735458e6e479759bdd500 172.30.0.105:6379@16379 slave 9922b4fb888f86437a10912ed4505f86277b6c2e 0 1733503696221 13 connected\ne42760e10502691aa9e9791a103ac77cb707c070 172.30.0.102:6379@16379 master - 0 1733503696523 14 connected 5461-6825 6827-10922\n9cd6418590131bf0b6fa20c046ee9bbb06f56afe 172.30.0.106:6379@16379 slave 9922b4fb888f86437a10912ed4505f86277b6c2e 0 1733503696121 13 connected\n0903a2928d09168fa3cc2f4f74c96fe926eef8ef 172.30.0.107:6379@16379 slave 4544c27547b8392cbd5b2e7afcb80c0066d37e9f 0 1733503695000 15 connected\nfc92b4b941bc55edc638b3ed5570c77649f11124 172.30.0.109:6379@16379 slave 4544c27547b8392cbd5b2e7afcb80c0066d37e9f 0 1733503695518 15 connected\n4544c27547b8392cbd5b2e7afcb80c0066d37e9f 172.30.0.103:6379@16379 master - 0 1733503695217 15 connected 6826 10923-16383\n172.30.0.101:6379> exit\n\n```\n## 3.Redis 常见的问题\n\n### 3.1.缓存雪崩\n\n- 随机缓存过期时间：采用不同的缓存过期时间。\n- 采用缓存预热：当大量缓存失效时，数据库压力激增。特别是热点数据突然被请求，数据库直接崩溃，应该提前将热点数据加载到缓存。\n- 采用缓存更新策略：写入数据库时更新缓存时间。\n- 引入消息队列组件：削峰填谷请求。\n- 集群相互监督：","excerpt":"","includedFiles":[],"tasklistId":0,"title":"","headers":[{"level":2,"title":"1.Redis 读分离架构/高可用架构","slug":"_1-redis-读分离架构-高可用架构","link":"#_1-redis-读分离架构-高可用架构","children":[{"level":3,"title":"1.1.架构原理","slug":"_1-1-架构原理","link":"#_1-1-架构原理","children":[]},{"level":3,"title":"1.2.数据节点","slug":"_1-2-数据节点","link":"#_1-2-数据节点","children":[]},{"level":3,"title":"1.3.哨兵节点","slug":"_1-3-哨兵节点","link":"#_1-3-哨兵节点","children":[]}]},{"level":2,"title":"2.Redis 写分离架构/多分片架构","slug":"_2-redis-写分离架构-多分片架构","link":"#_2-redis-写分离架构-多分片架构","children":[{"level":3,"title":"2.1.架构原理","slug":"_2-1-架构原理","link":"#_2-1-架构原理","children":[]},{"level":3,"title":"2.2.分片算法","slug":"_2-2-分片算法","link":"#_2-2-分片算法","children":[]},{"level":3,"title":"2.3.搭建集群","slug":"_2-3-搭建集群","link":"#_2-3-搭建集群","children":[]},{"level":3,"title":"2.4.故障转移","slug":"_2-4-故障转移","link":"#_2-4-故障转移","children":[]},{"level":3,"title":"2.5.扩容集群","slug":"_2-5-扩容集群","link":"#_2-5-扩容集群","children":[]},{"level":3,"title":"2.6.缩容集群","slug":"_2-6-缩容集群","link":"#_2-6-缩容集群","children":[]}]},{"level":2,"title":"3.Redis 常见的问题","slug":"_3-redis-常见的问题","link":"#_3-redis-常见的问题","children":[{"level":3,"title":"3.1.缓存雪崩","slug":"_3-1-缓存雪崩","link":"#_3-1-缓存雪崩","children":[]}]}]}}
