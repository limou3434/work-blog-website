{"content":"<h1 id=\"_1-frp-的安装运行\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-frp-的安装运行\"><span>1.frp 的安装运行</span></a></h1>\n<p><a href=\"https://gofrp.org/zh-cn/docs/setup/\" target=\"_blank\" rel=\"noopener noreferrer\">直接去 frp 官网获取其对应的二进制文件即可</a>，而这里我以 <code v-pre>Ubuntu</code> 为例子，使用 <code v-pre>wget</code> 进行安装，并且只在 <code v-pre>Ubuntu</code> 的具有公网 <code v-pre>ip</code> 的机器上尝试运行。</p>\n<div class=\"hint-container caution\">\n<p class=\"hint-container-title\">警告</p>\n<p>警告：我们这里只是尝试运行，不代表真正应用 <code v-pre>frp</code>，因此下载好 <code v-pre>frp</code> 后，配置文件我暂时不修改，只是做个解读。</p>\n</div>\n<div class=\"hint-container caution\">\n<p class=\"hint-container-title\">警告</p>\n<p>警告：整个下载配置运行的过程，我都在具有公网 <code v-pre>IP</code> 服务器上进行了配置。</p>\n</div>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 安装 frp</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 下载 frp 的二进制文件压缩包</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> wget</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> https://github.com/fatedier/frp/releases/download/v0.60.0/frp_0.60.0_linux_amd64.tar.gz</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 解压 frp 的压缩包</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> tar</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -zxvf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frp_0.60.0_linux_amd64.tar.gz</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 重命名解压文件夹</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> mv</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frp_0.60.0_linux_amd64</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frp</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 打开解压文件夹</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cd</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frp</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看当前目录下的文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ls</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">frpc</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  frpc.toml</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  frps</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  frps.toml</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  LICENSE</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看 frp</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看当前服务端程序的配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frps.toml</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 不过我们先按照默认的即可, 我们只在本地稍微测试一下就行</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bindPort</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 7000</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # frp 服务端程序在公网服务器中运行时所在的端口</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看当前客户端程序的配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frpc.toml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">serverAddr</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">127.0.0.1</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 后续要改为公网服务器的公网 ip(后面是一定要修改的)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">serverPort</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 7000</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 就是前面的端口, 客户端通过 serverAddr+serverPort 才能找到公网机器中的 frp 服务端程序(因此要和前面 frps.toml 中的 bindPort 保持同步)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">proxies</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]]</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # proxies 就是代理的意思</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">name</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">test-tcp</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 客户端名称(可选修改)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">type</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">tcp</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 采用的代理协议(没有特殊需求无需修改)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">localIP</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">127.0.0.1</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 转发到这个 ip</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">localPort</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 22</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 转发到这个 port</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">remotePort</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6000</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 公网机器上对外开放的端口, 用于支持外界穿透到内网(这样其他非内网主机就可以把对 \"公网ip+remotePort\" 的请求转发到 \"localIP+localPort\" 上进行处理)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 运行 frp</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ./frps</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -c</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ./frps.toml</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 使用以下命令启动服务端程序</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> 558528</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">2024-09-09</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 00:18:12.920</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [I] </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">frps/root.go:105</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> frps uses config file: ./frps.toml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">2024-09-09</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 00:18:13.171</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [I] </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">server/service.go:237</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> frps tcp listen on 0.0.0.0:7000</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">2024-09-09</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 00:18:13.172</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [I] </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">frps/root.go:114</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> frps started successfully</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ./frpc</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -c</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ./frpc.toml</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 使用以下命令启动客户端程序</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">2024-09-09</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 00:21:01.337</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [I] </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sub/root.go:142</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> start frpc service </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> config file </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">./frpc.toml</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">2024-09-09</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 00:21:01.337</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [I] </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">client/service.go:295</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> try to connect to server...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">2024-09-09</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 00:21:01.342</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [I] </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">server/service.go:576</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> [</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">42307efebbdeb377</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> client login info: ip </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">127.0.0.1:48018</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> version </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">0.60.0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> hostname </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> os </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">linux</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> arch </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">amd64</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">2024-09-09</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 00:21:01.342</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [I] </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">client/service.go:287</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> [</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">42307efebbdeb377</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> login to server success, get run id </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">42307efebbdeb377</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">2024-09-09</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 00:21:01.342</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [I] </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">proxy/proxy_manager.go:173</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> [</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">42307efebbdeb377</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> proxy added: </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">test-tcp</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">2024-09-09</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 00:21:01.343</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [I] </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">proxy/tcp.go:82</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> [</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">42307efebbdeb377</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> [</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">test-tcp</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> tcp proxy listen port </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">6000</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">2024-09-09</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 00:21:01.343</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [I] </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">server/control.go:399</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> [</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">42307efebbdeb377</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> new proxy </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">test-tcp</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> type </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">tcp</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> success</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">2024-09-09</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 00:21:01.343</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [I] </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">client/control.go:168</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> [</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">42307efebbdeb377</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> [</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">test-tcp</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> start proxy success</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>可以看到没有什么明显的报错，这代表我们安装成功了。</p>\n<h1 id=\"_2-frp-的工作原理\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-frp-的工作原理\"><span>2.frp 的工作原理</span></a></h1>\n<p><code v-pre>frp</code> 主要由两个组件组成：<code v-pre>客户端(frpc)</code> 和 <code v-pre>服务端(frps)</code>。通常情况下，服务端部署在具有公网 <code v-pre>IP</code> 地址的机器上，而客户端部署在需要穿透的内网服务所在的机器上。</p>\n<p>由于内网服务缺乏公网 <code v-pre>IP</code> 地址，因此无法直接被非局域网内的用户访问。用户通过访问服务端的 <code v-pre>frps</code>，<code v-pre>frp</code> 负责根据请求的端口或其他信息将请求路由到相应的内网机器，从而实现从局域网外的计算机向局域网进行通信。</p>\n<p>在 <code v-pre>frp</code> 中，一个代理对应一个需要公开访问的内网服务。一个客户端可以同时配置多个代理，以满足不同的需求。</p>\n<p><code v-pre>frp</code> 支持多种代理类型，以适应不同的使用场景。以下是一些常见的代理类型：</p>\n<ul>\n<li><strong>TCP</strong>：提供纯粹的 <code v-pre>TCP</code> 端口映射，使服务端能够根据不同的端口将请求路由到不同的内网服务</li>\n<li><strong>UDP</strong>：提供纯粹的 <code v-pre>UDP</code> 端口映射，与 <code v-pre>TCP</code> 代理类似，但用于 <code v-pre>UDP</code> 流量</li>\n<li><strong>HTTP</strong>：专为 <code v-pre>HTTP</code> 应用设计，支持修改 <code v-pre>Host Header</code> 和增加鉴权等额外功能</li>\n<li><strong>HTTPS</strong>：类似于 <code v-pre>HTTP</code> 代理，但专门用于处理 <code v-pre>HTTPS</code> 流量</li>\n<li><strong>STCP</strong>：提供安全的 <code v-pre>TCP</code> 内网代理，要求在被访问者和访问者的机器上都部署 <code v-pre>frpc</code>，不需要在服务端暴露端口</li>\n<li><strong>SUDP</strong>：提供安全的 <code v-pre>UDP</code> 内网代理，与 <code v-pre>STCP</code> 类似，需要在被访问者和访问者的机器上都部署 <code v-pre>frpc</code>，不需要在服务端暴露端口</li>\n<li><strong>XTCP</strong>：点对点内网穿透代理，与 <code v-pre>STCP</code> 类似，但流量不需要经过服务器中转</li>\n<li><strong>TCPMUX</strong>：支持服务端 <code v-pre>TCP</code> 端口的多路复用，允许通过同一端口访问不同的内网服务</li>\n</ul>\n<p>每种代理类型适用于不同的使用情境，您可以根据需求选择合适的代理类型来配置 <code v-pre>frp</code>，这里我尽可能追寻默认。</p>\n<h1 id=\"_3-frp-的实践过程\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-frp-的实践过程\"><span>3.frp 的实践过程</span></a></h1>\n<h2 id=\"_3-1-代理单个-ssh-服务访问一台内网机器\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-1-代理单个-ssh-服务访问一台内网机器\"><span>3.1.代理单个 ssh 服务访问一台内网机器</span></a></h2>\n<h3 id=\"_3-1-1-准备环境\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-1-1-准备环境\"><span>3.1.1.准备环境</span></a></h3>\n<div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>注意：当然，前提是内网机器已经部署了 <code v-pre>ssh</code> 连接，否则后面都是空谈...</p>\n</div>\n<p>首先需要准备三台机器，我这里以及有：</p>\n<ul>\n<li>一台具有公网 <code v-pre>ip</code> 的 <code v-pre>Ubuntu20</code> 服务器 <code v-pre>public_server</code>，分配公网 <code v-pre>IP</code> 假设为 <code v-pre>x.x.x.x</code></li>\n<li>一台我自己组件子网的 <code v-pre>Ubuntu24</code> 电脑 <code v-pre>private_server</code></li>\n<li>一台直连运行商 <code v-pre>4G</code> 网络的本地 <code v-pre>apple</code> 电脑 <code v-pre>self_server</code></li>\n</ul>\n<p>此时 <code v-pre>private_server</code> 和 <code v-pre>self_server</code> 都可以访问 <code v-pre>public_server</code>，但是 <code v-pre>self_server</code> 无法访问到 <code v-pre>private_server</code>。</p>\n<p>我们此时要做到的就是 <code v-pre>self_server</code> 可以成功借助 <code v-pre>public_server</code> 访问到 <code v-pre>private_server</code>。</p>\n<h3 id=\"_3-1-2-编写-frp-配置文件\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-1-2-编写-frp-配置文件\"><span>3.1.2.编写 frp 配置文件</span></a></h3>\n<p>此时我们先把之前在 <code v-pre>public_server</code> 的 <code v-pre>frp/</code> 文件夹及其内部的内容全部复制到 <code v-pre>private_server</code> 中。然后接下来记住：</p>\n<ul>\n<li><code v-pre>public_server</code> 持有文件 <code v-pre>frps, frps.toml, frps.service</code></li>\n<li><code v-pre>private_server</code> 持有文件 <code v-pre>frpc, frpc.toml, frpc.service</code></li>\n</ul>\n<p>根据我之前的提示，修改配置文件。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># public_server</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> vim</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frps.toml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frps.toml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bindPort</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 7000</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 保持不变即可, 不过注意 public_server 服务器需要开启这个端口</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># private_server</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> vim</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frpc.toml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frpc.toml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">serverAddr</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">x.x.x.x</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 公网机器</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">serverPort</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 7000</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 一定要和上面的 bindPort 保持同步</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">proxies</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">name</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">frp-tcp</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 这里我换了一个名字</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">type</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">tcp</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">localIP</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">127.0.0.1</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">localPort</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 22</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">remotePort</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6000</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 这个端口也一定要在 public_server 上开放</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3 id=\"_3-1-3-编写-systemd-配置文件\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-1-3-编写-systemd-配置文件\"><span>3.1.3.编写 systemd 配置文件</span></a></h3>\n<p>然后再配置文件的基础上，配置服务文件，因为我们一般都是直接使用 <code v-pre>systemd</code> 来管理服务端或客户端的。</p>\n<div class=\"hint-container caution\">\n<p class=\"hint-container-title\">警告</p>\n<p>警告：不过这里官方只配置了一服务端程序的配置文件，这里我把客户端程序的配置文件也给出了，为了方便您后续的使用。而且我还做了一些配置上的改动，增强这个 <code v-pre>frp</code> 服务，提高可用性。</p>\n</div>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 在 public_server 上创建 frps.service 配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 编写配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> vim</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/systemd/system/frps.service</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/systemd/system/frps.service</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Unit</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Description</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frp</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> server</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 服务名称，可自定义</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">After</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> network-online.target</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> syslog.target</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 定义启动顺序: 当前服务要等到系统的网络相关服务, 日志系统相关服务启动之后再启动</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Wants</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> network-online.target</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 定义软依赖关系: 尽可能启动网络服务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># Requires = ... # 定义硬依赖关系: ...</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Service</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Type</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> simple</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 定义服务启动类型</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">ExecStart</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">这里填入您的</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frps</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 可执行程序的路</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">径</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -c</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">这里填入您的</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frps.toml</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 配置文件的路</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">径</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 启动 frps 的命令, 需修改为您的 frps 的安装路径</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Install</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 这个不再展开, 要细细研究 systemd 一系列的知识才能正确理解...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">WantedBy</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> multi-user.target</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 在 private_server 上创建 frpc.service 配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 编写配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> vim</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/systemd/system/frpc.service</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/systemd/system/frpc.service</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Unit</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Description</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frp</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> client</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 服务名称，可自定义</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">After</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> network-online.target</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> syslog.target</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 定义启动顺序: 当前服务要等到系统的网络相关服务, 日志系统相关服务启动之后再启动</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Wants</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> network-online.target</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 定义软依赖关系: 尽可能启动网络服务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># Requires = ... # 定义硬依赖关系: ...</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Service</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Type</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> simple</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 定义服务启动类型</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">ExecStart</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">这里填入您的</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frpc</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 可执行程序的路</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">径</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -c</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">这里填入您的</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frpc.toml</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 配置文件的路</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">径</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 启动 frps 的命令, 需修改为您的 frpc 的安装路径</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Install</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 这个不再展开, 要细细研究 systemd 一系列的知识才能正确理解...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">WantedBy</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> multi-user.target</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>区别：软依赖和硬依赖的区别。</p>\n<ul>\n<li><strong>软依赖（Wants=）</strong>：表示一种<strong>非强制性依赖</strong>关系，启动当前服务时，会尽可能尝试启动依赖的服务，但即使依赖的服务启动失败，当前服务也会继续启动。适合那些不强制要求依赖服务的场景，即使依赖的服务未成功启动，当前服务依旧可以独立运行。</li>\n<li><strong>硬依赖（Requires=）</strong>：表示一种<strong>强制性依赖</strong>关系，启动当前服务时，要求依赖的服务必须成功启动，否则当前服务也会启动失败。若依赖的服务在运行过程中失败并退出，当前服务也会因此被终止。</li>\n</ul>\n</div>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：添加重启策略。</p>\n<p>我所在的地方经常停电，因此我对于自动重启是强需求，因此我补充下面这个具有重启策略的文件供您参考。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 在 private_server 上重新 frpc.service 配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 编写配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> vim</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/systemd/system/frpc.service</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/systemd/system/frpc.service</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Unit</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Description</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frp</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> client</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 服务名称，可自定义</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">After</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> network-online.target</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> syslog.target</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 定义启动顺序: 当前服务要等到系统的网络相关服务, 日志系统相关服务启动之后再启动</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Wants</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> network-online.target</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 定义软依赖关系: 尽可能启动网络服务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># Requires = ... # 定义硬依赖关系: ...</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Service</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Type</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> simple</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 定义服务启动类型</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">ExecStart</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">这里填入您的</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frpc</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 可执行程序的路</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">径</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -c</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">这里填入您的</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frpc.toml</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 配置文件的路</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">径</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 启动 frps 的命令, 需修改为您的 frpc 的安装路径</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Restart</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">on-failure</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">          # 失败时自动重启</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">RestartSec</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">5s</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">               # 重启间隔时间（5秒）</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Install</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">WantedBy</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">multi-user.target</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></div>\n<h3 id=\"_3-1-4-管理服务\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-1-4-管理服务\"><span>3.1.4.管理服务</span></a></h3>\n<p>然后也是经典的 <code v-pre>systemd</code> 管理指令来进行管理。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 管理 frps.service 服务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 重载 frps.service 服务文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> daemon-reload</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 启动 frps.service 服务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> start</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frps.service</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 设置 frps.service 服务为开机自启动</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> enable</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frps.service</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看 frps.service 状态</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> status</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frps.service</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 管理 frpc.service 服务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 重载 frpc.service 服务文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> daemon-reload</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 启动 frpc.service 服务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> start</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frpc.service</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 设置 frpc.service 服务为开机自启动</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> enable</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frpc.service</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看 frpc.service 状态</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> status</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frpc.service</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3 id=\"_3-1-5-使用内网穿透\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-1-5-使用内网穿透\"><span>3.1.5.使用内网穿透</span></a></h3>\n<p>然后使用 <code v-pre>ssh -p 6001 private_server_user_name@x.x.x.x</code> 在 <code v-pre>self_server</code> 上开始内网穿透，能输入密码并且访问到 <code v-pre>bash</code> 终端就说明穿透成功。</p>\n<h2 id=\"_3-2-代理多个-ssh-服务访问多台内网机器\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-2-代理多个-ssh-服务访问多台内网机器\"><span>3.2.代理多个 ssh 服务访问多台内网机器</span></a></h2>\n<p>但是如果希望配置多个 <code v-pre>ssh</code> 服务怎么办呢？照葫芦画瓢。</p>\n<h3 id=\"_3-2-1-准备环境\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-2-1-准备环境\"><span>3.2.1.准备环境</span></a></h3>\n<p>假设我现在有一台 <code v-pre>public_server</code>，以及两台 <code v-pre>private_server_1, private_server_2</code> 和一台 <code v-pre>self_server</code>，我们希望 <code v-pre>self_server</code> 可以通过 <code v-pre>public_server</code> 访问 <code v-pre>private_server_1, private_server_2</code>。</p>\n<p>这种做法可以，但是需要换一种协议，这种协议就是 <code v-pre>tcpmux</code>，可以让我们只使用一个端口就可以连接多台服务器。</p>\n<h3 id=\"_3-2-2-编写-frp-配置文件\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-2-2-编写-frp-配置文件\"><span>3.2.2.编写 frp 配置文件</span></a></h3>\n<div class=\"language-toml line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"toml\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-toml\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># frps.toml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">bindPort</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 7000</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # frps 服务的运行端口</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">tcpmuxHTTPConnectPort</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 5002</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 多路复用代理端口, 通过一个 TCP 连接发送多个 HTTP 请求</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-toml line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"toml\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-toml\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># frpc.toml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">serverAddr</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">x.x.x.x</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # frps 服务的运行地址</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">serverPort</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 7000</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # frps 服务的运行端口</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[[</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">proxies</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">server_name</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 我改为了 private_server_1 和 private_server_2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">tcpmux</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 注意协议更换了</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">multiplexer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">httpconnect</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 允许多路复用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">customDomains</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> [</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">server_name.com</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 自定义域名, 我改为了 private_server_1.com 和 private_server_2.com</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">localIP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">127.0.0.1</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">localPort</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 22</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>注意：多个 <code v-pre>private_server</code> 复用上面的 <code v-pre>frpc.toml</code> 即可，注意还是需要做些修改才能进行复用。</p>\n</div>\n<h3 id=\"_3-2-3-编写-systemd-配置文件\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-2-3-编写-systemd-配置文件\"><span>3.2.3.编写 systemd 配置文件</span></a></h3>\n<p>然后再配置文件的基础上，配置服务文件。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 在 public_server 上创建 frps.service 配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 编写配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> vim</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/systemd/system/frps.service</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/systemd/system/frps.service</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Unit</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Description</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frp</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> server</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 服务名称，可自定义</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">After</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> network-online.target</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> syslog.target</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 定义启动顺序: 当前服务要等到系统的网络相关服务, 日志系统相关服务启动之后再启动</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Wants</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> network-online.target</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 定义软依赖关系: 尽可能启动网络服务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># Requires = ... # 定义硬依赖关系: ...</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Service</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Type</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> simple</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 定义服务启动类型</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">ExecStart</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">这里填入您的</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frps</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 可执行程序的路</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">径</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -c</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">这里填入您的</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frps.toml</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 配置文件的路</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">径</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 启动 frps 的命令, 需修改为您的 frps 的安装路径</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Install</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 这个不再展开, 要细细研究 systemd 一系列的知识才能正确理解...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">WantedBy</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> multi-user.target</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 在 private_server 上都创建一样的 frpc.service 配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 编写配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> vim</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/systemd/system/frpc.service</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/systemd/system/frpc.service</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Unit</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Description</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frp</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> client</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 服务名称，可自定义</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">After</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> network-online.target</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> syslog.target</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 定义启动顺序: 当前服务要等到系统的网络相关服务, 日志系统相关服务启动之后再启动</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Wants</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> network-online.target</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 定义软依赖关系: 尽可能启动网络服务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># Requires = ... # 定义硬依赖关系: ...</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Service</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Type</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> simple</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 定义服务启动类型</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">ExecStart</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">这里填入您的</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frpc</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 可执行程序的路</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">径</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -c</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">这里填入您的</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frpc.toml</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 配置文件的路</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">径</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 启动 frps 的命令, 需修改为您的 frpc 的安装路径</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Install</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 这个不再展开, 要细细研究 systemd 一系列的知识才能正确理解...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">WantedBy</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> multi-user.target</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3 id=\"_3-1-4-管理服务-1\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-1-4-管理服务-1\"><span>3.1.4.管理服务</span></a></h3>\n<p>然后也是经典的 <code v-pre>systemd</code> 管理指令来进行管理。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 管理 frps.service 服务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 重载 frps.service 服务文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> daemon-reload</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 启动 frps.service 服务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> start</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frps.service</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 设置 frps.service 服务为开机自启动</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> enable</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frps.service</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看 frps.service 状态</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> status</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frps.service</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 管理 frpc.service 服务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 重载 frpc.service 服务文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> daemon-reload</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 启动 frpc.service 服务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> start</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frpc.service</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 设置 frpc.service 服务为开机自启动</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> enable</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frpc.service</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看 frpc.service 状态</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> status</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frpc.service</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3 id=\"_3-1-5-使用内网穿透-1\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-1-5-使用内网穿透-1\"><span>3.1.5.使用内网穿透</span></a></h3>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：要使用还必须在本主机上下载 <code v-pre>socat</code>...</p>\n</div>\n<p>使用 <code v-pre>SSH ProxyCommand</code> 访问内网机器 <code v-pre>private_server_1</code>，假设用户名为 <code v-pre>test</code>。使用以下命令：</p>\n<div class=\"language-bash line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"bash\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-bash\"><span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">ssh</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -o</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">proxycommand socat - PROXY:x.x.x.x:%h:%p,proxyport=5002</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> test@private_server_1.com</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div></div></div><p>要访问内网机器 <code v-pre>B</code>，只需更改域名，假设用户名仍然为 <code v-pre>test</code>：</p>\n<div class=\"language-bash line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"bash\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-bash\"><span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">ssh</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -o</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">proxycommand socat - PROXY:x.x.x.x:%h:%p,proxyport=5002</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> test@private_server_2.com</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div></div></div><p>通过按照以上步骤进行配置，您可以实现多个 <code v-pre>SSH</code> 服务复用同一端口，以便在具有公网 <code v-pre>IP</code> 的机器上进行访问。</p>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：不过这有一个麻烦，就是使用某些 <code v-pre>ssh</code> 连接软件的时候不太好配置，并且有时装发压力比较大...</p>\n</div>\n<hr>\n<div class=\"hint-container note\">\n<p class=\"hint-container-title\">注</p>\n<p>结语：...</p>\n</div>\n<p><strong>如果本系列文章对您有帮助，可以 <a href=\"https://github.com/xiaogithubooo/LimouLearnNote\" target=\"_blank\" rel=\"noopener noreferrer\">star 一下我的 limou-learn-note</a>，求求惹(๑＞ ＜)☆♡~</strong></p>\n<div class=\"language- line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-\"><span class=\"line\"><span>[Unit]</span></span>\n<span class=\"line\"><span>Description=Magic Service</span></span>\n<span class=\"line\"><span>After=network.target</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>[Service]</span></span>\n<span class=\"line\"><span>ExecStart=/home/ljp/.config/mihomo/clash-linux</span></span>\n<span class=\"line\"><span>Restart=on-failure</span></span>\n<span class=\"line\"><span>User=ljp</span></span>\n<span class=\"line\"><span>WorkingDirectory=/home/ljp/.config/mihomo/</span></span>\n<span class=\"line\"><span>StandardOutput=syslog</span></span>\n<span class=\"line\"><span>StandardError=syslog</span></span>\n<span class=\"line\"><span>SyslogIdentifier=clash-linux</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>[Install]</span></span>\n<span class=\"line\"><span>WantedBy=multi-user.target</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div>","env":{"base":"/","filePath":"/home/ljp/git/work/work-blog-website/work-blog-website-frontend/docs/3.系统网络/1.基本操作/033_ljp_2024_08_06_内网穿透软件.md","filePathRelative":"3.系统网络/1.基本操作/033_ljp_2024_08_06_内网穿透软件.md","frontmatter":{"createTime":"2025/04/09 23:31:30","permalink":"/3.系统网络/3hoxlbkl/","title":"内网穿透软件"},"sfcBlocks":{"template":{"type":"template","content":"<template><h1 id=\"_1-frp-的安装运行\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-frp-的安装运行\"><span>1.frp 的安装运行</span></a></h1>\n<p><a href=\"https://gofrp.org/zh-cn/docs/setup/\" target=\"_blank\" rel=\"noopener noreferrer\">直接去 frp 官网获取其对应的二进制文件即可</a>，而这里我以 <code v-pre>Ubuntu</code> 为例子，使用 <code v-pre>wget</code> 进行安装，并且只在 <code v-pre>Ubuntu</code> 的具有公网 <code v-pre>ip</code> 的机器上尝试运行。</p>\n<div class=\"hint-container caution\">\n<p class=\"hint-container-title\">警告</p>\n<p>警告：我们这里只是尝试运行，不代表真正应用 <code v-pre>frp</code>，因此下载好 <code v-pre>frp</code> 后，配置文件我暂时不修改，只是做个解读。</p>\n</div>\n<div class=\"hint-container caution\">\n<p class=\"hint-container-title\">警告</p>\n<p>警告：整个下载配置运行的过程，我都在具有公网 <code v-pre>IP</code> 服务器上进行了配置。</p>\n</div>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 安装 frp</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 下载 frp 的二进制文件压缩包</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> wget</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> https://github.com/fatedier/frp/releases/download/v0.60.0/frp_0.60.0_linux_amd64.tar.gz</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 解压 frp 的压缩包</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> tar</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -zxvf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frp_0.60.0_linux_amd64.tar.gz</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 重命名解压文件夹</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> mv</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frp_0.60.0_linux_amd64</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frp</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 打开解压文件夹</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cd</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frp</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看当前目录下的文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ls</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">frpc</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  frpc.toml</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  frps</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  frps.toml</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  LICENSE</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看 frp</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看当前服务端程序的配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frps.toml</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 不过我们先按照默认的即可, 我们只在本地稍微测试一下就行</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bindPort</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 7000</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # frp 服务端程序在公网服务器中运行时所在的端口</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看当前客户端程序的配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frpc.toml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">serverAddr</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">127.0.0.1</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 后续要改为公网服务器的公网 ip(后面是一定要修改的)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">serverPort</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 7000</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 就是前面的端口, 客户端通过 serverAddr+serverPort 才能找到公网机器中的 frp 服务端程序(因此要和前面 frps.toml 中的 bindPort 保持同步)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">proxies</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]]</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # proxies 就是代理的意思</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">name</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">test-tcp</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 客户端名称(可选修改)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">type</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">tcp</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 采用的代理协议(没有特殊需求无需修改)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">localIP</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">127.0.0.1</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 转发到这个 ip</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">localPort</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 22</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 转发到这个 port</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">remotePort</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6000</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 公网机器上对外开放的端口, 用于支持外界穿透到内网(这样其他非内网主机就可以把对 \"公网ip+remotePort\" 的请求转发到 \"localIP+localPort\" 上进行处理)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 运行 frp</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ./frps</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -c</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ./frps.toml</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 使用以下命令启动服务端程序</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> 558528</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">2024-09-09</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 00:18:12.920</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [I] </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">frps/root.go:105</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> frps uses config file: ./frps.toml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">2024-09-09</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 00:18:13.171</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [I] </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">server/service.go:237</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> frps tcp listen on 0.0.0.0:7000</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">2024-09-09</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 00:18:13.172</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [I] </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">frps/root.go:114</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> frps started successfully</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ./frpc</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -c</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ./frpc.toml</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 使用以下命令启动客户端程序</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">2024-09-09</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 00:21:01.337</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [I] </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sub/root.go:142</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> start frpc service </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> config file </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">./frpc.toml</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">2024-09-09</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 00:21:01.337</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [I] </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">client/service.go:295</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> try to connect to server...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">2024-09-09</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 00:21:01.342</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [I] </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">server/service.go:576</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> [</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">42307efebbdeb377</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> client login info: ip </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">127.0.0.1:48018</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> version </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">0.60.0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> hostname </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> os </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">linux</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> arch </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">amd64</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">2024-09-09</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 00:21:01.342</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [I] </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">client/service.go:287</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> [</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">42307efebbdeb377</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> login to server success, get run id </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">42307efebbdeb377</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">2024-09-09</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 00:21:01.342</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [I] </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">proxy/proxy_manager.go:173</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> [</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">42307efebbdeb377</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> proxy added: </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">test-tcp</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">2024-09-09</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 00:21:01.343</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [I] </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">proxy/tcp.go:82</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> [</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">42307efebbdeb377</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> [</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">test-tcp</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> tcp proxy listen port </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">6000</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">2024-09-09</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 00:21:01.343</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [I] </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">server/control.go:399</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> [</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">42307efebbdeb377</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> new proxy </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">test-tcp</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> type </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">tcp</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> success</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">2024-09-09</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 00:21:01.343</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [I] </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">client/control.go:168</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> [</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">42307efebbdeb377</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> [</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">test-tcp</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> start proxy success</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>可以看到没有什么明显的报错，这代表我们安装成功了。</p>\n<h1 id=\"_2-frp-的工作原理\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-frp-的工作原理\"><span>2.frp 的工作原理</span></a></h1>\n<p><code v-pre>frp</code> 主要由两个组件组成：<code v-pre>客户端(frpc)</code> 和 <code v-pre>服务端(frps)</code>。通常情况下，服务端部署在具有公网 <code v-pre>IP</code> 地址的机器上，而客户端部署在需要穿透的内网服务所在的机器上。</p>\n<p>由于内网服务缺乏公网 <code v-pre>IP</code> 地址，因此无法直接被非局域网内的用户访问。用户通过访问服务端的 <code v-pre>frps</code>，<code v-pre>frp</code> 负责根据请求的端口或其他信息将请求路由到相应的内网机器，从而实现从局域网外的计算机向局域网进行通信。</p>\n<p>在 <code v-pre>frp</code> 中，一个代理对应一个需要公开访问的内网服务。一个客户端可以同时配置多个代理，以满足不同的需求。</p>\n<p><code v-pre>frp</code> 支持多种代理类型，以适应不同的使用场景。以下是一些常见的代理类型：</p>\n<ul>\n<li><strong>TCP</strong>：提供纯粹的 <code v-pre>TCP</code> 端口映射，使服务端能够根据不同的端口将请求路由到不同的内网服务</li>\n<li><strong>UDP</strong>：提供纯粹的 <code v-pre>UDP</code> 端口映射，与 <code v-pre>TCP</code> 代理类似，但用于 <code v-pre>UDP</code> 流量</li>\n<li><strong>HTTP</strong>：专为 <code v-pre>HTTP</code> 应用设计，支持修改 <code v-pre>Host Header</code> 和增加鉴权等额外功能</li>\n<li><strong>HTTPS</strong>：类似于 <code v-pre>HTTP</code> 代理，但专门用于处理 <code v-pre>HTTPS</code> 流量</li>\n<li><strong>STCP</strong>：提供安全的 <code v-pre>TCP</code> 内网代理，要求在被访问者和访问者的机器上都部署 <code v-pre>frpc</code>，不需要在服务端暴露端口</li>\n<li><strong>SUDP</strong>：提供安全的 <code v-pre>UDP</code> 内网代理，与 <code v-pre>STCP</code> 类似，需要在被访问者和访问者的机器上都部署 <code v-pre>frpc</code>，不需要在服务端暴露端口</li>\n<li><strong>XTCP</strong>：点对点内网穿透代理，与 <code v-pre>STCP</code> 类似，但流量不需要经过服务器中转</li>\n<li><strong>TCPMUX</strong>：支持服务端 <code v-pre>TCP</code> 端口的多路复用，允许通过同一端口访问不同的内网服务</li>\n</ul>\n<p>每种代理类型适用于不同的使用情境，您可以根据需求选择合适的代理类型来配置 <code v-pre>frp</code>，这里我尽可能追寻默认。</p>\n<h1 id=\"_3-frp-的实践过程\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-frp-的实践过程\"><span>3.frp 的实践过程</span></a></h1>\n<h2 id=\"_3-1-代理单个-ssh-服务访问一台内网机器\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-1-代理单个-ssh-服务访问一台内网机器\"><span>3.1.代理单个 ssh 服务访问一台内网机器</span></a></h2>\n<h3 id=\"_3-1-1-准备环境\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-1-1-准备环境\"><span>3.1.1.准备环境</span></a></h3>\n<div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>注意：当然，前提是内网机器已经部署了 <code v-pre>ssh</code> 连接，否则后面都是空谈...</p>\n</div>\n<p>首先需要准备三台机器，我这里以及有：</p>\n<ul>\n<li>一台具有公网 <code v-pre>ip</code> 的 <code v-pre>Ubuntu20</code> 服务器 <code v-pre>public_server</code>，分配公网 <code v-pre>IP</code> 假设为 <code v-pre>x.x.x.x</code></li>\n<li>一台我自己组件子网的 <code v-pre>Ubuntu24</code> 电脑 <code v-pre>private_server</code></li>\n<li>一台直连运行商 <code v-pre>4G</code> 网络的本地 <code v-pre>apple</code> 电脑 <code v-pre>self_server</code></li>\n</ul>\n<p>此时 <code v-pre>private_server</code> 和 <code v-pre>self_server</code> 都可以访问 <code v-pre>public_server</code>，但是 <code v-pre>self_server</code> 无法访问到 <code v-pre>private_server</code>。</p>\n<p>我们此时要做到的就是 <code v-pre>self_server</code> 可以成功借助 <code v-pre>public_server</code> 访问到 <code v-pre>private_server</code>。</p>\n<h3 id=\"_3-1-2-编写-frp-配置文件\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-1-2-编写-frp-配置文件\"><span>3.1.2.编写 frp 配置文件</span></a></h3>\n<p>此时我们先把之前在 <code v-pre>public_server</code> 的 <code v-pre>frp/</code> 文件夹及其内部的内容全部复制到 <code v-pre>private_server</code> 中。然后接下来记住：</p>\n<ul>\n<li><code v-pre>public_server</code> 持有文件 <code v-pre>frps, frps.toml, frps.service</code></li>\n<li><code v-pre>private_server</code> 持有文件 <code v-pre>frpc, frpc.toml, frpc.service</code></li>\n</ul>\n<p>根据我之前的提示，修改配置文件。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># public_server</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> vim</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frps.toml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frps.toml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bindPort</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 7000</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 保持不变即可, 不过注意 public_server 服务器需要开启这个端口</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># private_server</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> vim</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frpc.toml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frpc.toml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">serverAddr</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">x.x.x.x</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 公网机器</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">serverPort</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 7000</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 一定要和上面的 bindPort 保持同步</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">proxies</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">name</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">frp-tcp</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 这里我换了一个名字</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">type</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">tcp</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">localIP</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">127.0.0.1</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">localPort</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 22</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">remotePort</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6000</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 这个端口也一定要在 public_server 上开放</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3 id=\"_3-1-3-编写-systemd-配置文件\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-1-3-编写-systemd-配置文件\"><span>3.1.3.编写 systemd 配置文件</span></a></h3>\n<p>然后再配置文件的基础上，配置服务文件，因为我们一般都是直接使用 <code v-pre>systemd</code> 来管理服务端或客户端的。</p>\n<div class=\"hint-container caution\">\n<p class=\"hint-container-title\">警告</p>\n<p>警告：不过这里官方只配置了一服务端程序的配置文件，这里我把客户端程序的配置文件也给出了，为了方便您后续的使用。而且我还做了一些配置上的改动，增强这个 <code v-pre>frp</code> 服务，提高可用性。</p>\n</div>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 在 public_server 上创建 frps.service 配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 编写配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> vim</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/systemd/system/frps.service</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/systemd/system/frps.service</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Unit</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Description</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frp</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> server</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 服务名称，可自定义</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">After</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> network-online.target</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> syslog.target</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 定义启动顺序: 当前服务要等到系统的网络相关服务, 日志系统相关服务启动之后再启动</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Wants</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> network-online.target</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 定义软依赖关系: 尽可能启动网络服务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># Requires = ... # 定义硬依赖关系: ...</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Service</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Type</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> simple</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 定义服务启动类型</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">ExecStart</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">这里填入您的</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frps</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 可执行程序的路</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">径</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -c</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">这里填入您的</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frps.toml</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 配置文件的路</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">径</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 启动 frps 的命令, 需修改为您的 frps 的安装路径</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Install</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 这个不再展开, 要细细研究 systemd 一系列的知识才能正确理解...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">WantedBy</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> multi-user.target</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 在 private_server 上创建 frpc.service 配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 编写配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> vim</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/systemd/system/frpc.service</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/systemd/system/frpc.service</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Unit</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Description</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frp</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> client</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 服务名称，可自定义</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">After</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> network-online.target</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> syslog.target</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 定义启动顺序: 当前服务要等到系统的网络相关服务, 日志系统相关服务启动之后再启动</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Wants</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> network-online.target</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 定义软依赖关系: 尽可能启动网络服务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># Requires = ... # 定义硬依赖关系: ...</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Service</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Type</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> simple</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 定义服务启动类型</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">ExecStart</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">这里填入您的</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frpc</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 可执行程序的路</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">径</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -c</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">这里填入您的</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frpc.toml</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 配置文件的路</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">径</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 启动 frps 的命令, 需修改为您的 frpc 的安装路径</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Install</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 这个不再展开, 要细细研究 systemd 一系列的知识才能正确理解...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">WantedBy</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> multi-user.target</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>区别：软依赖和硬依赖的区别。</p>\n<ul>\n<li><strong>软依赖（Wants=）</strong>：表示一种<strong>非强制性依赖</strong>关系，启动当前服务时，会尽可能尝试启动依赖的服务，但即使依赖的服务启动失败，当前服务也会继续启动。适合那些不强制要求依赖服务的场景，即使依赖的服务未成功启动，当前服务依旧可以独立运行。</li>\n<li><strong>硬依赖（Requires=）</strong>：表示一种<strong>强制性依赖</strong>关系，启动当前服务时，要求依赖的服务必须成功启动，否则当前服务也会启动失败。若依赖的服务在运行过程中失败并退出，当前服务也会因此被终止。</li>\n</ul>\n</div>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：添加重启策略。</p>\n<p>我所在的地方经常停电，因此我对于自动重启是强需求，因此我补充下面这个具有重启策略的文件供您参考。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 在 private_server 上重新 frpc.service 配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 编写配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> vim</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/systemd/system/frpc.service</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/systemd/system/frpc.service</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Unit</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Description</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frp</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> client</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 服务名称，可自定义</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">After</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> network-online.target</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> syslog.target</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 定义启动顺序: 当前服务要等到系统的网络相关服务, 日志系统相关服务启动之后再启动</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Wants</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> network-online.target</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 定义软依赖关系: 尽可能启动网络服务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># Requires = ... # 定义硬依赖关系: ...</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Service</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Type</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> simple</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 定义服务启动类型</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">ExecStart</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">这里填入您的</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frpc</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 可执行程序的路</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">径</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -c</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">这里填入您的</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frpc.toml</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 配置文件的路</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">径</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 启动 frps 的命令, 需修改为您的 frpc 的安装路径</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Restart</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">on-failure</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">          # 失败时自动重启</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">RestartSec</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">5s</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">               # 重启间隔时间（5秒）</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Install</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">WantedBy</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">multi-user.target</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></div>\n<h3 id=\"_3-1-4-管理服务\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-1-4-管理服务\"><span>3.1.4.管理服务</span></a></h3>\n<p>然后也是经典的 <code v-pre>systemd</code> 管理指令来进行管理。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 管理 frps.service 服务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 重载 frps.service 服务文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> daemon-reload</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 启动 frps.service 服务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> start</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frps.service</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 设置 frps.service 服务为开机自启动</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> enable</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frps.service</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看 frps.service 状态</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> status</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frps.service</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 管理 frpc.service 服务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 重载 frpc.service 服务文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> daemon-reload</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 启动 frpc.service 服务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> start</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frpc.service</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 设置 frpc.service 服务为开机自启动</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> enable</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frpc.service</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看 frpc.service 状态</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> status</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frpc.service</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3 id=\"_3-1-5-使用内网穿透\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-1-5-使用内网穿透\"><span>3.1.5.使用内网穿透</span></a></h3>\n<p>然后使用 <code v-pre>ssh -p 6001 private_server_user_name@x.x.x.x</code> 在 <code v-pre>self_server</code> 上开始内网穿透，能输入密码并且访问到 <code v-pre>bash</code> 终端就说明穿透成功。</p>\n<h2 id=\"_3-2-代理多个-ssh-服务访问多台内网机器\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-2-代理多个-ssh-服务访问多台内网机器\"><span>3.2.代理多个 ssh 服务访问多台内网机器</span></a></h2>\n<p>但是如果希望配置多个 <code v-pre>ssh</code> 服务怎么办呢？照葫芦画瓢。</p>\n<h3 id=\"_3-2-1-准备环境\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-2-1-准备环境\"><span>3.2.1.准备环境</span></a></h3>\n<p>假设我现在有一台 <code v-pre>public_server</code>，以及两台 <code v-pre>private_server_1, private_server_2</code> 和一台 <code v-pre>self_server</code>，我们希望 <code v-pre>self_server</code> 可以通过 <code v-pre>public_server</code> 访问 <code v-pre>private_server_1, private_server_2</code>。</p>\n<p>这种做法可以，但是需要换一种协议，这种协议就是 <code v-pre>tcpmux</code>，可以让我们只使用一个端口就可以连接多台服务器。</p>\n<h3 id=\"_3-2-2-编写-frp-配置文件\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-2-2-编写-frp-配置文件\"><span>3.2.2.编写 frp 配置文件</span></a></h3>\n<div class=\"language-toml line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"toml\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-toml\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># frps.toml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">bindPort</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 7000</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # frps 服务的运行端口</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">tcpmuxHTTPConnectPort</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 5002</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 多路复用代理端口, 通过一个 TCP 连接发送多个 HTTP 请求</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-toml line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"toml\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-toml\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># frpc.toml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">serverAddr</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">x.x.x.x</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # frps 服务的运行地址</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">serverPort</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 7000</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # frps 服务的运行端口</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[[</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">proxies</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">server_name</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 我改为了 private_server_1 和 private_server_2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">tcpmux</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 注意协议更换了</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">multiplexer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">httpconnect</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 允许多路复用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">customDomains</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> [</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">server_name.com</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 自定义域名, 我改为了 private_server_1.com 和 private_server_2.com</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">localIP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">127.0.0.1</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">localPort</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 22</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>注意：多个 <code v-pre>private_server</code> 复用上面的 <code v-pre>frpc.toml</code> 即可，注意还是需要做些修改才能进行复用。</p>\n</div>\n<h3 id=\"_3-2-3-编写-systemd-配置文件\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-2-3-编写-systemd-配置文件\"><span>3.2.3.编写 systemd 配置文件</span></a></h3>\n<p>然后再配置文件的基础上，配置服务文件。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 在 public_server 上创建 frps.service 配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 编写配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> vim</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/systemd/system/frps.service</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/systemd/system/frps.service</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Unit</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Description</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frp</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> server</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 服务名称，可自定义</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">After</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> network-online.target</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> syslog.target</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 定义启动顺序: 当前服务要等到系统的网络相关服务, 日志系统相关服务启动之后再启动</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Wants</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> network-online.target</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 定义软依赖关系: 尽可能启动网络服务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># Requires = ... # 定义硬依赖关系: ...</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Service</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Type</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> simple</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 定义服务启动类型</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">ExecStart</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">这里填入您的</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frps</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 可执行程序的路</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">径</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -c</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">这里填入您的</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frps.toml</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 配置文件的路</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">径</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 启动 frps 的命令, 需修改为您的 frps 的安装路径</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Install</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 这个不再展开, 要细细研究 systemd 一系列的知识才能正确理解...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">WantedBy</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> multi-user.target</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 在 private_server 上都创建一样的 frpc.service 配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 编写配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> vim</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/systemd/system/frpc.service</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/systemd/system/frpc.service</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Unit</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Description</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frp</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> client</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 服务名称，可自定义</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">After</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> network-online.target</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> syslog.target</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 定义启动顺序: 当前服务要等到系统的网络相关服务, 日志系统相关服务启动之后再启动</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Wants</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> network-online.target</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 定义软依赖关系: 尽可能启动网络服务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># Requires = ... # 定义硬依赖关系: ...</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Service</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Type</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> simple</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 定义服务启动类型</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">ExecStart</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">这里填入您的</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frpc</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 可执行程序的路</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">径</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -c</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">这里填入您的</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frpc.toml</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 配置文件的路</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">径</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 启动 frps 的命令, 需修改为您的 frpc 的安装路径</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Install</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 这个不再展开, 要细细研究 systemd 一系列的知识才能正确理解...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">WantedBy</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> multi-user.target</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3 id=\"_3-1-4-管理服务-1\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-1-4-管理服务-1\"><span>3.1.4.管理服务</span></a></h3>\n<p>然后也是经典的 <code v-pre>systemd</code> 管理指令来进行管理。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 管理 frps.service 服务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 重载 frps.service 服务文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> daemon-reload</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 启动 frps.service 服务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> start</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frps.service</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 设置 frps.service 服务为开机自启动</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> enable</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frps.service</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看 frps.service 状态</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> status</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frps.service</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 管理 frpc.service 服务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 重载 frpc.service 服务文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> daemon-reload</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 启动 frpc.service 服务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> start</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frpc.service</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 设置 frpc.service 服务为开机自启动</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> enable</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frpc.service</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看 frpc.service 状态</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> status</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frpc.service</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3 id=\"_3-1-5-使用内网穿透-1\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-1-5-使用内网穿透-1\"><span>3.1.5.使用内网穿透</span></a></h3>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：要使用还必须在本主机上下载 <code v-pre>socat</code>...</p>\n</div>\n<p>使用 <code v-pre>SSH ProxyCommand</code> 访问内网机器 <code v-pre>private_server_1</code>，假设用户名为 <code v-pre>test</code>。使用以下命令：</p>\n<div class=\"language-bash line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"bash\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-bash\"><span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">ssh</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -o</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">proxycommand socat - PROXY:x.x.x.x:%h:%p,proxyport=5002</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> test@private_server_1.com</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div></div></div><p>要访问内网机器 <code v-pre>B</code>，只需更改域名，假设用户名仍然为 <code v-pre>test</code>：</p>\n<div class=\"language-bash line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"bash\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-bash\"><span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">ssh</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -o</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">proxycommand socat - PROXY:x.x.x.x:%h:%p,proxyport=5002</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> test@private_server_2.com</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div></div></div><p>通过按照以上步骤进行配置，您可以实现多个 <code v-pre>SSH</code> 服务复用同一端口，以便在具有公网 <code v-pre>IP</code> 的机器上进行访问。</p>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：不过这有一个麻烦，就是使用某些 <code v-pre>ssh</code> 连接软件的时候不太好配置，并且有时装发压力比较大...</p>\n</div>\n<hr>\n<div class=\"hint-container note\">\n<p class=\"hint-container-title\">注</p>\n<p>结语：...</p>\n</div>\n<p><strong>如果本系列文章对您有帮助，可以 <a href=\"https://github.com/xiaogithubooo/LimouLearnNote\" target=\"_blank\" rel=\"noopener noreferrer\">star 一下我的 limou-learn-note</a>，求求惹(๑＞ ＜)☆♡~</strong></p>\n<div class=\"language- line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-\"><span class=\"line\"><span>[Unit]</span></span>\n<span class=\"line\"><span>Description=Magic Service</span></span>\n<span class=\"line\"><span>After=network.target</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>[Service]</span></span>\n<span class=\"line\"><span>ExecStart=/home/ljp/.config/mihomo/clash-linux</span></span>\n<span class=\"line\"><span>Restart=on-failure</span></span>\n<span class=\"line\"><span>User=ljp</span></span>\n<span class=\"line\"><span>WorkingDirectory=/home/ljp/.config/mihomo/</span></span>\n<span class=\"line\"><span>StandardOutput=syslog</span></span>\n<span class=\"line\"><span>StandardError=syslog</span></span>\n<span class=\"line\"><span>SyslogIdentifier=clash-linux</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>[Install]</span></span>\n<span class=\"line\"><span>WantedBy=multi-user.target</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></template>","contentStripped":"<h1 id=\"_1-frp-的安装运行\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-frp-的安装运行\"><span>1.frp 的安装运行</span></a></h1>\n<p><a href=\"https://gofrp.org/zh-cn/docs/setup/\" target=\"_blank\" rel=\"noopener noreferrer\">直接去 frp 官网获取其对应的二进制文件即可</a>，而这里我以 <code v-pre>Ubuntu</code> 为例子，使用 <code v-pre>wget</code> 进行安装，并且只在 <code v-pre>Ubuntu</code> 的具有公网 <code v-pre>ip</code> 的机器上尝试运行。</p>\n<div class=\"hint-container caution\">\n<p class=\"hint-container-title\">警告</p>\n<p>警告：我们这里只是尝试运行，不代表真正应用 <code v-pre>frp</code>，因此下载好 <code v-pre>frp</code> 后，配置文件我暂时不修改，只是做个解读。</p>\n</div>\n<div class=\"hint-container caution\">\n<p class=\"hint-container-title\">警告</p>\n<p>警告：整个下载配置运行的过程，我都在具有公网 <code v-pre>IP</code> 服务器上进行了配置。</p>\n</div>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 安装 frp</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 下载 frp 的二进制文件压缩包</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> wget</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> https://github.com/fatedier/frp/releases/download/v0.60.0/frp_0.60.0_linux_amd64.tar.gz</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 解压 frp 的压缩包</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> tar</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -zxvf</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frp_0.60.0_linux_amd64.tar.gz</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 重命名解压文件夹</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> mv</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frp_0.60.0_linux_amd64</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frp</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 打开解压文件夹</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cd</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frp</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看当前目录下的文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ls</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">frpc</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  frpc.toml</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  frps</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  frps.toml</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">  LICENSE</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看 frp</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看当前服务端程序的配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frps.toml</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 不过我们先按照默认的即可, 我们只在本地稍微测试一下就行</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bindPort</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 7000</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # frp 服务端程序在公网服务器中运行时所在的端口</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看当前客户端程序的配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frpc.toml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">serverAddr</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">127.0.0.1</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 后续要改为公网服务器的公网 ip(后面是一定要修改的)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">serverPort</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 7000</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 就是前面的端口, 客户端通过 serverAddr+serverPort 才能找到公网机器中的 frp 服务端程序(因此要和前面 frps.toml 中的 bindPort 保持同步)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">proxies</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]]</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # proxies 就是代理的意思</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">name</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">test-tcp</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 客户端名称(可选修改)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">type</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">tcp</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 采用的代理协议(没有特殊需求无需修改)</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">localIP</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">127.0.0.1</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 转发到这个 ip</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">localPort</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 22</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 转发到这个 port</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">remotePort</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6000</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 公网机器上对外开放的端口, 用于支持外界穿透到内网(这样其他非内网主机就可以把对 \"公网ip+remotePort\" 的请求转发到 \"localIP+localPort\" 上进行处理)</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 运行 frp</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ./frps</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -c</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ./frps.toml</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 使用以下命令启动服务端程序</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">1</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> 558528</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">2024-09-09</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 00:18:12.920</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [I] </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">frps/root.go:105</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> frps uses config file: ./frps.toml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">2024-09-09</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 00:18:13.171</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [I] </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">server/service.go:237</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> frps tcp listen on 0.0.0.0:7000</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">2024-09-09</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 00:18:13.172</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [I] </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">frps/root.go:114</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> frps started successfully</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ./frpc</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -c</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> ./frpc.toml</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 使用以下命令启动客户端程序</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">2024-09-09</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 00:21:01.337</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [I] </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">sub/root.go:142</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> start frpc service </span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">for</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> config file </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">./frpc.toml</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">2024-09-09</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 00:21:01.337</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [I] </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">client/service.go:295</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> try to connect to server...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">2024-09-09</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 00:21:01.342</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [I] </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">server/service.go:576</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> [</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">42307efebbdeb377</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> client login info: ip </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">127.0.0.1:48018</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> version </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">0.60.0</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> hostname </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> os </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">linux</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> arch </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">amd64</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">2024-09-09</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 00:21:01.342</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [I] </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">client/service.go:287</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> [</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">42307efebbdeb377</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> login to server success, get run id </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">42307efebbdeb377</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">2024-09-09</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 00:21:01.342</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [I] </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">proxy/proxy_manager.go:173</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> [</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">42307efebbdeb377</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> proxy added: </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">test-tcp</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">2024-09-09</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 00:21:01.343</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [I] </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">proxy/tcp.go:82</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> [</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">42307efebbdeb377</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> [</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">test-tcp</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> tcp proxy listen port </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">6000</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">2024-09-09</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 00:21:01.343</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [I] </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">server/control.go:399</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> [</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">42307efebbdeb377</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> new proxy </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">test-tcp</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> type </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">tcp</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> success</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">2024-09-09</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 00:21:01.343</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> [I] </span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">client/control.go:168</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> [</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">42307efebbdeb377</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> [</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">test-tcp</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> start proxy success</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>可以看到没有什么明显的报错，这代表我们安装成功了。</p>\n<h1 id=\"_2-frp-的工作原理\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-frp-的工作原理\"><span>2.frp 的工作原理</span></a></h1>\n<p><code v-pre>frp</code> 主要由两个组件组成：<code v-pre>客户端(frpc)</code> 和 <code v-pre>服务端(frps)</code>。通常情况下，服务端部署在具有公网 <code v-pre>IP</code> 地址的机器上，而客户端部署在需要穿透的内网服务所在的机器上。</p>\n<p>由于内网服务缺乏公网 <code v-pre>IP</code> 地址，因此无法直接被非局域网内的用户访问。用户通过访问服务端的 <code v-pre>frps</code>，<code v-pre>frp</code> 负责根据请求的端口或其他信息将请求路由到相应的内网机器，从而实现从局域网外的计算机向局域网进行通信。</p>\n<p>在 <code v-pre>frp</code> 中，一个代理对应一个需要公开访问的内网服务。一个客户端可以同时配置多个代理，以满足不同的需求。</p>\n<p><code v-pre>frp</code> 支持多种代理类型，以适应不同的使用场景。以下是一些常见的代理类型：</p>\n<ul>\n<li><strong>TCP</strong>：提供纯粹的 <code v-pre>TCP</code> 端口映射，使服务端能够根据不同的端口将请求路由到不同的内网服务</li>\n<li><strong>UDP</strong>：提供纯粹的 <code v-pre>UDP</code> 端口映射，与 <code v-pre>TCP</code> 代理类似，但用于 <code v-pre>UDP</code> 流量</li>\n<li><strong>HTTP</strong>：专为 <code v-pre>HTTP</code> 应用设计，支持修改 <code v-pre>Host Header</code> 和增加鉴权等额外功能</li>\n<li><strong>HTTPS</strong>：类似于 <code v-pre>HTTP</code> 代理，但专门用于处理 <code v-pre>HTTPS</code> 流量</li>\n<li><strong>STCP</strong>：提供安全的 <code v-pre>TCP</code> 内网代理，要求在被访问者和访问者的机器上都部署 <code v-pre>frpc</code>，不需要在服务端暴露端口</li>\n<li><strong>SUDP</strong>：提供安全的 <code v-pre>UDP</code> 内网代理，与 <code v-pre>STCP</code> 类似，需要在被访问者和访问者的机器上都部署 <code v-pre>frpc</code>，不需要在服务端暴露端口</li>\n<li><strong>XTCP</strong>：点对点内网穿透代理，与 <code v-pre>STCP</code> 类似，但流量不需要经过服务器中转</li>\n<li><strong>TCPMUX</strong>：支持服务端 <code v-pre>TCP</code> 端口的多路复用，允许通过同一端口访问不同的内网服务</li>\n</ul>\n<p>每种代理类型适用于不同的使用情境，您可以根据需求选择合适的代理类型来配置 <code v-pre>frp</code>，这里我尽可能追寻默认。</p>\n<h1 id=\"_3-frp-的实践过程\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-frp-的实践过程\"><span>3.frp 的实践过程</span></a></h1>\n<h2 id=\"_3-1-代理单个-ssh-服务访问一台内网机器\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-1-代理单个-ssh-服务访问一台内网机器\"><span>3.1.代理单个 ssh 服务访问一台内网机器</span></a></h2>\n<h3 id=\"_3-1-1-准备环境\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-1-1-准备环境\"><span>3.1.1.准备环境</span></a></h3>\n<div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>注意：当然，前提是内网机器已经部署了 <code v-pre>ssh</code> 连接，否则后面都是空谈...</p>\n</div>\n<p>首先需要准备三台机器，我这里以及有：</p>\n<ul>\n<li>一台具有公网 <code v-pre>ip</code> 的 <code v-pre>Ubuntu20</code> 服务器 <code v-pre>public_server</code>，分配公网 <code v-pre>IP</code> 假设为 <code v-pre>x.x.x.x</code></li>\n<li>一台我自己组件子网的 <code v-pre>Ubuntu24</code> 电脑 <code v-pre>private_server</code></li>\n<li>一台直连运行商 <code v-pre>4G</code> 网络的本地 <code v-pre>apple</code> 电脑 <code v-pre>self_server</code></li>\n</ul>\n<p>此时 <code v-pre>private_server</code> 和 <code v-pre>self_server</code> 都可以访问 <code v-pre>public_server</code>，但是 <code v-pre>self_server</code> 无法访问到 <code v-pre>private_server</code>。</p>\n<p>我们此时要做到的就是 <code v-pre>self_server</code> 可以成功借助 <code v-pre>public_server</code> 访问到 <code v-pre>private_server</code>。</p>\n<h3 id=\"_3-1-2-编写-frp-配置文件\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-1-2-编写-frp-配置文件\"><span>3.1.2.编写 frp 配置文件</span></a></h3>\n<p>此时我们先把之前在 <code v-pre>public_server</code> 的 <code v-pre>frp/</code> 文件夹及其内部的内容全部复制到 <code v-pre>private_server</code> 中。然后接下来记住：</p>\n<ul>\n<li><code v-pre>public_server</code> 持有文件 <code v-pre>frps, frps.toml, frps.service</code></li>\n<li><code v-pre>private_server</code> 持有文件 <code v-pre>frpc, frpc.toml, frpc.service</code></li>\n</ul>\n<p>根据我之前的提示，修改配置文件。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># public_server</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> vim</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frps.toml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frps.toml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">bindPort</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 7000</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 保持不变即可, 不过注意 public_server 服务器需要开启这个端口</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># private_server</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> vim</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frpc.toml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frpc.toml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">serverAddr</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">x.x.x.x</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 公网机器</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">serverPort</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 7000</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 一定要和上面的 bindPort 保持同步</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">proxies</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">name</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">frp-tcp</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 这里我换了一个名字</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">type</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">tcp</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">localIP</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">127.0.0.1</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">localPort</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 22</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">remotePort</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 6000</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 这个端口也一定要在 public_server 上开放</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3 id=\"_3-1-3-编写-systemd-配置文件\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-1-3-编写-systemd-配置文件\"><span>3.1.3.编写 systemd 配置文件</span></a></h3>\n<p>然后再配置文件的基础上，配置服务文件，因为我们一般都是直接使用 <code v-pre>systemd</code> 来管理服务端或客户端的。</p>\n<div class=\"hint-container caution\">\n<p class=\"hint-container-title\">警告</p>\n<p>警告：不过这里官方只配置了一服务端程序的配置文件，这里我把客户端程序的配置文件也给出了，为了方便您后续的使用。而且我还做了一些配置上的改动，增强这个 <code v-pre>frp</code> 服务，提高可用性。</p>\n</div>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 在 public_server 上创建 frps.service 配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 编写配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> vim</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/systemd/system/frps.service</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/systemd/system/frps.service</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Unit</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Description</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frp</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> server</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 服务名称，可自定义</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">After</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> network-online.target</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> syslog.target</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 定义启动顺序: 当前服务要等到系统的网络相关服务, 日志系统相关服务启动之后再启动</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Wants</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> network-online.target</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 定义软依赖关系: 尽可能启动网络服务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># Requires = ... # 定义硬依赖关系: ...</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Service</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Type</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> simple</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 定义服务启动类型</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">ExecStart</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">这里填入您的</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frps</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 可执行程序的路</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">径</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -c</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">这里填入您的</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frps.toml</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 配置文件的路</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">径</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 启动 frps 的命令, 需修改为您的 frps 的安装路径</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Install</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 这个不再展开, 要细细研究 systemd 一系列的知识才能正确理解...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">WantedBy</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> multi-user.target</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 在 private_server 上创建 frpc.service 配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 编写配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> vim</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/systemd/system/frpc.service</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/systemd/system/frpc.service</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Unit</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Description</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frp</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> client</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 服务名称，可自定义</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">After</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> network-online.target</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> syslog.target</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 定义启动顺序: 当前服务要等到系统的网络相关服务, 日志系统相关服务启动之后再启动</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Wants</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> network-online.target</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 定义软依赖关系: 尽可能启动网络服务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># Requires = ... # 定义硬依赖关系: ...</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Service</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Type</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> simple</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 定义服务启动类型</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">ExecStart</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">这里填入您的</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frpc</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 可执行程序的路</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">径</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -c</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">这里填入您的</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frpc.toml</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 配置文件的路</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">径</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 启动 frps 的命令, 需修改为您的 frpc 的安装路径</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Install</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 这个不再展开, 要细细研究 systemd 一系列的知识才能正确理解...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">WantedBy</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> multi-user.target</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>区别：软依赖和硬依赖的区别。</p>\n<ul>\n<li><strong>软依赖（Wants=）</strong>：表示一种<strong>非强制性依赖</strong>关系，启动当前服务时，会尽可能尝试启动依赖的服务，但即使依赖的服务启动失败，当前服务也会继续启动。适合那些不强制要求依赖服务的场景，即使依赖的服务未成功启动，当前服务依旧可以独立运行。</li>\n<li><strong>硬依赖（Requires=）</strong>：表示一种<strong>强制性依赖</strong>关系，启动当前服务时，要求依赖的服务必须成功启动，否则当前服务也会启动失败。若依赖的服务在运行过程中失败并退出，当前服务也会因此被终止。</li>\n</ul>\n</div>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：添加重启策略。</p>\n<p>我所在的地方经常停电，因此我对于自动重启是强需求，因此我补充下面这个具有重启策略的文件供您参考。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 在 private_server 上重新 frpc.service 配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 编写配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> vim</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/systemd/system/frpc.service</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/systemd/system/frpc.service</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Unit</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Description</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frp</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> client</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 服务名称，可自定义</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">After</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> network-online.target</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> syslog.target</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 定义启动顺序: 当前服务要等到系统的网络相关服务, 日志系统相关服务启动之后再启动</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Wants</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> network-online.target</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 定义软依赖关系: 尽可能启动网络服务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># Requires = ... # 定义硬依赖关系: ...</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Service</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Type</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> simple</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 定义服务启动类型</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">ExecStart</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">这里填入您的</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frpc</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 可执行程序的路</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">径</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -c</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">这里填入您的</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frpc.toml</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 配置文件的路</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">径</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 启动 frps 的命令, 需修改为您的 frpc 的安装路径</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">Restart</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">on-failure</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">          # 失败时自动重启</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">RestartSec</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">5s</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">               # 重启间隔时间（5秒）</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Install</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">WantedBy</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">=</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">multi-user.target</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></div>\n<h3 id=\"_3-1-4-管理服务\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-1-4-管理服务\"><span>3.1.4.管理服务</span></a></h3>\n<p>然后也是经典的 <code v-pre>systemd</code> 管理指令来进行管理。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 管理 frps.service 服务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 重载 frps.service 服务文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> daemon-reload</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 启动 frps.service 服务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> start</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frps.service</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 设置 frps.service 服务为开机自启动</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> enable</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frps.service</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看 frps.service 状态</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> status</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frps.service</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 管理 frpc.service 服务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 重载 frpc.service 服务文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> daemon-reload</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 启动 frpc.service 服务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> start</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frpc.service</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 设置 frpc.service 服务为开机自启动</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> enable</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frpc.service</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看 frpc.service 状态</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> status</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frpc.service</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3 id=\"_3-1-5-使用内网穿透\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-1-5-使用内网穿透\"><span>3.1.5.使用内网穿透</span></a></h3>\n<p>然后使用 <code v-pre>ssh -p 6001 private_server_user_name@x.x.x.x</code> 在 <code v-pre>self_server</code> 上开始内网穿透，能输入密码并且访问到 <code v-pre>bash</code> 终端就说明穿透成功。</p>\n<h2 id=\"_3-2-代理多个-ssh-服务访问多台内网机器\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-2-代理多个-ssh-服务访问多台内网机器\"><span>3.2.代理多个 ssh 服务访问多台内网机器</span></a></h2>\n<p>但是如果希望配置多个 <code v-pre>ssh</code> 服务怎么办呢？照葫芦画瓢。</p>\n<h3 id=\"_3-2-1-准备环境\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-2-1-准备环境\"><span>3.2.1.准备环境</span></a></h3>\n<p>假设我现在有一台 <code v-pre>public_server</code>，以及两台 <code v-pre>private_server_1, private_server_2</code> 和一台 <code v-pre>self_server</code>，我们希望 <code v-pre>self_server</code> 可以通过 <code v-pre>public_server</code> 访问 <code v-pre>private_server_1, private_server_2</code>。</p>\n<p>这种做法可以，但是需要换一种协议，这种协议就是 <code v-pre>tcpmux</code>，可以让我们只使用一个端口就可以连接多台服务器。</p>\n<h3 id=\"_3-2-2-编写-frp-配置文件\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-2-2-编写-frp-配置文件\"><span>3.2.2.编写 frp 配置文件</span></a></h3>\n<div class=\"language-toml line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"toml\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-toml\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># frps.toml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">bindPort</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 7000</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # frps 服务的运行端口</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">tcpmuxHTTPConnectPort</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 5002</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 多路复用代理端口, 通过一个 TCP 连接发送多个 HTTP 请求</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-toml line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"toml\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-toml\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># frpc.toml</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">serverAddr</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">x.x.x.x</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # frps 服务的运行地址</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">serverPort</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 7000</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # frps 服务的运行端口</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[[</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">proxies</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">server_name</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 我改为了 private_server_1 和 private_server_2</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">type</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">tcpmux</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 注意协议更换了</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">multiplexer</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">httpconnect</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 允许多路复用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">customDomains</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> [</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">server_name.com</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 自定义域名, 我改为了 private_server_1.com 和 private_server_2.com</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">localIP</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">127.0.0.1</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">localPort</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 22</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>注意：多个 <code v-pre>private_server</code> 复用上面的 <code v-pre>frpc.toml</code> 即可，注意还是需要做些修改才能进行复用。</p>\n</div>\n<h3 id=\"_3-2-3-编写-systemd-配置文件\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-2-3-编写-systemd-配置文件\"><span>3.2.3.编写 systemd 配置文件</span></a></h3>\n<p>然后再配置文件的基础上，配置服务文件。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 在 public_server 上创建 frps.service 配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 编写配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> vim</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/systemd/system/frps.service</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/systemd/system/frps.service</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Unit</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Description</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frp</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> server</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 服务名称，可自定义</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">After</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> network-online.target</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> syslog.target</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 定义启动顺序: 当前服务要等到系统的网络相关服务, 日志系统相关服务启动之后再启动</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Wants</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> network-online.target</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 定义软依赖关系: 尽可能启动网络服务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># Requires = ... # 定义硬依赖关系: ...</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Service</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Type</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> simple</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 定义服务启动类型</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">ExecStart</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">这里填入您的</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frps</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 可执行程序的路</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">径</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -c</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">这里填入您的</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frps.toml</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 配置文件的路</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">径</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 启动 frps 的命令, 需修改为您的 frps 的安装路径</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Install</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 这个不再展开, 要细细研究 systemd 一系列的知识才能正确理解...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">WantedBy</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> multi-user.target</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 在 private_server 上都创建一样的 frpc.service 配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 编写配置文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> vim</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/systemd/system/frpc.service</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> cat</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> /etc/systemd/system/frpc.service</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Unit</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Description</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frp</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> client</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 服务名称，可自定义</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">After</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> network-online.target</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> syslog.target</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 定义启动顺序: 当前服务要等到系统的网络相关服务, 日志系统相关服务启动之后再启动</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Wants</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> network-online.target</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 定义软依赖关系: 尽可能启动网络服务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># Requires = ... # 定义硬依赖关系: ...</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Service</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Type</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> simple</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 定义服务启动类型</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">ExecStart</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">这里填入您的</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frpc</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 可执行程序的路</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">径</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -c</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">这里填入您的</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frpc.toml</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> 配置文件的路</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">径</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 启动 frps 的命令, 需修改为您的 frpc 的安装路径</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">Install</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">]</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> # 这个不再展开, 要细细研究 systemd 一系列的知识才能正确理解...</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">WantedBy</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> multi-user.target</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3 id=\"_3-1-4-管理服务-1\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-1-4-管理服务-1\"><span>3.1.4.管理服务</span></a></h3>\n<p>然后也是经典的 <code v-pre>systemd</code> 管理指令来进行管理。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 管理 frps.service 服务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 重载 frps.service 服务文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> daemon-reload</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 启动 frps.service 服务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> start</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frps.service</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 设置 frps.service 服务为开机自启动</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> enable</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frps.service</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看 frps.service 状态</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> status</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frps.service</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 管理 frpc.service 服务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 重载 frpc.service 服务文件</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> daemon-reload</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 启动 frpc.service 服务</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> start</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frpc.service</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 设置 frpc.service 服务为开机自启动</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> enable</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frpc.service</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 查看 frpc.service 状态</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">$</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> sudo</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> systemctl</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> status</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> frpc.service</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3 id=\"_3-1-5-使用内网穿透-1\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_3-1-5-使用内网穿透-1\"><span>3.1.5.使用内网穿透</span></a></h3>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：要使用还必须在本主机上下载 <code v-pre>socat</code>...</p>\n</div>\n<p>使用 <code v-pre>SSH ProxyCommand</code> 访问内网机器 <code v-pre>private_server_1</code>，假设用户名为 <code v-pre>test</code>。使用以下命令：</p>\n<div class=\"language-bash line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"bash\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-bash\"><span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">ssh</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -o</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">proxycommand socat - PROXY:x.x.x.x:%h:%p,proxyport=5002</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> test@private_server_1.com</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div></div></div><p>要访问内网机器 <code v-pre>B</code>，只需更改域名，假设用户名仍然为 <code v-pre>test</code>：</p>\n<div class=\"language-bash line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"bash\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-bash\"><span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">ssh</span><span style=\"--shiki-light:#A65E2B;--shiki-dark:#C99076\"> -o</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">proxycommand socat - PROXY:x.x.x.x:%h:%p,proxyport=5002</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> test@private_server_2.com</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div></div></div><p>通过按照以上步骤进行配置，您可以实现多个 <code v-pre>SSH</code> 服务复用同一端口，以便在具有公网 <code v-pre>IP</code> 的机器上进行访问。</p>\n<div class=\"hint-container important\">\n<p class=\"hint-container-title\">重要</p>\n<p>补充：不过这有一个麻烦，就是使用某些 <code v-pre>ssh</code> 连接软件的时候不太好配置，并且有时装发压力比较大...</p>\n</div>\n<hr>\n<div class=\"hint-container note\">\n<p class=\"hint-container-title\">注</p>\n<p>结语：...</p>\n</div>\n<p><strong>如果本系列文章对您有帮助，可以 <a href=\"https://github.com/xiaogithubooo/LimouLearnNote\" target=\"_blank\" rel=\"noopener noreferrer\">star 一下我的 limou-learn-note</a>，求求惹(๑＞ ＜)☆♡~</strong></p>\n<div class=\"language- line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-\"><span class=\"line\"><span>[Unit]</span></span>\n<span class=\"line\"><span>Description=Magic Service</span></span>\n<span class=\"line\"><span>After=network.target</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>[Service]</span></span>\n<span class=\"line\"><span>ExecStart=/home/ljp/.config/mihomo/clash-linux</span></span>\n<span class=\"line\"><span>Restart=on-failure</span></span>\n<span class=\"line\"><span>User=ljp</span></span>\n<span class=\"line\"><span>WorkingDirectory=/home/ljp/.config/mihomo/</span></span>\n<span class=\"line\"><span>StandardOutput=syslog</span></span>\n<span class=\"line\"><span>StandardError=syslog</span></span>\n<span class=\"line\"><span>SyslogIdentifier=clash-linux</span></span>\n<span class=\"line\"><span></span></span>\n<span class=\"line\"><span>[Install]</span></span>\n<span class=\"line\"><span>WantedBy=multi-user.target</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div>","tagOpen":"<template>","tagClose":"</template>"},"script":null,"scriptSetup":null,"scripts":[],"styles":[],"customBlocks":[]},"content":"\n# 1.frp 的安装运行\n\n[直接去 frp 官网获取其对应的二进制文件即可](https://gofrp.org/zh-cn/docs/setup/)，而这里我以 `Ubuntu` 为例子，使用 `wget` 进行安装，并且只在 `Ubuntu` 的具有公网 `ip` 的机器上尝试运行。\n\n>   [!CAUTION]\n>\n>   警告：我们这里只是尝试运行，不代表真正应用 `frp`，因此下载好 `frp` 后，配置文件我暂时不修改，只是做个解读。\n\n>   [!CAUTION]\n>\n>   警告：整个下载配置运行的过程，我都在具有公网 `IP` 服务器上进行了配置。\n\n```shell\n# 安装 frp\n# 下载 frp 的二进制文件压缩包\n$ wget https://github.com/fatedier/frp/releases/download/v0.60.0/frp_0.60.0_linux_amd64.tar.gz\n\n# 解压 frp 的压缩包\n$ tar -zxvf frp_0.60.0_linux_amd64.tar.gz\n\n# 重命名解压文件夹\n$ mv frp_0.60.0_linux_amd64 frp\n\n# 打开解压文件夹\n$ cd frp\n\n# 查看当前目录下的文件\n$ ls\nfrpc  frpc.toml  frps  frps.toml  LICENSE\n\n```\n\n```shell\n# 查看 frp\n# 查看当前服务端程序的配置文件\n$ cat frps.toml # 不过我们先按照默认的即可, 我们只在本地稍微测试一下就行\nbindPort = 7000 # frp 服务端程序在公网服务器中运行时所在的端口\n\n# 查看当前客户端程序的配置文件\n$ cat frpc.toml\nserverAddr = \"127.0.0.1\" # 后续要改为公网服务器的公网 ip(后面是一定要修改的)\nserverPort = 7000 # 就是前面的端口, 客户端通过 serverAddr+serverPort 才能找到公网机器中的 frp 服务端程序(因此要和前面 frps.toml 中的 bindPort 保持同步)\n\n[[proxies]] # proxies 就是代理的意思\nname = \"test-tcp\" # 客户端名称(可选修改)\ntype = \"tcp\" # 采用的代理协议(没有特殊需求无需修改)\nlocalIP = \"127.0.0.1\" # 转发到这个 ip\nlocalPort = 22 # 转发到这个 port\nremotePort = 6000 # 公网机器上对外开放的端口, 用于支持外界穿透到内网(这样其他非内网主机就可以把对 \"公网ip+remotePort\" 的请求转发到 \"localIP+localPort\" 上进行处理)\n\n```\n\n```shell\n# 运行 frp\n$ ./frps -c ./frps.toml # 使用以下命令启动服务端程序\n[1] 558528\n2024-09-09 00:18:12.920 [I] [frps/root.go:105] frps uses config file: ./frps.toml\n2024-09-09 00:18:13.171 [I] [server/service.go:237] frps tcp listen on 0.0.0.0:7000\n2024-09-09 00:18:13.172 [I] [frps/root.go:114] frps started successfully\n\n$ ./frpc -c ./frpc.toml # 使用以下命令启动客户端程序\n2024-09-09 00:21:01.337 [I] [sub/root.go:142] start frpc service for config file [./frpc.toml]\n2024-09-09 00:21:01.337 [I] [client/service.go:295] try to connect to server...\n2024-09-09 00:21:01.342 [I] [server/service.go:576] [42307efebbdeb377] client login info: ip [127.0.0.1:48018] version [0.60.0] hostname [] os [linux] arch [amd64]\n2024-09-09 00:21:01.342 [I] [client/service.go:287] [42307efebbdeb377] login to server success, get run id [42307efebbdeb377]\n2024-09-09 00:21:01.342 [I] [proxy/proxy_manager.go:173] [42307efebbdeb377] proxy added: [test-tcp]\n2024-09-09 00:21:01.343 [I] [proxy/tcp.go:82] [42307efebbdeb377] [test-tcp] tcp proxy listen port [6000]\n2024-09-09 00:21:01.343 [I] [server/control.go:399] [42307efebbdeb377] new proxy [test-tcp] type [tcp] success\n2024-09-09 00:21:01.343 [I] [client/control.go:168] [42307efebbdeb377] [test-tcp] start proxy success\n```\n\n可以看到没有什么明显的报错，这代表我们安装成功了。\n\n# 2.frp 的工作原理\n\n`frp` 主要由两个组件组成：`客户端(frpc)` 和 `服务端(frps)`。通常情况下，服务端部署在具有公网 `IP` 地址的机器上，而客户端部署在需要穿透的内网服务所在的机器上。\n\n由于内网服务缺乏公网 `IP` 地址，因此无法直接被非局域网内的用户访问。用户通过访问服务端的 `frps`，`frp` 负责根据请求的端口或其他信息将请求路由到相应的内网机器，从而实现从局域网外的计算机向局域网进行通信。\n\n在 `frp` 中，一个代理对应一个需要公开访问的内网服务。一个客户端可以同时配置多个代理，以满足不同的需求。\n\n`frp` 支持多种代理类型，以适应不同的使用场景。以下是一些常见的代理类型：\n\n*   **TCP**：提供纯粹的 `TCP` 端口映射，使服务端能够根据不同的端口将请求路由到不同的内网服务\n*   **UDP**：提供纯粹的 `UDP` 端口映射，与 `TCP` 代理类似，但用于 `UDP` 流量\n*   **HTTP**：专为 `HTTP` 应用设计，支持修改 `Host Header` 和增加鉴权等额外功能\n*   **HTTPS**：类似于 `HTTP` 代理，但专门用于处理 `HTTPS` 流量\n*   **STCP**：提供安全的 `TCP` 内网代理，要求在被访问者和访问者的机器上都部署 `frpc`，不需要在服务端暴露端口\n*   **SUDP**：提供安全的 `UDP` 内网代理，与 `STCP` 类似，需要在被访问者和访问者的机器上都部署 `frpc`，不需要在服务端暴露端口\n*   **XTCP**：点对点内网穿透代理，与 `STCP` 类似，但流量不需要经过服务器中转\n*   **TCPMUX**：支持服务端 `TCP` 端口的多路复用，允许通过同一端口访问不同的内网服务\n\n每种代理类型适用于不同的使用情境，您可以根据需求选择合适的代理类型来配置 `frp`，这里我尽可能追寻默认。\n\n# 3.frp 的实践过程\n\n## 3.1.代理单个 ssh 服务访问一台内网机器\n\n### 3.1.1.准备环境\n\n>   [!WARNING]\n>\n>   注意：当然，前提是内网机器已经部署了 `ssh` 连接，否则后面都是空谈...\n\n首先需要准备三台机器，我这里以及有：\n\n- 一台具有公网 `ip` 的 `Ubuntu20` 服务器 `public_server`，分配公网 `IP` 假设为 `x.x.x.x`\n- 一台我自己组件子网的 `Ubuntu24` 电脑 `private_server`\n- 一台直连运行商 `4G` 网络的本地 `apple` 电脑 `self_server`\n\n此时 `private_server` 和 `self_server` 都可以访问 `public_server`，但是 `self_server` 无法访问到 `private_server`。 \n\n我们此时要做到的就是 `self_server` 可以成功借助 `public_server` 访问到 `private_server`。\n\n### 3.1.2.编写 frp 配置文件\n\n此时我们先把之前在 `public_server` 的 `frp/` 文件夹及其内部的内容全部复制到 `private_server` 中。然后接下来记住：\n\n-   `public_server` 持有文件 `frps, frps.toml, frps.service`\n-   `private_server` 持有文件 `frpc, frpc.toml, frpc.service`\n\n根据我之前的提示，修改配置文件。\n\n```shell\n# public_server\n$ vim frps.toml\n$ cat frps.toml\nbindPort = 7000 # 保持不变即可, 不过注意 public_server 服务器需要开启这个端口\n```\n\n```shell\n# private_server\n$ vim frpc.toml\n$ cat frpc.toml\nserverAddr = \"x.x.x.x\" # 公网机器\nserverPort = 7000 # 一定要和上面的 bindPort 保持同步\n\n[[proxies]]\nname = \"frp-tcp\" # 这里我换了一个名字\ntype = \"tcp\"\nlocalIP = \"127.0.0.1\"\nlocalPort = 22\nremotePort = 6000 # 这个端口也一定要在 public_server 上开放\n```\n\n### 3.1.3.编写 systemd 配置文件\n\n然后再配置文件的基础上，配置服务文件，因为我们一般都是直接使用 `systemd` 来管理服务端或客户端的。\n\n>   [!CAUTION]\n>\n>   警告：不过这里官方只配置了一服务端程序的配置文件，这里我把客户端程序的配置文件也给出了，为了方便您后续的使用。而且我还做了一些配置上的改动，增强这个 `frp` 服务，提高可用性。\n\n```shell\n# 在 public_server 上创建 frps.service 配置文件\n# 编写配置文件\n$ sudo vim /etc/systemd/system/frps.service\n$ cat /etc/systemd/system/frps.service\n[Unit]\nDescription = frp server # 服务名称，可自定义\nAfter = network-online.target syslog.target # 定义启动顺序: 当前服务要等到系统的网络相关服务, 日志系统相关服务启动之后再启动\nWants = network-online.target # 定义软依赖关系: 尽可能启动网络服务\n# Requires = ... # 定义硬依赖关系: ...\n\n[Service]\nType = simple # 定义服务启动类型\nExecStart = <这里填入您的 frps 可执行程序的路径> -c <这里填入您的 frps.toml 配置文件的路径> # 启动 frps 的命令, 需修改为您的 frps 的安装路径\n\n[Install] # 这个不再展开, 要细细研究 systemd 一系列的知识才能正确理解...\nWantedBy = multi-user.target\n\n```\n\n```shell\n# 在 private_server 上创建 frpc.service 配置文件\n# 编写配置文件\n$ sudo vim /etc/systemd/system/frpc.service\n$ cat /etc/systemd/system/frpc.service\n[Unit]\nDescription = frp client # 服务名称，可自定义\nAfter = network-online.target syslog.target # 定义启动顺序: 当前服务要等到系统的网络相关服务, 日志系统相关服务启动之后再启动\nWants = network-online.target # 定义软依赖关系: 尽可能启动网络服务\n# Requires = ... # 定义硬依赖关系: ...\n\n[Service]\nType = simple # 定义服务启动类型\nExecStart = <这里填入您的 frpc 可执行程序的路径> -c <这里填入您的 frpc.toml 配置文件的路径> # 启动 frps 的命令, 需修改为您的 frpc 的安装路径\n\n[Install] # 这个不再展开, 要细细研究 systemd 一系列的知识才能正确理解...\nWantedBy = multi-user.target\n\n```\n\n>   [!TIP]\n>\n>   区别：软依赖和硬依赖的区别。\n>\n>   -   **软依赖（Wants=）**：表示一种**非强制性依赖**关系，启动当前服务时，会尽可能尝试启动依赖的服务，但即使依赖的服务启动失败，当前服务也会继续启动。适合那些不强制要求依赖服务的场景，即使依赖的服务未成功启动，当前服务依旧可以独立运行。\n>   -   **硬依赖（Requires=）**：表示一种**强制性依赖**关系，启动当前服务时，要求依赖的服务必须成功启动，否则当前服务也会启动失败。若依赖的服务在运行过程中失败并退出，当前服务也会因此被终止。\n\n>   [!IMPORTANT]\n>\n>   补充：添加重启策略。\n>\n>   我所在的地方经常停电，因此我对于自动重启是强需求，因此我补充下面这个具有重启策略的文件供您参考。\n>\n>   ```shell\n>   # 在 private_server 上重新 frpc.service 配置文件\n>   # 编写配置文件\n>   $ sudo vim /etc/systemd/system/frpc.service\n>   $ cat /etc/systemd/system/frpc.service\n>   [Unit]\n>   Description = frp client # 服务名称，可自定义\n>   After = network-online.target syslog.target # 定义启动顺序: 当前服务要等到系统的网络相关服务, 日志系统相关服务启动之后再启动\n>   Wants = network-online.target # 定义软依赖关系: 尽可能启动网络服务\n>   # Requires = ... # 定义硬依赖关系: ...\n>   \n>   [Service]\n>   Type = simple # 定义服务启动类型\n>   ExecStart = <这里填入您的 frpc 可执行程序的路径> -c <这里填入您的 frpc.toml 配置文件的路径> # 启动 frps 的命令, 需修改为您的 frpc 的安装路径\n>   Restart=on-failure          # 失败时自动重启\n>   RestartSec=5s               # 重启间隔时间（5秒）\n>   \n>   [Install]\n>   WantedBy=multi-user.target\n>   \n>   ```\n\n### 3.1.4.管理服务\n\n然后也是经典的 `systemd` 管理指令来进行管理。\n\n```shell\n# 管理 frps.service 服务\n# 重载 frps.service 服务文件\n$ sudo systemctl daemon-reload\n\n# 启动 frps.service 服务\nsudo systemctl start frps.service\n\n# 设置 frps.service 服务为开机自启动\nsudo systemctl enable frps.service\n\n# 查看 frps.service 状态\nsudo systemctl status frps.service\n\n```\n\n```shell\n# 管理 frpc.service 服务\n# 重载 frpc.service 服务文件\n$ sudo systemctl daemon-reload\n\n# 启动 frpc.service 服务\n$ sudo systemctl start frpc.service\n\n# 设置 frpc.service 服务为开机自启动\n$ sudo systemctl enable frpc.service\n\n# 查看 frpc.service 状态\n$ sudo systemctl status frpc.service\n\n```\n\n### 3.1.5.使用内网穿透\n\n然后使用 `ssh -p 6001 private_server_user_name@x.x.x.x` 在 `self_server` 上开始内网穿透，能输入密码并且访问到 `bash` 终端就说明穿透成功。\n\n## 3.2.代理多个 ssh 服务访问多台内网机器\n\n但是如果希望配置多个 `ssh` 服务怎么办呢？照葫芦画瓢。\n\n### 3.2.1.准备环境\n\n假设我现在有一台 `public_server`，以及两台 `private_server_1, private_server_2` 和一台 `self_server`，我们希望 `self_server` 可以通过 `public_server` 访问 `private_server_1, private_server_2`。\n\n这种做法可以，但是需要换一种协议，这种协议就是 `tcpmux`，可以让我们只使用一个端口就可以连接多台服务器。\n\n### 3.2.2.编写 frp 配置文件\n\n```toml\n# frps.toml\nbindPort = 7000 # frps 服务的运行端口\ntcpmuxHTTPConnectPort = 5002 # 多路复用代理端口, 通过一个 TCP 连接发送多个 HTTP 请求\n\n```\n\n```toml\n# frpc.toml\nserverAddr = \"x.x.x.x\" # frps 服务的运行地址\nserverPort = 7000 # frps 服务的运行端口\n\n[[proxies]]\nname = \"server_name\" # 我改为了 private_server_1 和 private_server_2\ntype = \"tcpmux\" # 注意协议更换了\nmultiplexer = \"httpconnect\" # 允许多路复用\ncustomDomains = [\"server_name.com\"] # 自定义域名, 我改为了 private_server_1.com 和 private_server_2.com\nlocalIP = \"127.0.0.1\"\nlocalPort = 22\n\n```\n\n>   [!WARNING]\n>\n>   注意：多个 `private_server` 复用上面的 `frpc.toml` 即可，注意还是需要做些修改才能进行复用。\n\n### 3.2.3.编写 systemd 配置文件\n\n然后再配置文件的基础上，配置服务文件。\n\n```shell\n# 在 public_server 上创建 frps.service 配置文件\n# 编写配置文件\n$ sudo vim /etc/systemd/system/frps.service\n$ cat /etc/systemd/system/frps.service\n[Unit]\nDescription = frp server # 服务名称，可自定义\nAfter = network-online.target syslog.target # 定义启动顺序: 当前服务要等到系统的网络相关服务, 日志系统相关服务启动之后再启动\nWants = network-online.target # 定义软依赖关系: 尽可能启动网络服务\n# Requires = ... # 定义硬依赖关系: ...\n\n[Service]\nType = simple # 定义服务启动类型\nExecStart = <这里填入您的 frps 可执行程序的路径> -c <这里填入您的 frps.toml 配置文件的路径> # 启动 frps 的命令, 需修改为您的 frps 的安装路径\n\n[Install] # 这个不再展开, 要细细研究 systemd 一系列的知识才能正确理解...\nWantedBy = multi-user.target\n\n```\n\n```shell\n# 在 private_server 上都创建一样的 frpc.service 配置文件\n# 编写配置文件\n$ sudo vim /etc/systemd/system/frpc.service\n$ cat /etc/systemd/system/frpc.service\n[Unit]\nDescription = frp client # 服务名称，可自定义\nAfter = network-online.target syslog.target # 定义启动顺序: 当前服务要等到系统的网络相关服务, 日志系统相关服务启动之后再启动\nWants = network-online.target # 定义软依赖关系: 尽可能启动网络服务\n# Requires = ... # 定义硬依赖关系: ...\n\n[Service]\nType = simple # 定义服务启动类型\nExecStart = <这里填入您的 frpc 可执行程序的路径> -c <这里填入您的 frpc.toml 配置文件的路径> # 启动 frps 的命令, 需修改为您的 frpc 的安装路径\n\n[Install] # 这个不再展开, 要细细研究 systemd 一系列的知识才能正确理解...\nWantedBy = multi-user.target\n\n```\n\n### 3.1.4.管理服务\n\n然后也是经典的 `systemd` 管理指令来进行管理。\n\n```shell\n# 管理 frps.service 服务\n# 重载 frps.service 服务文件\n$ sudo systemctl daemon-reload\n\n# 启动 frps.service 服务\nsudo systemctl start frps.service\n\n# 设置 frps.service 服务为开机自启动\nsudo systemctl enable frps.service\n\n# 查看 frps.service 状态\nsudo systemctl status frps.service\n\n```\n\n```shell\n# 管理 frpc.service 服务\n# 重载 frpc.service 服务文件\n$ sudo systemctl daemon-reload\n\n# 启动 frpc.service 服务\n$ sudo systemctl start frpc.service\n\n# 设置 frpc.service 服务为开机自启动\n$ sudo systemctl enable frpc.service\n\n# 查看 frpc.service 状态\n$ sudo systemctl status frpc.service\n\n```\n\n### 3.1.5.使用内网穿透\n\n>   [!IMPORTANT]\n>\n>   补充：要使用还必须在本主机上下载 `socat`...\n\n使用 `SSH ProxyCommand` 访问内网机器 `private_server_1`，假设用户名为 `test`。使用以下命令：\n\n```bash\nssh -o 'proxycommand socat - PROXY:x.x.x.x:%h:%p,proxyport=5002' test@private_server_1.com\n```\n\n要访问内网机器 `B`，只需更改域名，假设用户名仍然为 `test`：\n\n```bash\nssh -o 'proxycommand socat - PROXY:x.x.x.x:%h:%p,proxyport=5002' test@private_server_2.com\n```\n\n通过按照以上步骤进行配置，您可以实现多个 `SSH` 服务复用同一端口，以便在具有公网 `IP` 的机器上进行访问。\n\n>   [!IMPORTANT]\n>\n>   补充：不过这有一个麻烦，就是使用某些 `ssh` 连接软件的时候不太好配置，并且有时装发压力比较大...\n\n------\n\n>   [!NOTE]\n>\n>   结语：...\n\n**如果本系列文章对您有帮助，可以 [star 一下我的 limou-learn-note](https://github.com/xiaogithubooo/LimouLearnNote)，求求惹(๑＞ ＜)☆♡~**\n\n\n\n```\n[Unit]\nDescription=Magic Service\nAfter=network.target\n\n[Service]\nExecStart=/home/ljp/.config/mihomo/clash-linux\nRestart=on-failure\nUser=ljp\nWorkingDirectory=/home/ljp/.config/mihomo/\nStandardOutput=syslog\nStandardError=syslog\nSyslogIdentifier=clash-linux\n\n[Install]\nWantedBy=multi-user.target\n```","excerpt":"","includedFiles":[],"tasklistId":0,"title":"1.frp 的安装运行","headers":[{"level":2,"title":"3.1.代理单个 ssh 服务访问一台内网机器","slug":"_3-1-代理单个-ssh-服务访问一台内网机器","link":"#_3-1-代理单个-ssh-服务访问一台内网机器","children":[{"level":3,"title":"3.1.1.准备环境","slug":"_3-1-1-准备环境","link":"#_3-1-1-准备环境","children":[]},{"level":3,"title":"3.1.2.编写 frp 配置文件","slug":"_3-1-2-编写-frp-配置文件","link":"#_3-1-2-编写-frp-配置文件","children":[]},{"level":3,"title":"3.1.3.编写 systemd 配置文件","slug":"_3-1-3-编写-systemd-配置文件","link":"#_3-1-3-编写-systemd-配置文件","children":[]},{"level":3,"title":"3.1.4.管理服务","slug":"_3-1-4-管理服务","link":"#_3-1-4-管理服务","children":[]},{"level":3,"title":"3.1.5.使用内网穿透","slug":"_3-1-5-使用内网穿透","link":"#_3-1-5-使用内网穿透","children":[]}]},{"level":2,"title":"3.2.代理多个 ssh 服务访问多台内网机器","slug":"_3-2-代理多个-ssh-服务访问多台内网机器","link":"#_3-2-代理多个-ssh-服务访问多台内网机器","children":[{"level":3,"title":"3.2.1.准备环境","slug":"_3-2-1-准备环境","link":"#_3-2-1-准备环境","children":[]},{"level":3,"title":"3.2.2.编写 frp 配置文件","slug":"_3-2-2-编写-frp-配置文件","link":"#_3-2-2-编写-frp-配置文件","children":[]},{"level":3,"title":"3.2.3.编写 systemd 配置文件","slug":"_3-2-3-编写-systemd-配置文件","link":"#_3-2-3-编写-systemd-配置文件","children":[]},{"level":3,"title":"3.1.4.管理服务","slug":"_3-1-4-管理服务-1","link":"#_3-1-4-管理服务-1","children":[]},{"level":3,"title":"3.1.5.使用内网穿透","slug":"_3-1-5-使用内网穿透-1","link":"#_3-1-5-使用内网穿透-1","children":[]}]}]}}
