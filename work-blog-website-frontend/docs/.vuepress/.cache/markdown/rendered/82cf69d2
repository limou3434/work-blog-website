{"content":"<p>[TOC]</p>\n<blockquote>\n<p>概要：...</p>\n</blockquote>\n<blockquote>\n<p>资料：...</p>\n</blockquote>\n<hr>\n<h1 id=\"_1-jni\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-jni\"><span>1.JNI</span></a></h1>\n<h2 id=\"_1-1-设置项目文件结构\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-1-设置项目文件结构\"><span>1.1.设置项目文件结构</span></a></h2>\n<p>假设您的项目结构如下所示，并且都为空白文件。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 项目结构</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">project/</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> JNIDemo.java</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> JNIDemo.cpp</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">...</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2 id=\"_1-2-生成-cpp-头文件\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-生成-cpp-头文件\"><span>1.2.生成 Cpp 头文件</span></a></h2>\n<p>使用 <code v-pre>javah -jni JNIDemo</code> 工具生成 <code v-pre>Cpp</code> 头文件，生成的头文件 <code v-pre>JNIDemo.h</code> 会包含 <code v-pre>JNI</code> 函数签名。这个文件是用来规范 <code v-pre>Cpp</code> 程序员进行代码实现，<code v-pre>Cpp</code> 程序员需要根据这个头文件来进行源文件的实现。</p>\n<div class=\"language-cpp line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"cpp\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// JNIDemo.h</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">/* DO NOT EDIT THIS FILE - it is machine generated */</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">#</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">jni.h</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">></span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> // 这个头文件其实是 Java 官方提供的实现, 使得 Java 虚拟机能够与本地代码进行交互和通信</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">/* Header for class JNIDemo */</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">#</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">ifndef</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> _Included_JNIDemo</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> // 头文件防护符</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">#</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">define</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> _Included_JNIDemo</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">#</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">ifdef</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> __cplusplus</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> // 处理 C/Cpp 符号表规则不一的问题</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">extern</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">C</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">#</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">endif</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">/*</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> * Class:     JNIDemo</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> * Method:    add</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> * Signature: (II)I</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> // 一种简化的函数签名表达, 参数为 (int, int), 返回值为 int</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> */</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">JNIEXPORT jint JNICALL Java_JNIDemo_add</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">  (</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">JNIEnv </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> jobject</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> jint</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> jint</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// JNIEXPORT 宏用于标记一个函数是 JNI 的本地方法</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// JNICALL 宏用于标记 JNI 方法的调用约定, 确保在不同平台上的兼容性</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// 抽离上述的宏, 剩下的 jint Java_JNIDemo_add(JNIEnv *, jobject, jint, jint) 就是比较好理解的函数签名</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    // 函数名中 Java 表示这是一个 JNI 方法; JNIDemo 表示指定了这个 JNI 方法属于哪个 Java 类; add 表示 Java 类中方法的名称</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    // JNIEnv*: 是一个指向 JNI 环境的指针, 提供了访问 JNI API 的方法</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    // jobject: 是一个指向调用 JNI 方法的 Java 对象的引用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    // jint: \t是 JNI 中定义的基本类型, 表示 Java 的 int 类型</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">#</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">ifdef</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> __cplusplus</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">#</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">endif</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">#</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">endif</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><blockquote>\n<p>补充：关于 <code v-pre>JNIEnv*</code> 和 <code v-pre>jobject</code> 的使用，待补充...</p>\n</blockquote>\n<h2 id=\"_1-3-编写-cpp-程序实现\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-3-编写-cpp-程序实现\"><span>1.3.编写 Cpp 程序实现</span></a></h2>\n<div class=\"language-cpp line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"cpp\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// JNIDemo.cpp</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">#</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">jni.h</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">#</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">JNIDemo.h</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">JNIEXPORT jint JNICALL </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Java_JNIDemo_add</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">JNIEnv </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">env</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> jobject obj</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> jint a</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> jint b</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> a </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> b</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2 id=\"_1-4-生成本地-dll-动态库\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-4-生成本地-dll-动态库\"><span>1.4.生成本地 DLL 动态库</span></a></h2>\n<p>使用 <code v-pre>g++ -shared -o native.dll -I &quot;%JAVA_HOME%\\include&quot; -I &quot;%JAVA_HOME%\\include\\win32&quot; JNIDemo.cpp</code> 编译 <code v-pre>Cpp</code> 源文件生成 <code v-pre>DLL</code> 动态库。</p>\n<blockquote>\n<p>补充：在 <code v-pre>Linux</code> 中就是 <code v-pre>g++ -shared -fpic -o libnative.so -I${JAVA_HOME}/include -I${JAVA_HOME}/include/linux JNIDemo.cpp</code>，不过我没有尝试过，待补充...</p>\n</blockquote>\n<h2 id=\"_1-5-编写-java-程序逻辑\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-5-编写-java-程序逻辑\"><span>1.5.编写 Java 程序逻辑</span></a></h2>\n<div class=\"language-java line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"java\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-java\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// JNIDemo.java</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">public</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> JNIDemo</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    // 加载本地的库</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    static</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">        System</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">loadLibrary</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">native</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> // 对应于 native.dll</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">    }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    // 声明本地方法</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    public</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> native</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> int</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> add</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> a</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> int</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> b</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    // 测试可否调用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    public</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> static</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> void</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">String</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[]</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> args</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        JNIDemo</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> demo</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> new</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> JNIDemo</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">        int</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> result</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> demo</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">add</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 4</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">        System</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">out</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">println</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Result: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> result</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">    }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>然后使用 <code v-pre>javac JNIDemo.java</code> 进行编译生成 <code v-pre>JNIDemo.class</code>。</p>\n<h2 id=\"_1-6-运行-java-程序\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-6-运行-java-程序\"><span>1.6.运行 Java 程序</span></a></h2>\n<p>确保 <code v-pre>native.dll</code> 文件位于 <code v-pre>Java</code> 可加载的路径中（例如当前目录），然后使用 <code v-pre>java -Djava.library.path=. JNIDemo</code> 来运行 <code v-pre>Java</code> 程序。</p>\n<h1 id=\"_2-jna\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-jna\"><span>2.JNA</span></a></h1>\n<p>这个 <code v-pre>JNA</code> 貌似性能要差一些，待补充...</p>\n<hr>\n<blockquote>\n<p>结语：...</p>\n</blockquote>\n","env":{"base":"/","filePath":"/home/ljp/git/work/work-blog-website/work-blog-website-frontend/docs/1.编程语言/4.Java/015_limou_2024_07_14_java_多语言交互.md","filePathRelative":"1.编程语言/4.Java/015_limou_2024_07_14_java_多语言交互.md","frontmatter":{"createTime":"2025/06/21 15:33:58","permalink":"/1.编程语言/bc201oza/"},"sfcBlocks":{"template":{"type":"template","content":"<template><p>[TOC]</p>\n<blockquote>\n<p>概要：...</p>\n</blockquote>\n<blockquote>\n<p>资料：...</p>\n</blockquote>\n<hr>\n<h1 id=\"_1-jni\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-jni\"><span>1.JNI</span></a></h1>\n<h2 id=\"_1-1-设置项目文件结构\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-1-设置项目文件结构\"><span>1.1.设置项目文件结构</span></a></h2>\n<p>假设您的项目结构如下所示，并且都为空白文件。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 项目结构</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">project/</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> JNIDemo.java</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> JNIDemo.cpp</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">...</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2 id=\"_1-2-生成-cpp-头文件\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-生成-cpp-头文件\"><span>1.2.生成 Cpp 头文件</span></a></h2>\n<p>使用 <code v-pre>javah -jni JNIDemo</code> 工具生成 <code v-pre>Cpp</code> 头文件，生成的头文件 <code v-pre>JNIDemo.h</code> 会包含 <code v-pre>JNI</code> 函数签名。这个文件是用来规范 <code v-pre>Cpp</code> 程序员进行代码实现，<code v-pre>Cpp</code> 程序员需要根据这个头文件来进行源文件的实现。</p>\n<div class=\"language-cpp line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"cpp\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// JNIDemo.h</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">/* DO NOT EDIT THIS FILE - it is machine generated */</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">#</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">jni.h</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">></span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> // 这个头文件其实是 Java 官方提供的实现, 使得 Java 虚拟机能够与本地代码进行交互和通信</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">/* Header for class JNIDemo */</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">#</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">ifndef</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> _Included_JNIDemo</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> // 头文件防护符</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">#</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">define</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> _Included_JNIDemo</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">#</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">ifdef</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> __cplusplus</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> // 处理 C/Cpp 符号表规则不一的问题</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">extern</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">C</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">#</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">endif</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">/*</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> * Class:     JNIDemo</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> * Method:    add</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> * Signature: (II)I</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> // 一种简化的函数签名表达, 参数为 (int, int), 返回值为 int</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> */</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">JNIEXPORT jint JNICALL Java_JNIDemo_add</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">  (</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">JNIEnv </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> jobject</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> jint</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> jint</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// JNIEXPORT 宏用于标记一个函数是 JNI 的本地方法</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// JNICALL 宏用于标记 JNI 方法的调用约定, 确保在不同平台上的兼容性</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// 抽离上述的宏, 剩下的 jint Java_JNIDemo_add(JNIEnv *, jobject, jint, jint) 就是比较好理解的函数签名</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    // 函数名中 Java 表示这是一个 JNI 方法; JNIDemo 表示指定了这个 JNI 方法属于哪个 Java 类; add 表示 Java 类中方法的名称</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    // JNIEnv*: 是一个指向 JNI 环境的指针, 提供了访问 JNI API 的方法</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    // jobject: 是一个指向调用 JNI 方法的 Java 对象的引用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    // jint: \t是 JNI 中定义的基本类型, 表示 Java 的 int 类型</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">#</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">ifdef</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> __cplusplus</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">#</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">endif</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">#</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">endif</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><blockquote>\n<p>补充：关于 <code v-pre>JNIEnv*</code> 和 <code v-pre>jobject</code> 的使用，待补充...</p>\n</blockquote>\n<h2 id=\"_1-3-编写-cpp-程序实现\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-3-编写-cpp-程序实现\"><span>1.3.编写 Cpp 程序实现</span></a></h2>\n<div class=\"language-cpp line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"cpp\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// JNIDemo.cpp</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">#</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">jni.h</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">#</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">JNIDemo.h</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">JNIEXPORT jint JNICALL </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Java_JNIDemo_add</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">JNIEnv </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">env</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> jobject obj</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> jint a</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> jint b</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> a </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> b</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2 id=\"_1-4-生成本地-dll-动态库\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-4-生成本地-dll-动态库\"><span>1.4.生成本地 DLL 动态库</span></a></h2>\n<p>使用 <code v-pre>g++ -shared -o native.dll -I &quot;%JAVA_HOME%\\include&quot; -I &quot;%JAVA_HOME%\\include\\win32&quot; JNIDemo.cpp</code> 编译 <code v-pre>Cpp</code> 源文件生成 <code v-pre>DLL</code> 动态库。</p>\n<blockquote>\n<p>补充：在 <code v-pre>Linux</code> 中就是 <code v-pre>g++ -shared -fpic -o libnative.so -I${JAVA_HOME}/include -I${JAVA_HOME}/include/linux JNIDemo.cpp</code>，不过我没有尝试过，待补充...</p>\n</blockquote>\n<h2 id=\"_1-5-编写-java-程序逻辑\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-5-编写-java-程序逻辑\"><span>1.5.编写 Java 程序逻辑</span></a></h2>\n<div class=\"language-java line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"java\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-java\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// JNIDemo.java</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">public</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> JNIDemo</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    // 加载本地的库</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    static</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">        System</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">loadLibrary</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">native</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> // 对应于 native.dll</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">    }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    // 声明本地方法</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    public</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> native</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> int</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> add</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> a</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> int</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> b</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    // 测试可否调用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    public</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> static</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> void</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">String</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[]</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> args</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        JNIDemo</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> demo</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> new</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> JNIDemo</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">        int</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> result</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> demo</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">add</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 4</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">        System</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">out</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">println</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Result: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> result</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">    }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>然后使用 <code v-pre>javac JNIDemo.java</code> 进行编译生成 <code v-pre>JNIDemo.class</code>。</p>\n<h2 id=\"_1-6-运行-java-程序\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-6-运行-java-程序\"><span>1.6.运行 Java 程序</span></a></h2>\n<p>确保 <code v-pre>native.dll</code> 文件位于 <code v-pre>Java</code> 可加载的路径中（例如当前目录），然后使用 <code v-pre>java -Djava.library.path=. JNIDemo</code> 来运行 <code v-pre>Java</code> 程序。</p>\n<h1 id=\"_2-jna\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-jna\"><span>2.JNA</span></a></h1>\n<p>这个 <code v-pre>JNA</code> 貌似性能要差一些，待补充...</p>\n<hr>\n<blockquote>\n<p>结语：...</p>\n</blockquote>\n</template>","contentStripped":"<p>[TOC]</p>\n<blockquote>\n<p>概要：...</p>\n</blockquote>\n<blockquote>\n<p>资料：...</p>\n</blockquote>\n<hr>\n<h1 id=\"_1-jni\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-jni\"><span>1.JNI</span></a></h1>\n<h2 id=\"_1-1-设置项目文件结构\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-1-设置项目文件结构\"><span>1.1.设置项目文件结构</span></a></h2>\n<p>假设您的项目结构如下所示，并且都为空白文件。</p>\n<div class=\"language-shell line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"shell\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-shell\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"># 项目结构</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">project/</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> JNIDemo.java</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">├──</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\"> JNIDemo.cpp</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#998418;--shiki-dark:#B8A965\">...</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2 id=\"_1-2-生成-cpp-头文件\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-2-生成-cpp-头文件\"><span>1.2.生成 Cpp 头文件</span></a></h2>\n<p>使用 <code v-pre>javah -jni JNIDemo</code> 工具生成 <code v-pre>Cpp</code> 头文件，生成的头文件 <code v-pre>JNIDemo.h</code> 会包含 <code v-pre>JNI</code> 函数签名。这个文件是用来规范 <code v-pre>Cpp</code> 程序员进行代码实现，<code v-pre>Cpp</code> 程序员需要根据这个头文件来进行源文件的实现。</p>\n<div class=\"language-cpp line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"cpp\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// JNIDemo.h</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">/* DO NOT EDIT THIS FILE - it is machine generated */</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">#</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">jni.h</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">></span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> // 这个头文件其实是 Java 官方提供的实现, 使得 Java 虚拟机能够与本地代码进行交互和通信</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">/* Header for class JNIDemo */</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">#</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">ifndef</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> _Included_JNIDemo</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> // 头文件防护符</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">#</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">define</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> _Included_JNIDemo</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">#</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">ifdef</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> __cplusplus</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> // 处理 C/Cpp 符号表规则不一的问题</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">extern</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">C</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">#</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">endif</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">/*</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> * Class:     JNIDemo</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> * Method:    add</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> * Signature: (II)I</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> // 一种简化的函数签名表达, 参数为 (int, int), 返回值为 int</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> */</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">JNIEXPORT jint JNICALL Java_JNIDemo_add</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">  (</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">JNIEnv </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> jobject</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> jint</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> jint</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// JNIEXPORT 宏用于标记一个函数是 JNI 的本地方法</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// JNICALL 宏用于标记 JNI 方法的调用约定, 确保在不同平台上的兼容性</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// 抽离上述的宏, 剩下的 jint Java_JNIDemo_add(JNIEnv *, jobject, jint, jint) 就是比较好理解的函数签名</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    // 函数名中 Java 表示这是一个 JNI 方法; JNIDemo 表示指定了这个 JNI 方法属于哪个 Java 类; add 表示 Java 类中方法的名称</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    // JNIEnv*: 是一个指向 JNI 环境的指针, 提供了访问 JNI API 的方法</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    // jobject: 是一个指向调用 JNI 方法的 Java 对象的引用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    // jint: \t是 JNI 中定义的基本类型, 表示 Java 的 int 类型</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">#</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">ifdef</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> __cplusplus</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">#</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">endif</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">#</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">endif</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><blockquote>\n<p>补充：关于 <code v-pre>JNIEnv*</code> 和 <code v-pre>jobject</code> 的使用，待补充...</p>\n</blockquote>\n<h2 id=\"_1-3-编写-cpp-程序实现\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-3-编写-cpp-程序实现\"><span>1.3.编写 Cpp 程序实现</span></a></h2>\n<div class=\"language-cpp line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"cpp\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-cpp\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// JNIDemo.cpp</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">#</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> &#x3C;</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">jni.h</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">></span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">#</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">include</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">JNIDemo.h</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">JNIEXPORT jint JNICALL </span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">Java_JNIDemo_add</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">JNIEnv </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">env</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> jobject obj</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> jint a</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> jint b</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> a </span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> b</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2 id=\"_1-4-生成本地-dll-动态库\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-4-生成本地-dll-动态库\"><span>1.4.生成本地 DLL 动态库</span></a></h2>\n<p>使用 <code v-pre>g++ -shared -o native.dll -I &quot;%JAVA_HOME%\\include&quot; -I &quot;%JAVA_HOME%\\include\\win32&quot; JNIDemo.cpp</code> 编译 <code v-pre>Cpp</code> 源文件生成 <code v-pre>DLL</code> 动态库。</p>\n<blockquote>\n<p>补充：在 <code v-pre>Linux</code> 中就是 <code v-pre>g++ -shared -fpic -o libnative.so -I${JAVA_HOME}/include -I${JAVA_HOME}/include/linux JNIDemo.cpp</code>，不过我没有尝试过，待补充...</p>\n</blockquote>\n<h2 id=\"_1-5-编写-java-程序逻辑\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-5-编写-java-程序逻辑\"><span>1.5.编写 Java 程序逻辑</span></a></h2>\n<div class=\"language-java line-numbers-mode\" data-highlighter=\"shiki\" data-ext=\"java\" style=\"--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212\"><pre class=\"shiki shiki-themes vitesse-light vitesse-dark vp-code\" v-pre=\"\"><code class=\"language-java\"><span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">// JNIDemo.java</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">public</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> class</span><span style=\"--shiki-light:#2E8F82;--shiki-dark:#5DA994\"> JNIDemo</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    // 加载本地的库</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    static</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">        System</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">loadLibrary</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">native</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\"> // 对应于 native.dll</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">    }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">    </span></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    // 声明本地方法</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    public</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> native</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> int</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> add</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">int</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> a</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> int</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> b</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"--shiki-light:#A0ADA0;--shiki-dark:#758575DD\">    // 测试可否调用</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">    public</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> static</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> void</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> main</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">String</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">[]</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> args</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">)</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> {</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\">        JNIDemo</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> demo</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#1E754F;--shiki-dark:#4D9375\"> new</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\"> JNIDemo</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">();</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\">        int</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> result</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\"> =</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\"> demo</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">add</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">,</span><span style=\"--shiki-light:#2F798A;--shiki-dark:#4C9A91\"> 4</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">        System</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#B07D48;--shiki-dark:#BD976A\">out</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">.</span><span style=\"--shiki-light:#59873A;--shiki-dark:#80A665\">println</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">(</span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#B56959;--shiki-dark:#C98A7D\">Result: </span><span style=\"--shiki-light:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"--shiki-light:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"--shiki-light:#393A34;--shiki-dark:#DBD7CAEE\"> result</span><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">);</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">    }</span></span>\n<span class=\"line\"><span style=\"--shiki-light:#999999;--shiki-dark:#666666\">}</span></span></code></pre>\n<div class=\"line-numbers\" aria-hidden=\"true\" style=\"counter-reset:line-number 0\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>然后使用 <code v-pre>javac JNIDemo.java</code> 进行编译生成 <code v-pre>JNIDemo.class</code>。</p>\n<h2 id=\"_1-6-运行-java-程序\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_1-6-运行-java-程序\"><span>1.6.运行 Java 程序</span></a></h2>\n<p>确保 <code v-pre>native.dll</code> 文件位于 <code v-pre>Java</code> 可加载的路径中（例如当前目录），然后使用 <code v-pre>java -Djava.library.path=. JNIDemo</code> 来运行 <code v-pre>Java</code> 程序。</p>\n<h1 id=\"_2-jna\" tabindex=\"-1\"><a class=\"header-anchor\" href=\"#_2-jna\"><span>2.JNA</span></a></h1>\n<p>这个 <code v-pre>JNA</code> 貌似性能要差一些，待补充...</p>\n<hr>\n<blockquote>\n<p>结语：...</p>\n</blockquote>\n","tagOpen":"<template>","tagClose":"</template>"},"script":null,"scriptSetup":null,"scripts":[],"styles":[],"customBlocks":[]},"content":"[TOC]\n\n>   概要：...\n\n>   资料：...\n\n---\n\n# 1.JNI\n\n## 1.1.设置项目文件结构\n\n假设您的项目结构如下所示，并且都为空白文件。\n\n```shell\n# 项目结构\nproject/\n├── JNIDemo.java\n├── JNIDemo.cpp\n...\n```\n\n## 1.2.生成 Cpp 头文件\n\n使用 `javah -jni JNIDemo` 工具生成 `Cpp` 头文件，生成的头文件 `JNIDemo.h` 会包含 `JNI` 函数签名。这个文件是用来规范 `Cpp` 程序员进行代码实现，`Cpp` 程序员需要根据这个头文件来进行源文件的实现。\n\n```cpp\n// JNIDemo.h\n/* DO NOT EDIT THIS FILE - it is machine generated */\n#include <jni.h> // 这个头文件其实是 Java 官方提供的实现, 使得 Java 虚拟机能够与本地代码进行交互和通信\n/* Header for class JNIDemo */\n\n#ifndef _Included_JNIDemo // 头文件防护符\n#define _Included_JNIDemo\n\n#ifdef __cplusplus // 处理 C/Cpp 符号表规则不一的问题\nextern \"C\" {\n#endif\n    \n/*\n * Class:     JNIDemo\n * Method:    add\n * Signature: (II)I // 一种简化的函数签名表达, 参数为 (int, int), 返回值为 int\n */\nJNIEXPORT jint JNICALL Java_JNIDemo_add\n  (JNIEnv *, jobject, jint, jint);\n    \n// JNIEXPORT 宏用于标记一个函数是 JNI 的本地方法\n// JNICALL 宏用于标记 JNI 方法的调用约定, 确保在不同平台上的兼容性\n// 抽离上述的宏, 剩下的 jint Java_JNIDemo_add(JNIEnv *, jobject, jint, jint) 就是比较好理解的函数签名\n    // 函数名中 Java 表示这是一个 JNI 方法; JNIDemo 表示指定了这个 JNI 方法属于哪个 Java 类; add 表示 Java 类中方法的名称\n    // JNIEnv*: 是一个指向 JNI 环境的指针, 提供了访问 JNI API 的方法\n    // jobject: 是一个指向调用 JNI 方法的 Java 对象的引用\n    // jint: \t是 JNI 中定义的基本类型, 表示 Java 的 int 类型\n\n#ifdef __cplusplus\n}\n#endif\n\n#endif\n```\n\n>   补充：关于 `JNIEnv*` 和 `jobject` 的使用，待补充...\n\n## 1.3.编写 Cpp 程序实现\n\n```cpp\n// JNIDemo.cpp\n#include <jni.h>\n#include \"JNIDemo.h\"\n\nJNIEXPORT jint JNICALL Java_JNIDemo_add(JNIEnv *env, jobject obj, jint a, jint b) {\n    return a + b;\n}\n```\n\n## 1.4.生成本地 DLL 动态库\n\n使用 `g++ -shared -o native.dll -I \"%JAVA_HOME%\\include\" -I \"%JAVA_HOME%\\include\\win32\" JNIDemo.cpp` 编译 `Cpp` 源文件生成 `DLL` 动态库。\n\n>   补充：在 `Linux` 中就是 `g++ -shared -fpic -o libnative.so -I${JAVA_HOME}/include -I${JAVA_HOME}/include/linux JNIDemo.cpp`，不过我没有尝试过，待补充...\n\n## 1.5.编写 Java 程序逻辑\n\n```java\n// JNIDemo.java\npublic class JNIDemo {\n    // 加载本地的库\n    static {\n        System.loadLibrary(\"native\"); // 对应于 native.dll\n    }\n    \n    // 声明本地方法\n    public native int add(int a, int b);\n\n    // 测试可否调用\n    public static void main(String[] args) {\n        JNIDemo demo = new JNIDemo();\n        int result = demo.add(3, 4);\n        System.out.println(\"Result: \" + result);\n    }\n}\n```\n\n然后使用 `javac JNIDemo.java` 进行编译生成 `JNIDemo.class`。\n\n## 1.6.运行 Java 程序\n\n确保 `native.dll` 文件位于 `Java` 可加载的路径中（例如当前目录），然后使用 `java -Djava.library.path=. JNIDemo` 来运行 `Java` 程序。\n\n# 2.JNA\n\n这个 `JNA` 貌似性能要差一些，待补充...\n\n---\n\n>   结语：...","excerpt":"","includedFiles":[],"tasklistId":0,"title":"1.JNI","headers":[{"level":2,"title":"1.1.设置项目文件结构","slug":"_1-1-设置项目文件结构","link":"#_1-1-设置项目文件结构","children":[]},{"level":2,"title":"1.2.生成 Cpp 头文件","slug":"_1-2-生成-cpp-头文件","link":"#_1-2-生成-cpp-头文件","children":[]},{"level":2,"title":"1.3.编写 Cpp 程序实现","slug":"_1-3-编写-cpp-程序实现","link":"#_1-3-编写-cpp-程序实现","children":[]},{"level":2,"title":"1.4.生成本地 DLL 动态库","slug":"_1-4-生成本地-dll-动态库","link":"#_1-4-生成本地-dll-动态库","children":[]},{"level":2,"title":"1.5.编写 Java 程序逻辑","slug":"_1-5-编写-java-程序逻辑","link":"#_1-5-编写-java-程序逻辑","children":[]},{"level":2,"title":"1.6.运行 Java 程序","slug":"_1-6-运行-java-程序","link":"#_1-6-运行-java-程序","children":[]}]}}
